/*! For license information please see index.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.wwtlib=t():e.wwtlib=t()}(this,(()=>(()=>{"use strict";var __webpack_modules__={495:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function _ss(){function _nop(){}function isValue(e){return null!=e}function _value(e){for(var t=2,i=e.length;t<i;t++)if(isValue(e[t]))return e[t];return null}function value(e,t){return isValue(e)?e:isValue(t)?t:_value(arguments)}function extend(e,t){for(var i in t)e[i]=t[i];return e}function parseBoolean(e){return"true"==e.toLowerCase()}function parseRegExp(e){if("/"==e[0]){var t=e.lastIndexOf("/");if(t>1){var i=e.substring(1,t),r=e.substr(t+1);return new RegExp(i,r)}}return null}function parseNumber(e){return e&&e.length?e.indexOf(".")>=0||e.indexOf("e")>=0||endsWith(e,"f")||endsWith(e,"F")?parseFloat(e):parseInt(e,10):0}function parseDate(e){var t=Date.parse(e);return isNaN(t)?void 0:new Date(t)}function truncate(e){return e>=0?Math.floor(e):Math.ceil(e)}function now(){return new Date}function today(){var e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function compareDates(e,t){return e===t||!(!isValue(e)||!isValue(t))&&e.getTime()==t.getTime()}function _popStackFrame(e){if(isValue(e.stack)&&isValue(e.fileName)&&isValue(e.lineNumber)){for(var t=e.stack.split("\n"),i=t[0],r=e.fileName+":"+e.lineNumber;isValue(i)&&-1===i.indexOf(r);)t.shift(),i=t[0];var n=t[1];if(isValue(n)){var s=n.match(/@(.*):(\d+)$/);isValue(s)&&(t.shift(),e.stack=t.join("\n"),e.fileName=s[1],e.lineNumber=parseInt(s[2],10))}}}function error(e,t,i){var r=new Error(e);if(t)for(var n in t)r[n]=t[n];return i&&(r.innerException=i),_popStackFrame(r),r}function fail(message){console.assert(!1,message),globalThis.navigator&&eval("debugger;")}function toArray(e){return e?"string"==typeof e?JSON.parse("("+e+")"):Array.prototype.slice.call(e):null}function removeItem(e,t){var i=e.indexOf(t);return i>=0&&(e.splice(i,1),!0)}function clearKeys(e){for(var t in e)delete e[t]}function keyExists(e,t){return void 0!==e[t]}function keys(e){if(Object.keys)return Object.keys(e);var t=[];for(var i in e)t.push(i);return t}function keyCount(e){return keys(e).length}function Enumerator(e,t){var i=-1,r=t?t.length:e.length,n=t?function(){return{key:t[i],value:e[t[i]]}}:function(){return e[i]};this.current=null,this.moveNext=function(){return i++,this.current=n(),i<r},this.reset=function(){i=-1,this.current=null}}var _nopEnumerator={current:null,moveNext:function(){return!1},reset:_nop};function enumerate(e){return isValue(e)?e.getEnumerator?e.getEnumerator():void 0!==e.length?new Enumerator(e):new Enumerator(e,keys(e)):_nopEnumerator}function Stack(){this.count=0,this._items=[]}var Stack$={clear:function(){this._items.length=0,this.count=0},contains:function(e){for(var t=this.count-1;t>=0;t--)if(this._items[t]===e)return!0;return!1},getEnumerator:function(){return new Enumerator(this._items.reverse())},peek:function(){return this._items[this.count-1]},push:function(e){this._items.push(e),this.count++},pop:function(){if(this.count)return this.count--,this._items.pop()}};function Queue(){this.count=0,this._items=[],this._offset=0}function _cleanQueue(e){e._items=e._items.slice(e._offset),e._offset=0}var Queue$={clear:function(){this._items.length=0,this._offset=0,this.count=0},contains:function(e){for(var t=this._offset,i=this._items.length;t<=i;t++)if(this._items[t]===e)return!0;return!1},dequeue:function(){if(this.count){var e=this._items[this._offset];return 2*++this._offset>=this._items.length&&_cleanQueue(this),this.count--,e}},enqueue:function(e){this._items.push(e),this.count++},getEnumerator:function(){return 0!=this._offset&&_cleanQueue(this),new Enumerator(this._items)},peek:function(){return this._items.length?this._items[this._offset]:void 0}};function string(e,t){return"number"==typeof t?t>1?new Array(t+1).join(e):e:Array.prototype.join.call(arguments,"")}function emptyString(e){return!e||!e.length}function whitespace(e){return emptyString(e)||!e.replace(/^\s*/,"").length}function compareStrings(e,t,i){return e=e||"",t=t||"",i&&(e=e.toUpperCase(),t=t.toUpperCase()),e===t?0:e<t?-1:1}var _formatPlaceHolderRE=/(\{[^}^{]+\})/g,_formatters={};function format(e){var t=neutralCulture,i=e,r=Array.prototype.slice.call(arguments,1);return e.constructor!=String&&(t=e,i=r[0],r=r.slice(1)),i.replace(_formatPlaceHolderRE,(function(e,i){var n=parseInt(i.substr(1),10),s=r[n];if(!isValue(s))return"";var a=_formatters[typeName(s)];if(a){var o="",l=i.indexOf(":");if(l>0&&(o=i.substring(l+1,i.length-1)),o&&"i"!=o)return a(s,o,t)}return t==neutralCulture?s.toString():s.toLocaleString()}))}function trim(e,t){if(t||!String.prototype.trim){var i=(t=t?t.join(""):null)?new RegExp("^["+t+"]+|["+t+"]+$","g"):/^\s+|\s+$/g;return e.replace(i,"")}return e.trim()}function trimStart(e,t){var i=t?new RegExp("^["+t.join("")+"]+"):/^\s+/;return e.replace(i,"")}function trimEnd(e,t){var i=t?new RegExp("["+t.join("")+"]+$"):/\s+$/;return e.replace(i,"")}function startsWith(e,t){return!!emptyString(t)||!(emptyString(e)||t.length>e.length)&&e.substr(0,t.length)==t}function endsWith(e,t){return!!emptyString(t)||!(emptyString(e)||t.length>e.length)&&e.substr(-t.length)==t}function padLeft(e,t,i){return e.length<t?string(i||" ",t-e.length)+e:e}function padRight(e,t,i){return e.length<t?e+string(i||" ",t-e.length):e}function removeString(e,t,i){return!i||t+i>e.length?e.substr(0,t):e.substr(0,t)+e.substr(t+i)}function insertString(e,t,i){return i?t?e.substr(0,t)+i+e.substr(t):i+e:e}function replaceString(e,t,i){return e.split(t).join(i||"")}function _bindList(e){var t=function(){for(var t=arguments,i=null,r=0,n=e.length;r<n;r++)i=t.length?e[r].apply(null,t):e[r].call(null);return i};return t._fnList=e,t}function bind(e,t){if(!t)return e;var i=null;e="string"==typeof e?t[i=e]:e;var r=i?t.$$b||(t.$$b={}):null,n=r?r[i]:null;return n||(n=function(){return e.apply(t,arguments)},r&&(r[i]=n)),n}function bindAdd(e,t){return e?t?_bindList([].concat(e._fnList||e,t)):e:t}function bindSub(e,t){if(!e)return null;if(!t)return e;var i=e._fnList||[e],r=i.indexOf(t);return r>=0?1==i.length?null:_bindList(i=r?i.slice(0,r).concat(i.slice(r+1)):i.slice(1)):e}function bindExport(e,t,i,r){i=i||"__"+(new Date).valueOf(),r=r||globalThis;var n={name:i,detach:function(){r[i]=_nop},dispose:function(){try{delete r[i]}catch(e){r[i]=void 0}}};return r[i]=t?e:function(){return n.dispose(),e.apply(null,arguments)},n}function EventArgs(){}function CancelEventArgs(){this.cancel=!1}function IDisposable(){}function IEnumerable(){}function IEnumerator(){}function IObserver(){}function IApplication(){}function IContainer(){}function IObjectFactory(){}function IEventManager(){}function IInitializable(){}function StringBuilder(e){this._parts=isValue(e)&&""!==e?[e]:[],this.isEmpty=0==this._parts.length}EventArgs.Empty=new EventArgs;var StringBuilder$={append:function(e){return isValue(e)&&""!==e&&(this._parts.push(e),this.isEmpty=!1),this},appendLine:function(e){return this.append(e),this.append("\r\n"),this.isEmpty=!1,this},clear:function(){this._parts=[],this.isEmpty=!0},toString:function(e){return this._parts.join(e||"")}},_observerStack=[],_observerRegistration={dispose:function(){_observerStack.pop()}};function _captureObservers(e){var t=_observerStack,i=t.length;if(i){e=e||[];for(var r=0;r<i;r++){var n=t[r];e.indexOf(n)<0&&e.push(n)}return e}return null}function _invalidateObservers(e){for(var t=0,i=e.length;t<i;t++)e[t].invalidateObserver()}function Observable(e){this._v=e,this._observers=null}var Observable$={getValue:function(){return this._observers=_captureObservers(this._observers),this._v},setValue:function(e){if(this._v!==e){this._v=e;var t=this._observers;t&&(this._observers=null,_invalidateObservers(t))}}};function ObservableCollection(e){this._items=e||[],this._observers=null}Observable.registerObserver=function(e){return _observerStack.push(e),_observerRegistration};var ObservableCollection$={get_item:function(e){return this._observers=_captureObservers(this._observers),this._items[e]},set_item:function(e,t){this._items[e]=t,this._updated()},get_length:function(){return this._observers=_captureObservers(this._observers),this._items.length},add:function(e){this._items.push(e),this._updated()},clear:function(){this._items.clear(),this._updated()},contains:function(e){return this._items.indexOf(e)>=0},getEnumerator:function(){return this._observers=_captureObservers(this._observers),this._items.getEnumerator()},indexOf:function(e){return this._items.indexOf(e)},insert:function(e,t){this._items.insert(e,t),this._updated()},remove:function(e){return!!this._items.remove(e)&&(this._updated(),!0)},removeAt:function(e){this._items.splice(e,1),this._updated()},toArray:function(){return this._items},_updated:function(){var e=this._observers;e&&(this._observers=null,_invalidateObservers(e))}};function Task(e){this._continuations=void 0!==e?(this.status="done",null):(this.status="pending",[]),this.result=e,this.error=null}var Task$={get_completed:function(){return"pending"!=this.status},changeWith:function(e){var t=new Task;return this.continueWith((function(i){var r,n=i.error;if(!n)try{r=e(i)}catch(e){n=e}_updateTask(t,r,n)})),t},continueWith:function(e){if(this._continuations)this._continuations.push(e);else{var t=this;setTimeout((function(){e(t)}),0)}return this},done:function(e){return this.continueWith((function(t){"done"==t.status&&e(t.result)}))},fail:function(e){return this.continueWith((function(t){"failed"==t.status&&e(t.error)}))},then:function(e,t){return this.continueWith((function(i){"done"==i.status?e(i.result):t(i.error)}))}};function _updateTask(e,t,i){if("pending"==e.status){i?(e.error=i,e.status="failed"):(e.result=t,e.status="done");var r=e._continuations;e._continuations=null;for(var n=0,s=r.length;n<s;n++)r[n](e)}}function _joinTasks(e,t){var i=(e=toArray(e)).length,r=0;i>1&&"number"==typeof e[0]&&(r=e[0],e=e.slice(1),i--),Array.isArray(e[0])&&(e=e[0],i=e.length);var n=new Task,s=0;function a(e){"pending"==n.status&&(s++,t?_updateTask(n,e):s==i&&_updateTask(n,!0))}0!=r&&setTimeout((function(){"pending"==n.status&&_updateTask(n,!!t&&null)}),r);for(var o=0;o<i;o++)e[o].continueWith(a);return n}function deferred(e){var t=new Task(e);return{task:t,resolve:function(e){_updateTask(t,e)},reject:function(e){_updateTask(t,null,e||new Error)}}}Task.all=function(){return _joinTasks(arguments,!1)},Task.any=function(){return _joinTasks(arguments,!0)},Task.delay=function(e){var t=new Task;return setTimeout((function(){_updateTask(t,!0)}),e),t};var neutralCulture={name:"",nf:{nan:"NaN",neg:"-",pos:"+",negInf:"-Infinity",posInf:"Infinity",gw:[3],dd:2,ds:".",gs:",",per:"%",perGW:[3],perDD:2,perDS:".",perGS:",",perPP:"{0} %",perNP:"-{0} %",cur:"$",curGW:[3],curDD:2,curDS:".",curGS:",",curNP:"(${0})",curPP:"${0}"},dtf:{am:"AM",pm:"PM",ds:"/",ts:":",gmt:"ddd, dd MMM yyyy HH:mm:ss 'GMT'",uni:"yyyy-MM-dd HH:mm:ssZ",sort:"yyyy-MM-ddTHH:mm:ss",dt:"dddd, MMMM dd, yyyy h:mm:ss tt",ld:"dddd, MMMM dd, yyyy",sd:"M/d/yyyy",lt:"h:mm:ss tt",st:"h:mm tt",day0:0,day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],sday:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],mday:["Su","Mo","Tu","We","Th","Fr","Sa"],mon:["January","February","March","April","May","June","July","August","September","October","November","December",""],smon:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec",""]}},currentCulture={name:"en-us",dtf:neutralCulture.dtf,nf:neutralCulture.nf};function _commaFormatNumber(e,t,i,r){var n=null,s=e.indexOf(i);s>0&&(n=e.substr(s),e=e.substr(0,s));var a=e.startsWith("-");a&&(e=e.substr(1));var o=0,l=t[o];if(e.length<l)return n?e+n:e;for(var h=e.length,c="",u=!1;!u;){var d=l,_=h-d;if(_<0&&(l+=_,d+=_,_=0,u=!0),!d)break;var g=e.substr(_,d);c=c.length?g+r+c:g,h-=d,o<t.length-1&&(l=t[++o])}return a&&(c="-"+c),n?c+n:c}_formatters.Number=function(e,t,i){var r=i.nf,n="",s=-1;t.length>1&&(s=parseInt(t.substr(1)));var a=t.charAt(0);switch(a){case"d":case"D":n=parseInt(Math.abs(e)).toString(),-1!=s&&(n=padLeft(n,s,"0")),e<0&&(n="-"+n);break;case"x":case"X":n=parseInt(Math.abs(e)).toString(16),"X"==a&&(n=n.toUpperCase()),-1!=s&&(n=padLeft(n,s,"0"));break;case"e":case"E":n=-1==s?e.toExponential():e.toExponential(s),"E"==a&&(n=n.toUpperCase());break;case"f":case"F":case"n":case"N":if(-1==s&&(s=r.dd),n=e.toFixed(s).toString(),s&&"."!=r.ds){var o=n.indexOf(".");n=n.substr(0,o)+r.ds+n.substr(o+1)}"n"!=a&&"N"!=a||(n=_commaFormatNumber(n,r.gw,r.ds,r.gs));break;case"c":case"C":-1==s&&(s=r.curDD),n=Math.abs(e).toFixed(s).toString(),s&&"."!=r.curDS&&(o=n.indexOf("."),n=n.substr(0,o)+r.curDS+n.substr(o+1)),n=_commaFormatNumber(n,r.curGW,r.curDS,r.curGS),n=e<0?String.format(i,r.curNP,n):String.format(i,r.curPP,n);break;case"p":case"P":-1==s&&(s=r.perDD),n=(100*Math.abs(e)).toFixed(s).toString(),s&&"."!=r.perDS&&(o=n.indexOf("."),n=n.substr(0,o)+r.perDS+n.substr(o+1)),n=_commaFormatNumber(n,r.perGW,r.perDS,r.perGS),n=e<0?String.format(i,r.perNP,n):String.format(i,r.perPP,n)}return n};var _dateFormatRE=/'.*?[^\\]'|dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|y|hh|h|HH|H|mm|m|ss|s|tt|t|fff|ff|f|zzz|zz|z/g;_formatters.Date=function(e,t,i){if("iso"==t)return e.toISOString();if("i"==t.charAt(0)){var r="String";switch(t){case"id":r="DateString";break;case"it":r="TimeString"}return i==neutralCulture?e["to"+r]():e["toLocale"+r]()}var n=i.dtf;if(1==t.length)switch(t){case"f":t=n.ld+" "+n.st;break;case"F":t=n.dt;break;case"d":t=n.sd;break;case"D":t=n.ld;break;case"t":t=n.st;break;case"T":t=n.lt;break;case"g":t=n.sd+" "+n.st;break;case"G":t=n.sd+" "+n.lt;break;case"R":case"r":t=(n=neutralCulture.dtf).gmt;break;case"u":t=n.uni;break;case"U":t=n.dt,e=new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds());break;case"s":t=n.sort}"%"==t.charAt(0)&&(t=t.substr(1));var s=new StringBuilder;for(_dateFormatRE.lastIndex=0;;){var a=_dateFormatRE.lastIndex,o=_dateFormatRE.exec(t);if(s.append(t.slice(a,o?o.index:t.length)),!o)break;var l=o[0],h=l;switch(l){case"dddd":h=n.day[e.getDay()];break;case"ddd":h=n.sday[e.getDay()];break;case"dd":h=padLeft(e.getDate().toString(),2,"0");break;case"d":h=e.getDate();break;case"MMMM":h=n.mon[e.getMonth()];break;case"MMM":h=n.smon[e.getMonth()];break;case"MM":h=padLeft((e.getMonth()+1).toString(),2,"0");break;case"M":h=e.getMonth()+1;break;case"yyyy":h=e.getFullYear();break;case"yy":h=padLeft((e.getFullYear()%100).toString(),2,"0");break;case"y":h=e.getFullYear()%100;break;case"h":case"hh":(h=e.getHours()%12)?"hh"==l&&(h=padLeft(h.toString(),2,"0")):h="12";break;case"HH":h=padLeft(e.getHours().toString(),2,"0");break;case"H":h=e.getHours();break;case"mm":h=padLeft(e.getMinutes().toString(),2,"0");break;case"m":h=e.getMinutes();break;case"ss":h=padLeft(e.getSeconds().toString(),2,"0");break;case"s":h=e.getSeconds();break;case"t":case"tt":h=e.getHours()<12?n.am:n.pm,"t"==l&&(h=h.charAt(0));break;case"fff":h=padLeft(e.getMilliseconds().toString(),3,"0");break;case"ff":h=padLeft(e.getMilliseconds().toString(),3).substr(0,2);break;case"f":h=padLeft(e.getMilliseconds().toString(),3).charAt(0);break;case"z":h=((h=e.getTimezoneOffset()/60)>=0?"-":"+")+Math.floor(Math.abs(h));break;case"zz":case"zzz":h=((h=e.getTimezoneOffset()/60)>=0?"-":"+")+padLeft(Math.floor(Math.abs(h)).toString(),2,"0"),"zzz"==l&&(h+=n.ts+padLeft(Math.abs(e.getTimezoneOffset()%60).toString(),2,"0"));break;default:"'"==h.charAt(0)&&(h=h.substr(1,h.length-2).replace(/\\'/g,"'"))}s.append(h)}return s.toString()};var _modules={},_classMarker="class",_interfaceMarker="interface";function createType(e,t,i){if(Array.isArray(t)){var r=t[0];if(t.length>=2){var n=t[2];if(n){var s=function(){};s.prototype=n.prototype,r.prototype=new s,r.prototype.constructor=r}t[1]&&extend(r.prototype,t[1]),r.$base=n||Object,r.$interfaces=t.slice(3),r.$type=_classMarker}else r.$type=_interfaceMarker;return r.$name=e,i[e]=r}return t}function isClass(e){return e.$type==_classMarker}function isInterface(e){return e.$type==_interfaceMarker}function typeOf(e){var t;try{t=e.constructor}catch(e){}return t||Object}function type(e){var t=e.indexOf("."),i=t>0?_modules[e.substr(0,t)]:globalThis,r=t>0?e.substr(t+1):e;return i?i[r]:null}var _typeNames=[Number,"Number",String,"String",Boolean,"Boolean",Array,"Array",Date,"Date",RegExp,"RegExp",Function,"Function"];function typeName(e){if(e instanceof Function||(e=e.constructor),e.$name)return e.$name;if(e.name)return e.name;for(var t=0,i=_typeNames.length;t<i;t+=2)if(e==_typeNames[t])return _typeNames[t+1];return"Object"}function canAssign(e,t){if(e==Object||e==t)return!0;if(e.$type==_classMarker)for(var i=t.$base;i;){if(e==i)return!0;i=i.$base}else if(e.$type==_interfaceMarker)for(i=t;i;){var r=i.$interfaces;if(r&&r.indexOf(e)>=0)return!0;i=i.$base}return!1}function instanceOf(e,t){return!!isValue(t)&&(e==Object||t instanceof e||canAssign(e,typeOf(t)))}function canCast(e,t){return instanceOf(t,e)}function safeCast(e,t){return instanceOf(t,e)?e:null}function ss_module(e,t,i){var r=_modules[e]={$name:e};if(t)for(var n in t)createType(n,t[n],r);var s={};if(i)for(var n in i)s[n]=createType(n,i[n],r);return s}function createRegistry(e){return _modules[e]={$name:e}}return extend(ss_module("ss",null,{IDisposable:[IDisposable],IEnumerable:[IEnumerable],IEnumerator:[IEnumerator],IObserver:[IObserver],IApplication:[IApplication],IContainer:[IContainer],IObjectFactory:[IObjectFactory],IEventManager:[IEventManager],IInitializable:[IInitializable],EventArgs:[EventArgs,{}],CancelEventArgs:[CancelEventArgs,{},EventArgs],StringBuilder:[StringBuilder,StringBuilder$],Stack:[Stack,Stack$],Queue:[Queue,Queue$],Observable:[Observable,Observable$],ObservableCollection:[ObservableCollection,ObservableCollection$,null,IEnumerable],Task:[Task,Task$]}),{version:"0.8",isValue,value,extend,keys,keyCount,keyExists,clearKeys,enumerate,array:toArray,remove:removeItem,boolean:parseBoolean,regexp:parseRegExp,number:parseNumber,date:parseDate,truncate,now,today,compareDates,error,string,emptyString,whitespace,format,compareStrings,startsWith,endsWith,padLeft,padRight,trim,trimStart,trimEnd,insertString,removeString,replaceString,bind,bindAdd,bindSub,bindExport,deferred,module:ss_module,modules:_modules,createRegistry,createType,isClass,isInterface,typeOf,type,typeName,canCast,safeCast,canAssign,instanceOf,culture:{neutral:neutralCulture,current:currentCulture},fail})}__webpack_require__.d(__webpack_exports__,{ss:()=>ss});var ss=_ss()},48:(e,t,i)=>{var r={};(0,i(937).assign)(r,i(579),i(399),i(717)),e.exports=r},579:(e,t,i)=>{var r=i(679),n=i(937),s=i(832),a=i(990),o=i(222),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function _(e){if(!(this instanceof _))return new _(e);this.options=n.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==h)throw new Error(a[i]);if(t.header&&r.deflateSetHeader(this.strm,t.header),t.dictionary){var g;if(g="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=r.deflateSetDictionary(this.strm,g))!==h)throw new Error(a[i]);this._dict_set=!0}}function g(e,t){var i=new _(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}_.prototype.push=function(e,t){var i,a,o=this.strm,c=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?o.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?o.input=new Uint8Array(e):o.input=e,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new n.Buf8(c),o.next_out=0,o.avail_out=c),1!==(i=r.deflate(o,a))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(s.buf2binstring(n.shrinkBuf(o.output,o.next_out))):this.onData(n.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&1!==i);return 4===a?(i=r.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==a||(this.onEnd(h),o.avail_out=0,!0)},_.prototype.onData=function(e){this.chunks.push(e)},_.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=_,t.deflate=g,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,g(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,g(e,t)}},399:(e,t,i)=>{var r=i(347),n=i(937),s=i(832),a=i(717),o=i(990),l=i(222),h=i(738),c=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=n.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=r.inflateInit2(this.strm,t.windowBits);if(i!==a.Z_OK)throw new Error(o[i]);if(this.header=new h,r.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=r.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(o[i])}function d(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg||o[i.err];return i.result}u.prototype.push=function(e,t){var i,o,l,h,u,d=this.strm,_=this.options.chunkSize,g=this.options.dictionary,f=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?d.input=s.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?d.input=new Uint8Array(e):d.input=e,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new n.Buf8(_),d.next_out=0,d.avail_out=_),(i=r.inflate(d,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g&&(i=r.inflateSetDictionary(this.strm,g)),i===a.Z_BUF_ERROR&&!0===f&&(i=a.Z_OK,f=!1),i!==a.Z_STREAM_END&&i!==a.Z_OK)return this.onEnd(i),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&i!==a.Z_STREAM_END&&(0!==d.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(l=s.utf8border(d.output,d.next_out),h=d.next_out-l,u=s.buf2string(d.output,l),d.next_out=h,d.avail_out=_-h,h&&n.arraySet(d.output,d.output,l,h,0),this.onData(u)):this.onData(n.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(f=!0)}while((d.avail_in>0||0===d.avail_out)&&i!==a.Z_STREAM_END);return i===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(i=r.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),d.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},937:(e,t)=>{var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(e[n]=i[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var s=0;s<r;s++)e[n+s]=t[i+s]},flattenChunks:function(e){var t,i,r,n,s,a;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(a=new Uint8Array(r),n=0,t=0,i=e.length;t<i;t++)s=e[t],a.set(s,n),n+=s.length;return a}},s={arraySet:function(e,t,i,r,n){for(var s=0;s<r;s++)e[n+s]=t[i+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,n)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(i)},832:(e,t,i)=>{var r=i(937),n=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){n=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var a=new r.Buf8(256),o=0;o<256;o++)a[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;function l(e,t){if(t<65534&&(e.subarray&&s||!e.subarray&&n))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var i="",a=0;a<t;a++)i+=String.fromCharCode(e[a]);return i}a[254]=a[254]=1,t.string2buf=function(e){var t,i,n,s,a,o=e.length,l=0;for(s=0;s<o;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new r.Buf8(l),a=0,s=0;a<l;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<o&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new r.Buf8(e.length),i=0,n=t.length;i<n;i++)t[i]=e.charCodeAt(i);return t},t.buf2string=function(e,t){var i,r,n,s,o=t||e.length,h=new Array(2*o);for(r=0,i=0;i<o;)if((n=e[i++])<128)h[r++]=n;else if((s=a[n])>4)h[r++]=65533,i+=s-1;else{for(n&=2===s?31:3===s?15:7;s>1&&i<o;)n=n<<6|63&e[i++],s--;s>1?h[r++]=65533:n<65536?h[r++]=n:(n-=65536,h[r++]=55296|n>>10&1023,h[r++]=56320|1023&n)}return l(h,r)},t.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+a[e[i]]>t?i:t}},697:e=>{e.exports=function(e,t,i,r){for(var n=65535&e|0,s=e>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{s=s+(n=n+t[r++]|0)|0}while(--a);n%=65521,s%=65521}return n|s<<16|0}},717:e=>{e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},731:e=>{var t=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();e.exports=function(e,i,r,n){var s=t,a=n+r;e^=-1;for(var o=n;o<a;o++)e=e>>>8^s[255&(e^i[o])];return-1^e}},679:(e,t,i)=>{var r,n=i(937),s=i(805),a=i(697),o=i(731),l=i(990),h=0,c=0,u=-2,d=2,_=8,g=286,f=30,m=19,p=2*g+1,C=15,S=3,w=258,T=w+S+1,y=42,b=103,v=113,M=666;function x(e,t){return e.msg=l[t],t}function L(e){return(e<<1)-(e>4?9:0)}function A(e){for(var t=e.length;--t>=0;)e[t]=0}function V(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(n.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function P(e,t){s._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,V(e.strm)}function E(e,t){e.pending_buf[e.pending++]=t}function I(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function R(e,t){var i,r,n=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,l=e.strstart>e.w_size-T?e.strstart-(e.w_size-T):0,h=e.window,c=e.w_mask,u=e.prev,d=e.strstart+w,_=h[s+a-1],g=h[s+a];e.prev_length>=e.good_match&&(n>>=2),o>e.lookahead&&(o=e.lookahead);do{if(h[(i=t)+a]===g&&h[i+a-1]===_&&h[i]===h[s]&&h[++i]===h[s+1]){s+=2,i++;do{}while(h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&h[++s]===h[++i]&&s<d);if(r=w-(d-s),s=d-w,r>a){if(e.match_start=t,a=r,r>=o)break;_=h[s+a-1],g=h[s+a]}}}while((t=u[t&c])>l&&0!=--n);return a<=e.lookahead?a:e.lookahead}function D(e){var t,i,r,s,l,h,c,u,d,_,g=e.w_size;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-T)){n.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=i=e.hash_size;do{r=e.head[--t],e.head[t]=r>=g?r-g:0}while(--i);t=i=g;do{r=e.prev[--t],e.prev[t]=r>=g?r-g:0}while(--i);s+=g}if(0===e.strm.avail_in)break;if(h=e.strm,c=e.window,u=e.strstart+e.lookahead,d=s,_=void 0,(_=h.avail_in)>d&&(_=d),i=0===_?0:(h.avail_in-=_,n.arraySet(c,h.input,h.next_in,_,u),1===h.state.wrap?h.adler=a(h.adler,c,_,u):2===h.state.wrap&&(h.adler=o(h.adler,c,_,u)),h.next_in+=_,h.total_in+=_,_),e.lookahead+=i,e.lookahead+e.insert>=S)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+S-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<S)););}while(e.lookahead<T&&0!==e.strm.avail_in)}function k(e,t){for(var i,r;;){if(e.lookahead<T){if(D(e),e.lookahead<T&&t===h)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-T&&(e.match_length=R(e,i)),e.match_length>=S)if(r=s._tr_tally(e,e.strstart-e.match_start,e.match_length-S),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=S){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<S-1?e.strstart:S-1,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}function F(e,t){for(var i,r,n;;){if(e.lookahead<T){if(D(e),e.lookahead<T&&t===h)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=S&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=S-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-T&&(e.match_length=R(e,i),e.match_length<=5&&(1===e.strategy||e.match_length===S&&e.strstart-e.match_start>4096)&&(e.match_length=S-1)),e.prev_length>=S&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-S,r=s._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-S),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+S-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=S-1,e.strstart++,r&&(P(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=s._tr_tally(e,0,e.window[e.strstart-1]))&&P(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=s._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<S-1?e.strstart:S-1,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}function B(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}function N(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(2*p),this.dyn_dtree=new n.Buf16(2*(2*f+1)),this.bl_tree=new n.Buf16(2*(2*m+1)),A(this.dyn_ltree),A(this.dyn_dtree),A(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(C+1),this.heap=new n.Buf16(2*g+1),A(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*g+1),A(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function $(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=d,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?y:v,e.adler=2===t.wrap?0:1,t.last_flush=h,s._tr_init(t),c):x(e,u)}function U(e){var t,i=$(e);return i===c&&((t=e.state).window_size=2*t.w_size,A(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=S-1,t.match_available=0,t.ins_h=0),i}function O(e,t,i,r,s,a){if(!e)return u;var o=1;if(-1===t&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>9||i!==_||r<8||r>15||t<0||t>9||a<0||a>4)return x(e,u);8===r&&(r=9);var l=new N;return e.state=l,l.strm=e,l.wrap=o,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+S-1)/S),l.window=new n.Buf8(2*l.w_size),l.head=new n.Buf16(l.hash_size),l.prev=new n.Buf16(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new n.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=i,U(e)}r=[new B(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(D(e),0===e.lookahead&&t===h)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,P(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-T&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(P(e,!1),e.strm.avail_out),1)})),new B(4,4,8,4,k),new B(4,5,16,8,k),new B(4,6,32,32,k),new B(4,4,16,16,F),new B(8,16,32,32,F),new B(8,16,128,128,F),new B(8,32,128,256,F),new B(32,128,258,1024,F),new B(32,258,258,4096,F)],t.deflateInit=function(e,t){return O(e,t,_,15,8,0)},t.deflateInit2=O,t.deflateReset=U,t.deflateResetKeep=$,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?u:(e.state.gzhead=t,c):u},t.deflate=function(e,t){var i,n,a,l;if(!e||!e.state||t>5||t<0)return e?x(e,u):u;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===M&&4!==t)return x(e,0===e.avail_out?-5:u);if(n.strm=e,i=n.last_flush,n.last_flush=t,n.status===y)if(2===n.wrap)e.adler=0,E(n,31),E(n,139),E(n,8),n.gzhead?(E(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),E(n,255&n.gzhead.time),E(n,n.gzhead.time>>8&255),E(n,n.gzhead.time>>16&255),E(n,n.gzhead.time>>24&255),E(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),E(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(E(n,255&n.gzhead.extra.length),E(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=o(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(E(n,0),E(n,0),E(n,0),E(n,0),E(n,0),E(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),E(n,3),n.status=v);else{var d=_+(n.w_bits-8<<4)<<8;d|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(d|=32),d+=31-d%31,n.status=v,I(n,d),0!==n.strstart&&(I(n,e.adler>>>16),I(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),V(e),a=n.pending,n.pending!==n.pending_buf_size));)E(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),V(e),a=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,E(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),0===l&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),V(e),a=n.pending,n.pending===n.pending_buf_size)){l=1;break}l=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,E(n,l)}while(0!==l);n.gzhead.hcrc&&n.pending>a&&(e.adler=o(e.adler,n.pending_buf,n.pending-a,a)),0===l&&(n.status=b)}else n.status=b;if(n.status===b&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&V(e),n.pending+2<=n.pending_buf_size&&(E(n,255&e.adler),E(n,e.adler>>8&255),e.adler=0,n.status=v)):n.status=v),0!==n.pending){if(V(e),0===e.avail_out)return n.last_flush=-1,c}else if(0===e.avail_in&&L(t)<=L(i)&&4!==t)return x(e,-5);if(n.status===M&&0!==e.avail_in)return x(e,-5);if(0!==e.avail_in||0!==n.lookahead||t!==h&&n.status!==M){var g=2===n.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(D(e),0===e.lookahead)){if(t===h)return 1;break}if(e.match_length=0,i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var i,r,n,a,o=e.window;;){if(e.lookahead<=w){if(D(e),e.lookahead<=w&&t===h)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=S&&e.strstart>0&&(r=o[n=e.strstart-1])===o[++n]&&r===o[++n]&&r===o[++n]){a=e.strstart+w;do{}while(r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&r===o[++n]&&n<a);e.match_length=w-(a-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=S?(i=s._tr_tally(e,1,e.match_length-S),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=s._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(P(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(P(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(P(e,!1),0===e.strm.avail_out)?1:2}(n,t):r[n.level].func(n,t);if(3!==g&&4!==g||(n.status=M),1===g||3===g)return 0===e.avail_out&&(n.last_flush=-1),c;if(2===g&&(1===t?s._tr_align(n):5!==t&&(s._tr_stored_block(n,0,0,!1),3===t&&(A(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),V(e),0===e.avail_out))return n.last_flush=-1,c}return 4!==t?c:n.wrap<=0?1:(2===n.wrap?(E(n,255&e.adler),E(n,e.adler>>8&255),E(n,e.adler>>16&255),E(n,e.adler>>24&255),E(n,255&e.total_in),E(n,e.total_in>>8&255),E(n,e.total_in>>16&255),E(n,e.total_in>>24&255)):(I(n,e.adler>>>16),I(n,65535&e.adler)),V(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?c:1)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==y&&69!==t&&73!==t&&91!==t&&t!==b&&t!==v&&t!==M?x(e,u):(e.state=null,t===v?x(e,-3):c):u},t.deflateSetDictionary=function(e,t){var i,r,s,o,l,h,d,_,g=t.length;if(!e||!e.state)return u;if(2===(o=(i=e.state).wrap)||1===o&&i.status!==y||i.lookahead)return u;for(1===o&&(e.adler=a(e.adler,t,g,0)),i.wrap=0,g>=i.w_size&&(0===o&&(A(i.head),i.strstart=0,i.block_start=0,i.insert=0),_=new n.Buf8(i.w_size),n.arraySet(_,t,g-i.w_size,i.w_size,0),t=_,g=i.w_size),l=e.avail_in,h=e.next_in,d=e.input,e.avail_in=g,e.next_in=0,e.input=t,D(i);i.lookahead>=S;){r=i.strstart,s=i.lookahead-(S-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+S-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--s);i.strstart=r,i.lookahead=S-1,D(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=S-1,i.match_available=0,e.next_in=h,e.input=d,e.avail_in=l,i.wrap=o,c},t.deflateInfo="pako deflate (from Nodeca project)"},738:e=>{e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},353:e=>{e.exports=function(e,t){var i,r,n,s,a,o,l,h,c,u,d,_,g,f,m,p,C,S,w,T,y,b,v,M,x;i=e.state,r=e.next_in,M=e.input,n=r+(e.avail_in-5),s=e.next_out,x=e.output,a=s-(t-e.avail_out),o=s+(e.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,_=i.hold,g=i.bits,f=i.lencode,m=i.distcode,p=(1<<i.lenbits)-1,C=(1<<i.distbits)-1;e:do{g<15&&(_+=M[r++]<<g,g+=8,_+=M[r++]<<g,g+=8),S=f[_&p];t:for(;;){if(_>>>=w=S>>>24,g-=w,0==(w=S>>>16&255))x[s++]=65535&S;else{if(!(16&w)){if(0==(64&w)){S=f[(65535&S)+(_&(1<<w)-1)];continue t}if(32&w){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}T=65535&S,(w&=15)&&(g<w&&(_+=M[r++]<<g,g+=8),T+=_&(1<<w)-1,_>>>=w,g-=w),g<15&&(_+=M[r++]<<g,g+=8,_+=M[r++]<<g,g+=8),S=m[_&C];i:for(;;){if(_>>>=w=S>>>24,g-=w,!(16&(w=S>>>16&255))){if(0==(64&w)){S=m[(65535&S)+(_&(1<<w)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(y=65535&S,g<(w&=15)&&(_+=M[r++]<<g,(g+=8)<w&&(_+=M[r++]<<g,g+=8)),(y+=_&(1<<w)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(_>>>=w,g-=w,y>(w=s-a)){if((w=y-w)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(b=0,v=d,0===u){if(b+=h-w,w<T){T-=w;do{x[s++]=d[b++]}while(--w);b=s-y,v=x}}else if(u<w){if(b+=h+u-w,(w-=u)<T){T-=w;do{x[s++]=d[b++]}while(--w);if(b=0,u<T){T-=w=u;do{x[s++]=d[b++]}while(--w);b=s-y,v=x}}}else if(b+=u-w,w<T){T-=w;do{x[s++]=d[b++]}while(--w);b=s-y,v=x}for(;T>2;)x[s++]=v[b++],x[s++]=v[b++],x[s++]=v[b++],T-=3;T&&(x[s++]=v[b++],T>1&&(x[s++]=v[b++]))}else{b=s-y;do{x[s++]=x[b++],x[s++]=x[b++],x[s++]=x[b++],T-=3}while(T>2);T&&(x[s++]=x[b++],T>1&&(x[s++]=x[b++]))}break}}break}}while(r<n&&s<o);r-=T=g>>3,_&=(1<<(g-=T<<3))-1,e.next_in=r,e.next_out=s,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=s<o?o-s+257:257-(s-o),i.hold=_,i.bits=g}},347:(e,t,i)=>{var r=i(937),n=i(697),s=i(731),a=i(353),o=i(274),l=0,h=-2,c=1,u=12,d=30,_=852,g=592;function f(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function p(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=c,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(_),t.distcode=t.distdyn=new r.Buf32(g),t.sane=1,t.back=-1,l):h}function C(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,p(e)):h}function S(e,t){var i,r;return e&&e.state?(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,C(e))):h}function w(e,t){var i,r;return e?(r=new m,e.state=r,r.window=null,(i=S(e,t))!==l&&(e.state=null),i):h}var T,y,b=!0;function v(e){if(b){var t;for(T=new r.Buf32(512),y=new r.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,T,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,y,0,e.work,{bits:5}),b=!1}e.lencode=T,e.lenbits=9,e.distcode=y,e.distbits=5}function M(e,t,i,n){var s,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),n>=a.wsize?(r.arraySet(a.window,t,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((s=a.wsize-a.wnext)>n&&(s=n),r.arraySet(a.window,t,i-n,s,a.wnext),(n-=s)?(r.arraySet(a.window,t,i-n,n,0),a.wnext=n,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0}t.inflateReset=C,t.inflateReset2=S,t.inflateResetKeep=p,t.inflateInit=function(e){return w(e,15)},t.inflateInit2=w,t.inflate=function(e,t){var i,_,g,m,p,C,S,w,T,y,b,x,L,A,V,P,E,I,R,D,k,F,B,N,$=0,U=new r.Buf8(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;(i=e.state).mode===u&&(i.mode=13),p=e.next_out,g=e.output,S=e.avail_out,m=e.next_in,_=e.input,C=e.avail_in,w=i.hold,T=i.bits,y=C,b=S,F=l;e:for(;;)switch(i.mode){case c:if(0===i.wrap){i.mode=13;break}for(;T<16;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(2&i.wrap&&35615===w){i.check=0,U[0]=255&w,U[1]=w>>>8&255,i.check=s(i.check,U,2,0),w=0,T=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&w)<<8)+(w>>8))%31){e.msg="incorrect header check",i.mode=d;break}if(8!=(15&w)){e.msg="unknown compression method",i.mode=d;break}if(T-=4,k=8+(15&(w>>>=4)),0===i.wbits)i.wbits=k;else if(k>i.wbits){e.msg="invalid window size",i.mode=d;break}i.dmax=1<<k,e.adler=i.check=1,i.mode=512&w?10:u,w=0,T=0;break;case 2:for(;T<16;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(i.flags=w,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=d;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=d;break}i.head&&(i.head.text=w>>8&1),512&i.flags&&(U[0]=255&w,U[1]=w>>>8&255,i.check=s(i.check,U,2,0)),w=0,T=0,i.mode=3;case 3:for(;T<32;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.head&&(i.head.time=w),512&i.flags&&(U[0]=255&w,U[1]=w>>>8&255,U[2]=w>>>16&255,U[3]=w>>>24&255,i.check=s(i.check,U,4,0)),w=0,T=0,i.mode=4;case 4:for(;T<16;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.head&&(i.head.xflags=255&w,i.head.os=w>>8),512&i.flags&&(U[0]=255&w,U[1]=w>>>8&255,i.check=s(i.check,U,2,0)),w=0,T=0,i.mode=5;case 5:if(1024&i.flags){for(;T<16;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.length=w,i.head&&(i.head.extra_len=w),512&i.flags&&(U[0]=255&w,U[1]=w>>>8&255,i.check=s(i.check,U,2,0)),w=0,T=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((x=i.length)>C&&(x=C),x&&(i.head&&(k=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),r.arraySet(i.head.extra,_,m,x,k)),512&i.flags&&(i.check=s(i.check,_,x,m)),C-=x,m+=x,i.length-=x),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===C)break e;x=0;do{k=_[m+x++],i.head&&k&&i.length<65536&&(i.head.name+=String.fromCharCode(k))}while(k&&x<C);if(512&i.flags&&(i.check=s(i.check,_,x,m)),C-=x,m+=x,k)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===C)break e;x=0;do{k=_[m+x++],i.head&&k&&i.length<65536&&(i.head.comment+=String.fromCharCode(k))}while(k&&x<C);if(512&i.flags&&(i.check=s(i.check,_,x,m)),C-=x,m+=x,k)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;T<16;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(w!==(65535&i.check)){e.msg="header crc mismatch",i.mode=d;break}w=0,T=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=u;break;case 10:for(;T<32;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}e.adler=i.check=f(w),w=0,T=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=p,e.avail_out=S,e.next_in=m,e.avail_in=C,i.hold=w,i.bits=T,2;e.adler=i.check=1,i.mode=u;case u:if(5===t||6===t)break e;case 13:if(i.last){w>>>=7&T,T-=7&T,i.mode=27;break}for(;T<3;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}switch(i.last=1&w,T-=1,3&(w>>>=1)){case 0:i.mode=14;break;case 1:if(v(i),i.mode=20,6===t){w>>>=2,T-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=d}w>>>=2,T-=2;break;case 14:for(w>>>=7&T,T-=7&T;T<32;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if((65535&w)!=(w>>>16^65535)){e.msg="invalid stored block lengths",i.mode=d;break}if(i.length=65535&w,w=0,T=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(x=i.length){if(x>C&&(x=C),x>S&&(x=S),0===x)break e;r.arraySet(g,_,m,x,p),C-=x,m+=x,S-=x,p+=x,i.length-=x;break}i.mode=u;break;case 17:for(;T<14;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(i.nlen=257+(31&w),w>>>=5,T-=5,i.ndist=1+(31&w),w>>>=5,T-=5,i.ncode=4+(15&w),w>>>=4,T-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=d;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;T<3;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.lens[O[i.have++]]=7&w,w>>>=3,T-=3}for(;i.have<19;)i.lens[O[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,B={bits:i.lenbits},F=o(0,i.lens,0,19,i.lencode,0,i.work,B),i.lenbits=B.bits,F){e.msg="invalid code lengths set",i.mode=d;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;P=($=i.lencode[w&(1<<i.lenbits)-1])>>>16&255,E=65535&$,!((V=$>>>24)<=T);){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(E<16)w>>>=V,T-=V,i.lens[i.have++]=E;else{if(16===E){for(N=V+2;T<N;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(w>>>=V,T-=V,0===i.have){e.msg="invalid bit length repeat",i.mode=d;break}k=i.lens[i.have-1],x=3+(3&w),w>>>=2,T-=2}else if(17===E){for(N=V+3;T<N;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}T-=V,k=0,x=3+(7&(w>>>=V)),w>>>=3,T-=3}else{for(N=V+7;T<N;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}T-=V,k=0,x=11+(127&(w>>>=V)),w>>>=7,T-=7}if(i.have+x>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=d;break}for(;x--;)i.lens[i.have++]=k}}if(i.mode===d)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=d;break}if(i.lenbits=9,B={bits:i.lenbits},F=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,B),i.lenbits=B.bits,F){e.msg="invalid literal/lengths set",i.mode=d;break}if(i.distbits=6,i.distcode=i.distdyn,B={bits:i.distbits},F=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,B),i.distbits=B.bits,F){e.msg="invalid distances set",i.mode=d;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(C>=6&&S>=258){e.next_out=p,e.avail_out=S,e.next_in=m,e.avail_in=C,i.hold=w,i.bits=T,a(e,b),p=e.next_out,g=e.output,S=e.avail_out,m=e.next_in,_=e.input,C=e.avail_in,w=i.hold,T=i.bits,i.mode===u&&(i.back=-1);break}for(i.back=0;P=($=i.lencode[w&(1<<i.lenbits)-1])>>>16&255,E=65535&$,!((V=$>>>24)<=T);){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(P&&0==(240&P)){for(I=V,R=P,D=E;P=($=i.lencode[D+((w&(1<<I+R)-1)>>I)])>>>16&255,E=65535&$,!(I+(V=$>>>24)<=T);){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}w>>>=I,T-=I,i.back+=I}if(w>>>=V,T-=V,i.back+=V,i.length=E,0===P){i.mode=26;break}if(32&P){i.back=-1,i.mode=u;break}if(64&P){e.msg="invalid literal/length code",i.mode=d;break}i.extra=15&P,i.mode=22;case 22:if(i.extra){for(N=i.extra;T<N;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.length+=w&(1<<i.extra)-1,w>>>=i.extra,T-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;P=($=i.distcode[w&(1<<i.distbits)-1])>>>16&255,E=65535&$,!((V=$>>>24)<=T);){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(0==(240&P)){for(I=V,R=P,D=E;P=($=i.distcode[D+((w&(1<<I+R)-1)>>I)])>>>16&255,E=65535&$,!(I+(V=$>>>24)<=T);){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}w>>>=I,T-=I,i.back+=I}if(w>>>=V,T-=V,i.back+=V,64&P){e.msg="invalid distance code",i.mode=d;break}i.offset=E,i.extra=15&P,i.mode=24;case 24:if(i.extra){for(N=i.extra;T<N;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}i.offset+=w&(1<<i.extra)-1,w>>>=i.extra,T-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=d;break}i.mode=25;case 25:if(0===S)break e;if(x=b-S,i.offset>x){if((x=i.offset-x)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=d;break}x>i.wnext?(x-=i.wnext,L=i.wsize-x):L=i.wnext-x,x>i.length&&(x=i.length),A=i.window}else A=g,L=p-i.offset,x=i.length;x>S&&(x=S),S-=x,i.length-=x;do{g[p++]=A[L++]}while(--x);0===i.length&&(i.mode=21);break;case 26:if(0===S)break e;g[p++]=i.length,S--,i.mode=21;break;case 27:if(i.wrap){for(;T<32;){if(0===C)break e;C--,w|=_[m++]<<T,T+=8}if(b-=S,e.total_out+=b,i.total+=b,b&&(e.adler=i.check=i.flags?s(i.check,g,b,p-b):n(i.check,g,b,p-b)),b=S,(i.flags?w:f(w))!==i.check){e.msg="incorrect data check",i.mode=d;break}w=0,T=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;T<32;){if(0===C)break e;C--,w+=_[m++]<<T,T+=8}if(w!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=d;break}w=0,T=0}i.mode=29;case 29:F=1;break e;case d:F=-3;break e;case 31:return-4;default:return h}return e.next_out=p,e.avail_out=S,e.next_in=m,e.avail_in=C,i.hold=w,i.bits=T,(i.wsize||b!==e.avail_out&&i.mode<d&&(i.mode<27||4!==t))&&M(e,e.output,e.next_out,b-e.avail_out)?(i.mode=31,-4):(y-=e.avail_in,b-=e.avail_out,e.total_in+=y,e.total_out+=b,i.total+=b,i.wrap&&b&&(e.adler=i.check=i.flags?s(i.check,g,b,e.next_out-b):n(i.check,g,b,e.next_out-b)),e.data_type=i.bits+(i.last?64:0)+(i.mode===u?128:0)+(20===i.mode||15===i.mode?256:0),(0===y&&0===b||4===t)&&F===l&&(F=-5),F)},t.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,l},t.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?h:(i.head=t,t.done=!1,l):h},t.inflateSetDictionary=function(e,t){var i,r=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?h:11===i.mode&&n(1,t,r,0)!==i.check?-3:M(e,t,r,r)?(i.mode=31,-4):(i.havedict=1,l):h},t.inflateInfo="pako inflate (from Nodeca project)"},274:(e,t,i)=>{var r=i(937),n=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,i,l,h,c,u,d){var _,g,f,m,p,C,S,w,T,y=d.bits,b=0,v=0,M=0,x=0,L=0,A=0,V=0,P=0,E=0,I=0,R=null,D=0,k=new r.Buf16(16),F=new r.Buf16(16),B=null,N=0;for(b=0;b<=15;b++)k[b]=0;for(v=0;v<l;v++)k[t[i+v]]++;for(L=y,x=15;x>=1&&0===k[x];x--);if(L>x&&(L=x),0===x)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(M=1;M<x&&0===k[M];M++);for(L<M&&(L=M),P=1,b=1;b<=15;b++)if(P<<=1,(P-=k[b])<0)return-1;if(P>0&&(0===e||1!==x))return-1;for(F[1]=0,b=1;b<15;b++)F[b+1]=F[b]+k[b];for(v=0;v<l;v++)0!==t[i+v]&&(u[F[t[i+v]]++]=v);if(0===e?(R=B=u,C=19):1===e?(R=n,D-=257,B=s,N-=257,C=256):(R=a,B=o,C=-1),I=0,v=0,b=M,p=c,A=L,V=0,f=-1,m=(E=1<<L)-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){S=b-V,u[v]<C?(w=0,T=u[v]):u[v]>C?(w=B[N+u[v]],T=R[D+u[v]]):(w=96,T=0),_=1<<b-V,M=g=1<<A;do{h[p+(I>>V)+(g-=_)]=S<<24|w<<16|T|0}while(0!==g);for(_=1<<b-1;I&_;)_>>=1;if(0!==_?(I&=_-1,I+=_):I=0,v++,0==--k[b]){if(b===x)break;b=t[i+u[v]]}if(b>L&&(I&m)!==f){for(0===V&&(V=L),p+=M,P=1<<(A=b-V);A+V<x&&!((P-=k[A+V])<=0);)A++,P<<=1;if(E+=1<<A,1===e&&E>852||2===e&&E>592)return 1;h[f=I&m]=L<<24|A<<16|p-c|0}}return 0!==I&&(h[p+I]=b-V<<24|64<<16|0),d.bits=L,0}},990:e=>{e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},805:(e,t,i)=>{var r=i(937);function n(e){for(var t=e.length;--t>=0;)e[t]=0}var s=256,a=286,o=30,l=15,h=16,c=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],g=new Array(576);n(g);var f=new Array(60);n(f);var m=new Array(512);n(m);var p=new Array(256);n(p);var C=new Array(29);n(C);var S,w,T,y=new Array(o);function b(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function v(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function M(e){return e<256?m[e]:m[256+(e>>>7)]}function x(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function L(e,t,i){e.bi_valid>h-i?(e.bi_buf|=t<<e.bi_valid&65535,x(e,e.bi_buf),e.bi_buf=t>>h-e.bi_valid,e.bi_valid+=i-h):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function A(e,t,i){L(e,i[2*t],i[2*t+1])}function V(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function P(e,t,i){var r,n,s=new Array(l+1),a=0;for(r=1;r<=l;r++)s[r]=a=a+i[r-1]<<1;for(n=0;n<=t;n++){var o=e[2*n+1];0!==o&&(e[2*n]=V(s[o]++,o))}}function E(e){var t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function I(e){e.bi_valid>8?x(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function R(e,t,i,r){var n=2*t,s=2*i;return e[n]<e[s]||e[n]===e[s]&&r[t]<=r[i]}function D(e,t,i){for(var r=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&R(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!R(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r}function k(e,t,i){var r,n,a,o,l=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],n=e.pending_buf[e.l_buf+l],l++,0===r?A(e,n,t):(A(e,(a=p[n])+s+1,t),0!==(o=c[a])&&L(e,n-=C[a],o),A(e,a=M(--r),i),0!==(o=u[a])&&L(e,r-=y[a],o))}while(l<e.last_lit);A(e,256,t)}function F(e,t){var i,r,n,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,h=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<h;i++)0!==s[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):s[2*i+1]=0;for(;e.heap_len<2;)s[2*(n=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[n]=0,e.opt_len--,o&&(e.static_len-=a[2*n+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)D(e,s,i);n=h;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],D(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,s[2*n]=s[2*i]+s[2*r],e.depth[n]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,s[2*i+1]=s[2*r+1]=n,e.heap[1]=n++,D(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,r,n,s,a,o,h=t.dyn_tree,c=t.max_code,u=t.stat_desc.static_tree,d=t.stat_desc.has_stree,_=t.stat_desc.extra_bits,g=t.stat_desc.extra_base,f=t.stat_desc.max_length,m=0;for(s=0;s<=l;s++)e.bl_count[s]=0;for(h[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(s=h[2*h[2*(r=e.heap[i])+1]+1]+1)>f&&(s=f,m++),h[2*r+1]=s,r>c||(e.bl_count[s]++,a=0,r>=g&&(a=_[r-g]),o=h[2*r],e.opt_len+=o*(s+a),d&&(e.static_len+=o*(u[2*r+1]+a)));if(0!==m){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,m-=2}while(m>0);for(s=f;0!==s;s--)for(r=e.bl_count[s];0!==r;)(n=e.heap[--i])>c||(h[2*n+1]!==s&&(e.opt_len+=(s-h[2*n+1])*h[2*n],h[2*n+1]=s),r--)}}(e,t),P(s,c,e.bl_count)}function B(e,t,i){var r,n,s=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=a,a=t[2*(r+1)+1],++o<l&&n===a||(o<h?e.bl_tree[2*n]+=o:0!==n?(n!==s&&e.bl_tree[2*n]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=n,0===a?(l=138,h=3):n===a?(l=6,h=3):(l=7,h=4))}function N(e,t,i){var r,n,s=-1,a=t[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),r=0;r<=i;r++)if(n=a,a=t[2*(r+1)+1],!(++o<l&&n===a)){if(o<h)do{A(e,n,e.bl_tree)}while(0!=--o);else 0!==n?(n!==s&&(A(e,n,e.bl_tree),o--),A(e,16,e.bl_tree),L(e,o-3,2)):o<=10?(A(e,17,e.bl_tree),L(e,o-3,3)):(A(e,18,e.bl_tree),L(e,o-11,7));o=0,s=n,0===a?(l=138,h=3):n===a?(l=6,h=3):(l=7,h=4)}}n(y);var $=!1;function U(e,t,i,n){L(e,0+(n?1:0),3),function(e,t,i,n){I(e),x(e,i),x(e,~i),r.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i)}t._tr_init=function(e){$||(function(){var e,t,i,r,n,s=new Array(l+1);for(i=0,r=0;r<28;r++)for(C[r]=i,e=0;e<1<<c[r];e++)p[i++]=r;for(p[i-1]=r,n=0,r=0;r<16;r++)for(y[r]=n,e=0;e<1<<u[r];e++)m[n++]=r;for(n>>=7;r<o;r++)for(y[r]=n<<7,e=0;e<1<<u[r]-7;e++)m[256+n++]=r;for(t=0;t<=l;t++)s[t]=0;for(e=0;e<=143;)g[2*e+1]=8,e++,s[8]++;for(;e<=255;)g[2*e+1]=9,e++,s[9]++;for(;e<=279;)g[2*e+1]=7,e++,s[7]++;for(;e<=287;)g[2*e+1]=8,e++,s[8]++;for(P(g,287,s),e=0;e<o;e++)f[2*e+1]=5,f[2*e]=V(e,5);S=new b(g,c,257,a,l),w=new b(f,u,0,o,l),T=new b(new Array(0),d,0,19,7)}(),$=!0),e.l_desc=new v(e.dyn_ltree,S),e.d_desc=new v(e.dyn_dtree,w),e.bl_desc=new v(e.bl_tree,T),e.bi_buf=0,e.bi_valid=0,E(e)},t._tr_stored_block=U,t._tr_flush_block=function(e,t,i,r){var n,a,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),F(e,e.l_desc),F(e,e.d_desc),o=function(e){var t;for(B(e,e.dyn_ltree,e.l_desc.max_code),B(e,e.dyn_dtree,e.d_desc.max_code),F(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*_[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=n&&(n=a)):n=a=i+5,i+4<=n&&-1!==t?U(e,t,i,r):4===e.strategy||a===n?(L(e,2+(r?1:0),3),k(e,g,f)):(L(e,4+(r?1:0),3),function(e,t,i,r){var n;for(L(e,t-257,5),L(e,i-1,5),L(e,r-4,4),n=0;n<r;n++)L(e,e.bl_tree[2*_[n]+1],3);N(e,e.dyn_ltree,t-1),N(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),k(e,e.dyn_ltree,e.dyn_dtree)),E(e),r&&I(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(p[i]+s+1)]++,e.dyn_dtree[2*M(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){L(e,2,3),A(e,256,g),function(e){16===e.bi_valid?(x(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},222:e=>{e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ABR:()=>ABR,ACFT:()=>ACFT,ASEP:()=>ASEP,Alignment:()=>Alignment,AltTypes:()=>AltTypes,AltUnits:()=>AltUnits,Annotation:()=>Annotation,AnnotationClickEventArgs:()=>AnnotationClickEventArgs,ArrivedEventArgs:()=>ArrivedEventArgs,AstroCalc:()=>AstroCalc,AstroRaDec:()=>AstroRaDec,AudioOverlay:()=>AudioOverlay,AudioType:()=>AudioType,BandPass:()=>BandPass,BinaryReader:()=>BinaryReader,Bitmap:()=>Bitmap,BitmapOverlay:()=>BitmapOverlay,BlendState:()=>BlendState,BodyAngles:()=>BodyAngles,C3D:()=>C3D,CAAEarth:()=>CAAEarth,CAAEclipticalElementDetails:()=>CAAEclipticalElementDetails,CAAEclipticalElements:()=>CAAEclipticalElements,CAAFK5:()=>CAAFK5,CAAGlobe:()=>CAAGlobe,CAAJupiter:()=>CAAJupiter,CAAKepler:()=>CAAKepler,CAAMars:()=>CAAMars,CAAMercury:()=>CAAMercury,CAAMoon:()=>CAAMoon,CAAMoonNodes:()=>CAAMoonNodes,CAAMoonPerigeeApogee:()=>CAAMoonPerigeeApogee,CAAMoonPhases:()=>CAAMoonPhases,CAANeptune:()=>CAANeptune,CAANutation:()=>CAANutation,CAAParallax:()=>CAAParallax,CAAPhysicalJupiter:()=>CAAPhysicalJupiter,CAAPhysicalJupiterDetails:()=>CAAPhysicalJupiterDetails,CAAPhysicalMars:()=>CAAPhysicalMars,CAAPhysicalMarsDetails:()=>CAAPhysicalMarsDetails,CAAPhysicalSun:()=>CAAPhysicalSun,CAAPhysicalSunDetails:()=>CAAPhysicalSunDetails,CAAPluto:()=>CAAPluto,CAAPrecession:()=>CAAPrecession,CAARiseTransitSet:()=>CAARiseTransitSet,CAARiseTransitSetDetails:()=>CAARiseTransitSetDetails,CAASaturn:()=>CAASaturn,CAASaturnRingDetails:()=>CAASaturnRingDetails,CAASaturnRings:()=>CAASaturnRings,CAASidereal:()=>CAASidereal,CAAStellarMagnitudes:()=>CAAStellarMagnitudes,CAASun:()=>CAASun,CAATopocentricEclipticDetails:()=>CAATopocentricEclipticDetails,CAAUranus:()=>CAAUranus,CAAVenus:()=>CAAVenus,COR:()=>COR,CT:()=>CT,CalD:()=>CalD,CameraParameters:()=>CameraParameters,CatalogSpreadSheetLayer:()=>CatalogSpreadSheetLayer,Circle:()=>Circle,Classification:()=>Classification,CollectionLoadedEventArgs:()=>CollectionLoadedEventArgs,Color:()=>Color,ColorMapContainer:()=>ColorMapContainer,ColorMaps:()=>ColorMaps,ColorPicker:()=>ColorPicker,Colors:()=>Colors,ConstellationFilter:()=>ConstellationFilter,Constellations:()=>Constellations,ContextMenuStrip:()=>ContextMenuStrip,ConvexHull:()=>ConvexHull,Coordinates:()=>Coordinates,CoordinatesTypes:()=>CoordinatesTypes,CullMode:()=>CullMode,Cursor:()=>Cursor,Cursors:()=>Cursors,DAY_OF_WEEK:()=>DAY_OF_WEEK,DT:()=>DT,DYT:()=>DYT,DataItem:()=>DataItem,DataTypes:()=>DataTypes,DataVizWizard:()=>DataVizWizard,Dates:()=>Dates,Dialog:()=>Dialog,DialogResult:()=>DialogResult,DomainValue:()=>DomainValue,DoubleUtilities:()=>DoubleUtilities,ELL:()=>ELL,EO:()=>EO,EOD:()=>EOD,EOE:()=>EOE,EOT:()=>EOT,EPD:()=>EPD,EPO:()=>EPO,EllipseRenderer:()=>EllipseRenderer,EllipseShader:()=>EllipseShader,EquirectangularTile:()=>EquirectangularTile,FadeType:()=>FadeType,FastMath:()=>FastMath,FileCabinet:()=>FileCabinet,FileEntry:()=>FileEntry,FitsImage:()=>FitsImage,FitsImageJs:()=>FitsImageJs,FitsImageTile:()=>FitsImageTile,FitsProperties:()=>FitsProperties,FitsShader:()=>FitsShader,FlipbookOverlay:()=>FlipbookOverlay,Folder:()=>Folder,FolderBrowser:()=>FolderBrowser,FolderDownloadAction:()=>FolderDownloadAction,FolderGroup:()=>FolderGroup,FolderRefreshType:()=>FolderRefreshType,FolderType:()=>FolderType,FolderUp:()=>FolderUp,Formatting:()=>Formatting,FrameTarget:()=>FrameTarget,FrameWizard:()=>FrameWizard,Fxyf:()=>Fxyf,GFX:()=>GFX,GM:()=>GM,GMD:()=>GMD,GMDS:()=>GMDS,Galaxy:()=>Galaxy,GlyphCache:()=>GlyphCache,GlyphItem:()=>GlyphItem,GreatCircleDialog:()=>GreatCircleDialog,GreatCirlceRouteLayer:()=>GreatCirlceRouteLayer,GridLayer:()=>GridLayer,Grids:()=>Grids,GroundOverlayLayer:()=>GroundOverlayLayer,Group:()=>Group,Guid:()=>Guid,HealpixTables:()=>HealpixTables,HealpixTile:()=>HealpixTile,HealpixUtils:()=>HealpixUtils,HipsProperties:()=>HipsProperties,Histogram:()=>Histogram,HistogramEqualization:()=>HistogramEqualization,Hploc:()=>Hploc,IFR:()=>IFR,INTP:()=>INTP,IPlace:()=>IPlace,ISSLayer:()=>ISSLayer,ISettings:()=>ISettings,IThumbnail:()=>IThumbnail,IUIServicesCallbacks:()=>IUIServicesCallbacks,IUiController:()=>IUiController,IUndoStep:()=>IUndoStep,IViewMover:()=>IViewMover,ImageSetLayer:()=>ImageSetLayer,ImageSetType:()=>ImageSetType,ImageShader:()=>ImageShader,ImageShader2:()=>ImageShader2,Imageset:()=>Imageset,InViewReturnMessage:()=>InViewReturnMessage,IndexBuffer:()=>IndexBuffer,InterpolationType:()=>InterpolationType,KeplerPointSpriteShader:()=>KeplerPointSpriteShader,KeplerVertex:()=>KeplerVertex,KeplerianElements:()=>KeplerianElements,Keys:()=>Keys,KmlCoordinate:()=>KmlCoordinate,KmlLineList:()=>KmlLineList,Language:()=>Language,LatLngEdges:()=>LatLngEdges,Layer:()=>Layer,LayerInfo:()=>LayerInfo,LayerManager:()=>LayerManager,LayerMap:()=>LayerMap,LayerUI:()=>LayerUI,LayerUIMenuItem:()=>LayerUIMenuItem,LayerUITreeNode:()=>LayerUITreeNode,LineList:()=>LineList,LineShaderNormalDates:()=>LineShaderNormalDates,Linepoint:()=>Linepoint,Lineset:()=>Lineset,LocationHint:()=>LocationHint,LoopTypes:()=>LoopTypes,MIFR:()=>MIFR,MPAC:()=>MPAC,MarkerMixes:()=>MarkerMixes,MarkerScales:()=>MarkerScales,MasterTime:()=>MasterTime,Material:()=>Material,Matrix2d:()=>Matrix2d,Matrix3d:()=>Matrix3d,MercatorTile:()=>MercatorTile,Mesh:()=>Mesh,ModelShader:()=>ModelShader,ModelShaderTan:()=>ModelShaderTan,MoonCoefficient1:()=>MoonCoefficient1,MoonCoefficient2:()=>MoonCoefficient2,Mouse:()=>Mouse,NUC:()=>NUC,Object3d:()=>Object3d,Object3dLayer:()=>Object3dLayer,Object3dLayerUI:()=>Object3dLayerUI,ObjectNode:()=>ObjectNode,Orbit:()=>Orbit,OrbitLayer:()=>OrbitLayer,OrbitLayerUI:()=>OrbitLayerUI,OrbitLineList:()=>OrbitLineList,OrbitLineShader:()=>OrbitLineShader,Overlay:()=>Overlay,OverlayAnchor:()=>OverlayAnchor,OverlayList:()=>OverlayList,OverlayProperties:()=>OverlayProperties,Place:()=>Place,PlaneD:()=>PlaneD,Planets:()=>Planets,PlotTile:()=>PlotTile,PlotTypes:()=>PlotTypes,PlutoCoefficient1:()=>PlutoCoefficient1,PlutoCoefficient2:()=>PlutoCoefficient2,PointList:()=>PointList,PointScaleTypes:()=>PointScaleTypes,PointType:()=>PointType,Pointing:()=>Pointing,Poly:()=>Poly,PolyLine:()=>PolyLine,PopupColorPicker:()=>PopupColorPicker,PopupVolume:()=>PopupVolume,PositionColored:()=>PositionColored,PositionColoredTextured:()=>PositionColoredTextured,PositionNormalTextured:()=>PositionNormalTextured,PositionNormalTexturedTangent:()=>PositionNormalTexturedTangent,PositionNormalTexturedTangentVertexBuffer:()=>PositionNormalTexturedTangentVertexBuffer,PositionNormalTexturedVertexBuffer:()=>PositionNormalTexturedVertexBuffer,PositionNormalTexturedX2:()=>PositionNormalTexturedX2,PositionTexture:()=>PositionTexture,PositionVertexBuffer:()=>PositionVertexBuffer,Primitives:()=>Primitives,ProjectionType:()=>ProjectionType,PushPin:()=>PushPin,RAUnits:()=>RAUnits,Rectangle:()=>Rectangle,ReferenceFrame:()=>ReferenceFrame,ReferenceFrameProps:()=>ReferenceFrameProps,ReferenceFrameTypes:()=>ReferenceFrameTypes,ReferenceFrames:()=>ReferenceFrames,RenderContext:()=>RenderContext,RenderTriangle:()=>RenderTriangle,RiseSetDetails:()=>RiseSetDetails,ScaleLinear:()=>ScaleLinear,ScaleLog:()=>ScaleLog,ScaleMap:()=>ScaleMap,ScalePow:()=>ScalePow,ScaleSqrt:()=>ScaleSqrt,ScaleTypes:()=>ScaleTypes,ScriptInterface:()=>ScriptInterface,SelectLink:()=>SelectLink,Selection:()=>Selection,SelectionAnchor:()=>SelectionAnchor,SettingParameter:()=>SettingParameter,Settings:()=>Settings,ShapeOverlay:()=>ShapeOverlay,ShapeSpriteShader:()=>ShapeSpriteShader,ShapeType:()=>ShapeType,ShortIndexBuffer:()=>ShortIndexBuffer,SimpleInput:()=>SimpleInput,SimpleLineList:()=>SimpleLineList,SimpleLineShader:()=>SimpleLineShader,SimpleLineShader2D:()=>SimpleLineShader2D,SkyImageTile:()=>SkyImageTile,SkyOverlays:()=>SkyOverlays,SlideChangedEventArgs:()=>SlideChangedEventArgs,SolarSystemObjects:()=>SolarSystemObjects,SoundEditor:()=>SoundEditor,SpaceTimeController:()=>SpaceTimeController,SphereHull:()=>SphereHull,SpreadSheetLayer:()=>SpreadSheetLayer,SpriteShader:()=>SpriteShader,Star:()=>Star,StateType:()=>StateType,StockSkyOverlayTypes:()=>StockSkyOverlayTypes,Table:()=>Table,TagMe:()=>TagMe,TangentTile:()=>TangentTile,Tessellator:()=>Tessellator,Text3d:()=>Text3d,Text3dBatch:()=>Text3dBatch,TextBorderStyle:()=>TextBorderStyle,TextObject:()=>TextObject,TextOverlay:()=>TextOverlay,TextShader:()=>TextShader,Texture:()=>Texture,ThumbnailSize:()=>ThumbnailSize,Tile:()=>Tile,TileCache:()=>TileCache,TileShader:()=>TileShader,TimeLine:()=>TimeLine,TimeSeriesLayer:()=>TimeSeriesLayer,TimeSeriesLineVertex:()=>TimeSeriesLineVertex,TimeSeriesPointSpriteShader:()=>TimeSeriesPointSpriteShader,TimeSeriesPointVertex:()=>TimeSeriesPointVertex,ToastTile:()=>ToastTile,ToolStripMenuItem:()=>ToolStripMenuItem,ToolStripSeparator:()=>ToolStripSeparator,Tour:()=>Tour,TourDocument:()=>TourDocument,TourEdit:()=>TourEdit,TourEditTab:()=>TourEditTab,TourEditor:()=>TourEditor,TourPlayer:()=>TourPlayer,TourStop:()=>TourStop,TourStopList:()=>TourStopList,TransitionType:()=>TransitionType,TriangleFanList:()=>TriangleFanList,TriangleList:()=>TriangleList,URLHelpers:()=>URLHelpers,URLRewriteMode:()=>URLRewriteMode,UiTools:()=>UiTools,Undo:()=>Undo,UndoStep:()=>UndoStep,UndoTourPropertiesChange:()=>UndoTourPropertiesChange,UndoTourSlidelistChange:()=>UndoTourSlidelistChange,UndoTourStopChange:()=>UndoTourStopChange,UserLevel:()=>UserLevel,Util:()=>Util,VSC:()=>VSC,Vector2d:()=>Vector2d,Vector3d:()=>Vector3d,Vector4d:()=>Vector4d,VertexBufferBase:()=>VertexBufferBase,VideoOutputType:()=>VideoOutputType,ViewMoverKenBurnsStyle:()=>ViewMoverKenBurnsStyle,VizLayer:()=>VizLayer,VoColumn:()=>VoColumn,VoRow:()=>VoRow,VoTable:()=>VoTable,VoTableLayer:()=>VoTableLayer,WWTControl:()=>WWTControl,WWTControlBuilder:()=>WWTControlBuilder,WWTElementEvent:()=>WWTElementEvent,WcsImage:()=>WcsImage,WebFile:()=>WebFile,Wtml:()=>Wtml,XmlTextWriter:()=>XmlTextWriter,Xyf:()=>Xyf,set_tilePrepDevice:()=>set_tilePrepDevice,set_useGlVersion2:()=>set_useGlVersion2,ss:()=>ss.ss});var ss=__webpack_require__(495);const registry=ss.ss.createRegistry("wwtlib"),enumTypes={};function registerType(e,t){ss.ss.createType(e,t,registry)}function registerEnum(e,t){enumTypes[e]=t}function Enums(){}Enums.parse=function(e,t){if("Default"===t&&(t="DefaultV"),"0"===t)return 0;var i=t.substr(0,1).toLowerCase()+t.substr(1);return enumTypes[e][i]},Enums.toXml=function(e,t){var i="0",r=Object.keys(enumTypes[e]);for(var n in r)if(enumTypes[e][r[n]]==t){i=r[n];break}var s=i,a=s.substr(0,1).toUpperCase()+s.substr(1);return"DefaultV"===a&&(a="Default"),a};const Enums$={};function Util(){}registerType("Enums",[Enums,Enums$,null]),Util.splitString=function(e,t){for(var i=[],r=0,n=0,s=t.slice().sort(((e,t)=>t.length-e.length)),a=0;a<e.length;a++){for(var o=0,l=0;l<s.length;l++){var h=s[l];if(e.substring(n,n+h.length)==h){n>r&&i.push(e.substring(r,n)),r=n+=o=h.length;break}}0==o&&n++}return(n=e.length)>r&&i.push(e.substring(r,n)),i},Util.stringContains=function(e,t){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>-1)return!0;return!1},Util.getHashCode=function(e){var t=0;if(!e.length)return t;for(var i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i);return t},Util.compare=function(e,t){return e===t?0:e>t?1:-1},Util.logN=function(e,t){return Math.log(e)/Math.log(t)},Util.parseTimeSpan=function(e){var t=0,i=e.split(":");return 3===i.length&&(t+=36e5*parseInt(i[0]),t+=6e4*parseInt(i[1]),t+=ss.ss.truncate(1e3*parseFloat(i[2]))),t},Util.xmlDuration=function(e){var t=e/1e3,i=Math.floor(t/3600),r=Math.floor(t/60)-60*i,n=t-(3600*i+60*r);return ss.ss.format("{0}:{1}:{2}",i,r,n)},Util.xmlDate=function(e){var t=e.getHours(),i="AM";return t>12&&(t-=12,i="PM"),(e.getMonth()+1).toString()+"/"+e.getDate().toString()+"/"+e.getFullYear().toString()+" "+t.toString()+":"+e.getMinutes().toString()+":"+e.getSeconds().toString()+" "+i},Util.selectSingleNode=function(e,t){for(var i=null,r=ss.ss.enumerate(e.childNodes);r.moveNext();){var n=r.current;if(n.nodeName===t){i=n;break}}return i},Util.getInnerText=function(e){return ss.ss.emptyString(e.text)?e.textContent:e.text},Util.getWrappedText=function(e,t,i){var r=[];return r.push(t),r},Util.toHex=function(e){var t=Math.max(0,Math.min(ss.ss.truncate(e),255));return"0123456789ABCDEF".substr((t-t%16)/16,1)+"0123456789ABCDEF".substr(t%16,1)},Util.fromHex=function(e){var t=0;switch(e.substr(1,1).toUpperCase()){case"A":t+=10;break;case"B":t+=11;break;case"C":t+=12;break;case"D":t+=13;break;case"E":t+=14;break;case"F":t+=15;break;default:t+=parseInt(e.substr(1,1))}switch(e.substr(0,1).toUpperCase()){case"A":t+=160;break;case"B":t+=176;break;case"C":t+=192;break;case"D":t+=208;break;case"E":t+=224;break;case"F":t+=240;break;default:t+=16*parseInt(e.substr(0,1))}return t},Util._openUrl=function(e){window.open(e)},Util.log10=function(e){return Math.log(e)/2.30258509299405},Util.sign=function(e){return e<0?-1:1};var Util$={};function CalD(){this.year=0,this.month=0,this.day=0,this.year=0,this.month=0,this.day=0}registerType("Util",[Util,Util$,null]),CalD.create=function(e,t,i){var r=new CalD;return r.year=e,r.month=t,r.day=i,r};var CalD$={};registerType("CalD",[CalD,CalD$,null]);var DAY_OF_WEEK={SUNDAY:0,MONDAY:1,TUESDAY:2,WEDNESDAY:3,THURSDAY:4,FRIDAY:5,SATURDAY:6};function DT(){this.m_dblJulian=0,this.m_bGregorianCalendar=!1,this.m_dblJulian=0,this.m_bGregorianCalendar=!1}registerType("DAY_OF_WEEK",DAY_OF_WEEK),DT.create=function(e,t,i,r){var n=new DT;return n.set(e,t,i,0,0,0,r),n},DT.createHMS=function(e,t,i,r,n,s,a){var o=new DT;return o.set(e,t,i,r,n,s,a),o},DT.createJD=function(e,t){var i=new DT;return i.setJD(e,t),i},DT.dateToJD=function(e,t,i,r){var n=e,s=t;s<3&&(n-=1,s+=12);var a=0,o=0;return r&&(o=2-(a=ss.ss.truncate(n/100))+ss.ss.truncate(a/4)),ss.ss.truncate(365.25*(n+4716))+ss.ss.truncate(30.6001*(s+1))+i+o-1524.5},DT.isLeap=function(e,t){return t?e%100?!(e%4):!(e%400):!(e%4)},DT.afterPapalReform=function(e,t,i){return e>1582||1582===e&&t>10||1582===e&&10===t&&i>=15},DT.afterPapalReformJD=function(e){return e>=2299160.5},DT.dayOfYearJD=function(e,t,i){return e-DT.dateToJD(t,1,1,i)+1},DT.daysInMonthForMonth=function(e,t){console.assert(e>=1&&e<=12);var i=[31,28,31,30,31,30,31,31,30,31,30,31,0];return t&&i[1]++,i[e-1]},DT.INT=function(e){return e>=0?ss.ss.truncate(e):ss.ss.truncate(e-1)};var DT$={julian:function(){return this.m_dblJulian},day:function(){var e=this.get();return ss.ss.truncate(e[2])},month:function(){var e=this.get();return ss.ss.truncate(e[1])},year:function(){var e=this.get();return ss.ss.truncate(e[0])},hour:function(){var e=this.get();return ss.ss.truncate(e[3])},minute:function(){var e=this.get();return ss.ss.truncate(e[4])},second:function(){var e=this.get();return ss.ss.truncate(e[5])},set:function(e,t,i,r,n,s,a){var o=i+r/24+n/1440+s/86400;this.setJD(DT.dateToJD(e,t,o,a),a)},setJD:function(e,t){this.m_dblJulian=e,this.setInGregorianCalendar(t)},setInGregorianCalendar:function(e){var t=this.m_dblJulian>=2299160.5;this.m_bGregorianCalendar=e&&t},get:function(){var e,t,i,r,n,s,a=this.m_dblJulian+.5,o=Math.floor(a),l=a-o,h=ss.ss.truncate(o);if(this.m_bGregorianCalendar){var c=ss.ss.truncate((h-1867216.25)/36524.25);s=h+1+c-ss.ss.truncate(c/4)}else s=h;var u=s+1524,d=ss.ss.truncate((u-122.1)/365.25),_=ss.ss.truncate(365.25*d),g=ss.ss.truncate((u-_)/30.6001),f=u-_-ss.ss.truncate(30.6001*g)+l;return i=ss.ss.truncate(f),e=(t=g<14?g-1:g-13)>2?d-4716:d-4715,l=f-(o=Math.floor(f)),[e,t,i,r=ss.ss.truncate(24*l),n=ss.ss.truncate(1440*(l-r/24)),86400*(l-r/24-n/1440)]},dayOfWeek:function(){return ss.ss.truncate(this.m_dblJulian+1.5)%7},dayOfYear:function(){var e=ss.ss.truncate(this.get()[0]);return DT.dayOfYearJD(this.m_dblJulian,e,DT.afterPapalReform(e,1,1))},daysInMonth:function(){var e=this.get(),t=ss.ss.truncate(e[0]),i=ss.ss.truncate(e[1]);return DT.daysInMonthForMonth(i,DT.isLeap(t,this.m_bGregorianCalendar))},daysInYear:function(){var e=this.get(),t=ss.ss.truncate(e[0]);return DT.isLeap(t,this.m_bGregorianCalendar)?366:365},leap:function(){return DT.isLeap(this.year(),this.m_bGregorianCalendar)},inGregorianCalendar:function(){return this.m_bGregorianCalendar},fractionalYear:function(){var e,t=this.get(),i=ss.ss.truncate(t[0]);return ss.ss.truncate(t[1]),ss.ss.truncate(t[2]),ss.ss.truncate(t[3]),ss.ss.truncate(t[4]),t[5],e=DT.isLeap(i,this.m_bGregorianCalendar)?366:365,i+(this.m_dblJulian-DT.dateToJD(i,1,1,DT.afterPapalReform(i,1,1)))/e}};function COR(){this.x=0,this.y=0,this.x=0,this.y=0}registerType("DT",[DT,DT$,null]),COR.create=function(e,t){var i=new COR;return i.x=e,i.y=t,i};var COR$={};function C3D(){this.x=0,this.y=0,this.z=0,this.x=0,this.y=0,this.z=0}registerType("COR",[COR,COR$,null]),C3D.create=function(e,t,i){var r=new C3D;return r.x=e,r.y=t,r.z=i,r};var C3D$={};function CT(){}registerType("C3D",[C3D,C3D$,null]),CT.eq2Ec=function(e,t,i){e=CT.h2R(e),t=CT.d2R(t),i=CT.d2R(i);var r=new COR;return r.x=CT.r2D(Math.atan2(Math.sin(e)*Math.cos(i)+Math.tan(t)*Math.sin(i),Math.cos(e))),r.x<0&&(r.x+=360),r.y=CT.r2D(Math.asin(Math.sin(t)*Math.cos(i)-Math.cos(t)*Math.sin(i)*Math.sin(e))),r},CT.ec2Eq=function(e,t,i){e=CT.d2R(e),t=CT.d2R(t),i=CT.d2R(i);var r=new COR;return r.x=CT.r2H(Math.atan2(Math.sin(e)*Math.cos(i)-Math.tan(t)*Math.sin(i),Math.cos(e))),r.x<0&&(r.x+=24),r.y=CT.r2D(Math.asin(Math.sin(t)*Math.cos(i)+Math.cos(t)*Math.sin(i)*Math.sin(e))),r},CT.eq2H=function(e,t,i){e=CT.h2R(e),t=CT.d2R(t),i=CT.d2R(i);var r=new COR;return r.x=CT.r2D(Math.atan2(Math.sin(e),Math.cos(e)*Math.sin(i)-Math.tan(t)*Math.cos(i))),r.x<0&&(r.x+=360),r.y=CT.r2D(Math.asin(Math.sin(i)*Math.sin(t)+Math.cos(i)*Math.cos(t)*Math.cos(e))),r},CT.h2Eq=function(e,t,i){e=CT.d2R(e),t=CT.d2R(t),i=CT.d2R(i);var r=new COR;return r.x=CT.r2H(Math.atan2(Math.sin(e),Math.cos(e)*Math.sin(i)+Math.tan(t)*Math.cos(i))),r.x<0&&(r.x+=24),r.y=CT.r2D(Math.asin(Math.sin(i)*Math.sin(t)-Math.cos(i)*Math.cos(t)*Math.cos(e))),r},CT.eq2G=function(e,t){e=192.25-CT.h2D(e),e=CT.d2R(e),t=CT.d2R(t);var i=new COR;return i.x=CT.r2D(Math.atan2(Math.sin(e),Math.cos(e)*Math.sin(CT.d2R(27.4))-Math.tan(t)*Math.cos(CT.d2R(27.4)))),i.x=303-i.x,i.x>=360&&(i.x-=360),i.y=CT.r2D(Math.asin(Math.sin(t)*Math.sin(CT.d2R(27.4))+Math.cos(t)*Math.cos(CT.d2R(27.4))*Math.cos(e))),i},CT.g2Eq=function(e,t){e-=123,e=CT.d2R(e),t=CT.d2R(t);var i=new COR;return i.x=CT.r2D(Math.atan2(Math.sin(e),Math.cos(e)*Math.sin(CT.d2R(27.4))-Math.tan(t)*Math.cos(CT.d2R(27.4)))),i.x+=12.25,i.x<0&&(i.x+=360),i.x=CT.d2H(i.x),i.y=CT.r2D(Math.asin(Math.sin(t)*Math.sin(CT.d2R(27.4))+Math.cos(t)*Math.cos(CT.d2R(27.4))*Math.cos(e))),i},CT.d2R=function(e){return.0174532925199433*e},CT.r2D=function(e){return 57.2957795130823*e},CT.r2H=function(e){return 3.81971863420549*e},CT.h2R=function(e){return.261799387799149*e},CT.h2D=function(e){return 15*e},CT.d2H=function(e){return e/15},CT.PI=function(){return 3.14159265358979},CT.m360=function(e){return e-360*Math.floor(e/360)},CT.m24=function(e){return e-24*Math.floor(e/24)},CT.dmS2D=function(e,t,i){return CT.dmS2Dp(e,t,i,!0)},CT.dmS2Dp=function(e,t,i,r){return r||(console.assert(e>=0),console.assert(t>=0),console.assert(i>=0)),r?e+t/60+i/3600:-e-t/60-i/3600};var CT$={};function ASEP(){}registerType("CT",[CT,CT$,null]),ASEP.separation=function(e,t,i,r){t=CT.d2R(t),r=CT.d2R(r),e=CT.h2R(e),i=CT.h2R(i);var n=Math.cos(t)*Math.sin(r)-Math.sin(t)*Math.cos(r)*Math.cos(i-e),s=Math.cos(r)*Math.sin(i-e),a=Math.sin(t)*Math.sin(r)+Math.cos(t)*Math.cos(r)*Math.cos(i-e),o=Math.atan2(Math.sqrt(n*n+s*s),a);return(o=CT.r2D(o))<0&&(o+=180),o},ASEP.positionAngle=function(e,t,i,r){var n,s;n=CT.d2R(t),s=CT.d2R(r);var a=CT.h2R(e)-CT.h2R(i),o=Math.cos(s)*Math.tan(n)-Math.sin(s)*Math.cos(a),l=Math.sin(a),h=Math.atan2(l,o);return CT.r2D(h)},ASEP.distanceFromGreatArc=function(e,t,i,r,n,s){t=CT.d2R(t),r=CT.d2R(r),s=CT.d2R(s),e=CT.h2R(e),i=CT.h2R(i),n=CT.h2R(n);var a=Math.cos(t)*Math.cos(e),o=Math.cos(r)*Math.cos(i),l=Math.cos(t)*Math.sin(e),h=Math.cos(r)*Math.sin(i),c=Math.sin(t),u=Math.sin(r),d=l*u-c*h,_=c*o-a*u,g=a*h-l*o,f=Math.tan(n),m=Math.tan(s)/Math.cos(n),p=Math.asin((d+_*f+g*m)/(Math.sqrt(d*d+_*_+g*g)*Math.sqrt(1+f*f+m*m)));return(p=CT.r2D(p))<0&&(p=Math.abs(p)),p};var ASEP$={};function VSC(e,t,i){this.a=0,this.b=0,this.c=0,this.a=e,this.b=t,this.c=i}registerType("ASEP",[ASEP,ASEP$,null]);var VSC$={};registerType("VSC",[VSC,VSC$,null]);const g_L0EarthCoefficients=[new VSC(175347046,0,0),new VSC(3341656,4.6692568,6283.07585),new VSC(34894,4.6261,12566.1517),new VSC(3497,2.7441,5753.3849),new VSC(3418,2.8289,3.5231),new VSC(3136,3.6277,77713.7715),new VSC(2676,4.4181,7860.4194),new VSC(2343,6.1352,3930.2097),new VSC(1324,.7425,11506.7698),new VSC(1273,2.0371,529.691),new VSC(1199,1.1096,1577.3435),new VSC(990,5.233,5884.927),new VSC(902,2.045,26.298),new VSC(857,3.508,398.149),new VSC(780,1.179,5223.694),new VSC(753,2.533,5507.553),new VSC(505,4.583,18849.228),new VSC(492,4.205,775.523),new VSC(357,2.92,.067),new VSC(317,5.849,11790.629),new VSC(284,1.899,796.288),new VSC(271,.315,10977.079),new VSC(243,.345,5486.778),new VSC(206,4.806,2544.314),new VSC(205,1.869,5573.143),new VSC(202,2.458,6069.777),new VSC(156,.833,213.299),new VSC(132,3.411,2942.463),new VSC(126,1.083,20.775),new VSC(115,.645,.98),new VSC(103,.636,4694.003),new VSC(102,.976,15720.839),new VSC(102,4.267,7.114),new VSC(99,6.21,2146.17),new VSC(98,.68,155.42),new VSC(86,5.98,161000.69),new VSC(85,1.3,6275.96),new VSC(85,3.67,71430.7),new VSC(80,1.81,17260.15),new VSC(79,3.04,12036.46),new VSC(75,1.76,5088.63),new VSC(74,3.5,3154.69),new VSC(74,4.68,801.82),new VSC(70,.83,9437.76),new VSC(62,3.98,8827.39),new VSC(61,1.82,7084.9),new VSC(57,2.78,6286.6),new VSC(56,4.39,14143.5),new VSC(56,3.47,6279.55),new VSC(52,.19,12139.55),new VSC(52,1.33,1748.02),new VSC(51,.28,5856.48),new VSC(49,.49,1194.45),new VSC(41,5.37,8429.24),new VSC(41,2.4,19651.05),new VSC(39,6.17,10447.39),new VSC(37,6.04,10213.29),new VSC(37,2.57,1059.38),new VSC(36,1.71,2352.87),new VSC(36,1.78,6812.77),new VSC(33,.59,17789.85),new VSC(30,.44,83996.85),new VSC(30,2.74,1349.87),new VSC(25,3.16,4690.48)],g_L1EarthCoefficients=[new VSC(628331966747,0,0),new VSC(206059,2.678235,6283.07585),new VSC(4303,2.6351,12566.1517),new VSC(425,1.59,3.523),new VSC(119,5.796,26.298),new VSC(109,2.966,1577.344),new VSC(93,2.59,18849.23),new VSC(72,1.14,529.69),new VSC(68,1.87,398.15),new VSC(67,4.41,5507.55),new VSC(59,2.89,5223.69),new VSC(56,2.17,155.42),new VSC(45,.4,796.3),new VSC(36,.47,775.52),new VSC(29,2.65,7.11),new VSC(21,5.43,.98),new VSC(19,1.85,5486.78),new VSC(19,4.97,213.3),new VSC(17,2.99,6275.96),new VSC(16,.03,2544.31),new VSC(16,1.43,2146.17),new VSC(15,1.21,10977.08),new VSC(12,2.83,1748.02),new VSC(12,3.26,5088.63),new VSC(12,5.27,1194.45),new VSC(12,2.08,4694),new VSC(11,.77,553.57),new VSC(10,1.3,6286.6),new VSC(10,4.24,1349.87),new VSC(9,2.7,242.73),new VSC(9,5.64,951.72),new VSC(8,5.3,2352.87),new VSC(6,2.65,9437.76),new VSC(6,4.67,4690.48)],g_L2EarthCoefficients=[new VSC(52919,0,0),new VSC(8720,1.0721,6283.0758),new VSC(309,.867,12566.152),new VSC(27,.05,3.52),new VSC(16,5.19,26.3),new VSC(16,3.68,155.42),new VSC(10,.76,18849.23),new VSC(9,2.06,77713.77),new VSC(7,.83,775.52),new VSC(5,4.66,1577.34),new VSC(4,1.03,7.11),new VSC(4,3.44,5573.14),new VSC(3,5.14,796.3),new VSC(3,6.05,5507.55),new VSC(3,1.19,242.73),new VSC(3,6.12,529.69),new VSC(3,.31,398.15),new VSC(3,2.28,553.57),new VSC(2,4.38,5223.69),new VSC(2,3.75,.98)],g_L3EarthCoefficients=[new VSC(289,5.844,6283.076),new VSC(35,0,0),new VSC(17,5.49,12566.15),new VSC(3,5.2,155.42),new VSC(1,4.72,3.52),new VSC(1,5.3,18849.23),new VSC(1,5.97,242.73)],g_L4EarthCoefficients=[new VSC(114,3.142,0),new VSC(8,4.13,6283.08),new VSC(1,3.84,12566.15)],g_L5EarthCoefficients=[new VSC(1,3.14,0)],g_B0EarthCoefficients=[new VSC(280,3.199,84334.662),new VSC(102,5.422,5507.553),new VSC(80,3.88,5223.69),new VSC(44,3.7,2352.87),new VSC(32,4,1577.34)],g_B1EarthCoefficients=[new VSC(9,3.9,5507.55),new VSC(6,1.73,5223.69)],g_B2EarthCoefficients=[new VSC(22378,3.38509,10213.28555),new VSC(282,0,0),new VSC(173,5.256,20426.571),new VSC(27,3.87,30639.86)],g_B3EarthCoefficients=[new VSC(647,4.992,10213.286),new VSC(20,3.14,0),new VSC(6,.77,20426.57),new VSC(3,5.44,30639.86)],g_B4EarthCoefficients=[new VSC(14,.32,10213.29)],g_R0EarthCoefficients=[new VSC(100013989,0,0),new VSC(1670700,3.0984635,6283.07585),new VSC(13956,3.05525,12566.1517),new VSC(3084,5.1985,77713.7715),new VSC(1628,1.1739,5753.3849),new VSC(1576,2.8469,7860.4194),new VSC(925,5.453,11506.77),new VSC(542,4.564,3930.21),new VSC(472,3.661,5884.927),new VSC(346,.964,5507.553),new VSC(329,5.9,5223.694),new VSC(307,.299,5573.143),new VSC(243,4.273,11790.629),new VSC(212,5.847,1577.344),new VSC(186,5.022,10977.079),new VSC(175,3.012,18849.228),new VSC(110,5.055,5486.778),new VSC(98,.89,6069.78),new VSC(86,5.69,15720.84),new VSC(86,1.27,161000.69),new VSC(65,.27,17260.15),new VSC(63,.92,529.69),new VSC(57,2.01,83996.85),new VSC(56,5.24,71430.7),new VSC(49,3.25,2544.31),new VSC(47,2.58,775.52),new VSC(45,5.54,9437.76),new VSC(43,6.01,6275.96),new VSC(39,5.36,4694),new VSC(38,2.39,8827.39),new VSC(37,.83,19651.05),new VSC(37,4.9,12139.55),new VSC(36,1.67,12036.46),new VSC(35,1.84,2942.46),new VSC(33,.24,7084.9),new VSC(32,.18,5088.63),new VSC(32,1.78,398.15),new VSC(28,1.21,6286.6),new VSC(28,1.9,6279.55),new VSC(26,4.59,10447.39)],g_R1EarthCoefficients=[new VSC(103019,1.10749,6283.07585),new VSC(1721,1.0644,12566.1517),new VSC(702,3.142,0),new VSC(32,1.02,18849.23),new VSC(31,2.84,5507.55),new VSC(25,1.32,5223.69),new VSC(18,1.42,1577.34),new VSC(10,5.91,10977.08),new VSC(9,1.42,6275.96),new VSC(9,.27,5486.78)],g_R2EarthCoefficients=[new VSC(4359,5.7846,6283.0758),new VSC(124,5.579,12566.152),new VSC(12,3.14,0),new VSC(9,3.63,77713.77),new VSC(6,1.87,5573.14),new VSC(3,5.47,18849.23)],g_R3EarthCoefficients=[new VSC(145,4.273,6283.076),new VSC(7,3.92,12566.15)],g_R4EarthCoefficients=[new VSC(4,2.56,6283.08)],g_L1EarthCoefficientsJ2000=[new VSC(628307584999,0,0),new VSC(206059,2.678235,6283.07585),new VSC(4303,2.6351,12566.1517),new VSC(425,1.59,3.523),new VSC(119,5.796,26.298),new VSC(109,2.966,1577.344),new VSC(93,2.59,18849.23),new VSC(72,1.14,529.69),new VSC(68,1.87,398.15),new VSC(67,4.41,5507.55),new VSC(59,2.89,5223.69),new VSC(56,2.17,155.42),new VSC(45,.4,796.3),new VSC(36,.47,775.52),new VSC(29,2.65,7.11),new VSC(21,5.43,.98),new VSC(19,1.85,5486.78),new VSC(19,4.97,213.3),new VSC(17,2.99,6275.96),new VSC(16,.03,2544.31),new VSC(16,1.43,2146.17),new VSC(15,1.21,10977.08),new VSC(12,2.83,1748.02),new VSC(12,3.26,5088.63),new VSC(12,5.27,1194.45),new VSC(12,2.08,4694),new VSC(11,.77,553.57),new VSC(10,1.3,6286.6),new VSC(10,4.24,1349.87),new VSC(9,2.7,242.73),new VSC(9,5.64,951.72),new VSC(8,5.3,2352.87),new VSC(6,2.65,9437.76),new VSC(6,4.67,4690.48)],g_L2EarthCoefficientsJ2000=[new VSC(8722,1.0725,6283.0758),new VSC(991,3.1416,0),new VSC(295,.437,12566.152),new VSC(27,.05,3.52),new VSC(16,5.19,26.3),new VSC(16,3.69,155.42),new VSC(9,.3,18849.23),new VSC(9,2.06,77713.77),new VSC(7,.83,775.52),new VSC(5,4.66,1577.34),new VSC(4,1.03,7.11),new VSC(4,3.44,5573.14),new VSC(3,5.14,796.3),new VSC(3,6.05,5507.55),new VSC(3,1.19,242.73),new VSC(3,6.12,529.69),new VSC(3,.3,398.15),new VSC(3,2.28,553.57),new VSC(2,4.38,5223.69),new VSC(2,3.75,.98)],g_L3EarthCoefficientsJ2000=[new VSC(289,5.842,6283.076),new VSC(21,6.05,12566.15),new VSC(3,5.2,155.42),new VSC(3,3.14,0),new VSC(1,4.72,3.52),new VSC(1,5.97,242.73),new VSC(1,5.54,18849.23)],g_L4EarthCoefficientsJ2000=[new VSC(8,4.14,6283.08),new VSC(1,3.28,12566.15)],g_B1EarthCoefficientsJ2000=[new VSC(227778,3.413766,6283.07585),new VSC(3806,3.3706,12566.1517),new VSC(3620,0,0),new VSC(72,3.33,18849.23),new VSC(8,3.89,5507.55),new VSC(8,1.79,5223.69),new VSC(6,5.2,2352.87)],g_B2EarthCoefficientsJ2000=[new VSC(9721,5.1519,6283.07585),new VSC(233,3.1416,0),new VSC(134,.644,12566.152),new VSC(7,1.07,18849.23)],g_B3EarthCoefficientsJ2000=[new VSC(276,.595,6283.076),new VSC(17,3.14,0),new VSC(4,.12,12566.15)],g_B4EarthCoefficientsJ2000=[new VSC(6,2.27,6283.08),new VSC(1,0,0)];function CAAEarth(){}CAAEarth.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0EarthCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0EarthCoefficients[t].a*Math.cos(g_L0EarthCoefficients[t].b+g_L0EarthCoefficients[t].c*i);var h=g_L1EarthCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1EarthCoefficients[t].a*Math.cos(g_L1EarthCoefficients[t].b+g_L1EarthCoefficients[t].c*i);var u=g_L2EarthCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2EarthCoefficients[t].a*Math.cos(g_L2EarthCoefficients[t].b+g_L2EarthCoefficients[t].c*i);var _=g_L3EarthCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3EarthCoefficients[t].a*Math.cos(g_L3EarthCoefficients[t].b+g_L3EarthCoefficients[t].c*i);var f=g_L4EarthCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4EarthCoefficients[t].a*Math.cos(g_L4EarthCoefficients[t].b+g_L4EarthCoefficients[t].c*i);var p=g_L5EarthCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5EarthCoefficients[t].a*Math.cos(g_L5EarthCoefficients[t].b+g_L5EarthCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAAEarth.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0EarthCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0EarthCoefficients[t].a*Math.cos(g_B0EarthCoefficients[t].b+g_B0EarthCoefficients[t].c*i);var l=g_B1EarthCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_B1EarthCoefficients[t].a*Math.cos(g_B1EarthCoefficients[t].b+g_B1EarthCoefficients[t].c*i);var c=g_B2EarthCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_B2EarthCoefficients[t].a*Math.cos(g_B2EarthCoefficients[t].b+g_B2EarthCoefficients[t].c*i);var d=g_B3EarthCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_B3EarthCoefficients[t].a*Math.cos(g_B3EarthCoefficients[t].b+g_B3EarthCoefficients[t].c*i);var g=g_B4EarthCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_B4EarthCoefficients[t].a*Math.cos(g_B4EarthCoefficients[t].b+g_B4EarthCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAAEarth.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_R0EarthCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_R0EarthCoefficients[t].a*Math.cos(g_R0EarthCoefficients[t].b+g_R0EarthCoefficients[t].c*i);var l=g_R1EarthCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_R1EarthCoefficients[t].a*Math.cos(g_R1EarthCoefficients[t].b+g_R1EarthCoefficients[t].c*i);var c=g_R2EarthCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_R2EarthCoefficients[t].a*Math.cos(g_R2EarthCoefficients[t].b+g_R2EarthCoefficients[t].c*i);var d=g_R3EarthCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_R3EarthCoefficients[t].a*Math.cos(g_R3EarthCoefficients[t].b+g_R3EarthCoefficients[t].c*i);var g=g_R4EarthCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_R4EarthCoefficients[t].a*Math.cos(g_R4EarthCoefficients[t].b+g_R4EarthCoefficients[t].c*i);return(o+h*i+u*r+_*n+f*s)/1e8},CAAEarth.sunMeanAnomaly=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(357.5291092+35999.0502909*t-1536e-7*i+r/2449e4)},CAAEarth.eccentricity=function(e){var t=(e-2451545)/36525;return 1-.002516*t-t*t*74e-7},CAAEarth.eclipticLongitudeJ2000=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_L0EarthCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_L0EarthCoefficients[t].a*Math.cos(g_L0EarthCoefficients[t].b+g_L0EarthCoefficients[t].c*i);var l=g_L1EarthCoefficientsJ2000.length,h=0;for(t=0;t<l;t++)h+=g_L1EarthCoefficientsJ2000[t].a*Math.cos(g_L1EarthCoefficientsJ2000[t].b+g_L1EarthCoefficientsJ2000[t].c*i);var c=g_L2EarthCoefficientsJ2000.length,u=0;for(t=0;t<c;t++)u+=g_L2EarthCoefficientsJ2000[t].a*Math.cos(g_L2EarthCoefficientsJ2000[t].b+g_L2EarthCoefficientsJ2000[t].c*i);var d=g_L3EarthCoefficientsJ2000.length,_=0;for(t=0;t<d;t++)_+=g_L3EarthCoefficientsJ2000[t].a*Math.cos(g_L3EarthCoefficientsJ2000[t].b+g_L3EarthCoefficientsJ2000[t].c*i);var g=g_L4EarthCoefficientsJ2000.length,f=0;for(t=0;t<g;t++)f+=g_L4EarthCoefficientsJ2000[t].a*Math.cos(g_L4EarthCoefficientsJ2000[t].b+g_L4EarthCoefficientsJ2000[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.m360(CT.r2D(m))},CAAEarth.eclipticLatitudeJ2000=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0EarthCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0EarthCoefficients[t].a*Math.cos(g_B0EarthCoefficients[t].b+g_B0EarthCoefficients[t].c*i);var l=g_B1EarthCoefficientsJ2000.length,h=0;for(t=0;t<l;t++)h+=g_B1EarthCoefficientsJ2000[t].a*Math.cos(g_B1EarthCoefficientsJ2000[t].b+g_B1EarthCoefficientsJ2000[t].c*i);var c=g_B2EarthCoefficientsJ2000.length,u=0;for(t=0;t<c;t++)u+=g_B2EarthCoefficientsJ2000[t].a*Math.cos(g_B2EarthCoefficientsJ2000[t].b+g_B2EarthCoefficientsJ2000[t].c*i);var d=g_B3EarthCoefficientsJ2000.length,_=0;for(t=0;t<d;t++)_+=g_B3EarthCoefficientsJ2000[t].a*Math.cos(g_B3EarthCoefficientsJ2000[t].b+g_B3EarthCoefficientsJ2000[t].c*i);var g=g_B4EarthCoefficientsJ2000.length,f=0;for(t=0;t<g;t++)f+=g_B4EarthCoefficientsJ2000[t].a*Math.cos(g_B4EarthCoefficientsJ2000[t].b+g_B4EarthCoefficientsJ2000[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)};var CAAEarth$={};function CAAFK5(){}registerType("CAAEarth",[CAAEarth,CAAEarth$,null]),CAAFK5.correctionInLongitude=function(e,t,i){var r=(i-2451545)/36525,n=e-1.397*r-31e-5*r*r;n=CT.d2R(n),e=CT.d2R(e),t=CT.d2R(t);var s=.03916*(Math.cos(n)+Math.sin(n))*Math.tan(t)-.09033;return CT.dmS2D(0,0,s)},CAAFK5.correctionInLatitude=function(e,t){var i=(t-2451545)/36525,r=e-1.397*i-31e-5*i*i;r=CT.d2R(r),e=CT.d2R(e);var n=.03916*(Math.cos(r)-Math.sin(r));return CT.dmS2D(0,0,n)},CAAFK5.convertVSOPToFK5J2000=function(e){var t=new C3D;return t.x=e.x+4.4036e-7*e.y-1.90919e-7*e.z,t.y=-4.79966e-7*e.x+.917482137087*e.y-.397776982902*e.z,t.z=.397776982902*e.y+.917482137087*e.z,t},CAAFK5.convertVSOPToFK5B1950=function(e){var t=new C3D;return t.x=.999925702634*e.x+.012189716217*e.y+11134016e-12*e.z,t.y=-.011179418036*e.x+.917413998946*e.y-.397777041885*e.z,t.z=-.004859003787*e.x+.397747363646*e.y+.917482111428*e.z,t},CAAFK5.convertVSOPToFK5AnyEquinox=function(e,t){var i=(t-2451545)/36525,r=i*i,n=r*i,s=2306.2181*i+.30188*r+.017988*n;s=CT.d2R(CT.dmS2D(0,0,s));var a=2306.2181*i+1.09468*r+.018203*n;a=CT.d2R(CT.dmS2D(0,0,a));var o=2004.3109*i-.42665*r-.041833*n;o=CT.d2R(CT.dmS2D(0,0,o));var l=Math.cos(s),h=Math.cos(a),c=Math.cos(o),u=Math.sin(s),d=Math.sin(a),_=Math.sin(o),g=l*h*c-u*d,f=u*h+l*d*c,m=l*_,p=-l*d-u*h*c,C=l*h-u*d*c,S=-u*_,w=-h*_,T=-d*_,y=c,b=new C3D;return b.x=g*e.x+p*e.y+w*e.z,b.y=f*e.x+C*e.y+T*e.z,b.z=m*e.x+S*e.y+y*e.z,b};var CAAFK5$={};function NUC(e,t,i,r,n,s,a,o,l){this.d=0,this.m=0,this.mprime=0,this.f=0,this.omega=0,this.sincoeff1=0,this.sincoeff2=0,this.coscoeff1=0,this.coscoeff2=0,this.d=e,this.m=t,this.mprime=i,this.f=r,this.omega=n,this.sincoeff1=s,this.sincoeff2=a,this.coscoeff1=o,this.coscoeff2=l}registerType("CAAFK5",[CAAFK5,CAAFK5$,null]);var NUC$={};registerType("NUC",[NUC,NUC$,null]);const g_NuC=[new NUC(0,0,0,0,1,-171996,-174.2,92025,8.9),new NUC(-2,0,0,2,2,-13187,-1.6,5736,-3.1),new NUC(0,0,0,2,2,-2274,-.2,977,-.5),new NUC(0,0,0,0,2,2062,.2,-895,.5),new NUC(0,1,0,0,0,1426,-3.4,54,-.1),new NUC(0,0,1,0,0,712,.1,-7,0),new NUC(-2,1,0,2,2,-517,1.2,224,-.6),new NUC(0,0,0,2,1,-386,-.4,200,0),new NUC(0,0,1,2,2,-301,0,129,-.1),new NUC(-2,-1,0,2,2,217,-.5,-95,.3),new NUC(-2,0,1,0,0,-158,0,0,0),new NUC(-2,0,0,2,1,129,.1,-70,0),new NUC(0,0,-1,2,2,123,0,-53,0),new NUC(2,0,0,0,0,63,0,0,0),new NUC(0,0,1,0,1,63,.1,-33,0),new NUC(2,0,-1,2,2,-59,0,26,0),new NUC(0,0,-1,0,1,-58,-.1,32,0),new NUC(0,0,1,2,1,-51,0,27,0),new NUC(-2,0,2,0,0,48,0,0,0),new NUC(0,0,-2,2,1,46,0,-24,0),new NUC(2,0,0,2,2,-38,0,16,0),new NUC(0,0,2,2,2,-31,0,13,0),new NUC(0,0,2,0,0,29,0,0,0),new NUC(-2,0,1,2,2,29,0,-12,0),new NUC(0,0,0,2,0,26,0,0,0),new NUC(-2,0,0,2,0,-22,0,0,0),new NUC(0,0,-1,2,1,21,0,-10,0),new NUC(0,2,0,0,0,17,-.1,0,0),new NUC(2,0,-1,0,1,16,0,-8,0),new NUC(-2,2,0,2,2,-16,.1,7,0),new NUC(0,1,0,0,1,-15,0,9,0),new NUC(-2,0,1,0,1,-13,0,7,0),new NUC(0,-1,0,0,1,-12,0,6,0),new NUC(0,0,2,-2,0,11,0,0,0),new NUC(2,0,-1,2,1,-10,0,5,0),new NUC(2,0,1,2,2,-8,0,3,0),new NUC(0,1,0,2,2,7,0,-3,0),new NUC(-2,1,1,0,0,-7,0,0,0),new NUC(0,-1,0,2,2,-7,0,3,0),new NUC(2,0,0,2,1,-7,0,3,0),new NUC(2,0,1,0,0,6,0,0,0),new NUC(-2,0,2,2,2,6,0,-3,0),new NUC(-2,0,1,2,1,6,0,-3,0),new NUC(2,0,-2,0,1,-6,0,3,0),new NUC(2,0,0,0,1,-6,0,3,0),new NUC(0,-1,1,0,0,5,0,0,0),new NUC(-2,-1,0,2,1,-5,0,3,0),new NUC(-2,0,0,0,1,-5,0,3,0),new NUC(0,0,2,2,1,-5,0,3,0),new NUC(-2,0,2,0,1,4,0,0,0),new NUC(-2,1,0,2,1,4,0,0,0),new NUC(0,0,1,-2,0,4,0,0,0),new NUC(-1,0,1,0,0,-4,0,0,0),new NUC(-2,1,0,0,0,-4,0,0,0),new NUC(1,0,0,0,0,-4,0,0,0),new NUC(0,0,1,2,0,3,0,0,0),new NUC(0,0,-2,2,2,-3,0,0,0),new NUC(-1,-1,1,0,0,-3,0,0,0),new NUC(0,1,1,0,0,-3,0,0,0),new NUC(0,-1,1,2,2,-3,0,0,0),new NUC(2,-1,-1,2,2,-3,0,0,0),new NUC(0,0,3,2,2,-3,0,0,0),new NUC(2,-1,0,2,2,-3,0,0,0)];function CAANutation(){}CAANutation.nutationInLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=297.85036+445267.11148*t-.0019142*i+r/189474;n=CT.m360(n);var s=357.52772+35999.05034*t-1603e-7*i-r/3e5;s=CT.m360(s);var a=134.96298+477198.867398*t+.0086972*i+r/56250;a=CT.m360(a);var o=93.27191+483202.017538*t-.0036825*i+r/327270;o=CT.m360(o);var l=125.04452-1934.136261*t+.0020708*i+r/45e4;l=CT.m360(l);for(var h=g_NuC.length,c=0,u=0;u<h;u++){var d=g_NuC[u].d*n+g_NuC[u].m*s+g_NuC[u].mprime*a+g_NuC[u].f*o+g_NuC[u].omega*l,_=CT.d2R(d);c+=(g_NuC[u].sincoeff1+g_NuC[u].sincoeff2*t)*Math.sin(_)*1e-4}return c},CAANutation.nutationInObliquity=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=297.85036+445267.11148*t-.0019142*i+r/189474;n=CT.m360(n);var s=357.52772+35999.05034*t-1603e-7*i-r/3e5;s=CT.m360(s);var a=134.96298+477198.867398*t+.0086972*i+r/56250;a=CT.m360(a);var o=93.27191+483202.017538*t-.0036825*i+r/327270;o=CT.m360(o);var l=125.04452-1934.136261*t+.0020708*i+r/45e4;l=CT.m360(l);for(var h=g_NuC.length,c=0,u=0;u<h;u++){var d=g_NuC[u].d*n+g_NuC[u].m*s+g_NuC[u].mprime*a+g_NuC[u].f*o+g_NuC[u].omega*l,_=CT.d2R(d);c+=(g_NuC[u].coscoeff1+g_NuC[u].coscoeff2*t)*Math.cos(_)*1e-4}return c},CAANutation.nutationInRightAscension=function(e,t,i,r,n){return e=CT.h2R(e),t=CT.d2R(t),i=CT.d2R(i),(Math.cos(i)+Math.sin(i)*Math.sin(e)*Math.tan(t))*r-Math.cos(e)*Math.tan(t)*n},CAANutation.nutationInDeclination=function(e,t,i,r,n){return e=CT.h2R(e),t=CT.d2R(t),i=CT.d2R(i),Math.sin(i)*Math.cos(e)*r+Math.sin(e)*n},CAANutation.meanObliquityOfEcliptic=function(e){var t=(e-2451545)/3652500,i=t*t,r=i*t,n=r*t,s=n*t,a=s*t,o=a*t,l=o*t,h=l*t,c=h*t;return CT.dmS2D(23,26,21.448)-CT.dmS2D(0,0,4680.93)*t-CT.dmS2D(0,0,1.55)*i+CT.dmS2D(0,0,1999.25)*r-CT.dmS2D(0,0,51.38)*n-CT.dmS2D(0,0,249.67)*s-CT.dmS2D(0,0,39.05)*a+CT.dmS2D(0,0,7.12)*o+CT.dmS2D(0,0,27.87)*l+CT.dmS2D(0,0,5.79)*h+CT.dmS2D(0,0,2.45)*c},CAANutation.trueObliquityOfEcliptic=function(e){return CAANutation.meanObliquityOfEcliptic(e)+CT.dmS2D(0,0,CAANutation.nutationInObliquity(e))};var CAANutation$={};function CAASun(){}registerType("CAANutation",[CAANutation,CAANutation$,null]),CAASun.geometricEclipticLongitude=function(e){return CT.m360(CAAEarth.eclipticLongitude(e)+180)},CAASun.geometricEclipticLatitude=function(e){return-CAAEarth.eclipticLatitude(e)},CAASun.geometricEclipticLongitudeJ2000=function(e){return CT.m360(CAAEarth.eclipticLongitudeJ2000(e)+180)},CAASun.geometricEclipticLatitudeJ2000=function(e){return-CAAEarth.eclipticLatitudeJ2000(e)},CAASun.geometricFK5EclipticLongitude=function(e){var t=CAASun.geometricEclipticLongitude(e),i=CAASun.geometricEclipticLatitude(e);return t+CAAFK5.correctionInLongitude(t,i,e)},CAASun.geometricFK5EclipticLatitude=function(e){var t=CAASun.geometricEclipticLongitude(e);return CAASun.geometricEclipticLatitude(e)+CAAFK5.correctionInLatitude(t,e)},CAASun.apparentEclipticLongitude=function(e){var t=CAASun.geometricFK5EclipticLongitude(e);t+=CT.dmS2D(0,0,CAANutation.nutationInLongitude(e));var i=CAAEarth.radiusVector(e);return t-CT.dmS2D(0,0,20.4898/i)},CAASun.apparentEclipticLatitude=function(e){return CAASun.geometricFK5EclipticLatitude(e)},CAASun.eclipticRectangularCoordinatesMeanEquinox=function(e){var t=CT.d2R(CAASun.geometricFK5EclipticLongitude(e)),i=CT.d2R(CAASun.geometricFK5EclipticLatitude(e)),r=CAAEarth.radiusVector(e),n=CT.d2R(CAANutation.meanObliquityOfEcliptic(e)),s=new C3D;return s.x=r*Math.cos(i)*Math.cos(t),s.y=r*(Math.cos(i)*Math.sin(t)*Math.cos(n)-Math.sin(i)*Math.sin(n)),s.z=r*(Math.cos(i)*Math.sin(t)*Math.sin(n)+Math.sin(i)*Math.cos(n)),s},CAASun.eclipticRectangularCoordinatesJ2000=function(e){var t=CAASun.geometricEclipticLongitudeJ2000(e);t=CT.d2R(t);var i=CAASun.geometricEclipticLatitudeJ2000(e);i=CT.d2R(i);var r=CAAEarth.radiusVector(e),n=new C3D,s=Math.cos(i);return n.x=r*s*Math.cos(t),n.y=r*s*Math.sin(t),n.z=r*Math.sin(i),n},CAASun.equatorialRectangularCoordinatesJ2000=function(e){var t=CAASun.eclipticRectangularCoordinatesJ2000(e);return CAAFK5.convertVSOPToFK5J2000(t)},CAASun.equatorialRectangularCoordinatesB1950=function(e){var t=CAASun.eclipticRectangularCoordinatesJ2000(e);return CAAFK5.convertVSOPToFK5B1950(t)},CAASun.equatorialRectangularCoordinatesAnyEquinox=function(e,t){var i=CAASun.equatorialRectangularCoordinatesJ2000(e);return CAAFK5.convertVSOPToFK5AnyEquinox(i,t)};var CAASun$={};registerType("CAASun",[CAASun,CAASun$,null]);const g_L0MercuryCoefficients=[new VSC(440250710,0,0),new VSC(40989415,1.48302034,26087.90314157),new VSC(5046294,4.47785449,52175.8062831),new VSC(855347,1.165203,78263.709425),new VSC(165590,4.119692,104351.612566),new VSC(34562,.77931,130439.51571),new VSC(7583,3.7135,156527.4188),new VSC(3560,1.512,1109.3786),new VSC(1803,4.1033,5661.332),new VSC(1726,.3583,182615.322),new VSC(1590,2.9951,25028.5212),new VSC(1365,4.5992,27197.2817),new VSC(1017,.8803,31749.2352),new VSC(714,1.541,24978.525),new VSC(644,5.303,21535.95),new VSC(451,6.05,51116.424),new VSC(404,3.282,208703.225),new VSC(352,5.242,20426.571),new VSC(345,2.792,15874.618),new VSC(343,5.765,955.6),new VSC(339,5.863,25558.212),new VSC(325,1.337,53285.185),new VSC(273,2.495,529.691),new VSC(264,3.917,57837.138),new VSC(260,.987,4551.953),new VSC(239,.113,1059.382),new VSC(235,.267,11322.664),new VSC(217,.66,13521.751),new VSC(209,2.092,47623.853),new VSC(183,2.629,27043.503),new VSC(182,2.434,25661.305),new VSC(176,4.536,51066.428),new VSC(173,2.452,24498.83),new VSC(142,3.36,37410.567),new VSC(138,.291,10213.286),new VSC(125,3.721,39609.655),new VSC(118,2.781,77204.327),new VSC(106,4.206,19804.827)],g_L1MercuryCoefficients=[new VSC(2608814706223,0,0),new VSC(1126008,6.2170397,26087.9031416),new VSC(303471,3.055655,52175.806283),new VSC(80538,6.10455,78263.70942),new VSC(21245,2.83532,104351.61257),new VSC(5592,5.8268,130439.5157),new VSC(1472,2.5185,156527.4188),new VSC(388,5.48,182615.322),new VSC(352,3.052,1109.379),new VSC(103,2.149,208703.225),new VSC(94,6.12,27197.28),new VSC(91,0,24978.52),new VSC(52,5.62,5661.33),new VSC(44,4.57,25028.52),new VSC(28,3.04,51066.43),new VSC(27,5.09,234791.13)],g_L2MercuryCoefficients=[new VSC(53050,0,0),new VSC(16904,4.69072,26087.90314),new VSC(7397,1.3474,52175.8063),new VSC(3018,4.4564,78263.7094),new VSC(1107,1.264,104351.6126),new VSC(378,4.32,130439.516),new VSC(123,1.069,156527.419),new VSC(39,4.08,182615.32),new VSC(15,4.63,1109.38),new VSC(12,.79,208703.23)],g_L3MercuryCoefficients=[new VSC(188,.035,52175.806),new VSC(142,3.125,26087.903),new VSC(97,3,78263.71),new VSC(44,6.02,104351.61),new VSC(35,0,0),new VSC(18,2.78,130439.52),new VSC(7,5.82,156527.42),new VSC(3,2.57,182615.32)],g_L4MercuryCoefficients=[new VSC(114,3.1416,0),new VSC(2,2.03,26087.9),new VSC(2,1.42,78263.71),new VSC(2,4.5,52175.81),new VSC(1,4.5,104351.61),new VSC(1,1.27,130439.52)],g_L5MercuryCoefficients=[new VSC(1,3.14,0)],g_B0MercuryCoefficients=[new VSC(11737529,1.98357499,26087.90314157),new VSC(2388077,5.0373896,52175.8062831),new VSC(1222840,3.1415927,0),new VSC(543252,1.796444,78263.709425),new VSC(129779,4.832325,104351.612566),new VSC(31867,1.58088,130439.51571),new VSC(7963,4.6097,156527.4188),new VSC(2014,1.3532,182615.322),new VSC(514,4.378,208703.325),new VSC(209,2.02,24978.525),new VSC(208,4.918,27197.282),new VSC(132,1.119,234791.128),new VSC(121,1.813,53285.185),new VSC(100,5.657,20426.571)],g_B1MercuryCoefficients=[new VSC(429151,3.501698,26087.903142),new VSC(146234,3.141593,0),new VSC(22675,.01515,52175.80628),new VSC(10895,.4854,78263.70942),new VSC(6353,3.4294,104351.6126),new VSC(2496,.1605,130439.5157),new VSC(860,3.185,156527.419),new VSC(278,6.21,182615.322),new VSC(86,2.95,208703.23),new VSC(28,.29,27197.28),new VSC(26,5.98,234791.13)],g_B2MercuryCoefficients=[new VSC(11831,4.79066,26087.90314),new VSC(1914,0,0),new VSC(1045,1.2122,52175.8063),new VSC(266,4.434,78263.709),new VSC(170,1.623,104351.613),new VSC(96,4.8,130439.52),new VSC(45,1.61,156527.42),new VSC(18,4.67,182615.32),new VSC(7,1.43,208703.23)],g_B3MercuryCoefficients=[new VSC(235,.354,26087.903),new VSC(161,0,0),new VSC(19,4.36,52175.81),new VSC(6,2.51,78263.71),new VSC(5,6.14,104351.61),new VSC(3,3.12,130439.52),new VSC(2,6.27,156527.42)],g_B4MercuryCoefficients=[new VSC(4,1.75,26087.9),new VSC(1,3.14,0)],g_R0MercuryCoefficients=[new VSC(39528272,0,0),new VSC(7834132,6.1923372,26087.9031416),new VSC(795526,2.959897,52175.806283),new VSC(121282,6.010642,78263.709425),new VSC(21922,2.7782,104351.61257),new VSC(4354,5.8289,130439.5157),new VSC(918,2.597,156527.419),new VSC(290,1.424,25028.521),new VSC(260,3.028,27197.282),new VSC(202,5.647,182615.322),new VSC(201,5.592,31749.235),new VSC(142,6.253,24978.525),new VSC(100,3.734,21535.95)],g_R1MercuryCoefficients=[new VSC(217348,4.656172,26087.903142),new VSC(44142,1.42386,52175.80628),new VSC(10094,4.47466,78263.70942),new VSC(2433,1.2423,104351.6126),new VSC(1624,0,0),new VSC(604,4.293,130439.516),new VSC(153,1.061,156527.419),new VSC(39,4.11,182615.32)],g_R2MercuryCoefficients=[new VSC(3118,3.0823,26087.9031),new VSC(1245,6.1518,52175.8063),new VSC(425,2.926,78263.709),new VSC(136,5.98,104351.613),new VSC(42,2.75,130439.52),new VSC(22,3.14,0),new VSC(13,5.8,156527.42)],g_R3MercuryCoefficients=[new VSC(33,1.68,26087.9),new VSC(24,4.63,52175.81),new VSC(12,1.39,78263.71),new VSC(5,4.44,104351.61),new VSC(2,1.21,130439.52)];function CAAMercury(){}CAAMercury.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0MercuryCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0MercuryCoefficients[t].a*Math.cos(g_L0MercuryCoefficients[t].b+g_L0MercuryCoefficients[t].c*i);var h=g_L1MercuryCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1MercuryCoefficients[t].a*Math.cos(g_L1MercuryCoefficients[t].b+g_L1MercuryCoefficients[t].c*i);var u=g_L2MercuryCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2MercuryCoefficients[t].a*Math.cos(g_L2MercuryCoefficients[t].b+g_L2MercuryCoefficients[t].c*i);var _=g_L3MercuryCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3MercuryCoefficients[t].a*Math.cos(g_L3MercuryCoefficients[t].b+g_L3MercuryCoefficients[t].c*i);var f=g_L4MercuryCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4MercuryCoefficients[t].a*Math.cos(g_L4MercuryCoefficients[t].b+g_L4MercuryCoefficients[t].c*i);var p=g_L5MercuryCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5MercuryCoefficients[t].a*Math.cos(g_L5MercuryCoefficients[t].b+g_L5MercuryCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAAMercury.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0MercuryCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0MercuryCoefficients[t].a*Math.cos(g_B0MercuryCoefficients[t].b+g_B0MercuryCoefficients[t].c*i);var l=g_B1MercuryCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_B1MercuryCoefficients[t].a*Math.cos(g_B1MercuryCoefficients[t].b+g_B1MercuryCoefficients[t].c*i);var c=g_B2MercuryCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_B2MercuryCoefficients[t].a*Math.cos(g_B2MercuryCoefficients[t].b+g_B2MercuryCoefficients[t].c*i);var d=g_B3MercuryCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_B3MercuryCoefficients[t].a*Math.cos(g_B3MercuryCoefficients[t].b+g_B3MercuryCoefficients[t].c*i);var g=g_B4MercuryCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_B4MercuryCoefficients[t].a*Math.cos(g_B4MercuryCoefficients[t].b+g_B4MercuryCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAAMercury.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=g_R0MercuryCoefficients.length,a=0;for(t=0;t<s;t++)a+=g_R0MercuryCoefficients[t].a*Math.cos(g_R0MercuryCoefficients[t].b+g_R0MercuryCoefficients[t].c*i);var o=g_R1MercuryCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_R1MercuryCoefficients[t].a*Math.cos(g_R1MercuryCoefficients[t].b+g_R1MercuryCoefficients[t].c*i);var h=g_R2MercuryCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_R2MercuryCoefficients[t].a*Math.cos(g_R2MercuryCoefficients[t].b+g_R2MercuryCoefficients[t].c*i);var u=g_R3MercuryCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_R3MercuryCoefficients[t].a*Math.cos(g_R3MercuryCoefficients[t].b+g_R3MercuryCoefficients[t].c*i);return(a+l*i+c*r+d*n)/1e8};var CAAMercury$={};registerType("CAAMercury",[CAAMercury,CAAMercury$,null]);const g_L0VenusCoefficients=[new VSC(317614667,0,0),new VSC(1353968,5.5931332,10213.2855462),new VSC(89892,5.3065,20426.57109),new VSC(5477,4.4163,7860.4194),new VSC(3456,2.6996,11790.6291),new VSC(2372,2.9938,3930.2097),new VSC(1664,4.2502,1577.3435),new VSC(1438,4.1575,9683.5946),new VSC(1317,5.1867,26.2983),new VSC(1201,6.1536,30639.8566),new VSC(769,.816,9437.763),new VSC(761,1.95,529.691),new VSC(708,1.065,775.523),new VSC(585,3.998,191.448),new VSC(500,4.123,15720.839),new VSC(429,3.586,19367.189),new VSC(327,5.677,5507.553),new VSC(326,4.591,10404.734),new VSC(232,3.163,9153.904),new VSC(180,4.653,1109.379),new VSC(155,5.57,19651.048),new VSC(128,4.226,20.775),new VSC(128,.962,5661.332),new VSC(106,1.537,801.821)],g_L1VenusCoefficients=[new VSC(0xedcd611dcd,0,0),new VSC(95708,2.46424,10213.28555),new VSC(14445,.51625,20426.57109),new VSC(213,1.795,30639.857),new VSC(174,2.655,26.298),new VSC(152,6.106,1577.344),new VSC(82,5.7,191.45),new VSC(70,2.68,9437.76),new VSC(52,3.6,775.52),new VSC(38,1.03,529.69),new VSC(30,1.25,5507.55),new VSC(25,6.11,10404.73)],g_L2VenusCoefficients=[new VSC(54127,0,0),new VSC(3891,.3451,10213.2855),new VSC(1338,2.0201,20426.5711),new VSC(24,2.05,26.3),new VSC(19,3.54,30639.86),new VSC(10,3.97,775.52),new VSC(7,1.52,1577.34),new VSC(6,1,191.45)],g_L3VenusCoefficients=[new VSC(136,4.804,10213.286),new VSC(78,3.67,20426.57),new VSC(26,0,0)],g_L4VenusCoefficients=[new VSC(114,3.1416,0),new VSC(3,5.21,20426.57),new VSC(2,2.51,10213.29)],g_L5VenusCoefficients=[new VSC(1,3.14,0)],g_B0VenusCoefficients=[new VSC(5923638,.2670278,10213.2855462),new VSC(40108,1.14737,20426.57109),new VSC(32815,3.14737,0),new VSC(1011,1.0895,30639.8566),new VSC(149,6.254,18073.705),new VSC(138,.86,1577.344),new VSC(130,3.672,9437.763),new VSC(120,3.705,2352.866),new VSC(108,4.539,22003.915)],g_B1VenusCoefficients=[new VSC(513348,1.803643,10213.285546),new VSC(4380,3.3862,20426.5711),new VSC(199,0,0),new VSC(197,2.53,30639.857)],g_B2VenusCoefficients=[new VSC(22378,3.38509,10213.28555),new VSC(282,0,0),new VSC(173,5.256,20426.571),new VSC(27,3.87,30639.86)],g_B3VenusCoefficients=[new VSC(647,4.992,10213.286),new VSC(20,3.14,0),new VSC(6,.77,20426.57),new VSC(3,5.44,30639.86)],g_B4VenusCoefficients=[new VSC(14,.32,10213.29)],g_R0VenusCoefficients=[new VSC(72334821,0,0),new VSC(489824,4.021518,10213.285546),new VSC(1658,4.9021,20426.5711),new VSC(1632,2.8455,7860.4194),new VSC(1378,1.1285,11790.6291),new VSC(498,2.587,9683.595),new VSC(374,1.423,3930.21),new VSC(264,5.529,9437.763),new VSC(237,2.551,15720.839),new VSC(222,2.013,19367.189),new VSC(126,2.728,1577.344),new VSC(119,3.02,10404.734)],g_R1VenusCoefficients=[new VSC(34551,.89199,10213.28555),new VSC(234,1.772,20426.571),new VSC(234,3.142,0)],g_R2VenusCoefficients=[new VSC(1407,5.0637,10213.2855),new VSC(16,5.47,20426.57),new VSC(13,0,0)],g_R3VenusCoefficients=[new VSC(50,3.22,10213.29)],g_R4VenusCoefficients=[new VSC(1,.92,10213.29)];function CAAVenus(){}CAAVenus.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0VenusCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0VenusCoefficients[t].a*Math.cos(g_L0VenusCoefficients[t].b+g_L0VenusCoefficients[t].c*i);var h=g_L1VenusCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1VenusCoefficients[t].a*Math.cos(g_L1VenusCoefficients[t].b+g_L1VenusCoefficients[t].c*i);var u=g_L2VenusCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2VenusCoefficients[t].a*Math.cos(g_L2VenusCoefficients[t].b+g_L2VenusCoefficients[t].c*i);var _=g_L3VenusCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3VenusCoefficients[t].a*Math.cos(g_L3VenusCoefficients[t].b+g_L3VenusCoefficients[t].c*i);var f=g_L4VenusCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4VenusCoefficients[t].a*Math.cos(g_L4VenusCoefficients[t].b+g_L4VenusCoefficients[t].c*i);var p=g_L5VenusCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5VenusCoefficients[t].a*Math.cos(g_L5VenusCoefficients[t].b+g_L5VenusCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAAVenus.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0VenusCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0VenusCoefficients[t].a*Math.cos(g_B0VenusCoefficients[t].b+g_B0VenusCoefficients[t].c*i);var l=g_B1VenusCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_B1VenusCoefficients[t].a*Math.cos(g_B1VenusCoefficients[t].b+g_B1VenusCoefficients[t].c*i);var c=g_B2VenusCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_B2VenusCoefficients[t].a*Math.cos(g_B2VenusCoefficients[t].b+g_B2VenusCoefficients[t].c*i);var d=g_B3VenusCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_B3VenusCoefficients[t].a*Math.cos(g_B3VenusCoefficients[t].b+g_B3VenusCoefficients[t].c*i);var g=g_B4VenusCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_B4VenusCoefficients[t].a*Math.cos(g_B4VenusCoefficients[t].b+g_B4VenusCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAAVenus.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_R0VenusCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_R0VenusCoefficients[t].a*Math.cos(g_R0VenusCoefficients[t].b+g_R0VenusCoefficients[t].c*i);var l=g_R1VenusCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_R1VenusCoefficients[t].a*Math.cos(g_R1VenusCoefficients[t].b+g_R1VenusCoefficients[t].c*i);var c=g_R2VenusCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_R2VenusCoefficients[t].a*Math.cos(g_R2VenusCoefficients[t].b+g_R2VenusCoefficients[t].c*i);var d=g_R3VenusCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_R3VenusCoefficients[t].a*Math.cos(g_R3VenusCoefficients[t].b+g_R3VenusCoefficients[t].c*i);var g=g_R4VenusCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_R4VenusCoefficients[t].a*Math.cos(g_R4VenusCoefficients[t].b+g_R4VenusCoefficients[t].c*i);return(o+h*i+u*r+_*n+f*s)/1e8};var CAAVenus$={};registerType("CAAVenus",[CAAVenus,CAAVenus$,null]);const g_L0MarsCoefficients=[new VSC(620347712,0,0),new VSC(18656368,5.050371,3340.6124267),new VSC(1108217,5.4009984,6681.2248534),new VSC(91798,5.75479,10021.83728),new VSC(27745,5.9705,3.52312),new VSC(12316,.84956,2810.92146),new VSC(10610,2.93959,2281.2305),new VSC(8927,4.157,.0173),new VSC(8716,6.1101,13362.4497),new VSC(7775,3.3397,5621.8429),new VSC(6798,.3646,398.149),new VSC(4161,.2281,2942.4634),new VSC(3575,1.6619,2544.3144),new VSC(3075,.857,191.4483),new VSC(2938,6.0789,.0673),new VSC(2628,.6481,3337.0893),new VSC(2580,.03,3344.1355),new VSC(2389,5.039,796.298),new VSC(1799,.6563,529.691),new VSC(1546,2.9158,1751.5395),new VSC(1528,1.1498,6151.5339),new VSC(1286,3.068,2146.1654),new VSC(1264,3.6228,5092.152),new VSC(1025,3.6933,8962.4553),new VSC(892,.183,16703.062),new VSC(859,2.401,2914.014),new VSC(833,4.495,3340.63),new VSC(833,2.464,3340.595),new VSC(749,3.822,155.42),new VSC(724,.675,3738.761),new VSC(713,3.663,1059.382),new VSC(655,.489,3127.313),new VSC(636,2.922,8432.764),new VSC(553,4.475,1748.016),new VSC(550,3.81,.98),new VSC(472,3.625,1194.447),new VSC(426,.554,6283.076),new VSC(415,.497,213.299),new VSC(312,.999,6677.702),new VSC(307,.381,6684.748),new VSC(302,4.486,3532.061),new VSC(299,2.783,6254.627),new VSC(293,4.221,20.775),new VSC(284,5.769,3149.164),new VSC(281,5.882,1349.867),new VSC(274,.542,3340.545),new VSC(274,.134,3340.68),new VSC(239,5.372,4136.91),new VSC(236,5.755,3333.499),new VSC(231,1.282,3870.303),new VSC(221,3.505,382.897),new VSC(204,2.821,1221.849),new VSC(193,3.357,3.59),new VSC(189,1.491,9492.146),new VSC(179,1.006,951.718),new VSC(174,2.414,553.569),new VSC(172,.439,5486.778),new VSC(160,3.949,4562.461),new VSC(144,1.419,135.065),new VSC(140,3.326,2700.715),new VSC(138,4.301,7.114),new VSC(131,4.045,12303.068),new VSC(128,2.208,1592.596),new VSC(128,1.807,5088.629),new VSC(117,3.128,7903.073),new VSC(113,3.701,1589.073),new VSC(110,1.052,242.729),new VSC(105,.785,8827.39),new VSC(100,3.243,11773.377)],g_L1MarsCoefficients=[new VSC(334085627474,0,0),new VSC(1458227,3.6042605,3340.6124267),new VSC(164901,3.926313,6681.224853),new VSC(19963,4.26594,10021.83728),new VSC(3452,4.7321,3.5231),new VSC(2485,4.6128,13362.4497),new VSC(842,4.459,2281.23),new VSC(538,5.016,398.149),new VSC(521,4.994,3344.136),new VSC(433,2.561,191.448),new VSC(430,5.316,155.42),new VSC(382,3.539,796.298),new VSC(314,4.963,16703.062),new VSC(283,3.16,2544.314),new VSC(206,4.569,2146.165),new VSC(169,1.329,3337.089),new VSC(158,4.185,1751.54),new VSC(134,2.233,.98),new VSC(134,5.974,1748.016),new VSC(118,6.024,6151.534),new VSC(117,2.213,1059.382),new VSC(114,2.129,1194.447),new VSC(114,5.428,3738.761),new VSC(91,1.1,1349.87),new VSC(85,3.91,553.57),new VSC(83,5.3,6684.75),new VSC(81,4.43,529.69),new VSC(80,2.25,8962.46),new VSC(73,2.5,951.72),new VSC(73,5.84,242.73),new VSC(71,3.86,2914.01),new VSC(68,5.02,382.9),new VSC(65,1.02,3340.6),new VSC(65,3.05,3340.63),new VSC(62,4.15,3149.16),new VSC(57,3.89,4136.91),new VSC(48,4.87,213.3),new VSC(48,1.18,3333.5),new VSC(47,1.31,3185.19),new VSC(41,.71,1592.6),new VSC(40,2.73,7.11),new VSC(40,5.32,20043.67),new VSC(33,5.41,6283.08),new VSC(28,.05,9492.15),new VSC(27,3.89,1221.85),new VSC(27,5.11,2700.72)],g_L2MarsCoefficients=[new VSC(58016,2.04979,3340.61243),new VSC(54188,0,0),new VSC(13908,2.45742,6681.22485),new VSC(2465,2.8,10021.8373),new VSC(398,3.141,13362.45),new VSC(222,3.194,3.523),new VSC(121,.543,155.42),new VSC(62,3.49,16703.06),new VSC(54,3.54,3344.14),new VSC(34,6,2281.23),new VSC(32,4.14,191.45),new VSC(30,2,796.3),new VSC(23,4.33,242.73),new VSC(22,3.45,398.15),new VSC(20,5.42,553.57),new VSC(16,.66,.98),new VSC(16,6.11,2146.17),new VSC(16,1.22,1748.02),new VSC(15,6.1,3185.19),new VSC(14,4.02,951.72),new VSC(14,2.62,1349.87),new VSC(13,.6,1194.45),new VSC(12,3.86,6684.75),new VSC(11,4.72,2544.31),new VSC(10,.25,382.9),new VSC(9,.68,1059.38),new VSC(9,3.83,20043.67),new VSC(9,3.88,3738.76),new VSC(8,5.46,1751.54),new VSC(7,2.58,3149.16),new VSC(7,2.38,4136.91),new VSC(6,5.48,1592.6),new VSC(6,2.34,3097.88)],g_L3MarsCoefficients=[new VSC(1482,.4443,3340.6124),new VSC(662,.885,6681.225),new VSC(188,1.288,10021.837),new VSC(41,1.65,13362.45),new VSC(26,0,0),new VSC(23,2.05,155.42),new VSC(10,1.58,3.52),new VSC(8,2,16703.06),new VSC(5,2.82,242.73),new VSC(4,2.02,3344.14),new VSC(3,4.59,3185.19),new VSC(3,.65,553.57)],g_L4MarsCoefficients=[new VSC(114,3.1416,0),new VSC(29,5.64,6681.22),new VSC(24,5.14,3340.61),new VSC(11,6.03,10021.84),new VSC(3,.13,13362.45),new VSC(3,3.56,155.42),new VSC(1,.49,16703.06),new VSC(1,1.32,242.73)],g_L5MarsCoefficients=[new VSC(1,3.14,0),new VSC(1,4.04,6681.22)],g_B0MarsCoefficients=[new VSC(3197135,3.7683204,3340.6124267),new VSC(298033,4.10617,6681.224853),new VSC(289105,0,0),new VSC(31366,4.44651,10021.83728),new VSC(3484,4.7881,13362.4497),new VSC(443,5.026,3344.136),new VSC(443,5.652,3337.089),new VSC(399,5.131,16703.062),new VSC(293,3.793,2281.23),new VSC(182,6.136,6151.534),new VSC(163,4.264,529.691),new VSC(160,2.232,1059.382),new VSC(149,2.165,5621.843),new VSC(143,1.182,3340.595),new VSC(143,3.213,3340.63),new VSC(139,2.418,8962.455)],g_B1MarsCoefficients=[new VSC(350069,5.368478,3340.612427),new VSC(14116,3.14159,0),new VSC(9671,5.4788,6681.2249),new VSC(1472,3.2021,10021.8373),new VSC(426,3.408,13362.45),new VSC(102,.776,3337.089),new VSC(79,3.72,16703.06),new VSC(33,3.46,5621.84),new VSC(26,2.48,2281.23)],g_B2MarsCoefficients=[new VSC(16727,.60221,3340.61243),new VSC(4987,4.1416,0),new VSC(302,3.559,6681.225),new VSC(26,1.9,13362.45),new VSC(21,.92,10021.84),new VSC(12,2.24,3337.09),new VSC(8,2.25,16703.06)],g_B3MarsCoefficients=[new VSC(607,1.981,3340.612),new VSC(43,0,0),new VSC(14,1.8,6681.22),new VSC(3,3.45,10021.84)],g_B4MarsCoefficients=[new VSC(13,0,0),new VSC(11,3.46,3340.61),new VSC(1,.5,6681.22)],g_R0MarsCoefficients=[new VSC(153033488,0,0),new VSC(14184953,3.47971284,3340.6124267),new VSC(660776,3.817834,6681.224853),new VSC(46179,4.15595,10021.83728),new VSC(8110,5.5596,2810.9215),new VSC(7485,1.7724,5621.8429),new VSC(5523,1.3644,2281.2305),new VSC(3825,4.4941,13362.4497),new VSC(2484,4.9255,2942.4634),new VSC(2307,.0908,2544.3144),new VSC(1999,5.3606,3337.0893),new VSC(1960,4.7425,3344.1355),new VSC(1167,2.1126,5092.152),new VSC(1103,5.0091,398.149),new VSC(992,5.839,6151.534),new VSC(899,4.408,529.691),new VSC(807,2.102,1059.382),new VSC(798,3.448,796.298),new VSC(741,1.499,2146.165),new VSC(726,1.245,8432.764),new VSC(692,2.134,8962.455),new VSC(633,.894,3340.595),new VSC(633,2.924,3340.63),new VSC(630,1.287,1751.54),new VSC(574,.829,2914.014),new VSC(526,5.383,3738.761),new VSC(473,5.199,3127.313),new VSC(348,4.832,16703.062),new VSC(284,2.907,3532.061),new VSC(280,5.257,6283.076),new VSC(276,1.218,6254.627),new VSC(275,2.908,1748.016),new VSC(270,3.764,5884.927),new VSC(239,2.037,1194.447),new VSC(234,5.105,5486.778),new VSC(228,3.255,6872.673),new VSC(223,4.199,3149.164),new VSC(219,5.583,191.448),new VSC(208,5.255,3340.545),new VSC(208,4.846,3340.68),new VSC(186,5.699,6677.702),new VSC(183,5.081,6684.748),new VSC(179,4.184,3333.499),new VSC(176,5.953,3870.303),new VSC(164,3.799,4136.91)],g_R1MarsCoefficients=[new VSC(1107433,2.0325052,3340.6124267),new VSC(103176,2.370718,6681.224853),new VSC(12877,0,0),new VSC(10816,2.70888,10021.83728),new VSC(1195,3.047,13362.4497),new VSC(439,2.888,2281.23),new VSC(396,3.423,3344.136),new VSC(183,1.584,2544.314),new VSC(136,3.385,16703.062),new VSC(128,6.043,3337.089),new VSC(128,.63,1059.382),new VSC(127,1.954,796.298),new VSC(118,2.998,2146.165),new VSC(88,3.42,398.15),new VSC(83,3.86,3738.76),new VSC(76,4.45,6151.53),new VSC(72,2.76,529.69),new VSC(67,2.55,1751.54),new VSC(66,4.41,1748.02),new VSC(58,.54,1194.45),new VSC(54,.68,8962.46),new VSC(51,3.73,6684.75),new VSC(49,5.73,3340.6),new VSC(49,1.48,3340.63),new VSC(48,2.58,3149.16),new VSC(48,2.29,2914.01),new VSC(39,2.32,4136.91)],g_R2MarsCoefficients=[new VSC(44242,.47931,3340.61243),new VSC(8138,.87,6681.2249),new VSC(1275,1.2259,10021.8373),new VSC(187,1.573,13362.45),new VSC(52,3.14,0),new VSC(41,1.97,3344.14),new VSC(27,1.92,16703.06),new VSC(18,4.43,2281.23),new VSC(12,4.53,3185.19),new VSC(10,5.39,1059.38),new VSC(10,.42,796.3)],g_R3MarsCoefficients=[new VSC(1113,5.1499,3340.6124),new VSC(424,5.613,6681.225),new VSC(100,5.997,10021.837),new VSC(20,.08,13362.45),new VSC(5,3.14,0),new VSC(3,.43,16703.06)],g_R4MarsCoefficients=[new VSC(20,3.58,3340.61),new VSC(16,4.05,6681.22),new VSC(6,4.46,10021.84),new VSC(2,4.84,13362.45)];function CAAMars(){}CAAMars.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0MarsCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0MarsCoefficients[t].a*Math.cos(g_L0MarsCoefficients[t].b+g_L0MarsCoefficients[t].c*i);var h=g_L1MarsCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1MarsCoefficients[t].a*Math.cos(g_L1MarsCoefficients[t].b+g_L1MarsCoefficients[t].c*i);var u=g_L2MarsCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2MarsCoefficients[t].a*Math.cos(g_L2MarsCoefficients[t].b+g_L2MarsCoefficients[t].c*i);var _=g_L3MarsCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3MarsCoefficients[t].a*Math.cos(g_L3MarsCoefficients[t].b+g_L3MarsCoefficients[t].c*i);var f=g_L4MarsCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4MarsCoefficients[t].a*Math.cos(g_L4MarsCoefficients[t].b+g_L4MarsCoefficients[t].c*i);var p=g_L5MarsCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5MarsCoefficients[t].a*Math.cos(g_L5MarsCoefficients[t].b+g_L5MarsCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAAMars.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0MarsCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0MarsCoefficients[t].a*Math.cos(g_B0MarsCoefficients[t].b+g_B0MarsCoefficients[t].c*i);var l=g_B1MarsCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_B1MarsCoefficients[t].a*Math.cos(g_B1MarsCoefficients[t].b+g_B1MarsCoefficients[t].c*i);var c=g_B2MarsCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_B2MarsCoefficients[t].a*Math.cos(g_B2MarsCoefficients[t].b+g_B2MarsCoefficients[t].c*i);var d=g_B3MarsCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_B3MarsCoefficients[t].a*Math.cos(g_B3MarsCoefficients[t].b+g_B3MarsCoefficients[t].c*i);var g=g_B4MarsCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_B4MarsCoefficients[t].a*Math.cos(g_B4MarsCoefficients[t].b+g_B4MarsCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAAMars.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_R0MarsCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_R0MarsCoefficients[t].a*Math.cos(g_R0MarsCoefficients[t].b+g_R0MarsCoefficients[t].c*i);var l=g_R1MarsCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_R1MarsCoefficients[t].a*Math.cos(g_R1MarsCoefficients[t].b+g_R1MarsCoefficients[t].c*i);var c=g_R2MarsCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_R2MarsCoefficients[t].a*Math.cos(g_R2MarsCoefficients[t].b+g_R2MarsCoefficients[t].c*i);var d=g_R3MarsCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_R3MarsCoefficients[t].a*Math.cos(g_R3MarsCoefficients[t].b+g_R3MarsCoefficients[t].c*i);var g=g_R4MarsCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_R4MarsCoefficients[t].a*Math.cos(g_R4MarsCoefficients[t].b+g_R4MarsCoefficients[t].c*i);return(o+h*i+u*r+_*n+f*s)/1e8};var CAAMars$={};registerType("CAAMars",[CAAMars,CAAMars$,null]);const g_L0JupiterCoefficients=[new VSC(59954691,0,0),new VSC(9695899,5.0619179,529.6909651),new VSC(573610,1.444062,7.113547),new VSC(306389,5.417347,1059.38193),new VSC(97178,4.14265,632.78374),new VSC(72903,3.64043,522.57742),new VSC(64264,3.41145,103.09277),new VSC(39806,2.29377,419.48464),new VSC(38858,1.27232,316.39187),new VSC(27965,1.78455,536.80451),new VSC(13590,5.77481,1589.0729),new VSC(8769,3.63,949.1756),new VSC(8246,3.5823,206.1855),new VSC(7368,5.081,735.8765),new VSC(6263,.025,213.2991),new VSC(6114,4.5132,1162.4747),new VSC(5305,4.1863,1052.2684),new VSC(5305,1.3067,14.2271),new VSC(4905,1.3208,110.2063),new VSC(4647,4.6996,3.9322),new VSC(3045,4.3168,426.5982),new VSC(2610,1.5667,846.0828),new VSC(2028,1.0638,3.1814),new VSC(1921,.9717,639.8973),new VSC(1765,2.1415,1066.4955),new VSC(1723,3.8804,1265.5675),new VSC(1633,3.582,515.4639),new VSC(1432,4.2968,625.6702),new VSC(973,4.098,95.979),new VSC(884,2.437,412.371),new VSC(733,6.085,838.969),new VSC(731,3.806,1581.959),new VSC(709,1.293,742.99),new VSC(692,6.134,2118.764),new VSC(614,4.109,1478.867),new VSC(582,4.54,309.278),new VSC(495,3.756,323.505),new VSC(441,2.958,454.909),new VSC(417,1.036,2.488),new VSC(390,4.897,1692.166),new VSC(376,4.703,1368.66),new VSC(341,5.715,533.623),new VSC(330,4.74,.048),new VSC(262,1.877,.963),new VSC(261,.82,380.128),new VSC(257,3.724,199.072),new VSC(244,5.22,728.763),new VSC(235,1.227,909.819),new VSC(220,1.651,543.918),new VSC(207,1.855,525.759),new VSC(202,1.807,1375.774),new VSC(197,5.293,1155.361),new VSC(175,3.73,942.062),new VSC(175,3.226,1898.351),new VSC(175,5.91,956.289),new VSC(158,4.365,1795.258),new VSC(151,3.906,74.782),new VSC(149,4.377,1685.052),new VSC(141,3.136,491.558),new VSC(138,1.318,1169.588),new VSC(131,4.169,1045.155),new VSC(117,2.5,1596.186),new VSC(117,3.389,.521),new VSC(106,4.554,526.51)],g_L1JupiterCoefficients=[new VSC(52993480757,0,0),new VSC(489741,4.220667,529.690965),new VSC(228919,6.026475,7.113547),new VSC(27655,4.57266,1059.38193),new VSC(20721,5.45939,522.57742),new VSC(12106,.16986,536.80451),new VSC(6068,4.4242,103.0928),new VSC(5434,3.9848,419.4846),new VSC(4238,5.8901,14.2271),new VSC(2212,5.2677,206.1855),new VSC(1746,4.9267,1589.0729),new VSC(1296,5.5513,3.1814),new VSC(1173,5.8565,1052.2684),new VSC(1163,.5145,3.9322),new VSC(1099,5.307,515.4639),new VSC(1007,.4648,735.8765),new VSC(1004,3.1504,426.5982),new VSC(848,5.758,110.206),new VSC(827,4.803,213.299),new VSC(816,.586,1066.495),new VSC(725,5.518,639.897),new VSC(568,5.989,625.67),new VSC(474,4.132,412.371),new VSC(413,5.737,95.979),new VSC(345,4.242,632.784),new VSC(336,3.732,1162.475),new VSC(234,4.035,949.176),new VSC(234,6.243,309.278),new VSC(199,1.505,838.969),new VSC(195,2.219,323.505),new VSC(187,6.086,742.99),new VSC(184,6.28,543.918),new VSC(171,5.417,199.072),new VSC(131,.626,728.763),new VSC(115,.68,846.083),new VSC(115,5.286,2118.764),new VSC(108,4.493,956.289),new VSC(80,5.82,1045.15),new VSC(72,5.34,942.06),new VSC(70,5.97,532.87),new VSC(67,5.73,21.34),new VSC(66,.13,526.51),new VSC(65,6.09,1581.96),new VSC(59,.59,1155.36),new VSC(58,.99,1596.19),new VSC(57,5.97,1169.59),new VSC(57,1.41,533.62),new VSC(55,5.43,10.29),new VSC(52,5.73,117.32),new VSC(52,.23,1368.66),new VSC(50,6.08,525.76),new VSC(47,3.63,1478.87),new VSC(47,.51,1265.57),new VSC(40,4.16,1692.17),new VSC(34,.1,302.16),new VSC(33,5.04,220.41),new VSC(32,5.37,508.35),new VSC(29,5.42,1272.68),new VSC(29,3.36,4.67),new VSC(29,.76,88.87),new VSC(25,1.61,831.86)],g_L2JupiterCoefficients=[new VSC(47234,4.32148,7.11355),new VSC(38966,0,0),new VSC(30629,2.93021,529.69097),new VSC(3189,1.055,522.5774),new VSC(2729,4.8455,536.8045),new VSC(2723,3.4141,1059.3819),new VSC(1721,4.1873,14.2271),new VSC(383,5.768,419.485),new VSC(378,.76,515.464),new VSC(367,6.055,103.093),new VSC(337,3.786,3.181),new VSC(308,.694,206.186),new VSC(218,3.814,1589.073),new VSC(199,5.34,1066.495),new VSC(197,2.484,3.932),new VSC(156,1.406,1052.268),new VSC(146,3.814,639.897),new VSC(142,1.634,426.598),new VSC(130,5.837,412.371),new VSC(117,1.414,625.67),new VSC(97,4.03,110.21),new VSC(91,1.11,95.98),new VSC(87,2.52,632.78),new VSC(79,4.64,543.92),new VSC(72,2.22,735.88),new VSC(58,.83,199.07),new VSC(57,3.12,213.3),new VSC(49,1.67,309.28),new VSC(40,4.02,21.34),new VSC(40,.62,323.51),new VSC(36,2.33,728.76),new VSC(29,3.61,10.29),new VSC(28,3.24,838.97),new VSC(26,4.5,742.99),new VSC(26,2.51,1162.47),new VSC(25,1.22,1045.15),new VSC(24,3.01,956.29),new VSC(19,4.29,532.87),new VSC(18,.81,508.35),new VSC(17,4.2,2118.76),new VSC(17,1.83,526.51),new VSC(15,5.81,1596.19),new VSC(15,.68,942.06),new VSC(15,4,117.32),new VSC(14,5.95,316.39),new VSC(14,1.8,302.16),new VSC(13,2.52,88.87),new VSC(13,4.37,1169.59),new VSC(11,4.44,525.76),new VSC(10,1.72,1581.96),new VSC(9,2.18,1155.36),new VSC(9,3.29,220.41),new VSC(9,3.32,831.86),new VSC(8,5.76,846.08),new VSC(8,2.71,533.62),new VSC(7,2.18,1265.57),new VSC(6,.5,949.18)],g_L3JupiterCoefficients=[new VSC(6502,2.5986,7.1135),new VSC(1357,1.3464,529.691),new VSC(471,2.475,14.227),new VSC(417,3.245,536.805),new VSC(353,2.974,522.577),new VSC(155,2.076,1059.382),new VSC(87,2.51,515.46),new VSC(44,0,0),new VSC(34,3.83,1066.5),new VSC(28,2.45,206.19),new VSC(24,1.28,412.37),new VSC(23,2.98,543.92),new VSC(20,2.1,639.9),new VSC(20,1.4,419.48),new VSC(19,1.59,103.09),new VSC(17,2.3,21.34),new VSC(17,2.6,1589.07),new VSC(16,3.15,625.67),new VSC(16,3.36,1052.27),new VSC(13,2.76,95.98),new VSC(13,2.54,199.07),new VSC(13,6.27,426.6),new VSC(9,1.76,10.29),new VSC(9,2.27,110.21),new VSC(7,3.43,309.28),new VSC(7,4.04,728.76),new VSC(6,2.52,508.35),new VSC(5,2.91,1045.15),new VSC(5,5.25,323.51),new VSC(4,4.3,88.87),new VSC(4,3.52,302.16),new VSC(4,4.09,735.88),new VSC(3,1.43,956.29),new VSC(3,4.36,1596.19),new VSC(3,1.25,213.3),new VSC(3,5.02,838.97),new VSC(3,2.24,117.32),new VSC(2,2.9,742.99),new VSC(2,2.36,942.06)],g_L4JupiterCoefficients=[new VSC(669,.853,7.114),new VSC(114,3.142,0),new VSC(100,.743,14.227),new VSC(50,1.65,536.8),new VSC(44,5.82,529.69),new VSC(32,4.86,522.58),new VSC(15,4.29,515.46),new VSC(9,.71,1059.38),new VSC(5,1.3,543.92),new VSC(4,2.32,1066.5),new VSC(4,.48,21.34),new VSC(3,3,412.37),new VSC(2,.4,639.9),new VSC(2,4.26,199.07),new VSC(2,4.91,625.67),new VSC(2,4.26,206.19),new VSC(1,5.26,1052.27),new VSC(1,4.72,95.98),new VSC(1,1.29,1589.07)],g_L5JupiterCoefficients=[new VSC(50,5.26,7.11),new VSC(16,5.25,14.23),new VSC(4,.01,536.8),new VSC(2,1.1,522.58),new VSC(1,3.14,0)],g_B0JupiterCoefficients=[new VSC(2268616,3.5585261,529.6909651),new VSC(110090,0,0),new VSC(109972,3.908093,1059.38193),new VSC(8101,3.6051,522.5774),new VSC(6438,.3063,536.8045),new VSC(6044,4.2588,1589.0729),new VSC(1107,2.9853,1162.4747),new VSC(944,1.675,426.598),new VSC(942,2.936,1052.268),new VSC(894,1.754,7.114),new VSC(836,5.179,103.093),new VSC(767,2.155,632.784),new VSC(684,3.678,213.299),new VSC(629,.643,1066.495),new VSC(559,.014,846.083),new VSC(532,2.703,110.206),new VSC(464,1.173,949.176),new VSC(431,2.608,419.485),new VSC(351,4.611,2118.764),new VSC(132,4.778,742.99),new VSC(123,3.35,1692.166),new VSC(116,1.387,323.505),new VSC(115,5.049,316.392),new VSC(104,3.701,515.464),new VSC(103,2.319,1478.867),new VSC(102,3.153,1581.959)],g_B1JupiterCoefficients=[new VSC(177352,5.701665,529.690965),new VSC(3230,5.7794,1059.3819),new VSC(3081,5.4746,522.5774),new VSC(2212,4.7348,536.8045),new VSC(1694,3.1416,0),new VSC(346,4.746,1052.268),new VSC(234,5.189,1066.495),new VSC(196,6.186,7.114),new VSC(150,3.927,1589.073),new VSC(114,3.439,632.784),new VSC(97,2.91,949.18),new VSC(82,5.08,1162.47),new VSC(77,2.51,103.09),new VSC(77,.61,419.48),new VSC(74,5.5,515.46),new VSC(61,5.45,213.3),new VSC(50,3.95,735.88),new VSC(46,.54,110.21),new VSC(45,1.9,846.08),new VSC(37,4.7,543.92),new VSC(36,6.11,316.39),new VSC(32,4.92,1581.96)],g_B2JupiterCoefficients=[new VSC(8094,1.4632,529.691),new VSC(813,3.1416,0),new VSC(742,.957,522.577),new VSC(399,2.899,536.805),new VSC(342,1.447,1059.382),new VSC(74,.41,1052.27),new VSC(46,3.48,1066.5),new VSC(30,1.93,1589.07),new VSC(29,.99,515.46),new VSC(23,4.27,7.11),new VSC(14,2.92,543.92),new VSC(12,5.22,632.78),new VSC(11,4.88,949.18),new VSC(6,6.21,1045.15)],g_B3JupiterCoefficients=[new VSC(252,3.381,529.691),new VSC(122,2.733,522.577),new VSC(49,1.04,536.8),new VSC(11,2.31,1052.27),new VSC(8,2.77,515.46),new VSC(7,4.25,1059.38),new VSC(6,1.78,1066.5),new VSC(4,1.13,543.92),new VSC(3,3.14,0)],g_B4JupiterCoefficients=[new VSC(15,4.53,522.58),new VSC(5,4.47,529.69),new VSC(4,5.44,536.8),new VSC(3,0,0),new VSC(2,4.52,515.46),new VSC(1,4.2,1052.27)],g_B5JupiterCoefficients=[new VSC(1,.09,522.58)],g_R0JupiterCoefficients=[new VSC(520887429,0,0),new VSC(25209327,3.4910864,529.69096509),new VSC(610600,3.841154,1059.38193),new VSC(282029,2.574199,632.783739),new VSC(187647,2.075904,522.577418),new VSC(86793,.71001,419.48464),new VSC(72063,.21466,536.80451),new VSC(65517,5.97996,316.39187),new VSC(30135,2.16132,949.17561),new VSC(29135,1.67759,103.09277),new VSC(23947,.27458,7.11355),new VSC(23453,3.54023,735.87651),new VSC(22284,4.19363,1589.0729),new VSC(13033,2.96043,1162.4747),new VSC(12749,2.7155,1052.26838),new VSC(9703,1.9067,206.1855),new VSC(9161,4.4135,213.2991),new VSC(7895,2.4791,426.5982),new VSC(7058,2.1818,1265.5675),new VSC(6138,6.2642,846.0828),new VSC(5477,5.6573,639.8973),new VSC(4170,2.0161,515.4639),new VSC(4137,2.7222,625.6702),new VSC(3503,.5653,1066.4955),new VSC(2617,2.0099,1581.9593),new VSC(2500,4.5518,838.9693),new VSC(2128,6.1275,742.9901),new VSC(1912,.8562,412.3711),new VSC(1611,3.0887,1368.6603),new VSC(1479,2.6803,1478.8666),new VSC(1231,1.8904,323.5054),new VSC(1217,1.8017,110.2063),new VSC(1015,1.3867,454.9094),new VSC(999,2.872,309.278),new VSC(961,4.549,2118.764),new VSC(886,4.148,533.623),new VSC(821,1.593,1898.351),new VSC(812,5.941,909.819),new VSC(777,3.677,728.763),new VSC(727,3.988,1155.361),new VSC(655,2.791,1685.052),new VSC(654,3.382,1692.166),new VSC(621,4.823,956.289),new VSC(615,2.276,942.062),new VSC(562,.081,543.918),new VSC(542,.284,525.759)],g_R1JupiterCoefficients=[new VSC(1271802,2.6493751,529.6909651),new VSC(61662,3.00076,1059.38193),new VSC(53444,3.89718,522.57742),new VSC(41390,0,0),new VSC(31185,4.88277,536.80451),new VSC(11847,2.4133,419.48464),new VSC(9166,4.7598,7.1135),new VSC(3404,3.3469,1589.0729),new VSC(3203,5.2108,735.8765),new VSC(3176,2.793,103.0928),new VSC(2806,3.7422,515.4639),new VSC(2677,4.3305,1052.2684),new VSC(2600,3.6344,206.1855),new VSC(2412,1.4695,426.5982),new VSC(2101,3.9276,639.8973),new VSC(1646,4.4163,1066.4955),new VSC(1641,4.4163,625.6702),new VSC(1050,3.1611,213.2991),new VSC(1025,2.5543,412.3711),new VSC(806,2.678,632.784),new VSC(741,2.171,1162.475),new VSC(677,6.25,838.969),new VSC(567,4.577,742.99),new VSC(485,2.469,949.176),new VSC(469,4.71,543.918),new VSC(445,.403,323.505),new VSC(416,5.368,728.763),new VSC(402,4.605,309.278),new VSC(347,4.681,14.227),new VSC(338,3.168,956.289),new VSC(261,5.343,846.083),new VSC(247,3.923,942.062),new VSC(220,4.842,1368.66),new VSC(203,5.6,1155.361),new VSC(200,4.439,1045.155),new VSC(197,3.706,2118.764),new VSC(196,3.759,199.072),new VSC(184,4.265,95.979),new VSC(180,4.402,532.872),new VSC(170,4.846,526.51),new VSC(146,6.13,533.623),new VSC(133,1.322,110.206),new VSC(132,4.512,525.759)],g_R2JupiterCoefficients=[new VSC(79645,1.35866,529.69097),new VSC(8252,5.7777,522.5774),new VSC(7030,3.2748,536.8045),new VSC(5314,1.8384,1059.3819),new VSC(1861,2.9768,7.1135),new VSC(964,5.48,515.464),new VSC(836,4.199,419.485),new VSC(498,3.142,0),new VSC(427,2.228,639.897),new VSC(406,3.783,1066.495),new VSC(377,2.242,1589.073),new VSC(363,5.368,206.186),new VSC(342,6.099,1052.268),new VSC(339,6.127,625.67),new VSC(333,.003,426.598),new VSC(280,4.262,412.371),new VSC(257,.963,632.784),new VSC(230,.705,735.877),new VSC(201,3.069,543.918),new VSC(200,4.429,103.093),new VSC(139,2.932,14.227),new VSC(114,.787,728.763),new VSC(95,1.7,838.97),new VSC(86,5.14,323.51),new VSC(83,.06,309.28),new VSC(80,2.98,742.99),new VSC(75,1.6,956.29),new VSC(70,1.51,213.3),new VSC(67,5.47,199.07),new VSC(62,6.1,1045.15),new VSC(56,.96,1162.47),new VSC(52,5.58,942.06),new VSC(50,2.72,532.87),new VSC(45,5.52,508.35),new VSC(44,.27,526.51),new VSC(40,5.95,95.98)],g_R3JupiterCoefficients=[new VSC(3519,6.058,529.691),new VSC(1073,1.6732,536.8045),new VSC(916,1.413,522.577),new VSC(342,.523,1059.382),new VSC(255,1.196,7.114),new VSC(222,.952,515.464),new VSC(90,3.14,0),new VSC(69,2.27,1066.5),new VSC(58,1.41,543.92),new VSC(58,.53,639.9),new VSC(51,5.98,412.37),new VSC(47,1.58,625.67),new VSC(43,6.12,419.48),new VSC(37,1.18,14.23),new VSC(34,1.67,1052.27),new VSC(34,.85,206.19),new VSC(31,1.04,1589.07),new VSC(30,4.63,426.6),new VSC(21,2.5,728.76),new VSC(15,.89,199.07),new VSC(14,.96,508.35),new VSC(13,1.5,1045.15),new VSC(12,2.61,735.88),new VSC(12,3.56,323.51),new VSC(11,1.79,309.28),new VSC(11,6.28,956.29),new VSC(10,6.26,103.09),new VSC(9,3.45,838.97)],g_R4JupiterCoefficients=[new VSC(129,.084,536.805),new VSC(113,4.249,529.691),new VSC(83,3.3,522.58),new VSC(38,2.73,515.46),new VSC(27,5.69,7.11),new VSC(18,5.4,1059.38),new VSC(13,6.02,543.92),new VSC(9,.77,1066.5),new VSC(8,5.68,14.23),new VSC(7,1.43,412.37),new VSC(6,5.12,639.9),new VSC(5,3.34,625.67),new VSC(3,3.4,1052.27),new VSC(3,4.16,728.76),new VSC(3,2.9,426.6)],g_R5JupiterCoefficients=[new VSC(11,4.75,536.8),new VSC(4,5.92,522.58),new VSC(2,5.57,515.46),new VSC(2,4.3,543.92),new VSC(2,3.69,7.11),new VSC(2,4.13,1059.38),new VSC(2,5.49,1066.5)];function CAAJupiter(){}CAAJupiter.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0JupiterCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0JupiterCoefficients[t].a*Math.cos(g_L0JupiterCoefficients[t].b+g_L0JupiterCoefficients[t].c*i);var h=g_L1JupiterCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1JupiterCoefficients[t].a*Math.cos(g_L1JupiterCoefficients[t].b+g_L1JupiterCoefficients[t].c*i);var u=g_L2JupiterCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2JupiterCoefficients[t].a*Math.cos(g_L2JupiterCoefficients[t].b+g_L2JupiterCoefficients[t].c*i);var _=g_L3JupiterCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3JupiterCoefficients[t].a*Math.cos(g_L3JupiterCoefficients[t].b+g_L3JupiterCoefficients[t].c*i);var f=g_L4JupiterCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4JupiterCoefficients[t].a*Math.cos(g_L4JupiterCoefficients[t].b+g_L4JupiterCoefficients[t].c*i);var p=g_L5JupiterCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5JupiterCoefficients[t].a*Math.cos(g_L5JupiterCoefficients[t].b+g_L5JupiterCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAAJupiter.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_B0JupiterCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_B0JupiterCoefficients[t].a*Math.cos(g_B0JupiterCoefficients[t].b+g_B0JupiterCoefficients[t].c*i);var h=g_B1JupiterCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_B1JupiterCoefficients[t].a*Math.cos(g_B1JupiterCoefficients[t].b+g_B1JupiterCoefficients[t].c*i);var u=g_B2JupiterCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_B2JupiterCoefficients[t].a*Math.cos(g_B2JupiterCoefficients[t].b+g_B2JupiterCoefficients[t].c*i);var _=g_B3JupiterCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_B3JupiterCoefficients[t].a*Math.cos(g_B3JupiterCoefficients[t].b+g_B3JupiterCoefficients[t].c*i);var f=g_B4JupiterCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_B4JupiterCoefficients[t].a*Math.cos(g_B4JupiterCoefficients[t].b+g_B4JupiterCoefficients[t].c*i);var p=g_B5JupiterCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_B5JupiterCoefficients[t].a*Math.cos(g_B5JupiterCoefficients[t].b+g_B5JupiterCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.r2D(S)},CAAJupiter.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_R0JupiterCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_R0JupiterCoefficients[t].a*Math.cos(g_R0JupiterCoefficients[t].b+g_R0JupiterCoefficients[t].c*i);var h=g_R1JupiterCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_R1JupiterCoefficients[t].a*Math.cos(g_R1JupiterCoefficients[t].b+g_R1JupiterCoefficients[t].c*i);var u=g_R2JupiterCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_R2JupiterCoefficients[t].a*Math.cos(g_R2JupiterCoefficients[t].b+g_R2JupiterCoefficients[t].c*i);var _=g_R3JupiterCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_R3JupiterCoefficients[t].a*Math.cos(g_R3JupiterCoefficients[t].b+g_R3JupiterCoefficients[t].c*i);var f=g_R4JupiterCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_R4JupiterCoefficients[t].a*Math.cos(g_R4JupiterCoefficients[t].b+g_R4JupiterCoefficients[t].c*i);var p=g_R5JupiterCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_R5JupiterCoefficients[t].a*Math.cos(g_R5JupiterCoefficients[t].b+g_R5JupiterCoefficients[t].c*i);return(l+c*i+d*r+g*n+m*s+C*a)/1e8};var CAAJupiter$={};registerType("CAAJupiter",[CAAJupiter,CAAJupiter$,null]);const g_L0SaturnCoefficients=[new VSC(87401354,0,0),new VSC(11107660,3.9620509,213.29909544),new VSC(1414151,4.5858152,7.113547),new VSC(398379,.52112,206.185548),new VSC(350769,3.303299,426.598191),new VSC(206816,.246584,103.092774),new VSC(79271,3.84007,220.41264),new VSC(23990,4.66977,110.20632),new VSC(16574,.43719,419.48464),new VSC(15820,.93809,632.78374),new VSC(15054,2.7167,639.89729),new VSC(14907,5.76903,316.39187),new VSC(14610,1.56519,3.93215),new VSC(13160,4.44891,14.22709),new VSC(13005,5.98119,11.0457),new VSC(10725,3.1294,202.2534),new VSC(6126,1.7633,277.035),new VSC(5863,.2366,529.691),new VSC(5228,4.2078,3.1814),new VSC(5020,3.1779,433.7117),new VSC(4593,.6198,199.072),new VSC(4006,2.2448,63.7359),new VSC(3874,3.2228,138.5175),new VSC(3269,.7749,949.1756),new VSC(2954,.9828,95.9792),new VSC(2461,2.0316,735.8765),new VSC(1758,3.2658,522.5774),new VSC(1640,5.505,846.0828),new VSC(1581,4.3727,309.2783),new VSC(1391,4.0233,323.5054),new VSC(1124,2.8373,415.5525),new VSC(1087,4.1834,2.4477),new VSC(1017,3.717,227.5262),new VSC(957,.507,1265.567),new VSC(853,3.421,175.166),new VSC(849,3.191,209.367),new VSC(789,5.007,.963),new VSC(749,2.144,853.196),new VSC(744,5.253,224.345),new VSC(687,1.747,1052.268),new VSC(654,1.599,.048),new VSC(634,2.299,412.371),new VSC(625,.97,210.118),new VSC(580,3.093,74.782),new VSC(546,2.127,350.332),new VSC(543,1.518,9.561),new VSC(530,4.449,117.32),new VSC(478,2.965,137.033),new VSC(474,5.475,742.99),new VSC(452,1.044,490.334),new VSC(449,1.29,127.472),new VSC(372,2.278,217.231),new VSC(355,3.013,838.969),new VSC(347,1.539,340.771),new VSC(343,.246,.521),new VSC(330,.247,1581.959),new VSC(322,.961,203.738),new VSC(322,2.572,647.011),new VSC(309,3.495,216.48),new VSC(287,2.37,351.817),new VSC(278,.4,211.815),new VSC(249,1.47,1368.66),new VSC(227,4.91,12.53),new VSC(220,4.204,200.769),new VSC(209,1.345,625.67),new VSC(208,.483,1162.475),new VSC(208,1.283,39.357),new VSC(204,6.011,265.989),new VSC(185,3.503,149.563),new VSC(184,.973,4.193),new VSC(182,5.491,2.921),new VSC(174,1.863,.751),new VSC(165,.44,5.417),new VSC(149,5.736,52.69),new VSC(148,1.535,5.629),new VSC(146,6.231,195.14),new VSC(140,4.295,21.341),new VSC(131,4.068,10.295),new VSC(125,6.277,1898.351),new VSC(122,1.976,4.666),new VSC(118,5.341,554.07),new VSC(117,2.679,1155.361),new VSC(114,5.594,1059.382),new VSC(112,1.105,191.208),new VSC(110,.166,1.484),new VSC(109,3.438,536.805),new VSC(107,4.012,956.289),new VSC(104,2.192,88.866),new VSC(103,1.197,1685.052),new VSC(101,4.965,269.921)],g_L1SaturnCoefficients=[new VSC(21354295596,0,0),new VSC(1296855,1.8282054,213.2990954),new VSC(564348,2.885001,7.113547),new VSC(107679,2.277699,206.185548),new VSC(98323,1.0807,426.59819),new VSC(40255,2.04128,220.41264),new VSC(19942,1.27955,103.09277),new VSC(10512,2.7488,14.22709),new VSC(6939,.4049,639.8973),new VSC(4803,2.4419,419.4846),new VSC(4056,2.9217,110.2063),new VSC(3769,3.6497,3.9322),new VSC(3385,2.4169,3.1814),new VSC(3302,1.2626,433.7117),new VSC(3071,2.3274,199.072),new VSC(1953,3.5639,11.0457),new VSC(1249,2.628,95.9792),new VSC(922,1.961,227.526),new VSC(706,4.417,529.691),new VSC(650,6.174,202.253),new VSC(628,6.111,309.278),new VSC(487,6.04,853.196),new VSC(479,4.988,522.577),new VSC(468,4.617,63.736),new VSC(417,2.117,323.505),new VSC(408,1.299,209.367),new VSC(352,2.317,632.784),new VSC(344,3.959,412.371),new VSC(340,3.634,316.392),new VSC(336,3.772,735.877),new VSC(332,2.861,210.118),new VSC(289,2.733,117.32),new VSC(281,5.744,2.448),new VSC(266,.543,647.011),new VSC(230,1.644,216.48),new VSC(192,2.965,224.345),new VSC(173,4.077,846.083),new VSC(167,2.597,21.341),new VSC(136,2.286,10.295),new VSC(131,3.441,742.99),new VSC(128,4.095,217.231),new VSC(109,6.161,415.552),new VSC(98,4.73,838.97),new VSC(94,3.48,1052.27),new VSC(92,3.95,88.87),new VSC(87,1.22,440.83),new VSC(83,3.11,625.67),new VSC(78,6.24,302.16),new VSC(67,.29,4.67),new VSC(66,5.65,9.56),new VSC(62,4.29,127.47),new VSC(62,1.83,195.14),new VSC(58,2.48,191.96),new VSC(57,5.02,137.03),new VSC(55,.28,74.78),new VSC(54,5.13,490.33),new VSC(51,1.46,536.8),new VSC(47,1.18,149.56),new VSC(47,5.15,515.46),new VSC(46,2.23,956.29),new VSC(44,2.71,5.42),new VSC(40,.41,269.92),new VSC(40,3.89,728.76),new VSC(38,.65,422.67),new VSC(38,2.53,12.53),new VSC(37,3.78,2.92),new VSC(35,6.08,5.63),new VSC(34,3.21,1368.66),new VSC(33,4.64,277.03),new VSC(33,5.43,1066.5),new VSC(33,.3,351.82),new VSC(32,4.39,1155.36),new VSC(31,2.43,52.69),new VSC(30,2.84,203),new VSC(30,6.19,284.15),new VSC(30,3.39,1059.38),new VSC(29,2.03,330.62),new VSC(28,2.74,265.99),new VSC(26,4.51,340.77)],g_L2SaturnCoefficients=[new VSC(116441,1.179879,7.113547),new VSC(91921,.07425,213.2991),new VSC(90592,0,0),new VSC(15277,4.06492,206.18555),new VSC(10631,.25778,220.41264),new VSC(10605,5.40964,426.59819),new VSC(4265,1.046,14.2271),new VSC(1216,2.9186,103.0928),new VSC(1165,4.6094,639.8973),new VSC(1082,5.6913,433.7117),new VSC(1045,4.0421,199.072),new VSC(1020,.6337,3.1814),new VSC(634,4.388,419.485),new VSC(549,5.573,3.932),new VSC(457,1.268,110.206),new VSC(425,.209,227.526),new VSC(274,4.288,95.979),new VSC(162,1.381,11.046),new VSC(129,1.566,309.278),new VSC(117,3.881,853.196),new VSC(105,4.9,647.011),new VSC(101,.893,21.341),new VSC(96,2.91,316.39),new VSC(95,5.63,412.37),new VSC(85,5.73,209.37),new VSC(83,6.05,216.48),new VSC(82,1.02,117.32),new VSC(75,4.76,210.12),new VSC(67,.46,522.58),new VSC(66,.48,10.29),new VSC(64,.35,323.51),new VSC(61,4.88,632.78),new VSC(53,2.75,529.69),new VSC(46,5.69,440.83),new VSC(45,1.67,202.25),new VSC(42,5.71,88.87),new VSC(32,.07,63.74),new VSC(32,1.67,302.16),new VSC(31,4.16,191.96),new VSC(27,.83,224.34),new VSC(25,5.66,735.88),new VSC(20,5.94,217.23),new VSC(18,4.9,625.67),new VSC(17,1.63,742.99),new VSC(16,.58,515.46),new VSC(14,.21,838.97),new VSC(14,3.76,195.14),new VSC(12,4.72,203),new VSC(12,.13,234.64),new VSC(12,3.12,846.08),new VSC(11,5.92,536.8),new VSC(11,5.6,728.76),new VSC(11,3.2,1066.5),new VSC(10,4.99,422.67),new VSC(10,.26,330.62),new VSC(10,4.15,860.31),new VSC(9,.46,956.29),new VSC(8,2.14,269.92),new VSC(8,5.25,429.78),new VSC(8,4.03,9.56),new VSC(7,5.4,1052.27),new VSC(6,4.46,284.15),new VSC(6,5.93,405.26)],g_L3SaturnCoefficients=[new VSC(16039,5.73945,7.11355),new VSC(4250,4.5854,213.2991),new VSC(1907,4.7608,220.4126),new VSC(1466,5.9133,206.1855),new VSC(1162,5.6197,14.2271),new VSC(1067,3.6082,426.5982),new VSC(239,3.861,433.712),new VSC(237,5.768,199.072),new VSC(166,5.116,3.181),new VSC(151,2.736,639.897),new VSC(131,4.743,227.526),new VSC(63,.23,419.48),new VSC(62,4.74,103.09),new VSC(40,5.47,21.34),new VSC(40,5.96,95.98),new VSC(39,5.83,110.21),new VSC(28,3.01,647.01),new VSC(25,.99,3.93),new VSC(19,1.92,853.2),new VSC(18,4.97,10.29),new VSC(18,1.03,412.37),new VSC(18,4.2,216.48),new VSC(18,3.32,309.28),new VSC(16,3.9,440.83),new VSC(16,5.62,117.32),new VSC(13,1.18,88.87),new VSC(11,5.58,11.05),new VSC(11,5.93,191.96),new VSC(10,3.95,209.37),new VSC(9,3.39,302.16),new VSC(8,4.88,323.51),new VSC(7,.38,632.78),new VSC(6,2.25,522.58),new VSC(6,1.06,210.12),new VSC(5,4.64,234.64),new VSC(4,3.14,0),new VSC(4,2.31,515.46),new VSC(3,2.2,860.31),new VSC(3,.59,529.69),new VSC(3,4.93,224.34),new VSC(3,.42,625.67),new VSC(2,4.77,330.62),new VSC(2,3.35,429.78),new VSC(2,3.2,202.25),new VSC(2,1.19,1066.5),new VSC(2,1.35,405.26),new VSC(2,4.16,223.59),new VSC(2,3.07,654.12)],g_L4SaturnCoefficients=[new VSC(1662,3.9983,7.1135),new VSC(257,2.984,220.413),new VSC(236,3.902,14.227),new VSC(149,2.741,213.299),new VSC(114,3.142,0),new VSC(110,1.515,206.186),new VSC(68,1.72,426.6),new VSC(40,2.05,433.71),new VSC(38,1.24,199.07),new VSC(31,3.01,227.53),new VSC(15,.83,639.9),new VSC(9,3.71,21.34),new VSC(6,2.42,419.48),new VSC(6,1.16,647.01),new VSC(4,1.45,95.98),new VSC(4,2.12,440.83),new VSC(3,4.09,110.21),new VSC(3,2.77,412.37),new VSC(3,3.01,88.87),new VSC(3,0,853.2),new VSC(3,.39,103.09),new VSC(2,3.78,117.32),new VSC(2,2.83,234.64),new VSC(2,5.08,309.28),new VSC(2,2.24,216.48),new VSC(2,5.19,302.16),new VSC(1,1.55,191.96)],g_L5SaturnCoefficients=[new VSC(124,2.259,7.114),new VSC(34,2.16,14.23),new VSC(28,1.2,220.41),new VSC(6,1.22,227.53),new VSC(5,.24,433.71),new VSC(4,6.23,426.6),new VSC(3,2.97,199.07),new VSC(3,4.29,206.19),new VSC(2,6.25,213.3),new VSC(1,5.28,639.9),new VSC(1,.24,440.83),new VSC(1,3.14,0)],g_B0SaturnCoefficients=[new VSC(4330678,3.6028443,213.2990954),new VSC(240348,2.852385,426.598191),new VSC(84746,0,0),new VSC(34116,.57297,206.18555),new VSC(30863,3.48442,220.41264),new VSC(14734,2.11847,639.89729),new VSC(9917,5.79,419.4846),new VSC(6994,4.736,7.1135),new VSC(4808,5.4331,316.3919),new VSC(4788,4.9651,110.2063),new VSC(3432,2.7326,433.7117),new VSC(1506,6.013,103.0928),new VSC(1060,5.631,529.691),new VSC(969,5.204,632.784),new VSC(942,1.396,853.196),new VSC(708,3.803,323.505),new VSC(552,5.131,202.253),new VSC(400,3.359,227.526),new VSC(319,3.626,209.367),new VSC(316,1.997,647.011),new VSC(314,.465,217.231),new VSC(284,4.886,224.345),new VSC(236,2.139,11.046),new VSC(215,5.95,846.083),new VSC(209,2.12,415.552),new VSC(207,.73,199.072),new VSC(179,2.954,63.736),new VSC(141,.644,490.334),new VSC(139,4.595,14.227),new VSC(139,1.998,735.877),new VSC(135,5.245,742.99),new VSC(122,3.115,522.577),new VSC(116,3.109,216.48),new VSC(114,.963,210.118)],g_B1SaturnCoefficients=[new VSC(397555,5.3329,213.299095),new VSC(49479,3.14159,0),new VSC(18572,6.09919,426.59819),new VSC(14801,2.30586,206.18555),new VSC(9644,1.6967,220.4126),new VSC(3757,1.2543,419.4846),new VSC(2717,5.9117,639.8973),new VSC(1455,.8516,433.7117),new VSC(1291,2.9177,7.1135),new VSC(853,.436,316.392),new VSC(298,.919,632.784),new VSC(292,5.316,853.196),new VSC(284,1.619,227.526),new VSC(275,3.889,103.093),new VSC(172,.052,647.011),new VSC(166,2.444,199.072),new VSC(158,5.209,110.206),new VSC(128,1.207,529.691),new VSC(110,2.457,217.231),new VSC(82,2.76,210.12),new VSC(81,2.86,14.23),new VSC(69,1.66,202.25),new VSC(65,1.26,216.48),new VSC(61,1.25,209.37),new VSC(59,1.82,323.51),new VSC(46,.82,440.83),new VSC(36,1.82,224.34),new VSC(34,2.84,117.32),new VSC(33,1.31,412.37),new VSC(32,1.19,846.08),new VSC(27,4.65,1066.5),new VSC(27,4.44,11.05)],g_B2SaturnCoefficients=[new VSC(20630,.50482,213.2991),new VSC(3720,3.9983,206.1855),new VSC(1627,6.1819,220.4126),new VSC(1346,0,0),new VSC(706,3.039,419.485),new VSC(365,5.099,426.598),new VSC(330,5.279,433.712),new VSC(219,3.828,639.897),new VSC(139,1.043,7.114),new VSC(104,6.157,227.526),new VSC(93,1.98,316.39),new VSC(71,4.15,199.07),new VSC(52,2.88,632.78),new VSC(49,4.43,647.01),new VSC(41,3.16,853.2),new VSC(29,4.53,210.12),new VSC(24,1.12,14.23),new VSC(21,4.35,217.23),new VSC(20,5.31,440.83),new VSC(18,.85,110.21),new VSC(17,5.68,216.48),new VSC(16,4.26,103.09),new VSC(14,3,412.37),new VSC(12,2.53,529.69),new VSC(8,3.32,202.25),new VSC(7,5.56,209.37),new VSC(7,.29,323.51),new VSC(6,1.16,117.32),new VSC(6,3.61,869.31)],g_B3SaturnCoefficients=[new VSC(666,1.99,213.299),new VSC(632,5.698,206.186),new VSC(398,0,0),new VSC(188,4.338,220.413),new VSC(92,4.84,419.48),new VSC(52,3.42,433.71),new VSC(42,2.38,426.6),new VSC(26,4.4,227.53),new VSC(21,5.85,199.07),new VSC(18,1.99,639.9),new VSC(11,5.37,7.11),new VSC(10,2.55,647.01),new VSC(7,3.46,316.39),new VSC(6,4.8,632.78),new VSC(6,.02,210.12),new VSC(6,3.52,440.83),new VSC(5,5.64,14.23),new VSC(5,1.22,853.2),new VSC(4,4.71,412.37),new VSC(3,.63,103.09),new VSC(2,3.72,216.48)],g_B4SaturnCoefficients=[new VSC(80,1.12,206.19),new VSC(32,3.12,213.3),new VSC(17,2.48,220.41),new VSC(12,3.14,0),new VSC(9,.38,419.48),new VSC(6,1.56,433.71),new VSC(5,2.63,227.53),new VSC(5,1.28,199.07),new VSC(1,1.43,426.6),new VSC(1,.67,647.01),new VSC(1,1.72,440.83),new VSC(1,6.18,639.9)],g_B5SaturnCoefficients=[new VSC(8,2.82,206.19),new VSC(1,.51,220.41)],g_R0SaturnCoefficients=[new VSC(955758136,0,0),new VSC(52921382,2.3922622,213.29909544),new VSC(1873680,5.2354961,206.1855484),new VSC(1464664,1.6476305,426.5981909),new VSC(821891,5.9352,316.39187),new VSC(547507,5.015326,103.092774),new VSC(371684,2.271148,220.412642),new VSC(361778,3.139043,7.113547),new VSC(140618,5.704067,632.783739),new VSC(108975,3.293136,110.206321),new VSC(69007,5.941,419.48464),new VSC(61053,.94038,639.89729),new VSC(48913,1.55733,202.2534),new VSC(34144,.19519,277.03499),new VSC(32402,5.47085,949.17561),new VSC(20937,.46349,735.87651),new VSC(20839,1.52103,433.71174),new VSC(20747,5.33256,199.072),new VSC(15298,3.05944,529.69097),new VSC(14296,2.60434,323.50542),new VSC(12884,1.64892,138.5175),new VSC(11993,5.98051,846.08283),new VSC(11380,1.73106,522.57742),new VSC(9796,5.2048,1265.5675),new VSC(7753,5.8519,95.9792),new VSC(6771,3.0043,14.2271),new VSC(6466,.1773,1052.2684),new VSC(5850,1.4552,415.5525),new VSC(5307,.5974,63.7359),new VSC(4696,2.1492,227.5262),new VSC(4044,1.6401,209.3669),new VSC(3688,.7802,412.3711),new VSC(3461,1.8509,175.1661),new VSC(3420,4.9455,1581.9593),new VSC(3401,.5539,350.3321),new VSC(3376,3.6953,224.3448),new VSC(2976,5.6847,210.1177),new VSC(2885,1.3876,838.9693),new VSC(2881,.1796,853.1964),new VSC(2508,3.5385,742.9901),new VSC(2448,6.1841,1368.6603),new VSC(2406,2.9656,117.3199),new VSC(2174,.0151,340.7709),new VSC(2024,5.0541,11.0457)],g_R1SaturnCoefficients=[new VSC(6182981,.2584352,213.2990954),new VSC(506578,.711147,206.185548),new VSC(341394,5.796358,426.598191),new VSC(188491,.472157,220.412642),new VSC(186262,3.141593,0),new VSC(143891,1.407449,7.113547),new VSC(49621,6.01744,103.09277),new VSC(20928,5.09246,639.89729),new VSC(19953,1.1756,419.48464),new VSC(18840,1.6082,110.20632),new VSC(13877,.75886,199.072),new VSC(12893,5.9433,433.71174),new VSC(5397,1.2885,14.2271),new VSC(4869,.8679,323.5054),new VSC(4247,.393,227.5262),new VSC(3252,1.2585,95.9792),new VSC(3081,3.4366,522.5774),new VSC(2909,4.6068,202.2534),new VSC(2856,2.1673,735.8765),new VSC(1988,2.4505,412.3711),new VSC(1941,6.0239,209.3669),new VSC(1581,1.2919,210.1177),new VSC(1340,4.308,853.1964),new VSC(1316,1.253,117.3199),new VSC(1203,1.8665,316.3919),new VSC(1091,.0753,216.4805),new VSC(966,.48,632.784),new VSC(954,5.152,647.011),new VSC(898,.983,529.691),new VSC(882,1.885,1052.268),new VSC(874,1.402,224.345),new VSC(785,3.064,838.969),new VSC(740,1.382,625.67),new VSC(658,4.144,309.278),new VSC(650,1.725,742.99),new VSC(613,3.033,63.736),new VSC(599,2.549,217.231),new VSC(503,2.13,3.932)],g_R2SaturnCoefficients=[new VSC(436902,4.786717,213.299095),new VSC(71923,2.5007,206.18555),new VSC(49767,4.97168,220.41264),new VSC(43221,3.8694,426.59819),new VSC(29646,5.9631,7.11355),new VSC(4721,2.4753,199.072),new VSC(4142,4.1067,433.7117),new VSC(3789,3.0977,639.8973),new VSC(2964,1.3721,103.0928),new VSC(2556,2.8507,419.4846),new VSC(2327,0,0),new VSC(2208,6.2759,110.2063),new VSC(2188,5.8555,14.2271),new VSC(1957,4.9245,227.5262),new VSC(924,5.464,323.505),new VSC(706,2.971,95.979),new VSC(546,4.129,412.371),new VSC(431,5.178,522.577),new VSC(405,4.173,209.367),new VSC(391,4.481,216.48),new VSC(374,5.834,117.32),new VSC(361,3.277,647.011),new VSC(356,3.192,210.118),new VSC(326,2.269,853.196),new VSC(207,4.022,735.877),new VSC(204,.088,202.253),new VSC(180,3.597,632.784),new VSC(178,4.097,440.825),new VSC(154,3.135,625.67),new VSC(148,.136,302.165),new VSC(133,2.594,191.958),new VSC(132,5.933,309.278)],g_R3SaturnCoefficients=[new VSC(20315,3.02187,213.2991),new VSC(8924,3.1914,220.4126),new VSC(6909,4.3517,206.1855),new VSC(4087,4.2241,7.1135),new VSC(3879,2.0106,426.5982),new VSC(1071,4.2036,199.072),new VSC(907,2.283,433.712),new VSC(606,3.175,227.526),new VSC(597,4.135,14.227),new VSC(483,1.173,639.897),new VSC(393,0,0),new VSC(229,4.698,419.485),new VSC(188,4.59,110.206),new VSC(150,3.202,103.093),new VSC(121,3.768,323.505),new VSC(102,4.71,95.979),new VSC(101,5.819,412.371),new VSC(93,1.44,647.01),new VSC(84,2.63,216.48),new VSC(73,4.15,117.32),new VSC(62,2.31,440.83),new VSC(55,.31,853.2),new VSC(50,2.39,209.37),new VSC(45,4.37,191.96),new VSC(41,.69,522.58),new VSC(40,1.84,302.16),new VSC(38,5.94,88.87),new VSC(32,4.01,21.34)],g_R4SaturnCoefficients=[new VSC(1202,1.415,220.4126),new VSC(708,1.162,213.299),new VSC(516,6.24,206.186),new VSC(427,2.469,7.114),new VSC(268,.187,426.598),new VSC(170,5.959,199.072),new VSC(150,.48,433.712),new VSC(145,1.442,227.526),new VSC(121,2.405,14.227),new VSC(47,5.57,639.9),new VSC(19,5.86,647.01),new VSC(17,.53,440.83),new VSC(16,2.9,110.21),new VSC(15,.3,419.48),new VSC(14,1.3,412.37),new VSC(13,2.09,323.51),new VSC(11,.22,95.98),new VSC(11,2.46,117.32),new VSC(10,3.14,0),new VSC(9,1.56,88.87),new VSC(9,2.28,21.34),new VSC(9,.68,216.48),new VSC(8,1.27,234.64)],g_R5SaturnCoefficients=[new VSC(129,5.913,220.413),new VSC(32,.69,7.11),new VSC(27,5.91,227.53),new VSC(20,4.95,433.71),new VSC(20,.67,14.23),new VSC(14,2.67,206.19),new VSC(14,1.46,199.07),new VSC(13,4.59,426.6),new VSC(7,4.63,213.3),new VSC(5,3.61,639.9),new VSC(4,4.9,440.83),new VSC(3,4.07,647.01),new VSC(3,4.66,191.96),new VSC(3,.49,323.51),new VSC(3,3.18,419.48),new VSC(2,3.7,88.87),new VSC(2,3.32,95.98),new VSC(2,.56,117.32)];function CAASaturn(){}CAASaturn.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_L0SaturnCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_L0SaturnCoefficients[t].a*Math.cos(g_L0SaturnCoefficients[t].b+g_L0SaturnCoefficients[t].c*i);var h=g_L1SaturnCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_L1SaturnCoefficients[t].a*Math.cos(g_L1SaturnCoefficients[t].b+g_L1SaturnCoefficients[t].c*i);var u=g_L2SaturnCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_L2SaturnCoefficients[t].a*Math.cos(g_L2SaturnCoefficients[t].b+g_L2SaturnCoefficients[t].c*i);var _=g_L3SaturnCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_L3SaturnCoefficients[t].a*Math.cos(g_L3SaturnCoefficients[t].b+g_L3SaturnCoefficients[t].c*i);var f=g_L4SaturnCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_L4SaturnCoefficients[t].a*Math.cos(g_L4SaturnCoefficients[t].b+g_L4SaturnCoefficients[t].c*i);var p=g_L5SaturnCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_L5SaturnCoefficients[t].a*Math.cos(g_L5SaturnCoefficients[t].b+g_L5SaturnCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.m360(CT.r2D(S))},CAASaturn.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_B0SaturnCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_B0SaturnCoefficients[t].a*Math.cos(g_B0SaturnCoefficients[t].b+g_B0SaturnCoefficients[t].c*i);var h=g_B1SaturnCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_B1SaturnCoefficients[t].a*Math.cos(g_B1SaturnCoefficients[t].b+g_B1SaturnCoefficients[t].c*i);var u=g_B2SaturnCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_B2SaturnCoefficients[t].a*Math.cos(g_B2SaturnCoefficients[t].b+g_B2SaturnCoefficients[t].c*i);var _=g_B3SaturnCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_B3SaturnCoefficients[t].a*Math.cos(g_B3SaturnCoefficients[t].b+g_B3SaturnCoefficients[t].c*i);var f=g_B4SaturnCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_B4SaturnCoefficients[t].a*Math.cos(g_B4SaturnCoefficients[t].b+g_B4SaturnCoefficients[t].c*i);var p=g_B5SaturnCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_B5SaturnCoefficients[t].a*Math.cos(g_B5SaturnCoefficients[t].b+g_B5SaturnCoefficients[t].c*i);var S=(l+c*i+d*r+g*n+m*s+C*a)/1e8;return CT.r2D(S)},CAASaturn.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=s*i,o=g_R0SaturnCoefficients.length,l=0;for(t=0;t<o;t++)l+=g_R0SaturnCoefficients[t].a*Math.cos(g_R0SaturnCoefficients[t].b+g_R0SaturnCoefficients[t].c*i);var h=g_R1SaturnCoefficients.length,c=0;for(t=0;t<h;t++)c+=g_R1SaturnCoefficients[t].a*Math.cos(g_R1SaturnCoefficients[t].b+g_R1SaturnCoefficients[t].c*i);var u=g_R2SaturnCoefficients.length,d=0;for(t=0;t<u;t++)d+=g_R2SaturnCoefficients[t].a*Math.cos(g_R2SaturnCoefficients[t].b+g_R2SaturnCoefficients[t].c*i);var _=g_R3SaturnCoefficients.length,g=0;for(t=0;t<_;t++)g+=g_R3SaturnCoefficients[t].a*Math.cos(g_R3SaturnCoefficients[t].b+g_R3SaturnCoefficients[t].c*i);var f=g_R4SaturnCoefficients.length,m=0;for(t=0;t<f;t++)m+=g_R4SaturnCoefficients[t].a*Math.cos(g_R4SaturnCoefficients[t].b+g_R4SaturnCoefficients[t].c*i);var p=g_R5SaturnCoefficients.length,C=0;for(t=0;t<p;t++)C+=g_R5SaturnCoefficients[t].a*Math.cos(g_R5SaturnCoefficients[t].b+g_R5SaturnCoefficients[t].c*i);return(l+c*i+d*r+g*n+m*s+C*a)/1e8};var CAASaturn$={};registerType("CAASaturn",[CAASaturn,CAASaturn$,null]);const g_L0UranusCoefficients=[new VSC(548129294,0,0),new VSC(9260408,.8910642,74.7815986),new VSC(1504248,3.6271926,1.4844727),new VSC(365982,1.899622,73.297126),new VSC(272328,3.358237,149.563197),new VSC(70328,5.39254,63.7359),new VSC(68893,6.09292,76.26607),new VSC(61999,2.26952,2.96895),new VSC(61951,2.85099,11.0457),new VSC(26469,3.14152,71.81265),new VSC(25711,6.1138,454.90937),new VSC(21079,4.36059,148.07872),new VSC(17819,1.74437,36.64856),new VSC(14613,4.73732,3.93215),new VSC(11163,5.82682,224.3448),new VSC(10998,.48865,138.5175),new VSC(9527,2.9552,35.1641),new VSC(7546,5.2363,109.9457),new VSC(4220,3.2333,70.8494),new VSC(4052,2.2775,151.0477),new VSC(3490,5.4831,146.5943),new VSC(3355,1.0655,4.4534),new VSC(3144,4.752,77.7505),new VSC(2927,4.629,9.5612),new VSC(2922,5.3524,85.8273),new VSC(2273,4.366,70.3282),new VSC(2149,.6075,38.133),new VSC(2051,1.5177,.1119),new VSC(1992,4.9244,277.035),new VSC(1667,3.6274,380.1278),new VSC(1533,2.5859,52.6902),new VSC(1376,2.0428,65.2204),new VSC(1372,4.1964,111.4302),new VSC(1284,3.1135,202.2534),new VSC(1282,.5427,222.8603),new VSC(1244,.9161,2.4477),new VSC(1221,.199,108.4612),new VSC(1151,4.179,33.6796),new VSC(1150,.9334,3.1814),new VSC(1090,1.775,12.5302),new VSC(1072,.2356,62.2514),new VSC(946,1.192,127.472),new VSC(708,5.183,213.299),new VSC(653,.966,78.714),new VSC(628,.182,984.6),new VSC(607,5.432,529.691),new VSC(559,3.358,.521),new VSC(524,2.013,299.126),new VSC(483,2.106,.963),new VSC(471,1.407,184.727),new VSC(467,.415,145.11),new VSC(434,5.521,183.243),new VSC(405,5.987,8.077),new VSC(399,.338,415.552),new VSC(396,5.87,351.817),new VSC(379,2.35,56.622),new VSC(310,5.833,145.631),new VSC(300,5.644,22.091),new VSC(294,5.839,39.618),new VSC(252,1.637,221.376),new VSC(249,4.746,225.829),new VSC(239,2.35,137.033),new VSC(224,.516,84.343),new VSC(223,2.843,.261),new VSC(220,1.922,67.668),new VSC(217,6.142,5.938),new VSC(216,4.778,340.771),new VSC(208,5.58,68.844),new VSC(202,1.297,.048),new VSC(199,.956,152.532),new VSC(194,1.888,456.394),new VSC(193,.916,453.425),new VSC(187,1.319,.16),new VSC(182,3.536,79.235),new VSC(173,1.539,160.609),new VSC(172,5.68,219.891),new VSC(170,3.677,5.417),new VSC(169,5.879,18.159),new VSC(165,1.424,106.977),new VSC(163,3.05,112.915),new VSC(158,.738,54.175),new VSC(147,1.263,59.804),new VSC(143,1.3,35.425),new VSC(139,5.386,32.195),new VSC(139,4.26,909.819),new VSC(124,1.374,7.114),new VSC(110,2.027,554.07),new VSC(109,5.706,77.963),new VSC(104,5.028,.751),new VSC(104,1.458,24.379),new VSC(103,.681,14.978)],g_L1UranusCoefficients=[new VSC(7502543122,0,0),new VSC(154458,5.242017,74.781599),new VSC(24456,1.71256,1.48447),new VSC(9258,.4284,11.0457),new VSC(8266,1.5022,63.7359),new VSC(7842,1.3198,149.5632),new VSC(3899,.4648,3.9322),new VSC(2284,4.1737,76.2661),new VSC(1927,.5301,2.9689),new VSC(1233,1.5863,70.8494),new VSC(791,5.436,3.181),new VSC(767,1.996,73.297),new VSC(482,2.984,85.827),new VSC(450,4.138,138.517),new VSC(446,3.723,224.345),new VSC(427,4.731,71.813),new VSC(354,2.583,148.079),new VSC(348,2.454,9.561),new VSC(317,5.579,52.69),new VSC(206,2.363,2.448),new VSC(189,4.202,56.622),new VSC(184,.284,151.048),new VSC(180,5.684,12.53),new VSC(171,3.001,78.714),new VSC(158,2.909,.963),new VSC(155,5.591,4.453),new VSC(154,4.652,35.164),new VSC(152,2.942,77.751),new VSC(143,2.59,62.251),new VSC(121,4.148,127.472),new VSC(116,3.732,65.22),new VSC(102,4.188,145.631),new VSC(102,6.034,.112),new VSC(88,3.99,18.16),new VSC(88,6.16,202.25),new VSC(81,2.64,22.09),new VSC(72,6.05,70.33),new VSC(69,4.05,77.96),new VSC(59,3.7,67.67),new VSC(47,3.54,351.82),new VSC(44,5.91,7.11),new VSC(43,5.72,5.42),new VSC(39,4.92,222.86),new VSC(36,5.9,33.68),new VSC(36,3.29,8.08),new VSC(36,3.33,71.6),new VSC(35,5.08,38.13),new VSC(31,5.62,984.6),new VSC(31,5.5,59.8),new VSC(31,5.46,160.61),new VSC(30,1.66,447.8),new VSC(29,1.15,462.02),new VSC(29,4.52,84.34),new VSC(27,5.54,131.4),new VSC(27,6.15,299.13),new VSC(26,4.99,137.03),new VSC(25,5.74,380.13)],g_L2UranusCoefficients=[new VSC(53033,0,0),new VSC(2358,2.2601,74.7816),new VSC(769,4.526,11.046),new VSC(552,3.258,63.736),new VSC(542,2.276,3.932),new VSC(529,4.923,1.484),new VSC(258,3.691,3.181),new VSC(239,5.858,149.563),new VSC(182,6.218,70.849),new VSC(54,1.44,76.27),new VSC(49,6.03,56.62),new VSC(45,3.91,2.45),new VSC(45,.81,85.83),new VSC(38,1.78,52.69),new VSC(37,4.46,2.97),new VSC(33,.86,9.56),new VSC(29,5.1,73.3),new VSC(24,2.11,18.16),new VSC(22,5.99,138.52),new VSC(22,4.82,78.71),new VSC(21,2.4,77.96),new VSC(21,2.17,224.34),new VSC(17,2.54,145.63),new VSC(17,3.47,12.53),new VSC(12,.02,22.09),new VSC(11,.08,127.47),new VSC(10,5.16,71.6),new VSC(10,4.46,62.25),new VSC(9,4.26,7.11),new VSC(8,5.5,67.67),new VSC(7,1.25,5.42),new VSC(6,3.36,447.8),new VSC(6,5.45,65.22),new VSC(6,4.52,151.05),new VSC(6,5.73,462.02)],g_L3UranusCoefficients=[new VSC(121,.024,74.782),new VSC(68,4.12,3.93),new VSC(53,2.39,11.05),new VSC(46,0,0),new VSC(45,2.04,3.18),new VSC(44,2.96,1.48),new VSC(25,4.89,63.74),new VSC(21,4.55,70.85),new VSC(20,2.31,149.56),new VSC(9,1.58,56.62),new VSC(4,.23,18.16),new VSC(4,5.39,76.27),new VSC(4,.95,77.96),new VSC(3,4.98,85.83),new VSC(3,4.13,52.69),new VSC(3,.37,78.71),new VSC(2,.86,145.63),new VSC(2,5.66,9.56)],g_L4UranusCoefficients=[new VSC(114,3.142,0),new VSC(6,4.58,74.78),new VSC(3,.35,11.05),new VSC(1,3.42,56.62)],g_B0UranusCoefficients=[new VSC(1346278,2.6187781,74.7815986),new VSC(62341,5.08111,149.5632),new VSC(61601,3.14159,0),new VSC(9964,1.616,76.2661),new VSC(9926,.5763,73.2971),new VSC(3259,1.2612,224.3448),new VSC(2972,2.2437,1.4845),new VSC(2010,6.0555,148.0787),new VSC(1522,.2796,63.7359),new VSC(924,4.038,151.048),new VSC(761,6.14,71.813),new VSC(522,3.321,138.517),new VSC(463,.743,85.827),new VSC(437,3.381,529.691),new VSC(435,.341,77.751),new VSC(431,3.554,213.299),new VSC(420,5.213,11.046),new VSC(245,.788,2.969),new VSC(233,2.257,222.86),new VSC(216,1.591,38.133),new VSC(180,3.725,299.126),new VSC(175,1.236,146.594),new VSC(174,1.937,380.128),new VSC(160,5.336,111.43),new VSC(144,5.962,35.164),new VSC(116,5.739,70.849),new VSC(106,.941,70.328),new VSC(102,2.619,78.714)],g_B1UranusCoefficients=[new VSC(206366,4.123943,74.781599),new VSC(8563,.3382,149.5632),new VSC(1726,2.1219,73.2971),new VSC(1374,0,0),new VSC(1369,3.0686,76.2661),new VSC(451,3.777,1.484),new VSC(400,2.848,224.345),new VSC(307,1.255,148.079),new VSC(154,3.786,63.736),new VSC(112,5.573,151.048),new VSC(111,5.329,138.517),new VSC(83,3.59,71.81),new VSC(56,3.4,85.83),new VSC(54,1.7,77.75),new VSC(42,1.21,11.05),new VSC(41,4.45,78.71),new VSC(32,3.77,222.86),new VSC(30,2.56,2.97),new VSC(27,5.34,213.3),new VSC(26,.42,380.13)],g_B2UranusCoefficients=[new VSC(9212,5.8004,74.7816),new VSC(557,0,0),new VSC(286,2.177,149.563),new VSC(95,3.84,73.3),new VSC(45,4.88,76.27),new VSC(20,5.46,1.48),new VSC(15,.88,138.52),new VSC(14,2.85,148.08),new VSC(14,5.07,63.74),new VSC(10,5,224.34),new VSC(8,6.27,78.71)],g_B3UranusCoefficients=[new VSC(268,1.251,74.782),new VSC(11,3.14,0),new VSC(6,4.01,149.56),new VSC(3,5.78,73.3)],g_B4UranusCoefficients=[new VSC(6,2.85,74.78)],g_R0UranusCoefficients=[new VSC(1921264848,0,0),new VSC(88784984,5.60377527,74.78159857),new VSC(3440836,.328361,73.2971259),new VSC(2055653,1.7829517,149.5631971),new VSC(649322,4.522473,76.266071),new VSC(602248,3.860038,63.735898),new VSC(496404,1.401399,454.909367),new VSC(338526,1.580027,138.517497),new VSC(243508,1.570866,71.812653),new VSC(190522,1.998094,1.484473),new VSC(161858,2.791379,148.078724),new VSC(143706,1.383686,11.0457),new VSC(93192,.17437,36.64856),new VSC(89806,3.66105,109.94569),new VSC(71424,4.24509,224.3448),new VSC(46677,1.39977,35.16409),new VSC(39026,3.36235,277.03499),new VSC(39010,1.66971,70.84945),new VSC(36755,3.88649,146.59425),new VSC(30349,.701,151.04767),new VSC(29156,3.18056,77.75054),new VSC(25786,3.78538,85.8273),new VSC(25620,5.25656,380.12777),new VSC(22637,.72519,529.69097),new VSC(20473,2.7964,70.32818),new VSC(20472,1.55589,202.2534),new VSC(17901,.55455,2.96895),new VSC(15503,5.35405,38.13304),new VSC(14702,4.90434,108.46122),new VSC(12897,2.62154,111.43016),new VSC(12328,5.96039,127.4718),new VSC(11959,1.75044,984.60033),new VSC(11853,.99343,52.6902),new VSC(11696,3.29826,3.93215),new VSC(11495,.43774,65.22037),new VSC(10793,1.42105,213.2991),new VSC(9111,4.9964,62.2514),new VSC(8421,5.2535,222.8603),new VSC(8402,5.0388,415.5525),new VSC(7449,.7949,351.8166),new VSC(7329,3.9728,183.2428),new VSC(6046,5.6796,78.7138),new VSC(5524,3.115,9.5612),new VSC(5445,5.1058,145.1098),new VSC(5238,2.6296,33.6796),new VSC(4079,3.2206,340.7709),new VSC(3919,4.2502,39.6175),new VSC(3802,6.1099,184.7273),new VSC(3781,3.4584,456.3938),new VSC(3687,2.4872,453.4249),new VSC(3102,4.1403,219.8914),new VSC(2963,.8298,56.6224),new VSC(2942,.4239,299.1264),new VSC(2940,2.1464,137.033),new VSC(2938,3.6766,140.002),new VSC(2865,.31,12.5302),new VSC(2538,4.8546,131.4039),new VSC(2364,.4425,554.07),new VSC(2183,2.9404,305.3462)],g_R1UranusCoefficients=[new VSC(1479896,3.6720571,74.7815986),new VSC(71212,6.22601,63.7359),new VSC(68627,6.13411,149.5632),new VSC(24060,3.14159,0),new VSC(21468,2.60177,76.26607),new VSC(20857,5.24625,11.0457),new VSC(11405,.01848,70.84945),new VSC(7497,.4236,73.2971),new VSC(4244,1.4169,85.8273),new VSC(3927,3.1551,71.8127),new VSC(3578,2.3116,224.3448),new VSC(3506,2.5835,138.5175),new VSC(3229,5.255,3.9322),new VSC(3060,.1532,1.4845),new VSC(2564,.9808,148.0787),new VSC(2429,3.9944,52.6902),new VSC(1645,2.6535,127.4718),new VSC(1584,1.4305,78.7138),new VSC(1508,5.06,151.0477),new VSC(1490,2.6756,56.6224),new VSC(1413,4.5746,202.2534),new VSC(1403,1.3699,77.7505),new VSC(1228,1.047,62.2514),new VSC(1033,.2646,131.4039),new VSC(992,2.172,65.22),new VSC(862,5.055,351.817),new VSC(744,3.076,35.164),new VSC(687,2.499,77.963),new VSC(647,4.473,70.328),new VSC(624,.863,9.561),new VSC(604,.907,984.6),new VSC(575,3.231,447.796),new VSC(562,2.718,462.023),new VSC(530,5.917,213.299),new VSC(528,5.151,2.969)],g_R2UranusCoefficients=[new VSC(22440,.69953,74.7816),new VSC(4727,1.699,63.7359),new VSC(1682,4.6483,70.8494),new VSC(1650,3.0966,11.0457),new VSC(1434,3.5212,149.5632),new VSC(770,0,0),new VSC(500,6.172,76.266),new VSC(461,.767,3.932),new VSC(390,4.496,56.622),new VSC(390,5.527,85.827),new VSC(292,.204,52.69),new VSC(287,3.534,73.297),new VSC(273,3.847,138.517),new VSC(220,1.964,131.404),new VSC(216,.848,77.963),new VSC(205,3.248,78.714),new VSC(149,4.898,127.472),new VSC(129,2.081,3.181)],g_R3UranusCoefficients=[new VSC(1164,4.7345,74.7816),new VSC(212,3.343,63.736),new VSC(196,2.98,70.849),new VSC(105,.958,11.046),new VSC(73,1,149.56),new VSC(72,.03,56.62),new VSC(55,2.59,3.93),new VSC(36,5.65,77.96),new VSC(34,3.82,76.27),new VSC(32,3.6,131.4)],g_R4UranusCoefficients=[new VSC(53,3.01,74.78),new VSC(10,1.91,56.62)];function CAAUranus(){}CAAUranus.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_L0UranusCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_L0UranusCoefficients[t].a*Math.cos(g_L0UranusCoefficients[t].b+g_L0UranusCoefficients[t].c*i);var l=g_L1UranusCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_L1UranusCoefficients[t].a*Math.cos(g_L1UranusCoefficients[t].b+g_L1UranusCoefficients[t].c*i);var c=g_L2UranusCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_L2UranusCoefficients[t].a*Math.cos(g_L2UranusCoefficients[t].b+g_L2UranusCoefficients[t].c*i);var d=g_L3UranusCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_L3UranusCoefficients[t].a*Math.cos(g_L3UranusCoefficients[t].b+g_L3UranusCoefficients[t].c*i);var g=g_L4UranusCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_L4UranusCoefficients[t].a*Math.cos(g_L4UranusCoefficients[t].b+g_L4UranusCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.m360(CT.r2D(m))},CAAUranus.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0UranusCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_B0UranusCoefficients[t].a*Math.cos(g_B0UranusCoefficients[t].b+g_B0UranusCoefficients[t].c*i);var l=g_B1UranusCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_B1UranusCoefficients[t].a*Math.cos(g_B1UranusCoefficients[t].b+g_B1UranusCoefficients[t].c*i);var c=g_B2UranusCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_B2UranusCoefficients[t].a*Math.cos(g_B2UranusCoefficients[t].b+g_B2UranusCoefficients[t].c*i);var d=g_B3UranusCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_B3UranusCoefficients[t].a*Math.cos(g_B3UranusCoefficients[t].b+g_B3UranusCoefficients[t].c*i);var g=g_B4UranusCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_B4UranusCoefficients[t].a*Math.cos(g_B4UranusCoefficients[t].b+g_B4UranusCoefficients[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAAUranus.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_R0UranusCoefficients.length,o=0;for(t=0;t<a;t++)o+=g_R0UranusCoefficients[t].a*Math.cos(g_R0UranusCoefficients[t].b+g_R0UranusCoefficients[t].c*i);var l=g_R1UranusCoefficients.length,h=0;for(t=0;t<l;t++)h+=g_R1UranusCoefficients[t].a*Math.cos(g_R1UranusCoefficients[t].b+g_R1UranusCoefficients[t].c*i);var c=g_R2UranusCoefficients.length,u=0;for(t=0;t<c;t++)u+=g_R2UranusCoefficients[t].a*Math.cos(g_R2UranusCoefficients[t].b+g_R2UranusCoefficients[t].c*i);var d=g_R3UranusCoefficients.length,_=0;for(t=0;t<d;t++)_+=g_R3UranusCoefficients[t].a*Math.cos(g_R3UranusCoefficients[t].b+g_R3UranusCoefficients[t].c*i);var g=g_R4UranusCoefficients.length,f=0;for(t=0;t<g;t++)f+=g_R4UranusCoefficients[t].a*Math.cos(g_R4UranusCoefficients[t].b+g_R4UranusCoefficients[t].c*i);return(o+h*i+u*r+_*n+f*s)/1e8};var CAAUranus$={};registerType("CAAUranus",[CAAUranus,CAAUranus$,null]);const g_L0NC=[new VSC(531188633,0,0),new VSC(1798476,2.9010127,38.1330356),new VSC(1019728,.4858092,1.4844727),new VSC(124532,4.830081,36.648563),new VSC(42064,5.41055,2.96895),new VSC(37715,6.09222,35.16409),new VSC(33785,1.24489,76.26607),new VSC(16483,8e-5,491.55793),new VSC(9199,4.9375,39.6175),new VSC(8994,.2746,175.1661),new VSC(4216,1.9871,73.2971),new VSC(3365,1.0359,33.6796),new VSC(2285,4.2061,4.4534),new VSC(1434,2.7834,74.7816),new VSC(900,2.076,109.946),new VSC(745,3.19,71.813),new VSC(506,5.748,114.399),new VSC(400,.35,1021.249),new VSC(345,3.462,41.102),new VSC(340,3.304,77.751),new VSC(323,2.248,32.195),new VSC(306,.497,.521),new VSC(287,4.505,.048),new VSC(282,2.246,146.594),new VSC(267,4.889,.963),new VSC(252,5.782,388.465),new VSC(245,1.247,9.561),new VSC(233,2.505,137.033),new VSC(227,1.797,453.425),new VSC(170,3.324,108.461),new VSC(151,2.192,33.94),new VSC(150,2.997,5.938),new VSC(148,.859,111.43),new VSC(119,3.677,2.448),new VSC(109,2.416,183.243),new VSC(103,.041,.261),new VSC(103,4.404,70.328),new VSC(102,5.705,.112)],g_L1NC=[new VSC(3837687717,0,0),new VSC(16604,4.86319,1.48447),new VSC(15807,2.27923,38.13304),new VSC(3335,3.682,76.2661),new VSC(1306,3.6732,2.9689),new VSC(605,1.505,35.164),new VSC(179,3.453,39.618),new VSC(107,2.451,4.453),new VSC(106,2.755,33.68),new VSC(73,5.49,36.65),new VSC(57,1.86,114.4),new VSC(57,5.22,.52),new VSC(35,4.52,74.78),new VSC(32,5.9,77.75),new VSC(30,3.67,388.47),new VSC(29,5.17,9.56),new VSC(29,5.17,2.45),new VSC(26,5.25,168.05)],g_L2NC=[new VSC(53893,0,0),new VSC(296,1.855,1.484),new VSC(281,1.191,38.133),new VSC(270,5.721,76.266),new VSC(23,1.21,2.97),new VSC(9,4.43,35.16),new VSC(7,.54,2.45)],g_L3NC=[new VSC(31,0,0),new VSC(15,1.35,76.27),new VSC(12,6.04,1.48),new VSC(12,6.11,38.13)],g_L4NC=[new VSC(114,3.142,0)],g_B0NC=[new VSC(3088623,1.4410437,38.1330356),new VSC(27789,5.91272,76.26607),new VSC(27624,0,0),new VSC(15448,3.50877,39.61751),new VSC(15355,2.52124,36.64856),new VSC(2e3,1.51,74.7816),new VSC(1968,4.3778,1.4845),new VSC(1015,3.2156,35.1641),new VSC(606,2.802,73.297),new VSC(595,2.129,41.102),new VSC(589,3.187,2.969),new VSC(402,4.169,114.399),new VSC(280,1.682,77.751),new VSC(262,3.767,213.299),new VSC(254,3.271,453.425),new VSC(206,4.257,529.691),new VSC(140,3.53,137.033)],g_B1NC=[new VSC(227279,3.807931,38.133036),new VSC(1803,1.9758,76.2661),new VSC(1433,3.1416,0),new VSC(1386,4.8256,36.6486),new VSC(1073,6.0805,39.6175),new VSC(148,3.858,74.782),new VSC(136,.478,1.484),new VSC(70,6.19,35.16),new VSC(52,5.05,73.3),new VSC(43,.31,114.4),new VSC(37,4.89,41.1),new VSC(37,5.76,2.97),new VSC(26,5.22,213.3)],g_B2NC=[new VSC(9691,5.5712,38.133),new VSC(79,3.63,76.27),new VSC(72,.45,36.65),new VSC(59,3.14,0),new VSC(30,1.61,39.62),new VSC(6,5.61,74.78)],g_B3NC=[new VSC(273,1.017,38.133),new VSC(2,0,0),new VSC(2,2.37,36.65),new VSC(2,5.33,76.27)],g_B4NC=[new VSC(6,2.67,38.13)],g_R0NC=[new VSC(3007013206,0,0),new VSC(27062259,1.32999459,38.13303564),new VSC(1691764,3.2518614,36.6485629),new VSC(807831,5.185928,1.484473),new VSC(537761,4.521139,35.16409),new VSC(495726,1.571057,491.557929),new VSC(274572,1.845523,175.16606),new VSC(135134,3.372206,39.617508),new VSC(121802,5.797544,76.266071),new VSC(100895,.377027,73.297126),new VSC(69792,3.79617,2.96895),new VSC(46688,5.74938,33.67962),new VSC(24594,.50802,109.94569),new VSC(16939,1.59422,71.81265),new VSC(14230,1.07786,74.7816),new VSC(12012,1.92062,1021.24889),new VSC(8395,.6782,146.5943),new VSC(7572,1.0715,388.4652),new VSC(5721,2.5906,4.4534),new VSC(4840,1.9069,41.102),new VSC(4483,2.9057,529.691),new VSC(4421,1.7499,108.4612),new VSC(4354,.6799,32.1951),new VSC(4270,3.4134,453.4249),new VSC(3381,.8481,183.2428),new VSC(2881,1.986,137.033),new VSC(2879,3.6742,350.3321),new VSC(2636,3.0976,213.2991),new VSC(2530,5.7984,490.0735),new VSC(2523,.4863,493.0424),new VSC(2306,2.8096,70.3282),new VSC(2087,.6186,33.9402)],g_R1NC=[new VSC(236339,.70498,38.133036),new VSC(13220,3.32015,1.48447),new VSC(8622,6.2163,35.1641),new VSC(2702,1.8814,39.6175),new VSC(2155,2.0943,2.9689),new VSC(2153,5.1687,76.2661),new VSC(1603,0,0),new VSC(1464,1.1842,33.6796),new VSC(1136,3.9189,36.6486),new VSC(898,5.241,388.465),new VSC(790,.533,168.053),new VSC(760,.021,182.28),new VSC(607,1.077,1021.249),new VSC(572,3.401,484.444),new VSC(561,2.887,498.671)],g_R2NC=[new VSC(4247,5.8991,38.133),new VSC(218,.346,1.484),new VSC(163,2.239,168.053),new VSC(156,4.594,182.28),new VSC(127,2.848,35.164)],g_R3NC=[new VSC(166,4.552,38.133)];function CAANeptune(){}CAANeptune.eclipticLongitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_L0NC.length,o=0;for(t=0;t<a;t++)o+=g_L0NC[t].a*Math.cos(g_L0NC[t].b+g_L0NC[t].c*i);var l=g_L1NC.length,h=0;for(t=0;t<l;t++)h+=g_L1NC[t].a*Math.cos(g_L1NC[t].b+g_L1NC[t].c*i);var c=g_L2NC.length,u=0;for(t=0;t<c;t++)u+=g_L2NC[t].a*Math.cos(g_L2NC[t].b+g_L2NC[t].c*i);var d=g_L3NC.length,_=0;for(t=0;t<d;t++)_+=g_L3NC[t].a*Math.cos(g_L3NC[t].b+g_L3NC[t].c*i);var g=g_L4NC.length,f=0;for(t=0;t<g;t++)f+=g_L4NC[t].a*Math.cos(g_L4NC[t].b+g_L4NC[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.m360(CT.r2D(m))},CAANeptune.eclipticLatitude=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=n*i,a=g_B0NC.length,o=0;for(t=0;t<a;t++)o+=g_B0NC[t].a*Math.cos(g_B0NC[t].b+g_B0NC[t].c*i);var l=g_B1NC.length,h=0;for(t=0;t<l;t++)h+=g_B1NC[t].a*Math.cos(g_B1NC[t].b+g_B1NC[t].c*i);var c=g_B2NC.length,u=0;for(t=0;t<c;t++)u+=g_B2NC[t].a*Math.cos(g_B2NC[t].b+g_B2NC[t].c*i);var d=g_B3NC.length,_=0;for(t=0;t<d;t++)_+=g_B3NC[t].a*Math.cos(g_B3NC[t].b+g_B3NC[t].c*i);var g=g_B4NC.length,f=0;for(t=0;t<g;t++)f+=g_B4NC[t].a*Math.cos(g_B4NC[t].b+g_B4NC[t].c*i);var m=(o+h*i+u*r+_*n+f*s)/1e8;return CT.r2D(m)},CAANeptune.radiusVector=function(e){var t,i=(e-2451545)/365250,r=i*i,n=r*i,s=g_R0NC.length,a=0;for(t=0;t<s;t++)a+=g_R0NC[t].a*Math.cos(g_R0NC[t].b+g_R0NC[t].c*i);var o=g_R1NC.length,l=0;for(t=0;t<o;t++)l+=g_R1NC[t].a*Math.cos(g_R1NC[t].b+g_R1NC[t].c*i);var h=g_R2NC.length,c=0;for(t=0;t<h;t++)c+=g_R2NC[t].a*Math.cos(g_R2NC[t].b+g_R2NC[t].c*i);var u=g_R3NC.length,d=0;for(t=0;t<u;t++)d+=g_R3NC[t].a*Math.cos(g_R3NC[t].b+g_R3NC[t].c*i);return(a+l*i+c*r+d*n)/1e8};var CAANeptune$={};function PlutoCoefficient1(e,t,i){this.j=0,this.s=0,this.p=0,this.j=e,this.s=t,this.p=i}registerType("CAANeptune",[CAANeptune,CAANeptune$,null]);var PlutoCoefficient1$={};function PlutoCoefficient2(e,t){this.a=0,this.b=0,this.a=e,this.b=t}registerType("PlutoCoefficient1",[PlutoCoefficient1,PlutoCoefficient1$,null]);var PlutoCoefficient2$={};registerType("PlutoCoefficient2",[PlutoCoefficient2,PlutoCoefficient2$,null]);const g_PlutoArgumentCoefficients=[new PlutoCoefficient1(0,0,1),new PlutoCoefficient1(0,0,2),new PlutoCoefficient1(0,0,3),new PlutoCoefficient1(0,0,4),new PlutoCoefficient1(0,0,5),new PlutoCoefficient1(0,0,6),new PlutoCoefficient1(0,1,-1),new PlutoCoefficient1(0,1,0),new PlutoCoefficient1(0,1,1),new PlutoCoefficient1(0,1,2),new PlutoCoefficient1(0,1,3),new PlutoCoefficient1(0,2,-2),new PlutoCoefficient1(0,2,-1),new PlutoCoefficient1(0,2,0),new PlutoCoefficient1(1,-1,0),new PlutoCoefficient1(1,-1,1),new PlutoCoefficient1(1,0,-3),new PlutoCoefficient1(1,0,-2),new PlutoCoefficient1(1,0,-1),new PlutoCoefficient1(1,0,0),new PlutoCoefficient1(1,0,1),new PlutoCoefficient1(1,0,2),new PlutoCoefficient1(1,0,3),new PlutoCoefficient1(1,0,4),new PlutoCoefficient1(1,1,-3),new PlutoCoefficient1(1,1,-2),new PlutoCoefficient1(1,1,-1),new PlutoCoefficient1(1,1,0),new PlutoCoefficient1(1,1,1),new PlutoCoefficient1(1,1,3),new PlutoCoefficient1(2,0,-6),new PlutoCoefficient1(2,0,-5),new PlutoCoefficient1(2,0,-4),new PlutoCoefficient1(2,0,-3),new PlutoCoefficient1(2,0,-2),new PlutoCoefficient1(2,0,-1),new PlutoCoefficient1(2,0,0),new PlutoCoefficient1(2,0,1),new PlutoCoefficient1(2,0,2),new PlutoCoefficient1(2,0,3),new PlutoCoefficient1(3,0,-2),new PlutoCoefficient1(3,0,-1),new PlutoCoefficient1(3,0,0)],g_PlutoLongitudeCoefficients=[new PlutoCoefficient2(-19799805,19850055),new PlutoCoefficient2(897144,-4954829),new PlutoCoefficient2(611149,1211027),new PlutoCoefficient2(-341243,-189585),new PlutoCoefficient2(129287,-34992),new PlutoCoefficient2(-38164,30893),new PlutoCoefficient2(20442,-9987),new PlutoCoefficient2(-4063,-5071),new PlutoCoefficient2(-6016,-3336),new PlutoCoefficient2(-3956,3039),new PlutoCoefficient2(-667,3572),new PlutoCoefficient2(1276,501),new PlutoCoefficient2(1152,-917),new PlutoCoefficient2(630,-1277),new PlutoCoefficient2(2571,-459),new PlutoCoefficient2(899,-1449),new PlutoCoefficient2(-1016,1043),new PlutoCoefficient2(-2343,-1012),new PlutoCoefficient2(7042,788),new PlutoCoefficient2(1199,-338),new PlutoCoefficient2(418,-67),new PlutoCoefficient2(120,-274),new PlutoCoefficient2(-60,-159),new PlutoCoefficient2(-82,-29),new PlutoCoefficient2(-36,-29),new PlutoCoefficient2(-40,7),new PlutoCoefficient2(-14,22),new PlutoCoefficient2(4,13),new PlutoCoefficient2(5,2),new PlutoCoefficient2(-1,0),new PlutoCoefficient2(2,0),new PlutoCoefficient2(-4,5),new PlutoCoefficient2(4,-7),new PlutoCoefficient2(14,24),new PlutoCoefficient2(-49,-34),new PlutoCoefficient2(163,-48),new PlutoCoefficient2(9,-24),new PlutoCoefficient2(-4,1),new PlutoCoefficient2(-3,1),new PlutoCoefficient2(1,3),new PlutoCoefficient2(-3,-1),new PlutoCoefficient2(5,-3),new PlutoCoefficient2(0,0)],g_PlutoLatitudeCoefficients=[new PlutoCoefficient2(-5452852,-14974862),new PlutoCoefficient2(3527812,1672790),new PlutoCoefficient2(-1050748,327647),new PlutoCoefficient2(178690,-292153),new PlutoCoefficient2(18650,100340),new PlutoCoefficient2(-30697,-25823),new PlutoCoefficient2(4878,11248),new PlutoCoefficient2(226,-64),new PlutoCoefficient2(2030,-836),new PlutoCoefficient2(69,-604),new PlutoCoefficient2(-247,-567),new PlutoCoefficient2(-57,1),new PlutoCoefficient2(-122,175),new PlutoCoefficient2(-49,-164),new PlutoCoefficient2(-197,199),new PlutoCoefficient2(-25,217),new PlutoCoefficient2(589,-248),new PlutoCoefficient2(-269,711),new PlutoCoefficient2(185,193),new PlutoCoefficient2(315,807),new PlutoCoefficient2(-130,-43),new PlutoCoefficient2(5,3),new PlutoCoefficient2(2,17),new PlutoCoefficient2(2,5),new PlutoCoefficient2(2,3),new PlutoCoefficient2(3,1),new PlutoCoefficient2(2,-1),new PlutoCoefficient2(1,-1),new PlutoCoefficient2(0,-1),new PlutoCoefficient2(0,0),new PlutoCoefficient2(0,-2),new PlutoCoefficient2(2,2),new PlutoCoefficient2(-7,0),new PlutoCoefficient2(10,-8),new PlutoCoefficient2(-3,20),new PlutoCoefficient2(6,5),new PlutoCoefficient2(14,17),new PlutoCoefficient2(-2,0),new PlutoCoefficient2(0,0),new PlutoCoefficient2(0,0),new PlutoCoefficient2(0,1),new PlutoCoefficient2(0,0),new PlutoCoefficient2(1,0)],g_PlutoRadiusCoefficients=[new PlutoCoefficient2(66865439,68951812),new PlutoCoefficient2(-11827535,-332538),new PlutoCoefficient2(1593179,-1438890),new PlutoCoefficient2(-18444,483220),new PlutoCoefficient2(-65977,-85431),new PlutoCoefficient2(31174,-6032),new PlutoCoefficient2(-5794,22161),new PlutoCoefficient2(4601,4032),new PlutoCoefficient2(-1729,234),new PlutoCoefficient2(-415,702),new PlutoCoefficient2(239,723),new PlutoCoefficient2(67,-67),new PlutoCoefficient2(1034,-451),new PlutoCoefficient2(-129,504),new PlutoCoefficient2(480,-231),new PlutoCoefficient2(2,-441),new PlutoCoefficient2(-3359,265),new PlutoCoefficient2(7856,-7832),new PlutoCoefficient2(36,45763),new PlutoCoefficient2(8663,8547),new PlutoCoefficient2(-809,-769),new PlutoCoefficient2(263,-144),new PlutoCoefficient2(-126,32),new PlutoCoefficient2(-35,-16),new PlutoCoefficient2(-19,-4),new PlutoCoefficient2(-15,8),new PlutoCoefficient2(-4,12),new PlutoCoefficient2(5,6),new PlutoCoefficient2(3,1),new PlutoCoefficient2(6,-2),new PlutoCoefficient2(2,2),new PlutoCoefficient2(-2,-2),new PlutoCoefficient2(14,13),new PlutoCoefficient2(-63,13),new PlutoCoefficient2(136,-236),new PlutoCoefficient2(273,1065),new PlutoCoefficient2(251,149),new PlutoCoefficient2(-25,-9),new PlutoCoefficient2(9,-2),new PlutoCoefficient2(-8,7),new PlutoCoefficient2(2,-10),new PlutoCoefficient2(19,35),new PlutoCoefficient2(10,3)];function CAAPluto(){}CAAPluto.eclipticLongitude=function(e){for(var t=(e-2451545)/36525,i=34.35+3034.9057*t,r=50.08+1222.1138*t,n=238.96+144.96*t,s=0,a=g_PlutoArgumentCoefficients.length,o=0;o<a;o++){var l=g_PlutoArgumentCoefficients[o].j*i+g_PlutoArgumentCoefficients[o].s*r+g_PlutoArgumentCoefficients[o].p*n;l=CT.d2R(l),s+=g_PlutoLongitudeCoefficients[o].a*Math.sin(l)+g_PlutoLongitudeCoefficients[o].b*Math.cos(l)}return s/=1e6,s+=238.958116+144.96*t,CT.m360(s)},CAAPluto.eclipticLatitude=function(e){for(var t=(e-2451545)/36525,i=34.35+3034.9057*t,r=50.08+1222.1138*t,n=238.96+144.96*t,s=0,a=g_PlutoArgumentCoefficients.length,o=0;o<a;o++){var l=g_PlutoArgumentCoefficients[o].j*i+g_PlutoArgumentCoefficients[o].s*r+g_PlutoArgumentCoefficients[o].p*n;l=CT.d2R(l),s+=g_PlutoLatitudeCoefficients[o].a*Math.sin(l)+g_PlutoLatitudeCoefficients[o].b*Math.cos(l)}return(s/=1e6)+-3.908239},CAAPluto.radiusVector=function(e){for(var t=(e-2451545)/36525,i=34.35+3034.9057*t,r=50.08+1222.1138*t,n=238.96+144.96*t,s=0,a=g_PlutoArgumentCoefficients.length,o=0;o<a;o++){var l=g_PlutoArgumentCoefficients[o].j*i+g_PlutoArgumentCoefficients[o].s*r+g_PlutoArgumentCoefficients[o].p*n;l=CT.d2R(l),s+=g_PlutoRadiusCoefficients[o].a*Math.sin(l)+g_PlutoRadiusCoefficients[o].b*Math.cos(l)}return(s/=1e7)+40.7241346};var CAAPluto$={};function CAAKepler(){}registerType("CAAPluto",[CAAPluto,CAAPluto$,null]),CAAKepler.calculate=function(e,t){return CAAKepler.calculateIter(e,t,53)},CAAKepler.calculateIter=function(e,t,i){e=CT.d2R(e);var r=CT.PI(),n=1;e<0&&(n=-1),(e=2*((e=Math.abs(e)/(2*r))-ss.ss.truncate(e))*r*n)<0&&(e+=2*r),n=1,e>r&&(n=-1),e>r&&(e=2*r-e);for(var s=r/2,a=r/4,o=0;o<i;o++)e>s-t*Math.sin(s)?s+=a:s-=a,a/=2;return CT.r2D(s)*n};var CAAKepler$={};function ACFT(e,t,i,r,n,s,a,o,l,h,c,u,d,_,g,f,m,p,C,S,w,T,y){this.l2=0,this.l3=0,this.l4=0,this.l5=0,this.l6=0,this.l7=0,this.l8=0,this.ldash=0,this.d=0,this.mdash=0,this.f=0,this.xsin=0,this.xsint=0,this.xcos=0,this.xcost=0,this.ysin=0,this.ysint=0,this.ycos=0,this.ycost=0,this.zsin=0,this.zsint=0,this.zcos=0,this.zcost=0,this.l2=e,this.l3=t,this.l4=i,this.l5=r,this.l6=n,this.l7=s,this.l8=a,this.ldash=o,this.d=l,this.mdash=h,this.f=c,this.xsin=u,this.xsint=d,this.xcos=_,this.xcost=g,this.ysin=f,this.ysint=m,this.ycos=p,this.ycost=C,this.zsin=S,this.zsint=w,this.zcos=T,this.zcost=y}registerType("CAAKepler",[CAAKepler,CAAKepler$,null]);var ACFT$={};registerType("ACFT",[ACFT,ACFT$,null]);const g_ACft=[new ACFT(0,1,0,0,0,0,0,0,0,0,0,-1719914,-2,-25,0,25,-13,1578089,156,10,32,684185,-358),new ACFT(0,2,0,0,0,0,0,0,0,0,0,6434,141,28007,-107,25697,-95,-5904,-130,11141,-48,-2559,-55),new ACFT(0,0,0,1,0,0,0,0,0,0,0,715,0,0,0,6,0,-657,0,-15,0,-282,0),new ACFT(0,0,0,0,0,0,0,1,0,0,0,715,0,0,0,0,0,-656,0,0,0,-285,0),new ACFT(0,3,0,0,0,0,0,0,0,0,0,486,-5,-236,-4,-216,-4,-446,5,-94,0,-193,0),new ACFT(0,0,0,0,1,0,0,0,0,0,0,159,0,0,0,2,0,-147,0,-6,0,-61,0),new ACFT(0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,26,0,0,0,-59,0),new ACFT(0,0,0,0,0,0,0,1,0,1,0,39,0,0,0,0,0,-36,0,0,0,-16,0),new ACFT(0,0,0,2,0,0,0,0,0,0,0,33,0,-10,0,-9,0,-30,0,-5,0,-13,0),new ACFT(0,2,0,-1,0,0,0,0,0,0,0,31,0,1,0,1,0,-28,0,0,0,-12,0),new ACFT(0,3,-8,3,0,0,0,0,0,0,0,8,0,-28,0,25,0,8,0,11,0,3,0),new ACFT(0,5,-8,3,0,0,0,0,0,0,0,8,0,-28,0,-25,0,-8,0,-11,0,-3,0),new ACFT(2,-1,0,0,0,0,0,0,0,0,0,21,0,0,0,0,0,-19,0,0,0,-8,0),new ACFT(1,0,0,0,0,0,0,0,0,0,0,-19,0,0,0,0,0,17,0,0,0,8,0),new ACFT(0,0,0,0,0,1,0,0,0,0,0,17,0,0,0,0,0,-16,0,0,0,-7,0),new ACFT(0,1,0,-2,0,0,0,0,0,0,0,16,0,0,0,0,0,15,0,1,0,7,0),new ACFT(0,0,0,0,0,0,1,0,0,0,0,16,0,0,0,1,0,-15,0,-3,0,-6,0),new ACFT(0,1,0,1,0,0,0,0,0,0,0,11,0,-1,0,-1,0,-10,0,-1,0,-5,0),new ACFT(2,-2,0,0,0,0,0,0,0,0,0,0,0,-11,0,-10,0,0,0,-4,0,0,0),new ACFT(0,1,0,-1,0,0,0,0,0,0,0,-11,0,-2,0,-2,0,9,0,-1,0,4,0),new ACFT(0,4,0,0,0,0,0,0,0,0,0,-7,0,-8,0,-8,0,6,0,-3,0,3,0),new ACFT(0,3,0,-2,0,0,0,0,0,0,0,-10,0,0,0,0,0,9,0,0,0,4,0),new ACFT(1,-2,0,0,0,0,0,0,0,0,0,-9,0,0,0,0,0,-9,0,0,0,-4,0),new ACFT(2,-3,0,0,0,0,0,0,0,0,0,-9,0,0,0,0,0,-8,0,0,0,-4,0),new ACFT(0,0,0,0,2,0,0,0,0,0,0,0,0,-9,0,-8,0,0,0,-3,0,0,0),new ACFT(2,-4,0,0,0,0,0,0,0,0,0,0,0,-9,0,8,0,0,0,3,0,0,0),new ACFT(0,3,-2,0,0,0,0,0,0,0,0,8,0,0,0,0,0,-8,0,0,0,-3,0),new ACFT(0,0,0,0,0,0,0,1,2,-1,0,8,0,0,0,0,0,-7,0,0,0,-3,0),new ACFT(8,-12,0,0,0,0,0,0,0,0,0,-4,0,-7,0,-6,0,4,0,-3,0,2,0),new ACFT(8,-14,0,0,0,0,0,0,0,0,0,-4,0,-7,0,6,0,-4,0,3,0,-2,0),new ACFT(0,0,2,0,0,0,0,0,0,0,0,-6,0,-5,0,-4,0,5,0,-2,0,2,0),new ACFT(3,-4,0,0,0,0,0,0,0,0,0,-1,0,-1,0,-2,0,-7,0,1,0,-4,0),new ACFT(0,2,0,-2,0,0,0,0,0,0,0,4,0,-6,0,-5,0,-4,0,-2,0,-2,0),new ACFT(3,-3,0,0,0,0,0,0,0,0,0,0,0,-7,0,-6,0,0,0,-3,0,0,0),new ACFT(0,2,-2,0,0,0,0,0,0,0,0,5,0,-5,0,-4,0,-5,0,-2,0,-2,0),new ACFT(0,0,0,0,0,0,0,1,-2,0,0,5,0,0,0,0,0,-5,0,0,0,-2,0)];function ABR(){}ABR.earthVelocity=function(e){for(var t=(e-2451545)/36525,i=3.1761467+1021.3285546*t,r=1.7534703+628.3075849*t,n=6.2034809+334.0612431*t,s=.5995465+52.9690965*t,a=.8740168+21.3299095*t,o=5.4812939+7.4781599*t,l=5.3118863+3.8133036*t,h=3.8103444+8399.6847337*t,c=5.1984667+7771.3771486*t,u=2.3555559+8328.6914289*t,d=1.6279052+8433.4661601*t,_=new C3D,g=g_ACft.length,f=0;f<g;f++){var m=g_ACft[f].l2*i+g_ACft[f].l3*r+g_ACft[f].l4*n+g_ACft[f].l5*s+g_ACft[f].l6*a+g_ACft[f].l7*o+g_ACft[f].l8*l+g_ACft[f].ldash*h+g_ACft[f].d*c+g_ACft[f].mdash*u+g_ACft[f].f*d;_.x+=(g_ACft[f].xsin+g_ACft[f].xsint*t)*Math.sin(m),_.x+=(g_ACft[f].xcos+g_ACft[f].xcost*t)*Math.cos(m),_.y+=(g_ACft[f].ysin+g_ACft[f].ysint*t)*Math.sin(m),_.y+=(g_ACft[f].ycos+g_ACft[f].ycost*t)*Math.cos(m),_.z+=(g_ACft[f].zsin+g_ACft[f].zsint*t)*Math.sin(m),_.z+=(g_ACft[f].zcos+g_ACft[f].zcost*t)*Math.cos(m)}return _},ABR.eclipticAberration=function(e,t,i){var r=new COR,n=(i-2451545)/36525,s=n*n,a=.016708634-42037e-9*n-1.267e-7*s,o=102.93735+1.71946*n+46e-5*s,l=20.49552,h=CAASun.geometricEclipticLongitude(i);return o=CT.d2R(o),e=CT.d2R(e),t=CT.d2R(t),h=CT.d2R(h),r.x=(-l*Math.cos(h-e)+a*l*Math.cos(o-e))/Math.cos(t)/3600,r.y=-l*Math.sin(t)*(Math.sin(h-e)-a*Math.sin(o-e))/3600,r},ABR.equatorialAberration=function(e,t,i){e=CT.d2R(15*e),t=CT.d2R(t);var r=Math.cos(e),n=Math.sin(e),s=Math.cos(t),a=Math.sin(t),o=ABR.earthVelocity(i),l=new COR;return l.x=CT.r2H((o.y*r-o.x*n)/(17314463350*s)),l.y=CT.r2D(-((o.x*r+o.y*n)*a-o.z*s)/17314463350),l};var ABR$={};registerType("ABR",[ABR,ABR$,null]);const deltaTTable=[121,112,103,95,88,82,77,72,68,63,60,56,53,51,48,46,44,42,40,38,35,33,31,29,26,24,22,20,18,16,14,12,11,10,9,8,7,7,7,7,7,7,8,8,9,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,12,12,12,12,13,13,13,14,14,14,14,15,15,15,15,15,16,16,16,16,16,16,16,16,15,15,14,13,13.1,12.5,12.2,12,12,12,12,12,12,11.9,11.6,11,10.2,9.2,8.2,7.1,6.2,5.6,5.4,5.3,5.4,5.6,5.9,6.2,6.5,6.8,7.1,7.3,7.5,7.6,7.7,7.3,6.2,5.2,2.7,1.4,-1.2,-2.8,-3.8,-4.8,-5.5,-5.3,-5.6,-5.7,-5.9,-6,-6.3,-6.5,-6.2,-4.7,-2.8,-.1,2.6,5.3,7.7,10.4,13.3,16,18.2,20.2,21.2,22.4,23.5,23.8,24.3,24,23.9,23.9,23.7,24,24.3,25.3,26.2,27.3,28.2,29.1,30,30.7,31.4,32.2,33.1,34,35,36.5,38.3,40.18,42.2,44.5,46.5,48.5,50.54,52.2,53.8,54.9,55.8,56.86,58.31,59.99,61.63,62.97];function DYT(){}DYT.deltaT=function(e){var t,i=DT.createJD(e,DT.afterPapalReformJD(e)).fractionalYear(),r=(i-2e3)/100;if(i<948)t=2177+497*r+44.1*r*r;else if(i<1620)t=102+102*r+25.3*r*r;else if(i<1998){var n=ss.ss.truncate((i-1620)/2);console.assert(n<deltaTTable.length),i=i/2-n-810,t=deltaTTable[n]+(deltaTTable[n+1]-deltaTTable[n])*i}else if(i<=2e3){var s=deltaTTable.length;t=deltaTTable[s-1]}else t=i<2100?102+102*r+25.3*r*r+.37*(i-2100):102+102*r+25.3*r*r;return t};var DYT$={};function CAAEclipticalElementDetails(){this.i=0,this.w=0,this.omega=0,this.i=0,this.w=0,this.omega=0}registerType("DYT",[DYT,DYT$,null]);var CAAEclipticalElementDetails$={};function CAAEclipticalElements(){}registerType("CAAEclipticalElementDetails",[CAAEclipticalElementDetails,CAAEclipticalElementDetails$,null]),CAAEclipticalElements.calculate=function(e,t,i,r,n){var s=(r-2451545)/36525,a=s*s,o=(n-r)/36525,l=o*o,h=l*o,c=CT.d2R(e),u=CT.d2R(i),d=(47.0029-.06603*s+598e-6*a)*o+(598e-6*s-.03302)*l+6e-5*h;d=CT.d2R(CT.dmS2D(0,0,d));var _=629554.9824+3289.4789*s+.60622*a-(869.8089+.50491*s)*o+.03536*l;_=CT.d2R(CT.dmS2D(0,0,_));var g=(5029.0966+2.22226*s-42e-6*a)*o+(1.11113-42e-6*s)*l-6e-6*h;g=CT.d2R(CT.dmS2D(0,0,g));var f=Math.sin(c),m=Math.cos(c),p=Math.sin(u-_),C=Math.cos(u-_),S=Math.sin(d),w=Math.cos(d),T=f*p,y=-S*m+w*f*C,b=Math.asin(Math.sqrt(T*T+y*y)),v=new CAAEclipticalElementDetails;v.i=CT.r2D(b),m*w+f*S*C<0&&(v.i=180-v.i);var M=_+g;v.omega=CT.m360(CT.r2D(Math.atan2(T,y)+M)),T=-S*p,y=f*w-m*S*C;var x=CT.r2D(Math.atan2(T,y));return v.w=CT.m360(t+x),v},CAAEclipticalElements.fK4B1950ToFK5J2000=function(e,t,i){var r=CT.d2R(5.19856209),n=CT.d2R(.00651966),s=CT.d2R(e),a=CT.d2R(i),o=Math.sin(s),l=Math.cos(s),h=Math.cos(n),c=Math.sin(n),u=r+a,d=Math.cos(u),_=Math.sin(u),g=c*_,f=o*h+l*c*d,m=new CAAEclipticalElementDetails;return m.i=CT.r2D(Math.asin(Math.sqrt(g*g+f*f))),l*h-o*c*d<0&&(m.i=180-m.i),m.w=CT.m360(t+CT.r2D(Math.atan2(g,f))),m.omega=CT.m360(CT.r2D(Math.atan2(o*_,l*c+o*h*d))-4.50001688),m};var CAAEclipticalElements$={};function EPO(){}registerType("CAAEclipticalElements",[CAAEclipticalElements,CAAEclipticalElements$,null]),EPO.mercuryMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(252.250906+149474.0722491*t+3035e-7*i+18e-9*r)},EPO.mercurySemimajorAxis=function(e){return.38709831},EPO.mercuryEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.20563175+20407e-9*t-2.83e-8*i-i*t*1.8e-10},EPO.mercuryInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(7.004986+.0018215*t-181e-7*i+56e-9*r)},EPO.mercuryLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(48.330893+1.1861883*t+17542e-8*i+215e-9*r)},EPO.mercuryLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(77.456119+1.5564776*t+29544e-8*i+9e-9*r)},EPO.venusMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(181.979801+58519.2130302*t+31014e-8*i+15e-9*r)},EPO.venusSemimajorAxis=function(e){return.72332982},EPO.venusEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.00677192-47765e-9*t+9.81e-8*i+i*t*4.6e-10},EPO.venusInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(3.394662+.0010037*t-88e-8*i-7e-9*r)},EPO.venusLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(76.67992+.9011206*t+40618e-8*i-93e-9*r)},EPO.venusLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(131.563703+1.4022288*t-.00107618*i-5678e-9*r)},EPO.earthMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(100.466457+36000.7698278*t+30322e-8*i+2e-8*r)},EPO.earthSemimajorAxis=function(e){return 1.000001018},EPO.earthEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.01670863-42037e-9*t-1.267e-7*i+i*t*1.4e-10},EPO.earthInclination=function(e){return 0},EPO.earthLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(102.937348+1.17195366*t+45688e-8*i-18e-9*r)},EPO.marsMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(355.433+19141.6964471*t+31052e-8*i+16e-9*r)},EPO.marsSemimajorAxis=function(e){return 1.523679342},EPO.marsEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.09340065+90484e-9*t-8.06e-8*i-i*t*2.5e-10},EPO.marsInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(1.849726-6011e-7*t+1276e-8*i-7e-9*r)},EPO.marsLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(49.588093+.7720959*t+1557e-8*i+2267e-9*r)},EPO.marsLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(336.060234+1.8410449*t+13477e-8*i+536e-9*r)},EPO.jupiterMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(34.351519+3036.3027748*t+2233e-7*i+37e-9*r)},EPO.jupiterSemimajorAxis=function(e){return 5.202603209+(e-2451545)/36525*1.913e-7},EPO.jupiterEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.04849793+163225e-9*t-4.714e-7*i-i*t*2.01e-9},EPO.jupiterInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(1.303267-.0054965*t+466e-8*i-2e-9*r)},EPO.jupiterLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(100.464407+1.0209774*t+40315e-8*i+404e-9*r)},EPO.jupiterLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(14.331207+1.6126352*t+.00103042*i-4464e-9*r)},EPO.saturnMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(50.077444+1223.5110686*t+51908e-8*i-3e-8*r)},EPO.saturnSemimajorAxis=function(e){var t=(e-2451545)/36525;return 9.554909192-2139e-9*t+t*t*4e-9},EPO.saturnEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.05554814-.0003446641*t-6.436e-7*i+i*t*3.4e-9},EPO.saturnInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(2.488879-.0037362*t-1519e-8*i+87e-9*r)},EPO.saturnLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(113.665503+.877088*t-12176e-8*i-2249e-9*r)},EPO.saturnLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(93.057237+1.19637613*t+83753e-8*i+4928e-9*r)},EPO.uranusMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(314.055005+429.8640561*t+3039e-7*i+26e-9*r)},EPO.uranusSemimajorAxis=function(e){var t=(e-2451545)/36525;return 19.218446062-3.72e-8*t+t*t*9.8e-10},EPO.uranusEccentricity=function(e){var t=(e-2451545)/36525,i=t*t;return.04638122-27293e-9*t+7.89e-8*i+i*t*2.4e-10},EPO.uranusInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(.773197+7744e-7*t+3749e-8*i-92e-9*r)},EPO.uranusLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(74.005957+.5211278*t+.00133947*i+18484e-9*r)},EPO.uranusLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(173.005291+1.486379*t+21406e-8*i+434e-9*r)},EPO.neptuneMeanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(304.348665+219.8833092*t+30882e-8*i+18e-9*r)},EPO.neptuneSemimajorAxis=function(e){var t=(e-2451545)/36525;return 30.110386869-1.663e-7*t+t*t*6.9e-10},EPO.neptuneEccentricity=function(e){var t=(e-2451545)/36525;return.00945575+6033e-9*t-t*t*t*5e-11},EPO.neptuneInclination=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(1.769953-.0093082*t-708e-8*i+27e-9*r)},EPO.neptuneLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(131.784057+1.1022039*t+25952e-8*i-637e-9*r)},EPO.neptuneLongitudePerihelion=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(48.120276+1.4262957*t+38434e-8*i+2e-8*r)},EPO.mercuryMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(252.250906+149472.6746358*t-536e-8*i+2e-9*r)},EPO.mercuryInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(7.004986-.0059516*t+8e-7*i+43e-9*r)},EPO.mercuryLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(48.330893-.1254227*t-8833e-8*i-2e-7*r)},EPO.mercuryLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(77.456119+.1588643*t-1342e-8*i-7e-9*r)},EPO.venusMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(181.979801+58517.815676*t+165e-8*i-2e-9*r)},EPO.venusInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(3.394662-8568e-7*t-3244e-8*i+9e-9*r)},EPO.venusLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(76.67992-.2780134*t-14257e-8*i-164e-9*r)},EPO.venusLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(131.563703+.0048746*t-.00138467*i-5695e-9*r)},EPO.earthMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(100.466457+35999.3728565*t-568e-8*i-1e-9*r)},EPO.earthInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t;return.0130548*t-931e-8*i-i*t*34e-9},EPO.earthLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(174.873176-.241098*t+4262e-8*i+1e-9*r)},EPO.earthLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(102.937348+.3225654*t+14799e-8*i-39e-9*r)},EPO.marsMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(355.433+19140.2993039*t+262e-8*i-3e-9*r)},EPO.marsInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(1.849726-.0081477*t-2255e-8*i-29e-9*r)},EPO.marsLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(49.588093-.295025*t-64048e-8*i-1964e-9*r)},EPO.marsLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(336.060234+.4439016*t-17313e-8*i+518e-9*r)},EPO.jupiterMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(34.351519+3034.9056606*t-8501e-8*i+16e-9*r)},EPO.jupiterInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(1.303267-.0019877*t+332e-7*i+97e-9*r)},EPO.jupiterLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(100.464407+.1767232*t+907e-6*i-7272e-9*r)},EPO.jupiterLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(14.331207+.2155209*t+72211e-8*i-4485e-9*r)},EPO.saturnMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(50.077444+1222.1138488*t+21004e-8*i-46e-9*r)},EPO.saturnInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(2.488879+.0025514*t-4906e-8*i+17e-9*r)},EPO.saturnLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(113.665503-.2566722*t-18399e-8*i+48e-8*r)},EPO.saturnLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(93.057237+.5665415*t+5285e-7*i+4912e-9*r)},EPO.uranusMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(314.055005+428.4669983*t-486e-8*i+6e-9*r)},EPO.uranusInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(.773197-.0016869*t+349e-8*i+16e-9*r)},EPO.uranusLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(74.005957+.0741431*t+40539e-8*i+119e-9*r)},EPO.uranusLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(173.005291+.0893212*t-947e-7*i+414e-9*r)},EPO.neptuneMeanLongitudeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(304.348665+218.4862002*t+59e-8*i-2e-9*r)},EPO.neptuneInclinationJ2000=function(e){var t=(e-2451545)/36525,i=t*t;return CT.m360(1.769953+2256e-7*t+23e-8*i)},EPO.neptuneLongitudeAscendingNodeJ2000=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t;return CT.m360(131.784057-.0061651*t-219e-8*i-78e-9*r)},EPO.neptuneLongitudePerihelionJ2000=function(e){var t=(e-2451545)/36525,i=t*t;return CT.m360(48.120276+.0291866*t+761e-7*i)};var EPO$={};registerType("EPO",[EPO,EPO$,null]);const regex=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return"string"==typeof e&&regex.test(e)}const esm_browser_validate=validate;for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(!esm_browser_validate(i))throw TypeError("Stringified UUID is invalid");return i}const esm_browser_stringify=stringify;function parse(e){if(!esm_browser_validate(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}const esm_browser_parse=parse;function stringToBytes(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}var DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",v35_URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function v35(e,t,i){function r(e,r,n,s){if("string"==typeof e&&(e=stringToBytes(e)),"string"==typeof r&&(r=esm_browser_parse(r)),16!==r.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),(a=i(a))[6]=15&a[6]|t,a[8]=63&a[8]|128,n){s=s||0;for(var o=0;o<16;++o)n[s+o]=a[o];return n}return esm_browser_stringify(a)}try{r.name=e}catch(e){}return r.DNS=DNS,r.URL=v35_URL,r}function f(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:case 3:return t^i^r;case 2:return t&i^t&r^i&r}}function ROTL(e,t){return e<<t|e>>>32-t}function sha1(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var n=0;n<r.length;++n)e.push(r.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,a=Math.ceil(s/16),o=new Array(a),l=0;l<a;++l){for(var h=new Uint32Array(16),c=0;c<16;++c)h[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];o[l]=h}o[a-1][14]=8*(e.length-1)/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=8*(e.length-1)&4294967295;for(var u=0;u<a;++u){for(var d=new Uint32Array(80),_=0;_<16;++_)d[_]=o[u][_];for(var g=16;g<80;++g)d[g]=ROTL(d[g-3]^d[g-8]^d[g-14]^d[g-16],1);for(var m=i[0],p=i[1],C=i[2],S=i[3],w=i[4],T=0;T<80;++T){var y=Math.floor(T/20),b=ROTL(m,5)+f(y,p,C,S)+w+t[y]+d[T]>>>0;w=S,S=C,C=ROTL(p,30)>>>0,p=m,m=b}i[0]=i[0]+m>>>0,i[1]=i[1]+p>>>0,i[2]=i[2]+C>>>0,i[3]=i[3]+S>>>0,i[4]=i[4]+w>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]}const esm_browser_sha1=sha1;var v5=v35("v5",80,esm_browser_sha1);const esm_browser_v5=v5;function Rectangle(){this.x=0,this.y=0,this.width=0,this.height=0}Rectangle.create=function(e,t,i,r){var n=new Rectangle;return n.x=e,n.y=t,n.width=i,n.height=r,n};var Rectangle$={get_left:function(){return this.x},get_right:function(){return this.x+this.width},get_top:function(){return this.y},get_bottom:function(){return this.y+this.height},contains:function(e){return this._between(e.x,this.x,this.x+this.width)&&this._between(e.y,this.y,this.y+this.height)},_between:function(e,t,i){return t>i?!(e>t||e<i):!(e<t||e>i)},copy:function(){var e=new Rectangle;return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}};function Guid(){this._guid=Guid.create()}registerType("Rectangle",[Rectangle,Rectangle$,null]),Guid.newGuid=function(){return new Guid},Guid.fromString=function(e){var t=new Guid;return t._guid=ss.ss.trim(e),t},Guid.create=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},Guid.createFrom=function(e){var t=esm_browser_v5(e,"1420736a-a637-40a7-813a-ba692e72204e");return Guid.fromString(t)};var Guid$={toString:function(){return this._guid}};function Mouse(){}function Language(){}registerType("Guid",[Guid,Guid$,null]),Mouse.offsetX=function(e,t){var i=0,r=e,n=t;if(null!=r.offsetParent)do{i+=r.offsetLeft}while(null!=(r=r.offsetParent));return n.pageX-i},Mouse.offsetY=function(e,t){var i=0,r=e,n=t;if(null!=r.offsetParent)do{i+=r.offsetTop}while(null!=(r=r.offsetParent));return n.pageY-i},registerType("Mouse",[Mouse,null,null]),Language.getLocalizedText=function(e,t){return t};var Language$={};function Cursor(){}registerType("Language",[Language,Language$,null]),Cursor.get_position=function(){return new Vector2d},Cursor.get_current=function(){return document.body.style.cursor},Cursor.set_current=function(e){return document.body.style.cursor=e,e};var Cursor$={};function Cursors(){}registerType("Cursor",[Cursor,Cursor$,null]),Cursors.get_arrow=function(){return"default"},Cursors.get_cross=function(){return"crosshair"},Cursors.get_defaultV=function(){return"default"},Cursors.get_hand=function(){return"grab"},Cursors.get_help=function(){return"help"},Cursors.get_hSplit=function(){return"row-resize"},Cursors.get_iBeam=function(){return"text"},Cursors.get_no=function(){return"not-allowed"},Cursors.get_sizeAll=function(){return"help"},Cursors.get_sizeNESW=function(){return"nwse-resize"},Cursors.get_sizeNS=function(){return"ns-resize"},Cursors.get_sizeNWSE=function(){return"nwse-resize"},Cursors.get_sizeWE=function(){return"ew-resize"},Cursors.get_upArrow=function(){return"help"},Cursors.get_vSplit=function(){return"col-resize"},Cursors.get_waitCursor=function(){return"wait"};var Cursors$={};registerType("Cursors",[Cursors,Cursors$,null]);var Keys={modifiers:-65536,none:0,lButton:1,rButton:2,cancel:3,mButton:4,xButton1:5,xButton2:6,back:8,tab:9,lineFeed:10,clearKey:12,returnKey:13,enter:13,shiftKey:16,controlKey:17,menu:18,pause:19,capital:20,capsLock:20,kanaMode:21,hanguelMode:21,hangulMode:21,junjaMode:23,finalMode:24,hanjaMode:25,kanjiMode:25,escape:27,imeConvert:28,imeNonconvert:29,imeAccept:30,imeAceept:30,imeModeChange:31,space:32,prior:33,pageUp:33,next:34,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,print:42,execute:43,snapshot:44,printScreen:44,insertKey:45,deleteKey:46,help:47,d0:48,d1:49,d2:50,d3:51,d4:52,d5:53,d6:54,d7:55,d8:56,d9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,lWin:91,rWin:92,apps:93,sleep:95,numPad0:96,numPad1:97,numPad2:98,numPad3:99,numPad4:100,numPad5:101,numPad6:102,numPad7:103,numPad8:104,numPad9:105,multiply:106,add:107,separator:108,subtract:109,decimal:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,f13:124,f14:125,f15:126,f16:127,f17:128,f18:129,f19:130,f20:131,f21:132,f22:133,f23:134,f24:135,numLock:144,scroll:145,lShiftKey:160,rShiftKey:161,lControlKey:162,rControlKey:163,lMenu:164,rMenu:165,browserBack:166,browserForward:167,browserRefresh:168,browserStop:169,browserSearch:170,browserFavorites:171,browserHome:172,volumeMute:173,volumeDown:174,volumeUp:175,mediaNextTrack:176,mediaPreviousTrack:177,mediaStop:178,mediaPlayPause:179,launchMail:180,selectMedia:181,launchApplication1:182,launchApplication2:183,oemSemicolon:186,oem1:186,oemplus:187,oemcomma:188,oemMinus:189,oemPeriod:190,oemQuestion:191,oem2:191,oemtilde:192,oem3:192,oemOpenBrackets:219,oem4:219,oemPipe:220,oem5:220,oemCloseBrackets:221,oem6:221,oemQuotes:222,oem7:222,oem8:223,oemBackslash:226,oem102:226,processKey:229,packet:231,attn:246,crsel:247,exsel:248,eraseEof:249,play:250,zoom:251,noName:252,pa1:253,oemClear:254,keyCode:65535,shift:65536,control:131072,alt:262144};function SelectLink(e){this._return=!1,this._next=!0,this._linkSlide=!1,this._slide=null,this._ok=!1,null!=e?this.set_id(e):this.set_next(!0)}registerType("Keys",Keys);var SelectLink$={get_returnCaller:function(){return this._return},set_returnCaller:function(e){return e&&(this._slide="Return"),this._return=e,e},get_next:function(){return this._next},set_next:function(e){return e&&(this._slide="Next"),this._next=e,e},get_linkToSlide:function(){return this._linkSlide},set_linkToSlide:function(e){return e&&(this._slide="Next"),this._linkSlide=e,e},get_id:function(){return this._slide},set_id:function(e){return this._return=!1,this._next=!1,this._linkSlide=!0,this._slide=e,e},get_OK:function(){return this._ok},set_OK:function(e){return this._ok=e,e}};function PopupVolume(){this.volume=0}registerType("SelectLink",[SelectLink,SelectLink$,null]);var PopupVolume$={showDialog:function(){return 1}};function PopupColorPicker(){this.volume=0,this.location=new Vector2d,this.color=new Color}registerType("PopupVolume",[PopupVolume,PopupVolume$,null]);var PopupColorPicker$={showDialog:function(){return 1}};function OverlayProperties(){this.volume=0,this.location=new Vector2d,this.overlay=null}registerType("PopupColorPicker",[PopupColorPicker,PopupColorPicker$,null]);var OverlayProperties$={showDialog:function(){return 1}};function getTileKey(e,t,i,r,n){if(7===e.get_projection()&&null!=n){var s=4*n.ipix+2*r+i;return e.get_imageSetID().toString()+"\\"+t.toString()+"\\"+s.toString()}return e.get_imageSetID().toString()+"\\"+t.toString()+"\\"+r.toString()+"_"+i.toString()}function DistanceCalc(){}registerType("OverlayProperties",[OverlayProperties,OverlayProperties$,null]),DistanceCalc.lineToPoint=function(e,t,i){var r=Vector3d.subtractVectors(t,e),n=Vector3d.subtractVectors(i,e);return Vector3d.cross(n,r).length()/r.length()},DistanceCalc.getUVFromInnerPoint=function(e,t,i,r,n){e.normalize(),t.normalize(),i.normalize(),r.normalize(),n.normalize();var s=DistanceCalc.lineToPoint(e,t,n),a=s+DistanceCalc.lineToPoint(i,r,n),o=DistanceCalc.lineToPoint(t,r,n),l=DistanceCalc.lineToPoint(e,i,n),h=o+l;return Vector2d.create(l/h,s/a)};var DistanceCalc$={};registerType("DistanceCalc",[DistanceCalc,DistanceCalc$,null]);var DialogResult={OK:1};function Color(){this.a=255,this.b=255,this.g=255,this.r=255,this.name=""}registerType("DialogResult",DialogResult),registerEnum("DialogResult",DialogResult),Color.fromArgb=function(e,t,i,r){var n=new Color;return n.a=e,n.r=t,n.g=i,n.b=r,n},Color._fromArgbColor=function(e,t){var i=new Color;return i.a=e,i.r=t.r,i.g=t.g,i.b=t.b,i},Color.fromName=function(e){return Color.load(e)},Color.load=function(e){var t=255,i=255,r=255,n=255,s=e.split(":");if(5===s.length)t=parseInt(s[1]),i=parseInt(s[2]),r=parseInt(s[3]),n=parseInt(s[4]);else{if(2===s.length)return Color.fromName(s[1].toLowerCase());if(1===s.length&&ss.ss.startsWith(s[0],"#"))return Color.fromHex(s[0]);if(1===s.length&&8===s[0].length)return Color.fromSimpleHex(s[0]);if(1===s.length)return Color._fromWindowsNamedColor(s[0])}return Color.fromArgb(t,i,r,n)},Color._fromWindowsNamedColor=function(e){switch(e.toLowerCase()){case"activeborder":return Color.fromArgb(255,180,180,180);case"activecaption":return Color.fromArgb(255,153,180,209);case"activecaptiontext":case"controltext":case"inactivecaptiontext":case"infotext":case"menutext":case"windowtext":case"black":return Color.fromArgb(255,0,0,0);case"appworkspace":return Color.fromArgb(255,171,171,171);case"control":case"menu":case"buttonface":case"menubar":return Color.fromArgb(255,240,240,240);case"controldark":case"buttonshadow":return Color.fromArgb(255,160,160,160);case"controldarkdark":case"dimgray":return Color.fromArgb(255,105,105,105);case"controllight":return Color.fromArgb(255,227,227,227);case"controllightlight":case"desktop":case"highlighttext":case"window":case"white":case"buttonhighlight":return Color.fromArgb(255,255,255,255);case"graytext":return Color.fromArgb(255,109,109,109);case"highlight":case"menuhighlight":return Color.fromArgb(255,51,153,255);case"hottrack":return Color.fromArgb(255,0,102,204);case"inactiveborder":return Color.fromArgb(255,244,247,252);case"inactivecaption":return Color.fromArgb(255,191,205,219);case"info":return Color.fromArgb(255,255,255,225);case"scrollbar":return Color.fromArgb(255,200,200,200);case"windowframe":return Color.fromArgb(255,100,100,100);case"transparent":return Color.fromArgb(0,255,255,255);case"aliceblue":return Color.fromArgb(255,240,248,255);case"antiquewhite":return Color.fromArgb(255,250,235,215);case"aqua":case"cyan":return Color.fromArgb(255,0,255,255);case"aquamarine":return Color.fromArgb(255,127,255,212);case"azure":return Color.fromArgb(255,240,255,255);case"beige":return Color.fromArgb(255,245,245,220);case"bisque":return Color.fromArgb(255,255,228,196);case"blanchedalmond":return Color.fromArgb(255,255,235,205);case"blue":return Color.fromArgb(255,0,0,255);case"blueviolet":return Color.fromArgb(255,138,43,226);case"brown":return Color.fromArgb(255,165,42,42);case"burlywood":return Color.fromArgb(255,222,184,135);case"cadetblue":return Color.fromArgb(255,95,158,160);case"chartreuse":return Color.fromArgb(255,127,255,0);case"chocolate":return Color.fromArgb(255,210,105,30);case"coral":return Color.fromArgb(255,255,127,80);case"cornflowerblue":return Color.fromArgb(255,100,149,237);case"cornsilk":return Color.fromArgb(255,255,248,220);case"crimson":return Color.fromArgb(255,220,20,60);case"darkblue":return Color.fromArgb(255,0,0,139);case"darkcyan":return Color.fromArgb(255,0,139,139);case"darkgoldenrod":return Color.fromArgb(255,184,134,11);case"darkgray":return Color.fromArgb(255,169,169,169);case"darkgreen":return Color.fromArgb(255,0,100,0);case"darkkhaki":return Color.fromArgb(255,189,183,107);case"darkmagenta":return Color.fromArgb(255,139,0,139);case"darkolivegreen":return Color.fromArgb(255,85,107,47);case"darkorange":return Color.fromArgb(255,255,140,0);case"darkorchid":return Color.fromArgb(255,153,50,204);case"darkred":return Color.fromArgb(255,139,0,0);case"darksalmon":return Color.fromArgb(255,233,150,122);case"darkseagreen":return Color.fromArgb(255,143,188,139);case"darkslateblue":return Color.fromArgb(255,72,61,139);case"darkslategray":return Color.fromArgb(255,47,79,79);case"darkturquoise":return Color.fromArgb(255,0,206,209);case"darkviolet":return Color.fromArgb(255,148,0,211);case"deeppink":return Color.fromArgb(255,255,20,147);case"deepskyblue":return Color.fromArgb(255,0,191,255);case"dodgerblue":return Color.fromArgb(255,30,144,255);case"firebrick":return Color.fromArgb(255,178,34,34);case"floralwhite":return Color.fromArgb(255,255,250,240);case"forestgreen":return Color.fromArgb(255,34,139,34);case"fuchsia":case"magenta":return Color.fromArgb(255,255,0,255);case"gainsboro":return Color.fromArgb(255,220,220,220);case"ghostwhite":return Color.fromArgb(255,248,248,255);case"gold":return Color.fromArgb(255,255,215,0);case"goldenrod":return Color.fromArgb(255,218,165,32);case"gray":return Color.fromArgb(255,128,128,128);case"green":return Color.fromArgb(255,0,128,0);case"greenyellow":return Color.fromArgb(255,173,255,47);case"honeydew":return Color.fromArgb(255,240,255,240);case"hotpink":return Color.fromArgb(255,255,105,180);case"indianred":return Color.fromArgb(255,205,92,92);case"indigo":return Color.fromArgb(255,75,0,130);case"ivory":return Color.fromArgb(255,255,255,240);case"khaki":return Color.fromArgb(255,240,230,140);case"lavender":return Color.fromArgb(255,230,230,250);case"lavenderblush":return Color.fromArgb(255,255,240,245);case"lawngreen":return Color.fromArgb(255,124,252,0);case"lemonchiffon":return Color.fromArgb(255,255,250,205);case"lightblue":return Color.fromArgb(255,173,216,230);case"lightcoral":return Color.fromArgb(255,240,128,128);case"lightcyan":return Color.fromArgb(255,224,255,255);case"lightgoldenrodyellow":return Color.fromArgb(255,250,250,210);case"lightgray":return Color.fromArgb(255,211,211,211);case"lightgreen":return Color.fromArgb(255,144,238,144);case"lightpink":return Color.fromArgb(255,255,182,193);case"lightsalmon":return Color.fromArgb(255,255,160,122);case"lightseagreen":return Color.fromArgb(255,32,178,170);case"lightskyblue":return Color.fromArgb(255,135,206,250);case"lightslategray":return Color.fromArgb(255,119,136,153);case"lightsteelblue":return Color.fromArgb(255,176,196,222);case"lightyellow":return Color.fromArgb(255,255,255,224);case"lime":return Color.fromArgb(255,0,255,0);case"limegreen":return Color.fromArgb(255,50,205,50);case"linen":return Color.fromArgb(255,250,240,230);case"maroon":return Color.fromArgb(255,128,0,0);case"mediumaquamarine":return Color.fromArgb(255,102,205,170);case"mediumblue":return Color.fromArgb(255,0,0,205);case"mediumorchid":return Color.fromArgb(255,186,85,211);case"mediumpurple":return Color.fromArgb(255,147,112,219);case"mediumseagreen":return Color.fromArgb(255,60,179,113);case"mediumslateblue":return Color.fromArgb(255,123,104,238);case"mediumspringgreen":return Color.fromArgb(255,0,250,154);case"mediumturquoise":return Color.fromArgb(255,72,209,204);case"mediumvioletred":return Color.fromArgb(255,199,21,133);case"midnightblue":return Color.fromArgb(255,25,25,112);case"mintcream":return Color.fromArgb(255,245,255,250);case"mistyrose":return Color.fromArgb(255,255,228,225);case"moccasin":return Color.fromArgb(255,255,228,181);case"navajowhite":return Color.fromArgb(255,255,222,173);case"navy":return Color.fromArgb(255,0,0,128);case"oldlace":return Color.fromArgb(255,253,245,230);case"olive":return Color.fromArgb(255,128,128,0);case"olivedrab":return Color.fromArgb(255,107,142,35);case"orange":return Color.fromArgb(255,255,165,0);case"orangered":return Color.fromArgb(255,255,69,0);case"orchid":return Color.fromArgb(255,218,112,214);case"palegoldenrod":return Color.fromArgb(255,238,232,170);case"palegreen":return Color.fromArgb(255,152,251,152);case"paleturquoise":return Color.fromArgb(255,175,238,238);case"palevioletred":return Color.fromArgb(255,219,112,147);case"papayawhip":return Color.fromArgb(255,255,239,213);case"peachpuff":return Color.fromArgb(255,255,218,185);case"peru":return Color.fromArgb(255,205,133,63);case"pink":return Color.fromArgb(255,255,192,203);case"plum":return Color.fromArgb(255,221,160,221);case"powderblue":return Color.fromArgb(255,176,224,230);case"purple":return Color.fromArgb(255,128,0,128);case"red":return Color.fromArgb(255,255,0,0);case"rosybrown":return Color.fromArgb(255,188,143,143);case"royalblue":return Color.fromArgb(255,65,105,225);case"saddlebrown":return Color.fromArgb(255,139,69,19);case"salmon":return Color.fromArgb(255,250,128,114);case"sandybrown":return Color.fromArgb(255,244,164,96);case"seagreen":return Color.fromArgb(255,46,139,87);case"seashell":return Color.fromArgb(255,255,245,238);case"sienna":return Color.fromArgb(255,160,82,45);case"silver":return Color.fromArgb(255,192,192,192);case"skyblue":return Color.fromArgb(255,135,206,235);case"slateblue":return Color.fromArgb(255,106,90,205);case"slategray":return Color.fromArgb(255,112,128,144);case"snow":return Color.fromArgb(255,255,250,250);case"springgreen":return Color.fromArgb(255,0,255,127);case"steelblue":return Color.fromArgb(255,70,130,180);case"tan":return Color.fromArgb(255,210,180,140);case"teal":return Color.fromArgb(255,0,128,128);case"thistle":return Color.fromArgb(255,216,191,216);case"tomato":return Color.fromArgb(255,255,99,71);case"turquoise":return Color.fromArgb(255,64,224,208);case"violet":return Color.fromArgb(255,238,130,238);case"wheat":return Color.fromArgb(255,245,222,179);case"whitesmoke":return Color.fromArgb(255,245,245,245);case"yellow":return Color.fromArgb(255,255,255,0);case"yellowgreen":return Color.fromArgb(255,154,205,50);case"gradientactivecaption":return Color.fromArgb(255,185,209,234);case"gradientinactivecaption":return Color.fromArgb(255,215,228,242)}return Color.fromArgb(255,255,255,255)},Color.fromHex=function(e){var t=Util.fromHex(e.substr(1,2)),i=Util.fromHex(e.substr(3,2)),r=Util.fromHex(e.substr(5,2));return Color.fromArgb(255,t,i,r)},Color.fromSimpleHex=function(e){var t=Util.fromHex(e.substr(0,2)),i=Util.fromHex(e.substr(2,2)),r=Util.fromHex(e.substr(4,2)),n=Util.fromHex(e.substr(6,2));return Color.fromArgb(t,i,r,n)},Color.fromInt=function(e){var t=(4278190080&e)>>>24,i=(16711680&e)>>>16,r=(65280&e)>>>8,n=255&e;return Color.fromArgb(n,t,i,r)};var Color$={toFormat:function(){return ss.ss.emptyString(this.name)?ss.ss.format("rgb({0},{1},{2})",this.r.toString(),this.g.toString(),this.b.toString()):this.name},save:function(){return ss.ss.emptyString(this.name)?ss.ss.format("{0}:{1}:{2}:{3}:{4}",1,this.a,this.r,this.g,this.b):ss.ss.format("{0}:{1}",0,this.name)},toString:function(){return ss.ss.emptyString(this.name)?ss.ss.format("#{0}{1}{2}",Util.toHex(this.r),Util.toHex(this.g),Util.toHex(this.b)):this.name},toSimpleHex:function(){return ss.ss.emptyString(this.name)?ss.ss.format("{0}{1}{2}{3}",Util.toHex(this.a),Util.toHex(this.r),Util.toHex(this.g),Util.toHex(this.b)):this.name},_clone:function(){return Color.fromArgb(this.a,this.r,this.g,this.b)}};function Colors(){}registerType("Color",[Color,Color$,null]),Colors.get_black=function(){return Color.fromArgb(255,0,0,0)},Colors.get_blue=function(){return Color.fromArgb(255,0,0,255)},Colors.get_brown=function(){return Color.fromArgb(255,165,42,42)},Colors.get_cyan=function(){return Color.fromArgb(255,0,255,255)},Colors.get_darkGray=function(){return Color.fromArgb(255,169,169,169)},Colors.get_gray=function(){return Color.fromArgb(255,128,128,128)},Colors.get_green=function(){return Color.fromArgb(255,0,255,0)},Colors.get_lightGray=function(){return Color.fromArgb(255,211,211,211)},Colors.get_magenta=function(){return Color.fromArgb(255,255,0,255)},Colors.get_orange=function(){return Color.fromArgb(255,255,165,0)},Colors.get_purple=function(){return Color.fromArgb(255,128,0,128)},Colors.get_red=function(){return Color.fromArgb(255,255,0,0)},Colors.get_transparent=function(){return Color.fromArgb(0,255,255,255)},Colors.get_white=function(){return Color.fromArgb(255,255,255,255)},Colors.get_yellow=function(){return Color.fromArgb(255,255,255,0)};var Colors$={};registerType("Colors",[Colors,Colors$,null]);var tilePrepDevice=null;function set_tilePrepDevice(e){tilePrepDevice=e}var tileUvMultiple=256;function set_tileUvMultiple(e){tileUvMultiple=e}var tileDemEnabled=!1;function set_tileDemEnabled(e){tileDemEnabled=!!e}var useGl=!1;function set_useGl(e){useGl=!!e}var useGlVersion2=!1;function set_useGlVersion2(e){useGlVersion2=!!e}var tileCacheAddTileToQueue=null;function set_tileCacheAddTileToQueue(e){tileCacheAddTileToQueue=e}var tileCacheRemoveFromQueue=null;function set_tileCacheRemoveFromQueue(e){tileCacheRemoveFromQueue=e}var tileCacheAccessID=0;function inc_tileCacheAccessID(){return tileCacheAccessID++}var tileCacheGetTile=null;function set_tileCacheGetTile(e){tileCacheGetTile=e}var tileCacheGetCachedTile=null;function set_tileCacheGetCachedTile(e){tileCacheGetCachedTile=e}var globalRenderContext=null;function set_globalRenderContext(e){globalRenderContext=e}const RC=3.1415927/180;function geoTo3dDouble(e,t){return Vector3d.create(Math.cos(t*RC)*Math.cos(e*RC)*1,1*Math.sin(e*RC),Math.sin(t*RC)*Math.cos(e*RC)*1)}function coords_cartesianToSpherical2(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i=Math.atan2(e.z,e.x),r=Math.asin(e.y/t),n=(i+=80*Math.PI%(2*Math.PI))/RC;return n>180&&(n=180-n-180),[r/RC,n]}var LocationHint={slash:0,backslash:1,top:2};function PositionTexture(){this.tu=0,this.tv=0,this.position=new Vector3d}registerType("LocationHint",LocationHint),PositionTexture.createPos=function(e,t,i){var r=new PositionTexture;return r.tu=t*tileUvMultiple,r.tv=i*tileUvMultiple,r.position=e,r},PositionTexture.createPosRaw=function(e,t,i){var r=new PositionTexture;return r.tu=t,r.tv=i,r.position=e,r},PositionTexture.createPosSize=function(e,t,i,r,n){var s=new PositionTexture;return s.tu=t*r,s.tv=i*n,s.position=e,s},PositionTexture.create=function(e,t,i,r,n){var s=new PositionTexture;return s.position=Vector3d.create(e,t,i),s.tu=r*tileUvMultiple,s.tv=n*tileUvMultiple,s};var PositionTexture$={copy:function(){var e=new PositionTexture;return e.position=Vector3d.makeCopy(this.position),e.tu=this.tu,e.tv=this.tv,e},toString:function(){return ss.ss.format("{0}, {1}, {2}, {3}, {4}",this.position.x,this.position.y,this.position.z,this.tu,this.tv)}};function PositionColoredTextured(){this.tu=0,this.tv=0,this.color=new Color,this.position=new Vector3d}registerType("PositionTexture",[PositionTexture,PositionTexture$,null]),PositionColoredTextured.createPos=function(e,t,i){var r=new PositionColoredTextured;return r.tu=t*tileUvMultiple,r.tv=i*tileUvMultiple,r.position=e,r},PositionColoredTextured.createPosRaw=function(e,t,i){var r=new PositionColoredTextured;return r.tu=t,r.tv=i,r.position=e,r},PositionColoredTextured.createPosSize=function(e,t,i,r,n){var s=new PositionColoredTextured;return s.tu=t*r,s.tv=i*n,s.position=e,s},PositionColoredTextured.create=function(e,t,i,r,n){var s=new PositionTexture;return s.position=Vector3d.create(e,t,i),s.tu=r*tileUvMultiple,s.tv=n*tileUvMultiple,s};var PositionColoredTextured$={copy:function(){var e=new PositionTexture;return e.position=Vector3d.makeCopy(this.position),e.tu=this.tu,e.tv=this.tv,e},toString:function(){return ss.ss.format("{0}, {1}, {2}, {3}, {4}",this.position.x,this.position.y,this.position.z,this.tu,this.tv)}};function PositionColored(e,t){this.color=new Color,this.color=t._clone(),this.position=e.copy()}registerType("PositionColoredTextured",[PositionColoredTextured,PositionColoredTextured$,null]);var PositionColored$={copy:function(){return new PositionColored(this.position,this.color)},toString:function(){return ss.ss.format("{0}, {1}, {2}, {3}",this.position.x,this.position.y,this.position.z,this.color.toString())}};function PositionNormalTexturedTangent(e,t,i,r){this.x=0,this.y=0,this.z=0,this.nx=0,this.ny=0,this.nz=0,this.tu=0,this.tv=0,this.tanx=0,this.tany=0,this.tanz=0,this.x=e.x,this.y=e.y,this.z=e.z,this.nx=t.x,this.ny=t.y,this.nz=t.z,this.tu=i.x,this.tv=i.y,this.tanx=r.x,this.tany=r.y,this.tanz=r.z}registerType("PositionColored",[PositionColored,PositionColored$,null]);var PositionNormalTexturedTangent$={get_normal:function(){return Vector3d.create(this.nx,this.ny,this.nz)},set_normal:function(e){return this.nx=e.x,this.ny=e.y,this.nz=e.z,e},get_position:function(){return Vector3d.create(this.x,this.y,this.z)},set_position:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,e},get_texCoord:function(){return Vector2d.create(this.tu,this.tv)},set_texCoord:function(e){return this.tu=e.x,this.tv=e.y,e},get_tangent:function(){return Vector3d.create(this.tanx,this.tany,this.tanz)},set_tangent:function(e){return this.tanx=e.x,this.tany=e.y,this.tanz=e.z,e},toString:function(){return ss.ss.format("X={0}, Y={1}, Z={2}, Nx={3}, Ny={4}, Nz={5}, U={6}, V={7}, TanX={8}, TanY={9}, TanZ={10}",this.x,this.y,this.z,this.nx,this.ny,this.nz,this.tu,this.tv,this.tanx,this.tany,this.tanz)}};function Vector3d(){this.x=0,this.y=0,this.z=0}registerType("PositionNormalTexturedTangent",[PositionNormalTexturedTangent,PositionNormalTexturedTangent$,null]),Vector3d.create=function(e,t,i){var r=new Vector3d;return r.x=e,r.y=t,r.z=i,r},Vector3d.makeCopy=function(e){var t=new Vector3d;return t.x=e.x,t.y=e.y,t.z=e.z,t},Vector3d.negate=function(e){return Vector3d.create(-e.x,-e.y,-e.z)},Vector3d.midPoint=function(e,t){return Vector3d.create((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)},Vector3d.midPointByLength=function(e,t){var i=Vector3d.create((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2);return i.normalize(),i.multiply(e.length()),i},Vector3d.get_empty=function(){return Vector3d.create(0,0,0)},Vector3d.addVectors=function(e,t){return Vector3d.create(e.x+t.x,e.y+t.y,e.z+t.z)},Vector3d.cross=function(e,t){return Vector3d.create(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},Vector3d.dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},Vector3d.getLength=function(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)},Vector3d.getLengthSq=function(e){return e.x*e.x+e.y*e.y+e.z*e.z},Vector3d.lerp=function(e,t,i){return Vector3d.create(e.x*(1-i)+t.x*i,e.y*(1-i)+t.y*i,e.z*(1-i)+t.z*i)},Vector3d.midpoint=function(e,t){var i=Vector3d.create(.5*e.x+.5*t.x,.5*e.y+.5*t.y,.5*e.z+.5*t.z);return i.normalize(),i},Vector3d.slerp=function(e,t,i){for(var r=Vector3d.dot(e,t);r<.98;){var n=Vector3d.midpoint(e,t);i>.5?(e=n,i-=.5,i*=2):(t=n,i*=2),r=Vector3d.dot(e,t)}var s=Vector3d.lerp(e,t,i);return s.normalize(),s},Vector3d.multiplyScalar=function(e,t){var i=e.copy();return i.multiply(t),i},Vector3d.scale=function(e,t){var i=e;return i.multiply(t),i},Vector3d.subtractVectors=function(e,t){var i=e.copy();return i.subtract(t),i},Vector3d.parse=function(e){var t=new Vector3d,i=e.split(",");return 3===i.length&&(t.x=parseFloat(i[0]),t.y=parseFloat(i[1]),t.z=parseFloat(i[2])),t},Vector3d._transformCoordinate=function(e,t){return t.transform(e)};var Vector3d$={set:function(e,t,i){this.x=e,this.y=t,this.z=i},copy:function(){var e=new Vector3d;return e.x=this.x,e.y=this.y,e.z=this.z,e},round:function(){this.x=ss.ss.truncate(65536*this.x)/65536,this.y=ss.ss.truncate(65536*this.y)/65536,this.z=ss.ss.truncate(65536*this.z)/65536},add:function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},multiply:function(e){this.x*=e,this.y*=e,this.z*=e},normalize:function(){var e=this.length();e&&(this.x/=e,this.y/=e,this.z/=e)},rotateX:function(e){var t,i;i=this.y*Math.cos(e)-this.z*Math.sin(e),t=this.y*Math.sin(e)+this.z*Math.cos(e),this.z=t,this.y=i},rotateZ:function(e){var t,i;t=this.x*Math.cos(e)-this.y*Math.sin(e),i=this.x*Math.sin(e)+this.y*Math.cos(e),this.y=i,this.x=t},rotateY:function(e){var t,i;t=this.z*Math.cos(e)-this.x*Math.sin(e),i=this.z*Math.sin(e)+this.x*Math.cos(e),this.x=i,this.z=t},subtract:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},toString:function(){return ss.ss.format("{0}, {1}, {2}",this.x,this.y,this.z)},toSpherical:function(){var e,t,i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),r=Math.sqrt(this.x*this.x+this.z*this.z);return t=Math.asin(this.y/i),e=r?0<=this.x?Math.asin(this.z/r):Math.PI-Math.asin(this.z/r):0,Vector2d.create((e+Math.PI)%(2*Math.PI),t+Math.PI/2)},toRaDec:function(){var e=this.toSpherical();return e.x=e.x/Math.PI*12,e.y=e.y/Math.PI*180-90,e},distanceToLine:function(e,t){var i=Vector3d.subtractVectors(t,e),r=Vector3d.subtractVectors(e,this);return Vector3d.cross(i,r).length()/Vector3d.subtractVectors(t,e).length()},_transformByMatrics:function(e){var t=e.transform(this);this.x=t.x,this.y=t.y,this.z=t.z}};function Vector2d(){this.x=0,this.y=0}registerType("Vector3d",[Vector3d,Vector3d$,null]),Vector3d.zero=new Vector3d,Vector2d.lerp=function(e,t,i){return Vector2d.create(e.x*(1-i)+t.x*i,e.y*(1-i)+t.y*i)},Vector2d.cartesianToSpherical2=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i=Math.atan2(e.z,e.x),r=Math.asin(e.y/t);return Vector2d.create(i/Math.PI*180,r/Math.PI*180)},Vector2d.average3d=function(e,t){var i=geoTo3dDouble(e.y,e.x),r=geoTo3dDouble(t.y,t.x),n=Vector3d.addVectors(i,r);return n.multiply(.5),n.normalize(),Vector2d.cartesianToSpherical2(n)},Vector2d.create=function(e,t){var i=new Vector2d;return i.x=e,i.y=t,i},Vector2d.subtract=function(e,t){return Vector2d.create(e.x-t.x,e.y-t.y)};var Vector2d$={distance3d:function(e){var t=geoTo3dDouble(e.y,e.x),i=geoTo3dDouble(this.y,this.x);return Vector3d.subtractVectors(t,i).length()/Math.PI*180},get_length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){var e=this.get_length();e&&(this.x/=e,this.y/=e)},extend:function(e){this.x=this.x*e,this.y=this.y*e}};function Matrix3d(){this._m11=0,this._m12=0,this._m13=0,this._m14=0,this._m21=0,this._m22=0,this._m23=0,this._m24=0,this._m31=0,this._m32=0,this._m33=0,this._m34=0,this._offsetX=0,this._offsetY=0,this._offsetZ=0,this._m44=0,this._isNotKnownToBeIdentity=!1}registerType("Vector2d",[Vector2d,Vector2d$,null]),Matrix3d.create=function(e,t,i,r,n,s,a,o,l,h,c,u,d,_,g,f){var m=new Matrix3d;return m._m11=e,m._m12=t,m._m13=i,m._m14=r,m._m21=n,m._m22=s,m._m23=a,m._m24=o,m._m31=l,m._m32=h,m._m33=c,m._m34=u,m._offsetX=d,m._offsetY=_,m._offsetZ=g,m._m44=f,m._isNotKnownToBeIdentity=!0,m},Matrix3d.get_identity=function(){var e=new Matrix3d;return e.set(Matrix3d._s_identity),e},Matrix3d.multiplyMatrix=function(e,t){return e.get__isDistinguishedIdentity()?t:t.get__isDistinguishedIdentity()?e:Matrix3d.create(e._m11*t._m11+e._m12*t._m21+e._m13*t._m31+e._m14*t._offsetX,e._m11*t._m12+e._m12*t._m22+e._m13*t._m32+e._m14*t._offsetY,e._m11*t._m13+e._m12*t._m23+e._m13*t._m33+e._m14*t._offsetZ,e._m11*t._m14+e._m12*t._m24+e._m13*t._m34+e._m14*t._m44,e._m21*t._m11+e._m22*t._m21+e._m23*t._m31+e._m24*t._offsetX,e._m21*t._m12+e._m22*t._m22+e._m23*t._m32+e._m24*t._offsetY,e._m21*t._m13+e._m22*t._m23+e._m23*t._m33+e._m24*t._offsetZ,e._m21*t._m14+e._m22*t._m24+e._m23*t._m34+e._m24*t._m44,e._m31*t._m11+e._m32*t._m21+e._m33*t._m31+e._m34*t._offsetX,e._m31*t._m12+e._m32*t._m22+e._m33*t._m32+e._m34*t._offsetY,e._m31*t._m13+e._m32*t._m23+e._m33*t._m33+e._m34*t._offsetZ,e._m31*t._m14+e._m32*t._m24+e._m33*t._m34+e._m34*t._m44,e._offsetX*t._m11+e._offsetY*t._m21+e._offsetZ*t._m31+e._m44*t._offsetX,e._offsetX*t._m12+e._offsetY*t._m22+e._offsetZ*t._m32+e._m44*t._offsetY,e._offsetX*t._m13+e._offsetY*t._m23+e._offsetZ*t._m33+e._m44*t._offsetZ,e._offsetX*t._m14+e._offsetY*t._m24+e._offsetZ*t._m34+e._m44*t._m44)},Matrix3d.lookAtLH=function(e,t,i){var r=Vector3d.subtractVectors(t,e);r.normalize();var n=Vector3d.cross(i,r);n.normalize();var s=Vector3d.cross(r,n);return Matrix3d.create(n.x,s.x,r.x,0,n.y,s.y,r.y,0,n.z,s.z,r.z,0,-Vector3d.dot(n,e),-Vector3d.dot(s,e),-Vector3d.dot(r,e),1)},Matrix3d._createIdentity=function(){var e=Matrix3d.create(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e.set__isDistinguishedIdentity(!0),e},Matrix3d.equals=function(e,t){return e.get__isDistinguishedIdentity()||t.get__isDistinguishedIdentity()?e.get_isIdentity()===t.get_isIdentity():e.get_m11()===t.get_m11()&&e.get_m12()===t.get_m12()&&e.get_m13()===t.get_m13()&&e.get_m14()===t.get_m14()&&e.get_m21()===t.get_m21()&&e.get_m22()===t.get_m22()&&e.get_m23()===t.get_m23()&&e.get_m24()===t.get_m24()&&e.get_m31()===t.get_m31()&&e.get_m32()===t.get_m32()&&e.get_m33()===t.get_m33()&&e.get_m34()===t.get_m34()&&e.get_offsetX()===t.get_offsetX()&&e.get_offsetY()===t.get_offsetY()&&e.get_offsetZ()===t.get_offsetZ()&&e.get_m44()===t.get_m44()},Matrix3d.fromMatrix2d=function(e){var t=Matrix3d._createIdentity();return t.set_m11(e.m11),t.set_m12(e.m12),t.set_m13(e.m13),t.set_m21(e.m21),t.set_m22(e.m22),t.set_m23(e.m23),t.set_m31(e.m31),t.set_m32(e.m32),t.set_m33(e.m33),t._isNotKnownToBeIdentity=!0,t},Matrix3d.rotationYawPitchRoll=function(e,t,i){var r=Matrix3d._rotationX(t),n=Matrix3d._rotationY(e),s=Matrix3d._rotationZ(i);return Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(n,r),s)},Matrix3d._rotationY=function(e){var t=e,i=Matrix3d.get_identity();return i._m11=Math.cos(t),i._m22=1,i._m31=Math.sin(t),i._m13=-Math.sin(t),i._m33=Math.cos(t),i._isNotKnownToBeIdentity=!0,i},Matrix3d._rotationX=function(e){var t=e,i=Matrix3d.get_identity();return i._m11=1,i._m22=Math.cos(t),i._m32=-Math.sin(t),i._m23=Math.sin(t),i._m33=Math.cos(t),i._isNotKnownToBeIdentity=!0,i},Matrix3d._rotationZ=function(e){var t=e,i=Matrix3d.get_identity();return i._m11=Math.cos(t),i._m21=-Math.sin(t),i._m12=Math.sin(t),i._m22=Math.cos(t),i._m33=1,i._isNotKnownToBeIdentity=!0,i},Matrix3d._scaling=function(e,t,i){var r=Matrix3d.get_identity();return r._m11=e,r._m22=t,r._m33=i,r._isNotKnownToBeIdentity=!0,r},Matrix3d._translationXYZ=function(e,t,i){var r=Matrix3d.get_identity();return r.set_offsetX(e),r.set_offsetY(t),r.set_offsetZ(i),r._isNotKnownToBeIdentity=!0,r},Matrix3d.perspectiveFovLH=function(e,t,i,r){var n=1/Math.tan(e/2),s=n/t;return Matrix3d.create(s,0,0,0,0,n,0,0,0,0,r/(r-i),1,0,0,-i*r/(r-i),0)},Matrix3d.perspectiveOffCenterLH=function(e,t,i,r,n,s){return Matrix3d.create(2*n/(t-e),0,0,0,0,2*n/(r-i),0,0,(e+t)/(e-t),(r+i)/(i-r),s/(s-n),1,0,0,n*s/(n-s),0)},Matrix3d.invertMatrix=function(e){var t=e.clone();return t.invert(),t},Matrix3d.translation=function(e){return Matrix3d._translationXYZ(e.x,e.y,e.z)},Matrix3d.getMapMatrix=function(e,t,i,r){var n,s;n=-(e.get_lng()+180-t/2)/360,s=-(1-(e.get_lat()+90+i/2)/180);var a,o,l=new Matrix2d;return a=360/t,o=180/i,l=Matrix2d.multiply(l,Matrix2d.translation(n,s)),l=Matrix2d.multiply(l,Matrix2d.scaling(a,o)),r&&(l=Matrix2d.multiply(l,Matrix2d.translation(-.5,-.5)),l=Matrix2d.multiply(l,Matrix2d.rotation(r)),l=Matrix2d.multiply(l,Matrix2d.translation(.5,.5))),Matrix3d.fromMatrix2d(l)};var Matrix3d$={clone:function(){var e=new Matrix3d;return e.set(this),e},setIdentity:function(){this.set(Matrix3d._s_identity)},set:function(e){this._m11=e._m11,this._m12=e._m12,this._m13=e._m13,this._m14=e._m14,this._m21=e._m21,this._m22=e._m22,this._m23=e._m23,this._m24=e._m24,this._m31=e._m31,this._m32=e._m32,this._m33=e._m33,this._m34=e._m34,this._offsetX=e._offsetX,this._offsetY=e._offsetY,this._offsetZ=e._offsetZ,this._m44=e._m44,this._isNotKnownToBeIdentity=!0},floatArray:function(){var e=new Array(16);return e[0]=this._m11,e[1]=this._m12,e[2]=this._m13,e[3]=this._m14,e[4]=this._m21,e[5]=this._m22,e[6]=this._m23,e[7]=this._m24,e[8]=this._m31,e[9]=this._m32,e[10]=this._m33,e[11]=this._m34,e[12]=this._offsetX,e[13]=this._offsetY,e[14]=this._offsetZ,e[15]=this._m44,e},get_isIdentity:function(){return!!this.get__isDistinguishedIdentity()||!(1!==this._m11||this._m12||this._m13||this._m14||this._m21||1!==this._m22||this._m23||this._m24||this._m31||this._m32||1!==this._m33||this._m34||this._offsetX||this._offsetY||this._offsetZ||1!==this._m44)&&(this.set__isDistinguishedIdentity(!0),!0)},prepend:function(e){this.set(Matrix3d.multiplyMatrix(e,this))},append:function(e){this._multiply(e)},scale:function(e){this.get__isDistinguishedIdentity()?this._setScaleMatrix(e):(this._m11*=e.x,this._m12*=e.y,this._m13*=e.z,this._m21*=e.x,this._m22*=e.y,this._m23*=e.z,this._m31*=e.x,this._m32*=e.y,this._m33*=e.z,this._offsetX*=e.x,this._offsetY*=e.y,this._offsetZ*=e.z)},scalePrepend:function(e){this.get__isDistinguishedIdentity()?this._setScaleMatrix(e):(this._m11*=e.x,this._m12*=e.x,this._m13*=e.x,this._m14*=e.x,this._m21*=e.y,this._m22*=e.y,this._m23*=e.y,this._m24*=e.y,this._m31*=e.z,this._m32*=e.z,this._m33*=e.z,this._m34*=e.z)},scaleAt:function(e,t){if(this.get__isDistinguishedIdentity())this._setScaleMatrixCenter(e,t);else{var i=this._m14*t.x;this._m11=i+e.x*(this._m11-i),i=this._m14*t.y,this._m12=i+e.y*(this._m12-i),i=this._m14*t.z,this._m13=i+e.z*(this._m13-i),i=this._m24*t.x,this._m21=i+e.x*(this._m21-i),i=this._m24*t.y,this._m22=i+e.y*(this._m22-i),i=this._m24*t.z,this._m23=i+e.z*(this._m23-i),i=this._m34*t.x,this._m31=i+e.x*(this._m31-i),i=this._m34*t.y,this._m32=i+e.y*(this._m32-i),i=this._m34*t.z,this._m33=i+e.z*(this._m33-i),i=this._m44*t.x,this._offsetX=i+e.x*(this._offsetX-i),i=this._m44*t.y,this._offsetY=i+e.y*(this._offsetY-i),i=this._m44*t.z,this._offsetZ=i+e.z*(this._offsetZ-i)}},scaleAtPrepend:function(e,t){if(this.get__isDistinguishedIdentity())this._setScaleMatrixCenter(e,t);else{var i=t.x-t.x*e.x,r=t.y-t.y*e.y,n=t.z-t.z*e.z;this._offsetX+=this._m11*i+this._m21*r+this._m31*n,this._offsetY+=this._m12*i+this._m22*r+this._m32*n,this._offsetZ+=this._m13*i+this._m23*r+this._m33*n,this._m44+=this._m14*i+this._m24*r+this._m34*n,this._m11*=e.x,this._m12*=e.x,this._m13*=e.x,this._m14*=e.x,this._m21*=e.y,this._m22*=e.y,this._m23*=e.y,this._m24*=e.y,this._m31*=e.z,this._m32*=e.z,this._m33*=e.z,this._m34*=e.z}},translate:function(e){this.get__isDistinguishedIdentity()?this._setTranslationMatrix(e):(this._m11+=this._m14*e.x,this._m12+=this._m14*e.y,this._m13+=this._m14*e.z,this._m21+=this._m24*e.x,this._m22+=this._m24*e.y,this._m23+=this._m24*e.z,this._m31+=this._m34*e.x,this._m32+=this._m34*e.y,this._m33+=this._m34*e.z,this._offsetX+=this._m44*e.x,this._offsetY+=this._m44*e.y,this._offsetZ+=this._m44*e.z)},translatePrepend:function(e){this.get__isDistinguishedIdentity()?this._setTranslationMatrix(e):(this._offsetX+=this._m11*e.x+this._m21*e.y+this._m31*e.z,this._offsetY+=this._m12*e.x+this._m22*e.y+this._m32*e.z,this._offsetZ+=this._m13*e.x+this._m23*e.y+this._m33*e.z,this._m44+=this._m14*e.x+this._m24*e.y+this._m34*e.z)},transform:function(e){var t=new Vector3d;if(!this.get__isDistinguishedIdentity()){var i=e.x,r=e.y,n=e.z;if(t.x=i*this._m11+r*this._m21+n*this._m31+this._offsetX,t.y=i*this._m12+r*this._m22+n*this._m32+this._offsetY,t.z=i*this._m13+r*this._m23+n*this._m33+this._offsetZ,!this.get_isAffine()){var s=i*this._m14+r*this._m24+n*this._m34+this._m44;t.x/=s,t.y/=s,t.z/=s}}return t},_transformTo:function(e,t){t.x=e.x*this._m11+e.y*this._m21+e.z*this._m31+this._offsetX,t.y=e.x*this._m12+e.y*this._m22+e.z*this._m32+this._offsetY,t.z=e.x*this._m13+e.y*this._m23+e.z*this._m33+this._offsetZ;var i=e.x*this._m14+e.y*this._m24+e.z*this._m34+this._m44;t.x/=i,t.y/=i,t.z/=i},transformArray:function(e){if(null!=e)for(var t=0;t<e.length;t++)this._multiplyPoint(e[t])},projectArrayToScreen:function(e,t){if(null!=e&&null!=t)for(var i=this.get_isAffine(),r=0;r<e.length;r++){var n=e[r].x,s=e[r].y,a=e[r].z;if(i)t[r].x=n*this._m11+s*this._m21+a*this._m31+this._offsetX,t[r].y=n*this._m12+s*this._m22+a*this._m32+this._offsetY,t[r].z=n*this._m13+s*this._m23+a*this._m33+this._offsetZ;else{var o=n*this._m14+s*this._m24+a*this._m34+this._m44;t[r].x=(n*this._m11+s*this._m21+a*this._m31+this._offsetX)/o,t[r].y=(n*this._m12+s*this._m22+a*this._m32+this._offsetY)/o,t[r].z=(n*this._m13+s*this._m23+a*this._m33+this._offsetZ)/o}}},projectToScreen:function(e,t,i){var r=new Vector3d,n=e.x,s=e.y,a=e.z;if(this.get_isAffine())r.x=(n*this._m11+s*this._m21+a*this._m31+this._offsetX+.5)*t,r.y=(.5-(n*this._m12+s*this._m22+a*this._m32+this._offsetY))*i,r.z=n*this._m13+s*this._m23+a*this._m33+this._offsetZ;else{var o=n*this._m14+s*this._m24+a*this._m34+this._m44;r.x=((n*this._m11+s*this._m21+a*this._m31+this._offsetX)/o+.5)*t,r.y=(-(n*this._m12+s*this._m22+a*this._m32+this._offsetY)/o+.5)*i,r.z=(n*this._m13+s*this._m23+a*this._m33+this._offsetZ)/o}return r},get_isAffine:function(){return!!this.get__isDistinguishedIdentity()||!(this._m14||this._m24||this._m34)&&1===this._m44},get_determinant:function(){if(this.get__isDistinguishedIdentity())return 1;if(this.get_isAffine())return this._getNormalizedAffineDeterminant();var e=this._m13*this._m24-this._m23*this._m14,t=this._m13*this._m34-this._m33*this._m14,i=this._m13*this._m44-this._offsetZ*this._m14,r=this._m23*this._m34-this._m33*this._m24,n=this._m23*this._m44-this._offsetZ*this._m24,s=this._m33*this._m44-this._offsetZ*this._m34,a=this._m22*t-this._m32*e-this._m12*r,o=this._m12*n-this._m22*i+this._offsetY*e,l=this._m32*i-this._offsetY*t-this._m12*s,h=this._m22*s-this._m32*n+this._offsetY*r;return this._offsetX*a+this._m31*o+this._m21*l+this._m11*h},get_hasInverse:function(){return!DoubleUtilities.isZero(this.get_determinant())},invert:function(){this._invertCore()},transpose:function(){var e=new Matrix3d;e.set(this),this._m12=e._m21,this._m13=e._m31,this._m14=e._offsetX,this._m23=e._m32,this._m24=e._offsetY,this._m34=e._offsetZ,this._m21=e._m12,this._m31=e._m13,this._offsetX=e._m14,this._m32=e._m23,this._offsetY=e._m24,this._offsetZ=e._m34},get_m11:function(){return this.get__isDistinguishedIdentity()?1:this._m11},set_m11:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m11=e,e},get_m12:function(){return this._m12},set_m12:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m12=e,e},get_m13:function(){return this._m13},set_m13:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m13=e,e},get_m14:function(){return this._m14},set_m14:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m14=e,e},get_m21:function(){return this._m21},set_m21:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m21=e,e},get_m22:function(){return this.get__isDistinguishedIdentity()?1:this._m22},set_m22:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m22=e,e},get_m23:function(){return this._m23},set_m23:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m23=e,e},get_m24:function(){return this._m24},set_m24:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m24=e,e},get_m31:function(){return this._m31},set_m31:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m31=e,e},get_m32:function(){return this._m32},set_m32:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m32=e,e},get_m33:function(){return this.get__isDistinguishedIdentity()?1:this._m33},set_m33:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m33=e,e},get_m34:function(){return this._m34},set_m34:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m34=e,e},get_m41:function(){return this.get_offsetX()},set_m41:function(e){return this.set_offsetX(e),e},get_m42:function(){return this.get_offsetY()},set_m42:function(e){return this.set_offsetY(e),e},get_m43:function(){return this.get_offsetZ()},set_m43:function(e){return this.set_offsetZ(e),e},get_offsetX:function(){return this._offsetX},set_offsetX:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._offsetX=e,e},get_offsetY:function(){return this._offsetY},set_offsetY:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._offsetY=e,e},get_offsetZ:function(){return this._offsetZ},set_offsetZ:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._offsetZ=e,e},get_m44:function(){return this.get__isDistinguishedIdentity()?1:this._m44},set_m44:function(e){return this.get__isDistinguishedIdentity()&&(this.set(Matrix3d._s_identity),this.set__isDistinguishedIdentity(!1)),this._m44=e,e},_setScaleMatrix:function(e){this._m11=e.x,this._m22=e.y,this._m33=e.z,this._m44=1,this.set__isDistinguishedIdentity(!1)},_setScaleMatrixCenter:function(e,t){this._m11=e.x,this._m22=e.y,this._m33=e.z,this._m44=1,this._offsetX=t.x-t.x*e.x,this._offsetY=t.y-t.y*e.y,this._offsetZ=t.z-t.z*e.z,this.set__isDistinguishedIdentity(!1)},_setTranslationMatrix:function(e){this._m11=this._m22=this._m33=this._m44=1,this._offsetX=e.x,this._offsetY=e.y,this._offsetZ=e.z,this.set__isDistinguishedIdentity(!1)},_multiplyPoint:function(e){if(!this.get__isDistinguishedIdentity()){var t=e.x,i=e.y,r=e.z;if(e.x=t*this._m11+i*this._m21+r*this._m31+this._offsetX,e.y=t*this._m12+i*this._m22+r*this._m32+this._offsetY,e.z=t*this._m13+i*this._m23+r*this._m33+this._offsetZ,!this.get_isAffine()){var n=t*this._m14+i*this._m24+r*this._m34+this._m44;e.x/=n,e.y/=n,e.z/=n}}},multiplyVector:function(e){if(!this.get__isDistinguishedIdentity()){var t=e.x,i=e.y,r=e.z;e.x=t*this._m11+i*this._m21+r*this._m31,e.y=t*this._m12+i*this._m22+r*this._m32,e.z=t*this._m13+i*this._m23+r*this._m33}},_getNormalizedAffineDeterminant:function(){var e=this._m12*this._m23-this._m22*this._m13,t=this._m32*this._m13-this._m12*this._m33,i=this._m22*this._m33-this._m32*this._m23;return this._m31*e+this._m21*t+this._m11*i},_normalizedAffineInvert:function(){var e=this._m12*this._m23-this._m22*this._m13,t=this._m32*this._m13-this._m12*this._m33,i=this._m22*this._m33-this._m32*this._m23,r=this._m31*e+this._m21*t+this._m11*i;if(DoubleUtilities.isZero(r))return!1;var n=this._m21*this._m13-this._m11*this._m23,s=this._m11*this._m33-this._m31*this._m13,a=this._m31*this._m23-this._m21*this._m33,o=this._m11*this._m22-this._m21*this._m12,l=this._m11*this._m32-this._m31*this._m12,h=this._m11*this._offsetY-this._offsetX*this._m12,c=this._m21*this._m32-this._m31*this._m22,u=this._m21*this._offsetY-this._offsetX*this._m22,d=this._m31*this._offsetY-this._offsetX*this._m32,_=this._m23*h-this._offsetZ*o-this._m13*u,g=this._m13*d-this._m33*h+this._offsetZ*l,f=this._m33*u-this._offsetZ*c-this._m23*d,m=o,p=-l,C=c,S=1/r;return this._m11=i*S,this._m12=t*S,this._m13=e*S,this._m21=a*S,this._m22=s*S,this._m23=n*S,this._m31=C*S,this._m32=p*S,this._m33=m*S,this._offsetX=f*S,this._offsetY=g*S,this._offsetZ=_*S,!0},_invertCore:function(){if(!this.get__isDistinguishedIdentity()){if(this.get_isAffine())return this._normalizedAffineInvert();var e=this._m13*this._m24-this._m23*this._m14,t=this._m13*this._m34-this._m33*this._m14,i=this._m13*this._m44-this._offsetZ*this._m14,r=this._m23*this._m34-this._m33*this._m24,n=this._m23*this._m44-this._offsetZ*this._m24,s=this._m33*this._m44-this._offsetZ*this._m34,a=this._m22*t-this._m32*e-this._m12*r,o=this._m12*n-this._m22*i+this._offsetY*e,l=this._m32*i-this._offsetY*t-this._m12*s,h=this._m22*s-this._m32*n+this._offsetY*r,c=this._offsetX*a+this._m31*o+this._m21*l+this._m11*h;if(DoubleUtilities.isZero(c))return!1;var u=this._m11*r-this._m21*t+this._m31*e,d=this._m21*i-this._offsetX*e-this._m11*n,_=this._m11*s-this._m31*i+this._offsetX*t,g=this._m31*n-this._offsetX*r-this._m21*s;e=this._m11*this._m22-this._m21*this._m12,t=this._m11*this._m32-this._m31*this._m12,i=this._m11*this._offsetY-this._offsetX*this._m12,r=this._m21*this._m32-this._m31*this._m22,n=this._m21*this._offsetY-this._offsetX*this._m22,s=this._m31*this._offsetY-this._offsetX*this._m32;var f=this._m13*r-this._m23*t+this._m33*e,m=this._m23*i-this._offsetZ*e-this._m13*n,p=this._m13*s-this._m33*i+this._offsetZ*t,C=this._m33*n-this._offsetZ*r-this._m23*s,S=this._m24*t-this._m34*e-this._m14*r,w=this._m14*n-this._m24*i+this._m44*e,T=this._m34*i-this._m44*t-this._m14*s,y=this._m24*s-this._m34*n+this._m44*r,b=1/c;this._m11=h*b,this._m12=l*b,this._m13=o*b,this._m14=a*b,this._m21=g*b,this._m22=_*b,this._m23=d*b,this._m24=u*b,this._m31=y*b,this._m32=T*b,this._m33=w*b,this._m34=S*b,this._offsetX=C*b,this._offsetY=p*b,this._offsetZ=m*b,this._m44=f*b}return!0},get__isDistinguishedIdentity:function(){return!this._isNotKnownToBeIdentity},set__isDistinguishedIdentity:function(e){return this._isNotKnownToBeIdentity=!e,e},_multiply:function(e){this.set(Matrix3d.multiplyMatrix(this,e))}};function Matrix2d(){this.m11=1,this.m12=0,this.m13=0,this.m21=0,this.m22=1,this.m23=0,this.m31=0,this.m32=0,this.m33=1}registerType("Matrix3d",[Matrix3d,Matrix3d$,null]),Matrix3d._s_identity=Matrix3d._createIdentity(),Matrix2d.create=function(e,t,i,r,n,s,a,o,l){var h=new Matrix2d;return h.m11=e,h.m12=t,h.m13=i,h.m21=r,h.m22=n,h.m23=s,h.m31=a,h.m32=o,h.m33=l,h},Matrix2d.rotation=function(e){var t=new Matrix2d;return t.m11=Math.cos(e),t.m21=-Math.sin(e),t.m12=Math.sin(e),t.m22=Math.cos(e),t},Matrix2d.translation=function(e,t){var i=new Matrix2d;return i.m31=e,i.m32=t,i},Matrix2d.scaling=function(e,t){var i=new Matrix2d;return i.m11=e,i.m22=t,i},Matrix2d.multiply=function(e,t){return Matrix2d.create(e.m11*t.m11+e.m12*t.m21+e.m13*t.m31,e.m11*t.m12+e.m12*t.m22+e.m13*t.m32,e.m11*t.m13+e.m12*t.m23+e.m13*t.m33,e.m21*t.m11+e.m22*t.m21+e.m23*t.m31,e.m21*t.m12+e.m22*t.m22+e.m23*t.m32,e.m21*t.m13+e.m22*t.m23+e.m23*t.m33,e.m31*t.m11+e.m32*t.m21+e.m33*t.m31,e.m31*t.m12+e.m32*t.m22+e.m33*t.m32,e.m31*t.m13+e.m32*t.m23+e.m33*t.m33)},Matrix2d.rotateAt=function(e,t){var i=Matrix2d.translation(-t.x,-t.y),r=Matrix2d.rotation(e),n=Matrix2d.translation(t.x,t.y);return Matrix2d.multiply(Matrix2d.multiply(i,r),n)};var Matrix2d$={_transformPoints:function(e){for(var t=ss.ss.enumerate(e);t.moveNext();){var i=t.current;this.multiplyPoint(i)}},multiplyPoint:function(e){var t=e.x,i=e.y;e.x=t*this.m11+i*this.m21+this.m31,e.y=t*this.m12+i*this.m22+this.m32}};function DoubleUtilities(){}function PlaneD(e,t,i,r){this.a=0,this.b=0,this.c=0,this.d=0,this.a=e,this.b=t,this.c=i,this.d=r}registerType("Matrix2d",[Matrix2d,Matrix2d$,null]),DoubleUtilities.isZero=function(e){return Math.abs(e)<2.22044604925031e-50},DoubleUtilities.isOne=function(e){return Math.abs(e-1)<2.22044604925031e-50},DoubleUtilities.radiansToDegrees=function(e){return 180*e/Math.PI},DoubleUtilities.degreesToRadians=function(e){return e*Math.PI/180},DoubleUtilities.clamp=function(e,t,i){return Math.max(t,Math.min(e,i))},registerType("DoubleUtilities",[DoubleUtilities,null,null]);var PlaneD$={normalize:function(){var e=Math.sqrt(this.a*this.a+this.b*this.b+this.c*this.c);this.a/=e,this.b/=e,this.c/=e,this.d/=e},dot:function(e){return this.b*e.y+this.c*e.z+this.d*e.w+this.a*e.x}};function Vector4d(e,t,i,r){this.x=0,this.y=0,this.z=0,this.w=0,this.x=e,this.y=t,this.z=i,this.w=r}registerType("PlaneD",[PlaneD,PlaneD$,null]);var Vector4d$={};function PositionNormalTexturedX2(){this.x=0,this.y=0,this.z=0,this.nx=0,this.ny=0,this.nz=0,this.tu=0,this.tv=0,this.tu1=0,this.tv1=0}registerType("Vector4d",[Vector4d,Vector4d$,null]),PositionNormalTexturedX2.create2UV=function(e,t,i,r,n,s){var a=new PositionNormalTexturedX2;return a.x=e.x,a.y=e.y,a.z=e.z,a.nx=t.x,a.ny=t.y,a.nz=t.z,a.tu=i,a.tv=r,a.tu1=n,a.tv1=s,a},PositionNormalTexturedX2.create=function(e,t,i,r){var n=new PositionNormalTexturedX2;n.x=e.x,n.y=e.y,n.z=e.z,n.nx=t.x,n.ny=t.y,n.nz=t.z,n.tu=i,n.tv=r;var s=coords_cartesianToSpherical2(t);return n.tu1=(s[1]+180)/360,n.tv1=1-(s[0]+90)/180,n},PositionNormalTexturedX2.createLong2UV=function(e,t,i,r,n,s,a,o,l,h){var c=new PositionNormalTexturedX2;return c.x=e,c.y=t,c.z=i,c.nx=r,c.ny=n,c.nz=s,c.tu=a,c.tv=o,c.tu1=l,c.tv1=h,c},PositionNormalTexturedX2.get_strideSize=function(){return 40};var PositionNormalTexturedX2$={get_lat:function(){return 180*(1-this.tv1)-90},set_lat:function(e){return this.tv1=1-(e+90)/180,e},get_lng:function(){return 360*this.tu1-180},set_lng:function(e){return this.tu1=(e+180)/360,e},createLong:function(e,t,i,r,n,s,a,o){var l=new PositionNormalTexturedX2;l.x=e,l.y=t,l.z=i,l.nx=r,l.ny=n,l.nz=s,l.tu=a,l.tv=o;var h=coords_cartesianToSpherical2(Vector3d.create(this.nx,this.ny,this.nz));return l.tu1=(h[1]+180)/360,l.tv1=1-(h[0]+90)/180,l},get_normal:function(){return Vector3d.create(this.nx,this.ny,this.nz)},set_normal:function(e){return this.nx=e.x,this.ny=e.y,this.nz=e.z,e},get_position:function(){return Vector3d.create(this.x,this.y,this.y)},set_position:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,e},toString:function(){return ss.ss.format("X={0}, Y={1}, Z={2}, Nx={3}, Ny={4}, Nz={5}, U={6}, V={7}, U1={8}, U2={9}",this.x,this.y,this.z,this.nx,this.ny,this.nz,this.tu,this.tv,this.tu1,this.tv1)}};function PositionNormalTextured(){this.x=0,this.y=0,this.z=0,this.nx=0,this.ny=0,this.nz=0,this.tu=0,this.tv=0}registerType("PositionNormalTexturedX2",[PositionNormalTexturedX2,PositionNormalTexturedX2$,null]),PositionNormalTextured.createShort=function(e,t,i,r){var n=new PositionNormalTextured;return n.x=e.x,n.y=e.y,n.z=e.z,n.nx=t.x,n.ny=t.y,n.nz=t.z,n.tu=i,n.tv=r,n},PositionNormalTextured._create=function(e,t,i,r,n,s,a,o){var l=new PositionNormalTextured;return l.x=e,l.y=t,l.z=i,l.nx=r,l.ny=n,l.nz=s,l.tu=a,l.tv=o,l},PositionNormalTextured.createUV=function(e,t,i){var r=new PositionNormalTextured;return r.x=e.x,r.y=e.y,r.z=e.z,r.nx=t.x,r.ny=t.y,r.nz=t.z,r.tu=i.x,r.tv=i.y,r};var PositionNormalTextured$={createLong:function(e,t,i,r,n,s,a,o){var l=new PositionNormalTexturedX2;return l.x=e,l.y=t,l.z=i,l.nx=r,l.ny=n,l.nz=s,l.tu=a,l.tv=o,l},get_normal:function(){return Vector3d.create(this.nx,this.ny,this.nz)},set_normal:function(e){return this.nx=e.x,this.ny=e.y,this.nz=e.z,e},get_position:function(){return Vector3d.create(this.x,this.y,this.z)},set_position:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,e},toString:function(){return ss.ss.format("X={0}, Y={1}, Z={2}, Nx={3}, Ny={4}, Nz={5}, U={6}, V={7}, U1={8}, U2={9}",this.x,this.y,this.z,this.nx,this.ny,this.nz,this.tu,this.tv)}};function SphereHull(){this.radius=0}registerType("PositionNormalTextured",[PositionNormalTextured,PositionNormalTextured$,null]),SphereHull._create=function(e,t){var i=new SphereHull;return i.center=e,i.radius=t,i};var SphereHull$={};function ConvexHull(){}registerType("SphereHull",[SphereHull,SphereHull$,null]),ConvexHull.findEnclosingSphereFast=function(e){for(var t=new SphereHull,i=e.length,r=Vector3d.zero,n=0;n<i;++n)r.add(e[n]);r.multiply(1/i);var s=0;for(n=0;n<i;++n){var a=Vector3d.getLengthSq(Vector3d.subtractVectors(e[n],r));a>s&&(s=a)}return s=Math.sqrt(s),t.center=r,t.radius=s,t},ConvexHull.findEnclosingSphere=function(e){var t,i,r,n,s,a,o,l,h,c,u,d=new Vector3d,_=0,g=e.length,f=new Vector3d,m=new Vector3d,p=new Vector3d,C=new Vector3d,S=new Vector3d,w=new Vector3d,T=new Vector3d,y=new Vector3d;for(f.x=p.y=S.z=1e8,m.x=C.y=w.z=-1e9,t=0;t<g;t++)(b=e[t]).x<f.x&&(f=b),b.x>m.x&&(m=b),b.y<p.y&&(p=b),b.y>C.y&&(C=b),b.z<S.z&&(S=b),b.z>w.z&&(w=b);for(a=(i=m.x-f.x)*i+(r=m.y-f.y)*r+(n=m.z-f.z)*n,T=f,y=m,(o=(i=C.x-p.x)*i+(r=C.y-p.y)*r+(n=C.z-p.z)*n)>(l=a)&&(l=o,T=p,y=C),(i=w.x-S.x)*i+(r=w.y-S.y)*r+(n=w.z-S.z)*n>l&&(T=S,y=w),d.x=(T.x+y.x)/2,d.y=(T.y+y.y)/2,d.z=(T.z+y.z)/2,s=(i=y.x-d.x)*i+(r=y.y-d.y)*r+(n=y.z-d.z)*n,_=Math.sqrt(s),t=0;t<g;t++){var b;(c=(i=(b=e[t]).x-d.x)*i+(r=b.y-d.y)*r+(n=b.z-d.z)*n)>s&&(s=(_=(_+(h=Math.sqrt(c)))/2)*_,u=h-_,d.x=(_*d.x+u*b.x)/h,d.y=(_*d.y+u*b.y)/h,d.z=(_*d.z+u*b.z)/h)}return SphereHull._create(d,_)};var ConvexHull$={};function EOE(){this.a=0,this.e=0,this.i=0,this.w=0,this.omega=0,this.jdEquinox=0,this.t=0,this.n=0,this.meanAnnomolyOut=0,this.a=0,this.e=0,this.i=0,this.w=0,this.omega=0,this.jdEquinox=0,this.t=0}registerType("ConvexHull",[ConvexHull,ConvexHull$,null]),EOE._create=function(e){var t=new EOE;return t.a=e.readSingle(),t.e=e.readSingle(),t.i=e.readSingle(),t.w=e.readSingle(),t.omega=e.readSingle(),t.jdEquinox=e.readSingle(),t.t=e.readSingle(),t};var EOE$={};function EPD(){this.apparentGeocentricLongitude=0,this.apparentGeocentricLatitude=0,this.apparentGeocentricDistance=0,this.apparentLightTime=0,this.apparentGeocentricRA=0,this.apparentGeocentricDeclination=0,this.apparentGeocentricLongitude=0,this.apparentGeocentricLatitude=0,this.apparentGeocentricDistance=0,this.apparentLightTime=0,this.apparentGeocentricRA=0,this.apparentGeocentricDeclination=0}registerType("EOE",[EOE,EOE$,null]);var EPD$={};function EOD(){this.heliocentricRectangularEquatorial=new C3D,this.heliocentricRectangularEcliptical=new C3D,this.heliocentricEclipticLongitude=0,this.heliocentricEclipticLatitude=0,this.trueGeocentricRA=0,this.trueGeocentricDeclination=0,this.trueGeocentricDistance=0,this.trueGeocentricLightTime=0,this.astrometricGeocenticRA=0,this.astrometricGeocentricDeclination=0,this.astrometricGeocentricDistance=0,this.astrometricGeocentricLightTime=0,this.elongation=0,this.phaseAngle=0,this.heliocentricEclipticLongitude=0,this.heliocentricEclipticLatitude=0,this.trueGeocentricRA=0,this.trueGeocentricDeclination=0,this.trueGeocentricDistance=0,this.trueGeocentricLightTime=0,this.astrometricGeocenticRA=0,this.astrometricGeocentricDeclination=0,this.astrometricGeocentricDistance=0,this.astrometricGeocentricLightTime=0,this.elongation=0,this.phaseAngle=0}registerType("EPD",[EPD,EPD$,null]);var EOD$={};registerType("EOD",[EOD,EOD$,null]);var EO={SUN:0,MERCURY:1,VENUS:2,MARS:3,JUPITER:4,SATURN:5,URANUS:6,NEPTUNE:7,PLUTO:8};function ELL(){}registerType("EO",EO),ELL.distanceToLightTime=function(e){return.0057755183*e},ELL.calculate=function(e,t){var i=new EPD,r=e,n=0,s=0,a=0,o=0;t&&(n=CAAEarth.eclipticLongitude(r),s=CAAEarth.eclipticLatitude(r),a=CAAEarth.radiusVector(r),n=CT.d2R(n),s=CT.d2R(s),o=Math.cos(s));for(var l,h,c,u,d,_,g=0,f=0,m=0,p=!0,C=!0,S=0,w=0,T=0;p;){switch(t){case 0:g=CAASun.geometricEclipticLongitude(r),f=CAASun.geometricEclipticLatitude(r),m=CAAEarth.radiusVector(r);break;case 1:g=CAAMercury.eclipticLongitude(r),f=CAAMercury.eclipticLatitude(r),m=CAAMercury.radiusVector(r);break;case 2:g=CAAVenus.eclipticLongitude(r),f=CAAVenus.eclipticLatitude(r),m=CAAVenus.radiusVector(r);break;case 3:g=CAAMars.eclipticLongitude(r),f=CAAMars.eclipticLatitude(r),m=CAAMars.radiusVector(r);break;case 4:g=CAAJupiter.eclipticLongitude(r),f=CAAJupiter.eclipticLatitude(r),m=CAAJupiter.radiusVector(r);break;case 5:g=CAASaturn.eclipticLongitude(r),f=CAASaturn.eclipticLatitude(r),m=CAASaturn.radiusVector(r);break;case 6:g=CAAUranus.eclipticLongitude(r),f=CAAUranus.eclipticLatitude(r),m=CAAUranus.radiusVector(r);break;case 7:g=CAANeptune.eclipticLongitude(r),f=CAANeptune.eclipticLatitude(r),m=CAANeptune.radiusVector(r);break;case 8:g=CAAPluto.eclipticLongitude(r),f=CAAPluto.eclipticLatitude(r),m=CAAPluto.radiusVector(r);break;default:console.assert(!1)}if(C?C=!1:(p=Math.abs(g-S)>1e-5||Math.abs(f-w)>1e-5||Math.abs(m-T)>1e-6,S=g,w=f,T=m),p){var y=0;t?(l=CT.d2R(g),h=CT.d2R(f),u=m*(c=Math.cos(h))*Math.cos(l)-a*o*Math.cos(n),d=m*c*Math.sin(l)-a*o*Math.sin(n),_=m*Math.sin(h)-a*Math.sin(s),y=Math.sqrt(u*u+d*d+_*_)):y=m,r=e-ELL.distanceToLightTime(y)}}l=CT.d2R(g),h=CT.d2R(f),u=m*(c=Math.cos(h))*Math.cos(l)-a*o*Math.cos(n),d=m*c*Math.sin(l)-a*o*Math.sin(n),_=m*Math.sin(h)-a*Math.sin(s);var b=u*u,v=d*d;i.apparentGeocentricLatitude=CT.r2D(Math.atan2(_,Math.sqrt(b+v))),i.apparentGeocentricDistance=Math.sqrt(b+v+_*_),i.apparentGeocentricLongitude=CT.m360(CT.r2D(Math.atan2(d,u))),i.apparentLightTime=ELL.distanceToLightTime(i.apparentGeocentricDistance);var M=ABR.eclipticAberration(i.apparentGeocentricLongitude,i.apparentGeocentricLatitude,e);i.apparentGeocentricLongitude+=M.x,i.apparentGeocentricLatitude+=M.y;var x=CAAFK5.correctionInLongitude(i.apparentGeocentricLongitude,i.apparentGeocentricLatitude,e);i.apparentGeocentricLatitude+=CAAFK5.correctionInLatitude(i.apparentGeocentricLongitude,e),i.apparentGeocentricLongitude+=x;var L=CAANutation.nutationInLongitude(e),A=CAANutation.trueObliquityOfEcliptic(e);i.apparentGeocentricLongitude+=CT.dmS2D(0,0,L);var V=CT.ec2Eq(i.apparentGeocentricLongitude,i.apparentGeocentricLatitude,A);return i.apparentGeocentricRA=V.x,i.apparentGeocentricDeclination=V.y,i},ELL.semiMajorAxisFromPerihelionDistance=function(e,t){return e/(1-t)},ELL.meanMotionFromSemiMajorAxis=function(e){return.9856076686/(e*Math.sqrt(e))},ELL.calculateRectangularJD=function(e,t){var i=e,r=CT.d2R(t.omega),n=CT.d2R(t.w),s=CT.d2R(t.i),a=Math.sin(r),o=Math.cos(r),l=Math.cos(s),h=Math.sin(s),c=o,u=1*a,d=0*a,_=-a*l,g=o*l*1-0*h,f=o*l*0+1*h,m=Math.sqrt(c*c+_*_),p=Math.sqrt(u*u+g*g),C=Math.sqrt(d*d+f*f),S=Math.atan2(c,_),w=Math.atan2(u,g),T=Math.atan2(d,f),y=t.n*(i-t.t);t.meanAnnomolyOut=y;var b=CAAKepler.calculate(y,t.e);b=CT.d2R(b);var v=2*Math.atan(Math.sqrt((1+t.e)/(1-t.e))*Math.tan(b/2)),M=t.a*(1-t.e*Math.cos(b)),x=M*m*Math.sin(S+n+v),L=M*p*Math.sin(w+n+v),A=M*C*Math.sin(T+n+v);return Vector3d.create(x,A,L)},ELL.calculateRectangular=function(e,t){var i=CT.d2R(e.omega),r=CT.d2R(e.w),n=CT.d2R(e.i),s=Math.sin(i),a=Math.cos(i),o=Math.cos(n),l=Math.sin(n),h=a,c=1*s,u=0*s,d=-s*o,_=a*o*1-0*l,g=a*o*0+1*l,f=Math.sqrt(h*h+d*d),m=Math.sqrt(c*c+_*_),p=Math.sqrt(u*u+g*g),C=Math.atan2(h,d),S=Math.atan2(c,_),w=Math.atan2(u,g),T=(e.n,t),y=CAAKepler.calculate(T,e.e);y=CT.d2R(y);var b=2*Math.atan(Math.sqrt((1+e.e)/(1-e.e))*Math.tan(y/2)),v=e.a*(1-e.e*Math.cos(y)),M=v*f*Math.sin(C+r+b),x=v*m*Math.sin(S+r+b),L=v*p*Math.sin(w+r+b);return Vector3d.create(M,L,x)},ELL.calculateElements=function(e,t){var i=CAANutation.meanObliquityOfEcliptic(t.jdEquinox),r=e,n=new EOD;i=CT.d2R(i);for(var s=CT.d2R(t.omega),a=CT.d2R(t.w),o=CT.d2R(t.i),l=Math.sin(i),h=Math.cos(i),c=Math.sin(s),u=Math.cos(s),d=Math.cos(o),_=Math.sin(o),g=u,f=c*h,m=c*l,p=-c*d,C=u*d*h-_*l,S=u*d*l+_*h,w=Math.sqrt(g*g+p*p),T=Math.sqrt(f*f+C*C),y=Math.sqrt(m*m+S*S),b=Math.atan2(g,p),v=Math.atan2(f,C),M=Math.atan2(m,S),x=ELL.meanMotionFromSemiMajorAxis(t.a),L=CAASun.equatorialRectangularCoordinatesAnyEquinox(e,t.jdEquinox),A=0;A<2;A++){var V=x*(r-t.t),P=CAAKepler.calculate(V,t.e);P=CT.d2R(P);var E=2*Math.atan(Math.sqrt((1+t.e)/(1-t.e))*Math.tan(P/2)),I=t.a*(1-t.e*Math.cos(P)),R=I*w*Math.sin(b+a+E),D=I*T*Math.sin(v+a+E),k=I*y*Math.sin(M+a+E);if(!A){n.heliocentricRectangularEquatorial.x=R,n.heliocentricRectangularEquatorial.y=D,n.heliocentricRectangularEquatorial.z=k;var F=s+E,B=Math.cos(F),N=Math.sin(F);n.heliocentricRectangularEcliptical.x=I*(u*B-c*N*d),n.heliocentricRectangularEcliptical.y=I*(c*B+u*N*d),n.heliocentricRectangularEcliptical.z=I*_*N,n.heliocentricEclipticLongitude=Math.atan2(D,R),n.heliocentricEclipticLongitude=CT.m24(CT.r2D(n.heliocentricEclipticLongitude)/15),n.heliocentricEclipticLatitude=Math.asin(k/I),n.heliocentricEclipticLatitude=CT.r2D(n.heliocentricEclipticLatitude)}var $=L.x+R,U=L.y+D,O=L.z+k,z=Math.atan2(U,$);z=CT.r2D(z);var G=Math.atan2(O,Math.sqrt($*$+U*U));G=CT.r2D(G);var W=Math.sqrt($*$+U*U+O*O);if(A){n.astrometricGeocenticRA=CT.m24(z/15),n.astrometricGeocentricDeclination=G,n.astrometricGeocentricDistance=W,n.astrometricGeocentricLightTime=ELL.distanceToLightTime(W);var H=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);n.elongation=Math.acos((H*H+W*W-I*I)/(2*H*W)),n.elongation=CT.r2D(n.elongation),n.phaseAngle=Math.acos((I*I+W*W-H*H)/(2*I*W)),n.phaseAngle=CT.r2D(n.phaseAngle)}else n.trueGeocentricRA=CT.m24(z/15),n.trueGeocentricDeclination=G,n.trueGeocentricDistance=W,n.trueGeocentricLightTime=ELL.distanceToLightTime(W);A||(r=e-n.trueGeocentricLightTime)}return n},ELL.instantaneousVelocity=function(e,t){return 42.1219*Math.sqrt(1/e-1/(2*t))},ELL.velocityAtPerihelion=function(e,t){return 29.7847/Math.sqrt(t)*Math.sqrt((1+e)/(1-e))},ELL.velocityAtAphelion=function(e,t){return 29.7847/Math.sqrt(t)*Math.sqrt((1-e)/(1+e))},ELL.lengthOfEllipse=function(e,t){var i=t*Math.sqrt(1-e*e);return CT.PI()*(3*(t+i)-Math.sqrt((t+3*i)*(3*t+i)))},ELL.cometMagnitude=function(e,t,i,r){return e+5*Util.log10(t)+i*Util.log10(r)},ELL.minorPlanetMagnitude=function(e,t,i,r,n){n=CT.d2R(n);var s=Math.exp(-3.33*Math.pow(Math.tan(n/2),.63)),a=Math.exp(-1.87*Math.pow(Math.tan(n/2),1.22));return e+5*Util.log10(r*t)-2.5*Util.log10((1-i)*s+i*a)};var ELL$={};function EOT(){}registerType("ELL",[ELL,ELL$,null]),EOT.calculate=function(e){var t=(e-2451545)/365250,i=t*t,r=i*t,n=r*t,s=n*t,a=CT.m360(280.4664567+360007.6982779*t+.03032028*i+r/49931-n/15300-s/2e6),o=CAASun.apparentEclipticLongitude(e),l=CAASun.apparentEclipticLatitude(e),h=CAANutation.trueObliquityOfEcliptic(e),c=CT.ec2Eq(o,l,h);h=CT.d2R(h);var u=a-.0057183-15*c.x+CT.dmS2D(0,0,CAANutation.nutationInLongitude(e))*Math.cos(h);return u>180&&(u=-(360-u)),4*u};var EOT$={};function GMD(){this.meanLongitude=0,this.trueLongitude=0,this.tropicalLongitude=0,this.equatorialLatitude=0,this.r=0,this.eclipticRectangularCoordinates=new C3D,this.trueRectangularCoordinates=new C3D,this.apparentRectangularCoordinates=new C3D,this.bInTransit=!1,this.bInOccultation=!1,this.bInEclipse=!1,this.bInShadowTransit=!1,this.apparentShadowRectangularCoordinates=new C3D,this.meanLongitude=0,this.trueLongitude=0,this.tropicalLongitude=0,this.equatorialLatitude=0,this.r=0,this.bInTransit=!1,this.bInOccultation=!1,this.bInEclipse=!1,this.bInShadowTransit=!1}registerType("EOT",[EOT,EOT$,null]);var GMD$={};function GMDS(){this.satellite1=new GMD,this.satellite2=new GMD,this.satellite3=new GMD,this.satellite4=new GMD}registerType("GMD",[GMD,GMD$,null]);var GMDS$={};function GM(){}registerType("GMDS",[GMDS,GMDS$,null]),GM.calculate=function(e){for(var t=CAASun.geometricEclipticLongitude(e),i=CT.d2R(t),r=CAASun.geometricEclipticLatitude(e),n=CT.d2R(r),s=CAAEarth.radiusVector(e),a=5,o=0,l=ELL.distanceToLightTime(a),h=e-l,c=!0,u=0,d=0,_=0,g=0,f=0,m=0,p=0,C=0;c;)g=CAAJupiter.eclipticLongitude(h),f=CT.d2R(g),m=CAAJupiter.eclipticLatitude(h),p=CT.d2R(m),u=(C=CAAJupiter.radiusVector(h))*Math.cos(p)*Math.cos(f)+s*Math.cos(i),d=C*Math.cos(p)*Math.sin(f)+s*Math.sin(i),_=C*Math.sin(p)+s*Math.sin(n),a=Math.sqrt(u*u+d*d+_*_),l=ELL.distanceToLightTime(a),(c=Math.abs(l-o)>2e-6)&&(h=e-l,o=l);var S=GM.calculateHelper(e,i,n,s);GM.fillInPhenomenaDetails(S.satellite1),GM.fillInPhenomenaDetails(S.satellite2),GM.fillInPhenomenaDetails(S.satellite3),GM.fillInPhenomenaDetails(S.satellite4),h=e-l,g=CAAJupiter.eclipticLongitude(h),f=CT.d2R(g),m=CAAJupiter.eclipticLatitude(h),p=CT.d2R(m),u=(C=CAAJupiter.radiusVector(h))*Math.cos(p)*Math.cos(f),d=C*Math.cos(p)*Math.sin(f),_=C*Math.sin(p),a=Math.sqrt(u*u+d*d+_*_);var w=ELL.distanceToLightTime(a),T=GM.calculateHelper(e+w-l,i,n,0);return GM.fillInPhenomenaDetails(T.satellite1),GM.fillInPhenomenaDetails(T.satellite2),GM.fillInPhenomenaDetails(T.satellite3),GM.fillInPhenomenaDetails(T.satellite4),S.satellite1.bInEclipse=T.satellite1.bInOccultation,S.satellite2.bInEclipse=T.satellite2.bInOccultation,S.satellite3.bInEclipse=T.satellite3.bInOccultation,S.satellite4.bInEclipse=T.satellite4.bInOccultation,S.satellite1.bInShadowTransit=T.satellite1.bInTransit,S.satellite2.bInShadowTransit=T.satellite2.bInTransit,S.satellite3.bInShadowTransit=T.satellite3.bInTransit,S.satellite4.bInShadowTransit=T.satellite4.bInTransit,S.satellite1.apparentShadowRectangularCoordinates=T.satellite1.apparentRectangularCoordinates,S.satellite2.apparentShadowRectangularCoordinates=T.satellite2.apparentRectangularCoordinates,S.satellite3.apparentShadowRectangularCoordinates=T.satellite3.apparentRectangularCoordinates,S.satellite4.apparentShadowRectangularCoordinates=T.satellite4.apparentRectangularCoordinates,S},GM.calculateHelper=function(e,t,i,r){for(var n=new GMDS,s=5,a=0,o=ELL.distanceToLightTime(s),l=0,h=0,c=0,u=0,d=0,_=0,g=0,f=0,m=e-o,p=!0;p;)u=CAAJupiter.eclipticLongitude(m),d=CT.d2R(u),_=CAAJupiter.eclipticLatitude(m),g=CT.d2R(_),l=(f=CAAJupiter.radiusVector(m))*Math.cos(g)*Math.cos(d)+r*Math.cos(t),h=f*Math.cos(g)*Math.sin(d)+r*Math.sin(t),c=f*Math.sin(g)+r*Math.sin(i),s=Math.sqrt(l*l+h*h+c*c),o=ELL.distanceToLightTime(s),(p=Math.abs(o-a)>2e-6)&&(m=e-o,a=o);var C=Math.atan2(h,l),S=Math.atan(c/Math.sqrt(l*l+h*h)),w=e-2443000.5-o,T=106.07719+203.48895579*w,y=CT.d2R(T),b=175.73161+101.374724735*w,v=CT.d2R(b),M=120.55883+50.317609207*w,x=CT.d2R(M),L=84.44459+21.571071177*w,A=CT.d2R(L),V=CT.d2R(CT.m360(97.0881+.16138586*w)),P=CT.d2R(CT.m360(154.8663+.04726307*w)),E=CT.d2R(CT.m360(188.184+.00712734*w)),I=CT.d2R(CT.m360(335.2868+.00184*w)),R=312.3346-.13279386*w,D=CT.d2R(R),k=100.4411-.03263064*w,F=CT.d2R(k),B=119.1942-.00717703*w,N=CT.d2R(B),$=322.6186-.00175934*w,U=CT.d2R($),O=.33033*Math.sin(CT.d2R(163.679+.0010512*w))+.03439*Math.sin(CT.d2R(34.486-.0161731*w)),z=CT.d2R(199.6766+.1737919*w),G=CT.d2R(316.5182-208e-8*w),W=CT.d2R(30.23756+.0830925701*w+O),H=CT.d2R(31.97853+.0334597339*w),X=CT.d2R(13.469942),j=.47259*Math.sin(2*(y-v))+-.03478*Math.sin(E-I)+.01081*Math.sin(v-2*x+E)+.00738*Math.sin(z)+.00713*Math.sin(v-2*x+P)+-.00674*Math.sin(V+E-2*X-2*W)+.00666*Math.sin(v-2*x+I)+.00445*Math.sin(y-E)+-.00354*Math.sin(y-v)+-.00317*Math.sin(2*G-2*X)+.00265*Math.sin(y-I)+-.00186*Math.sin(W)+.00162*Math.sin(P-E)+.00158*Math.sin(4*(y-v))+-.00155*Math.sin(y-x)+-.00138*Math.sin(G+N-2*X-2*W)+-.00115*Math.sin(2*(y-2*v+F))+89e-5*Math.sin(P-I)+85e-5*Math.sin(y+E-2*X-2*W)+83e-5*Math.sin(F-N)+53e-5*Math.sin(G-F),Y=1.06476*Math.sin(2*(v-x))+.04256*Math.sin(y-2*v+E)+.03581*Math.sin(v-E)+.02395*Math.sin(y-2*v+I)+.01984*Math.sin(v-I)+-.01778*Math.sin(z)+.01654*Math.sin(v-P)+.01334*Math.sin(v-2*x+P)+.01294*Math.sin(E-I)+-.01142*Math.sin(v-x)+-.01057*Math.sin(W)+-.00775*Math.sin(2*(G-X))+.00524*Math.sin(2*(y-v))+-.0046*Math.sin(y-x)+.00316*Math.sin(G-2*W+N-2*X)+-.00203*Math.sin(V+E-2*X-2*W)+.00146*Math.sin(G-N)+-.00145*Math.sin(2*W)+.00125*Math.sin(G-U)+-.00115*Math.sin(y-2*x+E)+-94e-5*Math.sin(2*(v-F))+86e-5*Math.sin(2*(y-2*v+F))+-86e-5*Math.sin(5*H-2*W+CT.d2R(52.225))+-78e-5*Math.sin(v-A)+-64e-5*Math.sin(3*x-7*A+4*I)+64e-5*Math.sin(V-I)+-63e-5*Math.sin(y-2*x+I)+58e-5*Math.sin(N-U)+56e-5*Math.sin(2*(G-X-W))+56e-5*Math.sin(2*(v-A))+55e-5*Math.sin(2*(y-x))+52e-5*Math.sin(3*x-7*A+E+3*I)+-43e-5*Math.sin(y-E)+41e-5*Math.sin(5*(v-x))+41e-5*Math.sin(I-X)+32e-5*Math.sin(F-N)+32e-5*Math.sin(2*(x-W-X)),q=.1649*Math.sin(x-E)+.09081*Math.sin(x-I)+-.06907*Math.sin(v-x)+.03784*Math.sin(E-I)+.01846*Math.sin(2*(x-A))+-.0134*Math.sin(W)+-.01014*Math.sin(2*(G-X))+.00704*Math.sin(v-2*x+E)+-.0062*Math.sin(v-2*x+P)+-.00541*Math.sin(x-A)+.00381*Math.sin(v-2*x+I)+.00235*Math.sin(G-N)+.00198*Math.sin(G-U)+.00176*Math.sin(z)+.0013*Math.sin(3*(x-A))+.00125*Math.sin(y-x)+-.00119*Math.sin(5*H-2*W+CT.d2R(52.225))+.00109*Math.sin(y-v)+-.001*Math.sin(3*x-7*A+4*I)+91e-5*Math.sin(N-U)+8e-4*Math.sin(3*x-7*A+E+3*I)+-75e-5*Math.sin(2*v-3*x+E)+72e-5*Math.sin(V+E-2*X-2*W)+69e-5*Math.sin(I-X)+-58e-5*Math.sin(2*x-3*A+I)+-57e-5*Math.sin(x-2*A+I)+56e-5*Math.sin(x+E-2*X-2*W)+-52e-5*Math.sin(v-2*x+V)+-5e-4*Math.sin(P-E)+48e-5*Math.sin(x-2*A+E)+-45e-5*Math.sin(2*v-3*x+I)+-41e-5*Math.sin(P-I)+-38e-5*Math.sin(2*W)+-37e-5*Math.sin(E-I+N-U)+-32e-5*Math.sin(3*x-7*A+2*E+2*I)+3e-4*Math.sin(4*(x-A))+29e-5*Math.sin(x+I-2*X-2*W)+-28e-5*Math.sin(N+G-2*X-2*W)+26e-5*Math.sin(x-X-W)+24e-5*Math.sin(v-3*x+2*A)+21e-5*Math.sin(x-X-W)+-21e-5*Math.sin(x-P)+17e-5*Math.sin(2*(x-E)),K=.84287*Math.sin(A-I)+.03431*Math.sin(I-E)+-.03305*Math.sin(2*(G-X))+-.03211*Math.sin(W)+-.01862*Math.sin(A-E)+.01186*Math.sin(G-U)+.00623*Math.sin(A+I-2*W-2*X)+.00387*Math.sin(2*(A-I))+-.00284*Math.sin(5*H-2*W+CT.d2R(52.225))+-.00234*Math.sin(2*(G-I))+-.00223*Math.sin(x-A)+-.00208*Math.sin(A-X)+.00178*Math.sin(G+U-2*I)+.00134*Math.sin(I-X)+.00125*Math.sin(2*(A-W-X))+-.00117*Math.sin(2*W)+-.00112*Math.sin(2*(x-A))+.00107*Math.sin(3*x-7*A+4*I)+.00102*Math.sin(A-W-X)+96e-5*Math.sin(2*A-G-U)+87e-5*Math.sin(2*(G-U))+-85e-5*Math.sin(3*x-7*A+E+3*I)+85e-5*Math.sin(x-2*A+I)+-81e-5*Math.sin(2*(A-G))+71e-5*Math.sin(A+I-2*X-3*W)+61e-5*Math.sin(y-A)+-56e-5*Math.sin(G-N)+-54e-5*Math.sin(x-2*A+E)+51e-5*Math.sin(v-A)+42e-5*Math.sin(2*(G-W-X))+39e-5*Math.sin(2*(I-U))+36e-5*Math.sin(G+X-I-U)+35e-5*Math.sin(2*H-W+CT.d2R(188.37))+-35e-5*Math.sin(A-I+2*X-2*G)+-32e-5*Math.sin(A+I-2*X-W)+3e-4*Math.sin(2*H-2*W+CT.d2R(149.15))+29e-5*Math.sin(3*x-7*A+2*E+2*I)+28e-5*Math.sin(A-I+2*G-2*X)+-28e-5*Math.sin(2*(A-U))+-27e-5*Math.sin(E-I+N-U)+-26e-5*Math.sin(5*H-3*W+CT.d2R(188.37))+25e-5*Math.sin(U-N)+-25e-5*Math.sin(v-3*x+2*A)+-23e-5*Math.sin(3*(x-A))+21e-5*Math.sin(2*A-2*X-3*W)+-21e-5*Math.sin(2*x-3*A+I)+19e-5*Math.sin(A-I-W)+-19e-5*Math.sin(2*A-E-I)+-18e-5*Math.sin(A-I+W)+-16e-5*Math.sin(A+E-2*X-2*W);n.satellite1.meanLongitude=CT.m360(T),n.satellite1.trueLongitude=CT.m360(T+j);var J=CT.d2R(n.satellite1.trueLongitude);n.satellite2.meanLongitude=CT.m360(b),n.satellite2.trueLongitude=CT.m360(b+Y);var Z=CT.d2R(n.satellite2.trueLongitude);n.satellite3.meanLongitude=CT.m360(M),n.satellite3.trueLongitude=CT.m360(M+q);var Q=CT.d2R(n.satellite3.trueLongitude);n.satellite4.meanLongitude=CT.m360(L),n.satellite4.trueLongitude=CT.m360(L+K);var ee=CT.d2R(n.satellite4.trueLongitude),te=Math.atan(6393e-7*Math.sin(J-D)+1825e-7*Math.sin(J-F)+329e-7*Math.sin(J-N)+-311e-7*Math.sin(J-G)+93e-7*Math.sin(J-U)+75e-7*Math.sin(3*J-4*v-1.9927*j+F)+46e-7*Math.sin(J+G-2*X-2*W));n.satellite1.equatorialLatitude=CT.r2D(te);var ie=Math.atan(.0081004*Math.sin(Z-F)+4512e-7*Math.sin(Z-N)+-3284e-7*Math.sin(Z-G)+116e-6*Math.sin(Z-U)+272e-7*Math.sin(y-2*x+1.0146*Y+F)+-144e-7*Math.sin(Z-D)+143e-7*Math.sin(Z+G-2*X-2*W)+35e-7*Math.sin(Z-G+W)+-28e-7*Math.sin(y-2*x+1.0146*Y+N));n.satellite2.equatorialLatitude=CT.r2D(ie);var re=Math.atan(.0032402*Math.sin(Q-N)+-.0016911*Math.sin(Q-G)+6847e-7*Math.sin(Q-U)+-2797e-7*Math.sin(Q-F)+321e-7*Math.sin(Q+G-2*X-2*W)+51e-7*Math.sin(Q-G+W)+-45e-7*Math.sin(Q-G-W)+-45e-7*Math.sin(Q+G-2*X)+37e-7*Math.sin(Q+G-2*X-3*W)+3e-6*Math.sin(2*v-3*Q+4.03*q+F)+-21e-7*Math.sin(2*v-3*Q+4.03*q+N));n.satellite3.equatorialLatitude=CT.r2D(re);var ne=Math.atan(-.0076579*Math.sin(ee-G)+.0044134*Math.sin(ee-U)+-5112e-7*Math.sin(ee-N)+773e-7*Math.sin(ee+G-2*X-2*W)+104e-7*Math.sin(ee-G+W)+-102e-7*Math.sin(ee-G-W)+88e-7*Math.sin(ee+G-2*X-3*W)+-38e-7*Math.sin(ee+G-2*X-W));n.satellite4.equatorialLatitude=CT.r2D(ne),n.satellite1.r=5.90569*(-.0041339*Math.cos(2*(y-v))+-387e-7*Math.cos(y-E)+-214e-7*Math.cos(y-I)+17e-6*Math.cos(y-v)+-131e-7*Math.cos(4*(y-v))+106e-7*Math.cos(y-x)+-66e-7*Math.cos(y+E-2*X-2*W)+1),n.satellite2.r=9.39657*(.0093848*Math.cos(y-v)+-3116e-7*Math.cos(v-E)+-1744e-7*Math.cos(v-I)+-1442e-7*Math.cos(v-P)+553e-7*Math.cos(v-x)+523e-7*Math.cos(y-x)+-29e-6*Math.cos(2*(y-v))+164e-7*Math.cos(2*(v-F))+107e-7*Math.cos(y-2*x+E)+-102e-7*Math.cos(v-V)+-91e-7*Math.cos(2*(y-x))+1),n.satellite3.r=14.98832*(-.0014388*Math.cos(x-E)+-7919e-7*Math.cos(x-I)+6342e-7*Math.cos(v-x)+-1761e-7*Math.cos(2*(x-A))+294e-7*Math.cos(x-A)+-156e-7*Math.cos(3*(x-A))+156e-7*Math.cos(y-x)+-153e-7*Math.cos(y-v)+7e-6*Math.cos(2*v-3*x+E)+-51e-7*Math.cos(x+E-2*X-2*W)+1),n.satellite4.r=26.36273*(-.0073546*Math.cos(A-I)+1621e-7*Math.cos(A-E)+974e-7*Math.cos(x-A)+-543e-7*Math.cos(A+I-2*X-2*W)+-271e-7*Math.cos(2*(A-I))+182e-7*Math.cos(A-X)+177e-7*Math.cos(2*(x-A))+-167e-7*Math.cos(2*A-G-U)+167e-7*Math.cos(G-U)+-155e-7*Math.cos(2*(A-X-W))+142e-7*Math.cos(2*(A-G))+105e-7*Math.cos(y-A)+92e-7*Math.cos(v-A)+-89e-7*Math.cos(A-X-W)+-62e-7*Math.cos(A+I-2*X-3*W)+48e-7*Math.cos(2*(A-U))+1);var se=(e-2433282.423)/36525,ae=CT.d2R(1.3966626*se+3088e-7*se*se);J+=ae,n.satellite1.tropicalLongitude=CT.m360(CT.r2D(J)),Z+=ae,n.satellite2.tropicalLongitude=CT.m360(CT.r2D(Z)),Q+=ae,n.satellite3.tropicalLongitude=CT.m360(CT.r2D(Q)),ee+=ae,n.satellite4.tropicalLongitude=CT.m360(CT.r2D(ee)),G+=ae;var oe=3.120262+(e-2415020.5)/36525*6e-4,le=CT.d2R(oe),he=n.satellite1.r*Math.cos(J-G)*Math.cos(te),ce=n.satellite2.r*Math.cos(Z-G)*Math.cos(ie),ue=n.satellite3.r*Math.cos(Q-G)*Math.cos(re),de=n.satellite4.r*Math.cos(ee-G)*Math.cos(ne),_e=n.satellite1.r*Math.sin(J-G)*Math.cos(te),ge=n.satellite2.r*Math.sin(Z-G)*Math.cos(ie),fe=n.satellite3.r*Math.sin(Q-G)*Math.cos(re),me=n.satellite4.r*Math.sin(ee-G)*Math.cos(ne),pe=n.satellite1.r*Math.sin(te),Ce=n.satellite2.r*Math.sin(ie),Se=n.satellite3.r*Math.sin(re),we=n.satellite4.r*Math.sin(ne),Te=CT.d2R(EPO.jupiterLongitudeAscendingNode(e)),ye=CT.d2R(EPO.jupiterInclination(e)),be=0,ve=0,Me=0,xe=new C3D,Le=GM.rotations(0,0,1,le,G,ye,Te,C,S,xe);be=Le[0],ve=Le[1],Me=Le[2];var Ae=Math.atan2(be,Me);be=(Le=GM.rotations(he,_e,pe,le,G,ye,Te,C,S,n.satellite1.eclipticRectangularCoordinates))[0],ve=Le[1],Me=Le[2],n.satellite1.trueRectangularCoordinates.x=be*Math.cos(Ae)-Me*Math.sin(Ae),n.satellite1.trueRectangularCoordinates.y=be*Math.sin(Ae)+Me*Math.cos(Ae),n.satellite1.trueRectangularCoordinates.z=ve,be=(Le=GM.rotations(ce,ge,Ce,le,G,ye,Te,C,S,n.satellite2.eclipticRectangularCoordinates))[0],ve=Le[1],Me=Le[2],n.satellite2.trueRectangularCoordinates.x=be*Math.cos(Ae)-Me*Math.sin(Ae),n.satellite2.trueRectangularCoordinates.y=be*Math.sin(Ae)+Me*Math.cos(Ae),n.satellite2.trueRectangularCoordinates.z=ve,be=(Le=GM.rotations(ue,fe,Se,le,G,ye,Te,C,S,n.satellite3.eclipticRectangularCoordinates))[0],ve=Le[1],Me=Le[2],n.satellite3.trueRectangularCoordinates.x=be*Math.cos(Ae)-Me*Math.sin(Ae),n.satellite3.trueRectangularCoordinates.y=be*Math.sin(Ae)+Me*Math.cos(Ae),n.satellite3.trueRectangularCoordinates.z=ve,be=(Le=GM.rotations(de,me,we,le,G,ye,Te,C,S,n.satellite4.eclipticRectangularCoordinates))[0],ve=Le[1],Me=Le[2],n.satellite4.trueRectangularCoordinates.x=be*Math.cos(Ae)-Me*Math.sin(Ae),n.satellite4.trueRectangularCoordinates.y=be*Math.sin(Ae)+Me*Math.cos(Ae),n.satellite4.trueRectangularCoordinates.z=ve,n.satellite1.apparentRectangularCoordinates.x=n.satellite1.trueRectangularCoordinates.x+Math.abs(n.satellite1.trueRectangularCoordinates.z)/17295*Math.sqrt(1-n.satellite1.trueRectangularCoordinates.x/n.satellite1.r*(n.satellite1.trueRectangularCoordinates.x/n.satellite1.r)),n.satellite1.apparentRectangularCoordinates.y=n.satellite1.trueRectangularCoordinates.y,n.satellite1.apparentRectangularCoordinates.z=n.satellite1.trueRectangularCoordinates.z,n.satellite2.apparentRectangularCoordinates.x=n.satellite2.trueRectangularCoordinates.x+Math.abs(n.satellite2.trueRectangularCoordinates.z)/21819*Math.sqrt(1-n.satellite2.trueRectangularCoordinates.x/n.satellite2.r*(n.satellite2.trueRectangularCoordinates.x/n.satellite2.r)),n.satellite2.apparentRectangularCoordinates.y=n.satellite2.trueRectangularCoordinates.y,n.satellite2.apparentRectangularCoordinates.z=n.satellite2.trueRectangularCoordinates.z,n.satellite3.apparentRectangularCoordinates.x=n.satellite3.trueRectangularCoordinates.x+Math.abs(n.satellite3.trueRectangularCoordinates.z)/27558*Math.sqrt(1-n.satellite3.trueRectangularCoordinates.x/n.satellite3.r*(n.satellite3.trueRectangularCoordinates.x/n.satellite3.r)),n.satellite3.apparentRectangularCoordinates.y=n.satellite3.trueRectangularCoordinates.y,n.satellite3.apparentRectangularCoordinates.z=n.satellite3.trueRectangularCoordinates.z,n.satellite4.apparentRectangularCoordinates.x=n.satellite4.trueRectangularCoordinates.x+Math.abs(n.satellite4.trueRectangularCoordinates.z)/36548*Math.sqrt(1-n.satellite4.trueRectangularCoordinates.x/n.satellite4.r*(n.satellite4.trueRectangularCoordinates.x/n.satellite4.r)),n.satellite4.apparentRectangularCoordinates.y=n.satellite4.trueRectangularCoordinates.y,n.satellite4.apparentRectangularCoordinates.z=n.satellite4.trueRectangularCoordinates.z;var Ve=s/(s+n.satellite1.trueRectangularCoordinates.z/2095);return n.satellite1.apparentRectangularCoordinates.x*=Ve,n.satellite1.apparentRectangularCoordinates.y*=Ve,Ve=s/(s+n.satellite2.trueRectangularCoordinates.z/2095),n.satellite2.apparentRectangularCoordinates.x*=Ve,n.satellite2.apparentRectangularCoordinates.y*=Ve,Ve=s/(s+n.satellite3.trueRectangularCoordinates.z/2095),n.satellite3.apparentRectangularCoordinates.x*=Ve,n.satellite3.apparentRectangularCoordinates.y*=Ve,Ve=s/(s+n.satellite4.trueRectangularCoordinates.z/2095),n.satellite4.apparentRectangularCoordinates.x*=Ve,n.satellite4.apparentRectangularCoordinates.y*=Ve,n},GM.rotations=function(e,t,i,r,n,s,a,o,l,h){var c=n-a,u=e,d=t*Math.cos(r)-i*Math.sin(r),_=t*Math.sin(r)+i*Math.cos(r),g=u*Math.cos(c)-d*Math.sin(c),f=u*Math.sin(c)+d*Math.cos(c),m=_,p=g,C=f*Math.cos(s)-m*Math.sin(s),S=f*Math.sin(s)+m*Math.cos(s),w=p*Math.cos(a)-C*Math.sin(a),T=p*Math.sin(a)+C*Math.cos(a),y=S,b=1/2095;h.x=w*b,h.y=T*b,h.z=y*b;var v=w*Math.sin(o)-T*Math.cos(o),M=w*Math.cos(o)+T*Math.sin(o),x=y;return[v,x*Math.sin(l)+M*Math.cos(l),x*Math.cos(l)-M*Math.sin(l)]},GM.fillInPhenomenaDetails=function(e){var t=1.071374*e.apparentRectangularCoordinates.y;t*t+e.apparentRectangularCoordinates.x*e.apparentRectangularCoordinates.x<1?e.apparentRectangularCoordinates.z<0?(e.bInTransit=!0,e.bInOccultation=!1):(e.bInTransit=!1,e.bInOccultation=!0):(e.bInTransit=!1,e.bInOccultation=!1)};var GM$={};function CAAGlobe(){}registerType("GM",[GM,GM$,null]),CAAGlobe.rhoSinThetaPrime=function(e,t){e=CT.d2R(e);var i=Math.atan(.99664719*Math.tan(e));return.99664719*Math.sin(i)+t/6378149*Math.sin(e)},CAAGlobe.rhoCosThetaPrime=function(e,t){e=CT.d2R(e);var i=Math.atan(.99664719*Math.tan(e));return Math.cos(i)+t/6378149*Math.cos(e)},CAAGlobe.radiusOfParallelOfLatitude=function(e){e=CT.d2R(e);var t=Math.sin(e);return 6378.14*Math.cos(e)/Math.sqrt(1-.0066943847614084*t*t)},CAAGlobe.radiusOfCurvature=function(e){e=CT.d2R(e);var t=Math.sin(e);return 6335.4422767778715/Math.pow(1-.0066943847614084*t*t,1.5)},CAAGlobe.distanceBetweenPoints=function(e,t,i,r){var n=((e=CT.d2R(e))+(i=CT.d2R(i)))/2,s=(e-i)/2,a=((t=CT.d2R(t))-(r=CT.d2R(r)))/2,o=Math.sin(s),l=Math.cos(s),h=Math.cos(n),c=Math.sin(n),u=Math.sin(a),d=Math.cos(a),_=o*o*d*d+h*h*u*u,g=l*l*d*d+c*c*u*u,f=Math.atan(Math.sqrt(_/g)),m=Math.sqrt(_*g)/f,p=.00335281317789691;return 2*f*6378.14*(1+p*((3*m-1)/(2*g))*c*c*l*l-p*((3*m+1)/(2*_))*h*h*o*o)};var CAAGlobe$={};function IFR(){}registerType("CAAGlobe",[CAAGlobe,CAAGlobe$,null]),IFR.phaseAngle=function(e,t,i){return CT.m360(CT.r2D(Math.acos((e*e+i*i-t*t)/(2*e*i))))},IFR.phaseAngle2=function(e,t,i,r,n,s){return i=CT.d2R(i),r=CT.d2R(r),n=CT.d2R(n),CT.m360(CT.r2D(Math.acos((e-t*Math.cos(i)*Math.cos(r-n))/s)))},IFR.phaseAngleRectangular=function(e,t,i,r,n,s){r=CT.d2R(r),n=CT.d2R(n);var a=Math.cos(r);return CT.m360(CT.r2D(Math.acos((e*a*Math.cos(n)+t*a*Math.sin(n)+i*Math.sin(r))/s)))},IFR.illuminatedFraction=function(e){return e=CT.d2R(e),(1+Math.cos(e))/2},IFR.illuminatedFraction2=function(e,t,i){return((e+i)*(e+i)-t*t)/(4*e*i)},IFR.mercuryMagnitudeMuller=function(e,t,i){var r=i-50;return 1.16+5*Util.log10(e*t)+.02838*r+1023e-7*r*r},IFR.venusMagnitudeMuller=function(e,t,i){return 5*Util.log10(e*t)-4+.01322*i+4.247e-7*i*i*i},IFR.marsMagnitudeMuller=function(e,t,i){return 5*Util.log10(e*t)-1.3+.01486*i},IFR.jupiterMagnitudeMuller=function(e,t){return 5*Util.log10(e*t)-8.93},IFR.saturnMagnitudeMuller=function(e,t,i,r){r=CT.d2R(r);var n=Math.sin(r);return 5*Util.log10(e*t)-8.68+.044*Math.abs(i)-2.6*Math.sin(Math.abs(r))+1.25*n*n},IFR.uranusMagnitudeMuller=function(e,t){return 5*Util.log10(e*t)-6.85},IFR.neptuneMagnitudeMuller=function(e,t){return 5*Util.log10(e*t)-7.05},IFR.mercuryMagnitudeAA=function(e,t,i){var r=i*i,n=r*i;return 5*Util.log10(e*t)-.42+.038*i-273e-6*r+2e-6*n},IFR.venusMagnitudeAA=function(e,t,i){var r=i*i,n=r*i;return 5*Util.log10(e*t)-4.4+9e-4*i+239e-6*r-65e-8*n},IFR.marsMagnitudeAA=function(e,t,i){return 5*Util.log10(e*t)-1.52+.016*i},IFR.jupiterMagnitudeAA=function(e,t,i){return 5*Util.log10(e*t)-9.4+.005*i},IFR.saturnMagnitudeAA=function(e,t,i,r){r=CT.d2R(r);var n=Math.sin(r);return 5*Util.log10(e*t)-8.88+.044*Math.abs(i)-2.6*Math.sin(Math.abs(r))+1.25*n*n},IFR.uranusMagnitudeAA=function(e,t){return 5*Util.log10(e*t)-7.19},IFR.neptuneMagnitudeAA=function(e,t){return 5*Util.log10(e*t)-6.87},IFR.plutoMagnitudeAA=function(e,t){return 5*Util.log10(e*t)-1};var IFR$={};function INTP(){}registerType("IFR",[IFR,IFR$,null]),INTP.interpolate=function(e,t,i,r){return i+e/2*(i-t+(r-i)+e*(t+r-2*i))},INTP.interpolate2=function(e,t,i,r,n,s){var a=r-i,o=n-r,l=o-a,h=l-(a-(i-t)),c=s-n-o-l,u=c-h,d=e*e,_=d*e;return r+e*((a+o)/2-(h+c)/12)+d*(l/2-u/24)+_*((h+c)/12)+_*e*(u/24)},INTP.interpolateToHalves=function(e,t,i,r){return(9*(t+i)-e-r)/16},INTP.lagrangeInterpolate=function(e,t,i,r){for(var n=0,s=1;s<=t;s++){for(var a=1,o=1;o<=t;o++)o!==s&&(a=a*(e-i[o-1])/(i[s-1]-i[o-1]));n+=a*r[s-1]}return n},INTP.zero=function(e,t,i){for(var r=t-e,n=i-t,s=e+i-2*t,a=!0,o=0,l=o;a;)l=-2*t/(r+n+s*o),(a=Math.abs(l-o)>1e-12)&&(o=l);return l},INTP.zeroB=function(e,t,i,r,n){for(var s=i-t,a=r-i,o=a-s,l=o-(s-(t-e)),h=n-r-a-o,c=h-l,u=!0,d=0,_=d;u;){var g=d*d,f=g*d;_=(-24*i+g*(c-12*o)-2*f*(l+h)-f*d*c)/(2*(6*s+6*a-l-h)),(u=Math.abs(_-d)>1e-12)&&(d=_)}return _},INTP.zero2=function(e,t,i){for(var r=t-e,n=i-t,s=e+i-2*t,a=!0,o=0,l=o;a;){var h=-(2*t+o*(r+n+s*o))/(r+n+2*s*o);l=o+h,(a=Math.abs(h)>1e-12)&&(o=l)}return l},INTP.zero2B=function(e,t,i,r,n){for(var s=i-t,a=r-i,o=a-s,l=o-(s-(t-e)),h=n-r-a-o,c=(h-l)/24,u=(l+h)/12,d=o/2-c,_=(s+a)/2-u,g=!0,f=0,m=f;g;){var p=f*f,C=p*f,S=-(c*(C*f)+u*C+d*p+_*f+i)/(4*c*C+3*u*p+2*d*f+_);m=f+S,(g=Math.abs(S)>1e-12)&&(f=m)}return m};var INTP$={};function MoonCoefficient1(e,t,i,r){this.d=0,this.m=0,this.mdash=0,this.f=0,this.d=e,this.m=t,this.mdash=i,this.f=r}registerType("INTP",[INTP,INTP$,null]);var MoonCoefficient1$={};function MoonCoefficient2(e,t){this.a=0,this.b=0,this.a=e,this.b=t}registerType("MoonCoefficient1",[MoonCoefficient1,MoonCoefficient1$,null]);var MoonCoefficient2$={};registerType("MoonCoefficient2",[MoonCoefficient2,MoonCoefficient2$,null]);const g_MoonCoefficients1=[new MoonCoefficient1(0,0,1,0),new MoonCoefficient1(2,0,-1,0),new MoonCoefficient1(2,0,0,0),new MoonCoefficient1(0,0,2,0),new MoonCoefficient1(0,1,0,0),new MoonCoefficient1(0,0,0,2),new MoonCoefficient1(2,0,-2,0),new MoonCoefficient1(2,-1,-1,0),new MoonCoefficient1(2,0,1,0),new MoonCoefficient1(2,-1,0,0),new MoonCoefficient1(0,1,-1,0),new MoonCoefficient1(1,0,0,0),new MoonCoefficient1(0,1,1,0),new MoonCoefficient1(2,0,0,-2),new MoonCoefficient1(0,0,1,2),new MoonCoefficient1(0,0,1,-2),new MoonCoefficient1(4,0,-1,0),new MoonCoefficient1(0,0,3,0),new MoonCoefficient1(4,0,-2,0),new MoonCoefficient1(2,1,-1,0),new MoonCoefficient1(2,1,0,0),new MoonCoefficient1(1,0,-1,0),new MoonCoefficient1(1,1,0,0),new MoonCoefficient1(2,-1,1,0),new MoonCoefficient1(2,0,2,0),new MoonCoefficient1(4,0,0,0),new MoonCoefficient1(2,0,-3,0),new MoonCoefficient1(0,1,-2,0),new MoonCoefficient1(2,0,-1,2),new MoonCoefficient1(2,-1,-2,0),new MoonCoefficient1(1,0,1,0),new MoonCoefficient1(2,-2,0,0),new MoonCoefficient1(0,1,2,0),new MoonCoefficient1(0,2,0,0),new MoonCoefficient1(2,-2,-1,0),new MoonCoefficient1(2,0,1,-2),new MoonCoefficient1(2,0,0,2),new MoonCoefficient1(4,-1,-1,0),new MoonCoefficient1(0,0,2,2),new MoonCoefficient1(3,0,-1,0),new MoonCoefficient1(2,1,1,0),new MoonCoefficient1(4,-1,-2,0),new MoonCoefficient1(0,2,-1,0),new MoonCoefficient1(2,2,-1,0),new MoonCoefficient1(2,1,-2,0),new MoonCoefficient1(2,-1,0,-2),new MoonCoefficient1(4,0,1,0),new MoonCoefficient1(0,0,4,0),new MoonCoefficient1(4,-1,0,0),new MoonCoefficient1(1,0,-2,0),new MoonCoefficient1(2,1,0,-2),new MoonCoefficient1(0,0,2,-2),new MoonCoefficient1(1,1,1,0),new MoonCoefficient1(3,0,-2,0),new MoonCoefficient1(4,0,-3,0),new MoonCoefficient1(2,-1,2,0),new MoonCoefficient1(0,2,1,0),new MoonCoefficient1(1,1,-1,0),new MoonCoefficient1(2,0,3,0),new MoonCoefficient1(2,0,-1,-2)],g_MoonCoefficients2=[new MoonCoefficient2(6288774,-20905355),new MoonCoefficient2(1274027,-3699111),new MoonCoefficient2(658314,-2955968),new MoonCoefficient2(213618,-569925),new MoonCoefficient2(-185116,48888),new MoonCoefficient2(-114332,-3149),new MoonCoefficient2(58793,246158),new MoonCoefficient2(57066,-152138),new MoonCoefficient2(53322,-170733),new MoonCoefficient2(45758,-204586),new MoonCoefficient2(-40923,-129620),new MoonCoefficient2(-34720,108743),new MoonCoefficient2(-30383,104755),new MoonCoefficient2(15327,10321),new MoonCoefficient2(-12528,0),new MoonCoefficient2(10980,79661),new MoonCoefficient2(10675,-34782),new MoonCoefficient2(10034,-23210),new MoonCoefficient2(8548,-21636),new MoonCoefficient2(-7888,24208),new MoonCoefficient2(-6766,30824),new MoonCoefficient2(-5163,-8379),new MoonCoefficient2(4987,-16675),new MoonCoefficient2(4036,-12831),new MoonCoefficient2(3994,-10445),new MoonCoefficient2(3861,-11650),new MoonCoefficient2(3665,14403),new MoonCoefficient2(-2689,-7003),new MoonCoefficient2(-2602,0),new MoonCoefficient2(2390,10056),new MoonCoefficient2(-2348,6322),new MoonCoefficient2(2236,-9884),new MoonCoefficient2(-2120,5751),new MoonCoefficient2(-2069,0),new MoonCoefficient2(2048,-4950),new MoonCoefficient2(-1773,4130),new MoonCoefficient2(-1595,0),new MoonCoefficient2(1215,-3958),new MoonCoefficient2(-1110,0),new MoonCoefficient2(-892,3258),new MoonCoefficient2(-810,2616),new MoonCoefficient2(759,-1897),new MoonCoefficient2(-713,-2117),new MoonCoefficient2(-700,2354),new MoonCoefficient2(691,0),new MoonCoefficient2(596,0),new MoonCoefficient2(549,-1423),new MoonCoefficient2(537,-1117),new MoonCoefficient2(520,-1571),new MoonCoefficient2(-487,-1739),new MoonCoefficient2(-399,0),new MoonCoefficient2(-381,-4421),new MoonCoefficient2(351,0),new MoonCoefficient2(-340,0),new MoonCoefficient2(330,0),new MoonCoefficient2(327,0),new MoonCoefficient2(-323,1165),new MoonCoefficient2(299,0),new MoonCoefficient2(294,0),new MoonCoefficient2(0,8752)],g_MoonCoefficients3=[new MoonCoefficient1(0,0,0,1),new MoonCoefficient1(0,0,1,1),new MoonCoefficient1(0,0,1,-1),new MoonCoefficient1(2,0,0,-1),new MoonCoefficient1(2,0,-1,1),new MoonCoefficient1(2,0,-1,-1),new MoonCoefficient1(2,0,0,1),new MoonCoefficient1(0,0,2,1),new MoonCoefficient1(2,0,1,-1),new MoonCoefficient1(0,0,2,-1),new MoonCoefficient1(2,-1,0,-1),new MoonCoefficient1(2,0,-2,-1),new MoonCoefficient1(2,0,1,1),new MoonCoefficient1(2,1,0,-1),new MoonCoefficient1(2,-1,-1,1),new MoonCoefficient1(2,-1,0,1),new MoonCoefficient1(2,-1,-1,-1),new MoonCoefficient1(0,1,-1,-1),new MoonCoefficient1(4,0,-1,-1),new MoonCoefficient1(0,1,0,1),new MoonCoefficient1(0,0,0,3),new MoonCoefficient1(0,1,-1,1),new MoonCoefficient1(1,0,0,1),new MoonCoefficient1(0,1,1,1),new MoonCoefficient1(0,1,1,-1),new MoonCoefficient1(0,1,0,-1),new MoonCoefficient1(1,0,0,-1),new MoonCoefficient1(0,0,3,1),new MoonCoefficient1(4,0,0,-1),new MoonCoefficient1(4,0,-1,1),new MoonCoefficient1(0,0,1,-3),new MoonCoefficient1(4,0,-2,1),new MoonCoefficient1(2,0,0,-3),new MoonCoefficient1(2,0,2,-1),new MoonCoefficient1(2,-1,1,-1),new MoonCoefficient1(2,0,-2,1),new MoonCoefficient1(0,0,3,-1),new MoonCoefficient1(2,0,2,1),new MoonCoefficient1(2,0,-3,-1),new MoonCoefficient1(2,1,-1,1),new MoonCoefficient1(2,1,0,1),new MoonCoefficient1(4,0,0,1),new MoonCoefficient1(2,-1,1,1),new MoonCoefficient1(2,-2,0,-1),new MoonCoefficient1(0,0,1,3),new MoonCoefficient1(2,1,1,-1),new MoonCoefficient1(1,1,0,-1),new MoonCoefficient1(1,1,0,1),new MoonCoefficient1(0,1,-2,-1),new MoonCoefficient1(2,1,-1,-1),new MoonCoefficient1(1,0,1,1),new MoonCoefficient1(2,-1,-2,-1),new MoonCoefficient1(0,1,2,1),new MoonCoefficient1(4,0,-2,-1),new MoonCoefficient1(4,-1,-1,-1),new MoonCoefficient1(1,0,1,-1),new MoonCoefficient1(4,0,1,-1),new MoonCoefficient1(1,0,-1,-1),new MoonCoefficient1(4,-1,0,-1),new MoonCoefficient1(2,-2,0,1)],g_MoonCoefficients4=[5128122,280602,277693,173237,55413,46271,32573,17198,9266,8822,8216,4324,4200,-3359,2463,2211,2065,-1870,1828,-1794,-1749,-1565,-1491,-1475,-1410,-1344,-1335,1107,1021,833,777,671,607,596,491,-451,439,422,421,-366,-351,331,315,302,-283,-229,223,223,-220,-220,-185,181,-177,176,166,-164,132,-119,115,107];function CAAMoon(){}CAAMoon.meanLongitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(218.3164477+481267.88123421*t-.0015786*i+r/538841-n/65194e3)},CAAMoon.meanElongation=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(297.8501921+445267.1114034*t-.0018819*i+r/545868-n/113065e3)},CAAMoon.meanAnomaly=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(134.9633964+477198.8675055*t+.0087414*i+r/69699-n/14712e3)},CAAMoon.argumentOfLatitude=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(93.272095+483202.0175233*t-.0036539*i-r/3526e3+n/86331e4)},CAAMoon.meanLongitudeAscendingNode=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(125.0445479-1934.1362891*t+.0020754*i+r/467441-n/60616e3)},CAAMoon.meanLongitudePerigee=function(e){var t=(e-2451545)/36525,i=t*t,r=i*t,n=r*t;return CT.m360(83.3532465+4069.0137287*t-.01032*i-r/80053+n/18999e3)},CAAMoon.trueLongitudeAscendingNode=function(e){var t=CAAMoon.meanLongitudeAscendingNode(e),i=CAAMoon.meanElongation(e);i=CT.d2R(i);var r=CAAEarth.sunMeanAnomaly(e);r=CT.d2R(r);var n=CAAMoon.meanAnomaly(e);n=CT.d2R(n);var s=CAAMoon.argumentOfLatitude(e);return s=CT.d2R(s),t-=1.4979*Math.sin(2*(i-s)),t-=.15*Math.sin(r),t-=.1226*Math.sin(2*i),t+=.1176*Math.sin(2*s),t-=.0801*Math.sin(2*(n-s)),CT.m360(t)},CAAMoon.eclipticLongitude=function(e){var t=CAAMoon.meanLongitude(e),i=t;t=CT.d2R(t);var r=CAAMoon.meanElongation(e);r=CT.d2R(r);var n=CAAEarth.sunMeanAnomaly(e);n=CT.d2R(n);var s=CAAMoon.meanAnomaly(e);s=CT.d2R(s);var a=CAAMoon.argumentOfLatitude(e);a=CT.d2R(a);var o=CAAEarth.eccentricity(e),l=(e-2451545)/36525,h=CT.m360(119.75+131.849*l);h=CT.d2R(h);var c=CT.m360(53.09+479264.29*l);c=CT.d2R(c);var u=CT.m360(313.45+481266.484*l);u=CT.d2R(u);var d=g_MoonCoefficients1.length;console.assert(g_MoonCoefficients2.length===d);for(var _=0,g=0;g<d;g++){var f=g_MoonCoefficients2[g].a*Math.sin(g_MoonCoefficients1[g].d*r+g_MoonCoefficients1[g].m*n+g_MoonCoefficients1[g].mdash*s+g_MoonCoefficients1[g].f*a);g_MoonCoefficients1[g].m&&(f*=o),_+=f}_+=3958*Math.sin(h),_+=1962*Math.sin(t-a),_+=318*Math.sin(c);var m=CAANutation.nutationInLongitude(e);return CT.m360(i+_/1e6+m/3600)},CAAMoon.eclipticLatitude=function(e){var t=CAAMoon.meanLongitude(e);t=CT.d2R(t);var i=CAAMoon.meanElongation(e);i=CT.d2R(i);var r=CAAEarth.sunMeanAnomaly(e);r=CT.d2R(r);var n=CAAMoon.meanAnomaly(e);n=CT.d2R(n);var s=CAAMoon.argumentOfLatitude(e);s=CT.d2R(s);var a=CAAEarth.eccentricity(e),o=(e-2451545)/36525,l=CT.m360(119.75+131.849*o);l=CT.d2R(l);var h=CT.m360(53.09+479264.29*o);h=CT.d2R(h);var c=CT.m360(313.45+481266.484*o);c=CT.d2R(c);var u=g_MoonCoefficients3.length;console.assert(g_MoonCoefficients4.length===u);for(var d=0,_=0;_<u;_++){var g=g_MoonCoefficients4[_]*Math.sin(g_MoonCoefficients3[_].d*i+g_MoonCoefficients3[_].m*r+g_MoonCoefficients3[_].mdash*n+g_MoonCoefficients3[_].f*s);g_MoonCoefficients3[_].m&&(g*=a),d+=g}return d-=2235*Math.sin(t),d+=382*Math.sin(c),d+=175*Math.sin(l-s),d+=175*Math.sin(l+s),d+=127*Math.sin(t-n),(d-=115*Math.sin(t+n))/1e6},CAAMoon.radiusVector=function(e){var t=CAAMoon.meanLongitude(e);t=CT.d2R(t);var i=CAAMoon.meanElongation(e);i=CT.d2R(i);var r=CAAEarth.sunMeanAnomaly(e);r=CT.d2R(r);var n=CAAMoon.meanAnomaly(e);n=CT.d2R(n);var s=CAAMoon.argumentOfLatitude(e);s=CT.d2R(s);var a=CAAEarth.eccentricity(e),o=(e-2451545)/36525,l=CT.m360(119.75+131.849*o);l=CT.d2R(l);var h=CT.m360(53.09+479264.29*o);h=CT.d2R(h);var c=CT.m360(313.45+481266.484*o);c=CT.d2R(c);var u=g_MoonCoefficients1.length;console.assert(g_MoonCoefficients2.length===u);for(var d=0,_=0;_<u;_++){var g=g_MoonCoefficients2[_].b*Math.cos(g_MoonCoefficients1[_].d*i+g_MoonCoefficients1[_].m*r+g_MoonCoefficients1[_].mdash*n+g_MoonCoefficients1[_].f*s);g_MoonCoefficients1[_].m&&(g*=a),d+=g}return 385000.56+d/1e3},CAAMoon.radiusVectorToHorizontalParallax=function(e){return CT.r2D(Math.asin(6378.14/e))},CAAMoon.horizontalParallaxToRadiusVector=function(e){return 6378.14/Math.sin(CT.d2R(e))};var CAAMoon$={};function MIFR(){}registerType("CAAMoon",[CAAMoon,CAAMoon$,null]),MIFR.geocentricElongation=function(e,t,i,r){return e=CT.d2R(15*e),i=CT.d2R(15*i),t=CT.d2R(t),r=CT.d2R(r),CT.r2D(Math.acos(Math.sin(r)*Math.sin(t)+Math.cos(r)*Math.cos(t)*Math.cos(i-e)))},MIFR.phaseAngle=function(e,t,i){return e=CT.d2R(e),CT.m360(CT.r2D(Math.atan2(i*Math.sin(e),t-i*Math.cos(e))))},MIFR.illuminatedFraction=function(e){return e=CT.d2R(e),(1+Math.cos(e))/2},MIFR.positionAngle=function(e,t,i,r){return e=CT.h2R(e),i=CT.h2R(i),t=CT.d2R(t),r=CT.d2R(r),CT.m360(CT.r2D(Math.atan2(Math.cos(t)*Math.sin(e-i),Math.sin(t)*Math.cos(r)-Math.cos(t)*Math.sin(r)*Math.cos(e-i))))};var MIFR$={};function CAAMoonNodes(){}registerType("MIFR",[MIFR,MIFR$,null]),CAAMoonNodes.k=function(e){return 13.4223*(e-2000.05)},CAAMoonNodes.passageThroNode=function(e){var t=e/1342.23,i=t*t,r=i*t,n=r*t,s=CT.m360(183.638+331.73735682*e+.0014852*i+209e-8*r-1e-8*n),a=CT.m360(17.4006+26.8203725*e+1186e-7*i+6e-8*r),o=CT.m360(38.3776+355.52747313*e+.0123499*i+14627e-9*r-69e-9*n),l=CT.m360(123.9767-1.44098956*e+.0020608*i+214e-8*r-16e-9*n),h=CT.m360(299.75+132.85*t-.009173*i),c=CT.m360(l+272.75-2.3*t),u=1-.002516*t-74e-7*i,d=2*(s=CT.d2R(s)),_=d*d;a=CT.d2R(a);var g=2*(o=CT.d2R(o));return l=CT.d2R(l),h=CT.d2R(h),c=CT.d2R(c),2451565.1619+27.212220817*e+2762e-7*i+21e-9*r-88e-12*n-.4721*Math.sin(o)-.1649*Math.sin(d)-.0868*Math.sin(d-o)+.0084*Math.sin(d+o)-.0083*u*Math.sin(d-a)-.0039*u*Math.sin(d-a-o)+.0034*Math.sin(g)-.0031*Math.sin(d-g)+.003*u*Math.sin(d+a)+.0028*u*Math.sin(a-o)+.0026*u*Math.sin(a)+.0025*Math.sin(_)+.0024*Math.sin(s)+.0022*u*Math.sin(a+o)+.0017*Math.sin(l)+.0014*Math.sin(_-o)+5e-4*u*Math.sin(d+a-o)+4e-4*u*Math.sin(d-a+o)-3e-4*u*Math.sin(d-a*a)+3e-4*u*Math.sin(_-a)+3e-4*Math.sin(h)+3e-4*Math.sin(c)};var CAAMoonNodes$={};function MPAC(e,t,i,r,n){this.d=0,this.m=0,this.f=0,this.c=0,this.t=0,this.d=e,this.m=t,this.f=i,this.c=r,this.t=n}registerType("CAAMoonNodes",[CAAMoonNodes,CAAMoonNodes$,null]);var MPAC$={};registerType("MPAC",[MPAC,MPAC$,null]);const g_MoonPerigeeApogeeCoefficients1=[new MPAC(2,0,0,-1.6769,0),new MPAC(4,0,0,.4589,0),new MPAC(6,0,0,-.1856,0),new MPAC(8,0,0,.0883,0),new MPAC(2,-1,0,-.0773,19e-5),new MPAC(0,1,0,.0502,-13e-5),new MPAC(10,0,0,-.046,0),new MPAC(4,-1,0,.0422,-11e-5),new MPAC(6,-1,0,-.0256,0),new MPAC(12,0,0,.0253,0),new MPAC(1,0,0,.0237,0),new MPAC(8,-1,0,.0162,0),new MPAC(14,0,0,-.0145,0),new MPAC(0,0,2,.0129,0),new MPAC(3,0,0,-.0112,0),new MPAC(10,-1,0,-.0104,0),new MPAC(16,0,0,.0086,0),new MPAC(12,-1,0,.0069,0),new MPAC(5,0,0,.0066,0),new MPAC(2,0,2,-.0053,0),new MPAC(18,0,0,-.0052,0),new MPAC(14,-1,0,-.0046,0),new MPAC(7,0,0,-.0041,0),new MPAC(2,1,0,.004,0),new MPAC(20,0,0,.0032,0),new MPAC(1,1,0,-.0032,0),new MPAC(16,-1,0,.0031,0),new MPAC(4,1,0,-.0029,0),new MPAC(9,0,0,.0027,0),new MPAC(4,0,2,.0027,0),new MPAC(2,-2,0,-.0027,0),new MPAC(4,-2,0,.0024,0),new MPAC(6,-2,0,-.0021,0),new MPAC(22,0,0,-.0021,0),new MPAC(18,-1,0,-.0021,0),new MPAC(6,1,0,.0019,0),new MPAC(11,0,0,-.0018,0),new MPAC(8,1,0,-.0014,0),new MPAC(4,0,-2,-.0014,0),new MPAC(6,0,2,-.0014,0),new MPAC(3,1,0,.0014,0),new MPAC(5,1,0,-.0014,0),new MPAC(13,0,0,.0013,0),new MPAC(20,-1,0,.0013,0),new MPAC(3,2,0,.0011,0),new MPAC(4,-2,2,-.0011,0),new MPAC(1,2,0,-.0011,0),new MPAC(22,-1,0,-9e-4,0),new MPAC(0,0,4,-8e-4,0),new MPAC(6,0,-2,8e-4,0),new MPAC(2,1,-2,8e-4,0),new MPAC(0,2,0,7e-4,0),new MPAC(0,-1,2,7e-4,0),new MPAC(2,0,4,7e-4,0),new MPAC(0,-2,2,-6e-4,0),new MPAC(2,2,-2,-6e-4,0),new MPAC(24,0,0,6e-4,0),new MPAC(4,0,-4,5e-4,0),new MPAC(2,2,0,5e-4,0),new MPAC(1,-1,0,-4e-4,0)],g_MoonPerigeeApogeeCoefficients2=[new MPAC(2,0,0,.4392,0),new MPAC(4,0,0,.0684,0),new MPAC(0,1,0,.0456,-11e-5),new MPAC(2,-1,0,.0426,-11e-5),new MPAC(0,0,2,.0212,0),new MPAC(1,0,0,-.0189,0),new MPAC(6,0,0,.0144,0),new MPAC(4,-1,0,.0113,0),new MPAC(2,0,2,.0047,0),new MPAC(1,1,0,.0036,0),new MPAC(8,0,0,.0035,0),new MPAC(6,-1,0,.0034,0),new MPAC(2,0,-2,-.0034,0),new MPAC(2,-2,0,.0022,0),new MPAC(3,0,0,-.0017,0),new MPAC(4,0,2,.0013,0),new MPAC(8,-1,0,.0011,0),new MPAC(4,-2,0,.001,0),new MPAC(10,0,0,9e-4,0),new MPAC(3,1,0,7e-4,0),new MPAC(0,2,0,6e-4,0),new MPAC(2,1,0,5e-4,0),new MPAC(2,2,0,5e-4,0),new MPAC(6,0,2,4e-4,0),new MPAC(6,-2,0,4e-4,0),new MPAC(10,-1,0,4e-4,0),new MPAC(5,0,0,-4e-4,0),new MPAC(4,0,-2,-4e-4,0),new MPAC(0,1,2,3e-4,0),new MPAC(12,0,0,3e-4,0),new MPAC(2,-1,2,3e-4,0),new MPAC(1,-1,0,-3e-4,0)],g_MoonPerigeeApogeeCoefficients3=[new MPAC(2,0,0,63.224,0),new MPAC(4,0,0,-6.99,0),new MPAC(2,-1,0,2.834,0),new MPAC(2,-1,0,0,-.0071),new MPAC(6,0,0,1.927,0),new MPAC(1,0,0,-1.263,0),new MPAC(8,0,0,-.702,0),new MPAC(0,1,0,.696,0),new MPAC(0,1,0,0,-.0017),new MPAC(0,0,2,-.69,0),new MPAC(4,-1,0,-.629,0),new MPAC(4,-1,0,0,.0016),new MPAC(2,0,-2,-.392,0),new MPAC(10,0,0,.297,0),new MPAC(6,-1,0,.26,0),new MPAC(3,0,0,.201,0),new MPAC(2,1,0,-.161,0),new MPAC(1,1,0,.157,0),new MPAC(12,0,0,-.138,0),new MPAC(8,-1,0,-.127,0),new MPAC(2,0,2,.104,0),new MPAC(2,-2,0,.104,0),new MPAC(5,0,0,-.079,0),new MPAC(14,0,0,.068,0),new MPAC(10,-1,0,.067,0),new MPAC(4,1,0,.054,0),new MPAC(12,-1,0,-.038,0),new MPAC(4,-2,0,-.038,0),new MPAC(7,0,0,.037,0),new MPAC(4,0,2,-.037,0),new MPAC(16,0,0,-.035,0),new MPAC(3,1,0,-.03,0),new MPAC(1,-1,0,.029,0),new MPAC(6,1,0,-.025,0),new MPAC(0,2,0,.023,0),new MPAC(14,-1,0,.023,0),new MPAC(2,2,0,-.023,0),new MPAC(6,-2,0,.022,0),new MPAC(2,-1,-2,-.021,0),new MPAC(9,0,0,-.02,0),new MPAC(18,0,0,.019,0),new MPAC(6,0,2,.017,0),new MPAC(0,-1,2,.014,0),new MPAC(16,-1,0,-.014,0),new MPAC(4,0,-20,.013,0),new MPAC(8,1,0,.012,0),new MPAC(11,0,0,.011,0),new MPAC(5,1,0,.01,0),new MPAC(20,0,0,-.01,0)],g_MoonPerigeeApogeeCoefficients4=[new MPAC(2,0,0,-9.147,0),new MPAC(1,0,0,-.841,0),new MPAC(0,0,2,.697,0),new MPAC(0,1,0,-.656,.0016),new MPAC(4,0,0,.355,0),new MPAC(2,-1,0,.159,0),new MPAC(1,1,0,.127,0),new MPAC(4,-1,0,.065,0),new MPAC(6,0,0,.052,0),new MPAC(2,1,0,.043,0),new MPAC(2,0,2,.031,0),new MPAC(2,0,-2,-.023,0),new MPAC(2,-2,0,.022,0),new MPAC(2,2,0,.019,0),new MPAC(0,2,0,-.016,0),new MPAC(6,-1,0,.014,0),new MPAC(8,0,0,.01,0)];function CAAMoonPerigeeApogee(){}CAAMoonPerigeeApogee.k=function(e){return 13.2555*(e-1999.97)},CAAMoonPerigeeApogee.meanPerigee=function(e){var t=e/1325.55,i=t*t,r=i*t;return 2451534.6698+27.55454989*e-6691e-7*i-1098e-9*r+r*t*5.2e-9},CAAMoonPerigeeApogee.meanApogee=function(e){return CAAMoonPerigeeApogee.meanPerigee(e)},CAAMoonPerigeeApogee.truePerigee=function(e){var t=CAAMoonPerigeeApogee.meanPerigee(e),i=e/1325.55,r=i*i,n=r*i,s=n*i,a=CT.m360(171.9179+335.9106046*e-.0100383*r-1156e-8*n+55e-9*s);a=CT.d2R(a);var o=CT.m360(347.3477+27.1577721*e-813e-6*r-1e-6*n);o=CT.d2R(o);var l=CT.m360(316.6109+364.5287911*e-.0125053*r-148e-7*n);l=CT.d2R(l);for(var h=g_MoonPerigeeApogeeCoefficients1.length,c=0,u=0;u<h;u++)c+=g_MoonPerigeeApogeeCoefficients1[u].c*Math.sin(a*g_MoonPerigeeApogeeCoefficients1[u].d+o*g_MoonPerigeeApogeeCoefficients1[u].m+l*g_MoonPerigeeApogeeCoefficients1[u].f+i*g_MoonPerigeeApogeeCoefficients1[u].t);return t+c},CAAMoonPerigeeApogee.trueApogee=function(e){var t=CAAMoonPerigeeApogee.meanApogee(e),i=e/1325.55,r=i*i,n=r*i,s=n*i,a=CT.m360(171.9179+335.9106046*e-.0100383*r-1156e-8*n+55e-9*s);a=CT.d2R(a);var o=CT.m360(347.3477+27.1577721*e-813e-6*r-1e-6*n);o=CT.d2R(o);var l=CT.m360(316.6109+364.5287911*e-.0125053*r-148e-7*n);l=CT.d2R(l);for(var h=g_MoonPerigeeApogeeCoefficients2.length,c=0,u=0;u<h;u++)c+=(g_MoonPerigeeApogeeCoefficients2[u].c+i*g_MoonPerigeeApogeeCoefficients2[u].t)*Math.sin(a*g_MoonPerigeeApogeeCoefficients2[u].d+o*g_MoonPerigeeApogeeCoefficients2[u].m+l*g_MoonPerigeeApogeeCoefficients2[u].f);return t+c},CAAMoonPerigeeApogee.perigeeParallax=function(e){var t=e/1325.55,i=t*t,r=i*t,n=r*t,s=CT.m360(171.9179+335.9106046*e-.0100383*i-1156e-8*r+55e-9*n);s=CT.d2R(s);var a=CT.m360(347.3477+27.1577721*e-813e-6*i-1e-6*r);a=CT.d2R(a);var o=CT.m360(316.6109+364.5287911*e-.0125053*i-148e-7*r);o=CT.d2R(o);for(var l=g_MoonPerigeeApogeeCoefficients3.length,h=3629.215,c=0;c<l;c++)h+=(g_MoonPerigeeApogeeCoefficients3[c].c+t*g_MoonPerigeeApogeeCoefficients3[c].t)*Math.cos(s*g_MoonPerigeeApogeeCoefficients3[c].d+a*g_MoonPerigeeApogeeCoefficients3[c].m+o*g_MoonPerigeeApogeeCoefficients3[c].f);return h/3600},CAAMoonPerigeeApogee.apogeeParallax=function(e){var t=e/1325.55,i=t*t,r=i*t,n=r*t,s=CT.m360(171.9179+335.9106046*e-.0100383*i-1156e-8*r+55e-9*n);s=CT.d2R(s);var a=CT.m360(347.3477+27.1577721*e-813e-6*i-1e-6*r);a=CT.d2R(a);var o=CT.m360(316.6109+364.5287911*e-.0125053*i-148e-7*r);o=CT.d2R(o);for(var l=g_MoonPerigeeApogeeCoefficients4.length,h=3245.251,c=0;c<l;c++)h+=(g_MoonPerigeeApogeeCoefficients4[c].c+t*g_MoonPerigeeApogeeCoefficients4[c].t)*Math.cos(s*g_MoonPerigeeApogeeCoefficients4[c].d+a*g_MoonPerigeeApogeeCoefficients4[c].m+o*g_MoonPerigeeApogeeCoefficients4[c].f);return h/3600};var CAAMoonPerigeeApogee$={};function CAAMoonPhases(){}registerType("CAAMoonPerigeeApogee",[CAAMoonPerigeeApogee,CAAMoonPerigeeApogee$,null]),CAAMoonPhases.k=function(e){return 12.3685*(e-2e3)},CAAMoonPhases.meanPhase=function(e){var t=e/1236.85,i=t*t,r=i*t;return 2451550.09766+29.530588861*e+15437e-8*i-15e-8*r+r*t*7.3e-10},CAAMoonPhases.truePhase=function(e){var t=CAAMoonPhases.meanPhase(e),i=e/1236.85,r=i*i,n=r*i,s=n*i,a=1-.002516*i-74e-7*r,o=a*a,l=CT.m360(2.5534+29.1053567*e-14e-7*r-11e-8*n);l=CT.d2R(l);var h=CT.m360(201.5643+385.81693528*e+.0107582*r+1238e-8*n-58e-9*s);h=CT.d2R(h);var c=CT.m360(160.7108+390.67050284*e-.0016118*r-227e-8*n+1e-8*s);c=CT.d2R(c);var u=CT.m360(124.7746-1.56375588*e+.0020672*r+215e-8*n);u=CT.d2R(u);var d=CT.m360(299.77+.107408*e-.009173*r);d=CT.d2R(d);var _=CT.m360(251.88+.016321*e);_=CT.d2R(_);var g=CT.m360(251.83+26.651886*e);g=CT.d2R(g);var f=CT.m360(349.42+36.412478*e);f=CT.d2R(f);var m=CT.m360(84.66+18.206239*e);m=CT.d2R(m);var p=CT.m360(141.74+53.303771*e);p=CT.d2R(p);var C=CT.m360(207.14+2.453732*e);C=CT.d2R(C);var S=CT.m360(154.84+7.30686*e);S=CT.d2R(S);var w=CT.m360(34.52+27.261239*e);w=CT.d2R(w);var T=CT.m360(207.19+.121824*e);T=CT.d2R(T);var y=CT.m360(291.34+1.844379*e);y=CT.d2R(y);var b=CT.m360(161.72+24.198154*e);b=CT.d2R(b);var v=CT.m360(239.56+25.513099*e);v=CT.d2R(v);var M=CT.m360(331.55+3.592518*e);M=CT.d2R(M);var x=e-Math.floor(e);if(x<0&&(x=1+x),x)if(.25===x||.75===x){t+=-.62801*Math.sin(h)+.17172*a*Math.sin(l)+-.01183*a*Math.sin(h+l)+.00862*Math.sin(2*h)+.00804*Math.sin(2*c)+.00454*a*Math.sin(h-l)+.00204*o*Math.sin(2*l)+-.0018*Math.sin(h-2*c)+-7e-4*Math.sin(h+2*c)+-4e-4*Math.sin(3*h)+-34e-5*a*Math.sin(2*h-l)+32e-5*a*Math.sin(l+2*c)+32e-5*a*Math.sin(l-2*c)+-28e-5*o*Math.sin(h+2*l)+27e-5*a*Math.sin(2*h+l)+-17e-5*Math.sin(u)+-5e-5*Math.sin(h-l-2*c)+4e-5*Math.sin(2*h+2*c)+-4e-5*Math.sin(h+l+2*c)+4e-5*Math.sin(h-2*l)+3e-5*Math.sin(h+l-2*c)+3e-5*Math.sin(3*l)+2e-5*Math.sin(2*h-2*c)+2e-5*Math.sin(h-l+2*c)+-2e-5*Math.sin(3*h+l);var L=.00306-38e-5*a*Math.cos(l)+26e-5*Math.cos(h)-2e-5*Math.cos(h-l)+2e-5*Math.cos(h+l)+2e-5*Math.cos(2*c);.25===x?t+=L:t-=L}else.5===x?t+=-.40614*Math.sin(h)+.17302*a*Math.sin(l)+.01614*Math.sin(2*h)+.01043*Math.sin(2*c)+.00734*a*Math.sin(h-l)+-.00514*a*Math.sin(h+l)+.00209*o*Math.sin(2*l)+-.00111*Math.sin(h-2*c)+-57e-5*Math.sin(h+2*c)+56e-5*a*Math.sin(2*h+l)+-42e-5*Math.sin(3*h)+42e-5*a*Math.sin(l+2*c)+38e-5*a*Math.sin(l-2*c)+-24e-5*a*Math.sin(2*h-l)+-17e-5*Math.sin(u)+-7e-5*Math.sin(h+2*l)+4e-5*Math.sin(2*h-2*c)+4e-5*Math.sin(3*l)+3e-5*Math.sin(h+l-2*c)+3e-5*Math.sin(2*h+2*c)+-3e-5*Math.sin(h+l+2*c)+3e-5*Math.sin(h-l+2*c)+-2e-5*Math.sin(h-l-2*c)+-2e-5*Math.sin(3*h+l)+2e-5*Math.sin(4*h):console.assert(!1);else t+=-.4072*Math.sin(h)+.17241*a*Math.sin(l)+.01608*Math.sin(2*h)+.01039*Math.sin(2*c)+.00739*a*Math.sin(h-l)+-.00514*a*Math.sin(h+l)+.00208*o*Math.sin(2*l)+-.00111*Math.sin(h-2*c)+-57e-5*Math.sin(h+2*c)+56e-5*a*Math.sin(2*h+l)+-42e-5*Math.sin(3*h)+42e-5*a*Math.sin(l+2*c)+38e-5*a*Math.sin(l-2*c)+-24e-5*a*Math.sin(2*h-l)+-17e-5*Math.sin(u)+-7e-5*Math.sin(h+2*l)+4e-5*Math.sin(2*h-2*c)+4e-5*Math.sin(3*l)+3e-5*Math.sin(h+l-2*c)+3e-5*Math.sin(2*h+2*c)+-3e-5*Math.sin(h+l+2*c)+3e-5*Math.sin(h-l+2*c)+-2e-5*Math.sin(h-l-2*c)+-2e-5*Math.sin(3*h+l)+2e-5*Math.sin(4*h);return t+(325e-6*Math.sin(d)+165e-6*Math.sin(_)+164e-6*Math.sin(g)+126e-6*Math.sin(f)+11e-5*Math.sin(m)+62e-6*Math.sin(p)+6e-5*Math.sin(C)+56e-6*Math.sin(S)+47e-6*Math.sin(w)+42e-6*Math.sin(T)+4e-5*Math.sin(y)+37e-6*Math.sin(b)+35e-6*Math.sin(v)+23e-6*Math.sin(M))};var CAAMoonPhases$={};function CAASidereal(){}registerType("CAAMoonPhases",[CAAMoonPhases,CAAMoonPhases$,null]),CAASidereal.meanGreenwichSiderealTime=function(e){var t=new DT;t.setJD(e,DT.afterPapalReformJD(e));var i=t.get(),r=ss.ss.truncate(i[0]),n=ss.ss.truncate(i[1]),s=ss.ss.truncate(i[2]),a=ss.ss.truncate(i[3]),o=ss.ss.truncate(i[4]),l=i[5];t.set(r,n,s,0,0,0,t.inGregorianCalendar());var h=(t.julian()-2451545)/36525,c=h*h,u=100.46061837+36000.770053608*h+387933e-9*c-c*h/3871e4;return u+=1.00273790935*(15*a+.25*o+.00416666666666667*l),u=CT.d2H(u),CT.m24(u)},CAASidereal.apparentGreenwichSiderealTime=function(e){var t=CAANutation.meanObliquityOfEcliptic(e)+CAANutation.nutationInObliquity(e)/3600,i=CAANutation.nutationInLongitude(e),r=CAASidereal.meanGreenwichSiderealTime(e)+i*Math.cos(CT.d2R(t))/54e3;return CT.m24(r)};var CAASidereal$={};function CAATopocentricEclipticDetails(){this.lambda=0,this.beta=0,this.semidiameter=0,this.lambda=0,this.beta=0,this.semidiameter=0}registerType("CAASidereal",[CAASidereal,CAASidereal$,null]);var CAATopocentricEclipticDetails$={};registerType("CAATopocentricEclipticDetails",[CAATopocentricEclipticDetails,CAATopocentricEclipticDetails$,null]);const g_AAParallax_C1=Math.sin(CT.d2R(CT.dmS2D(0,0,8.794)));function CAAParallax(){}CAAParallax.equatorial2TopocentricDelta=function(e,t,i,r,n,s,a){var o=CAAGlobe.rhoSinThetaPrime(n,s),l=CAAGlobe.rhoCosThetaPrime(n,s),h=CAASidereal.apparentGreenwichSiderealTime(a);t=CT.d2R(t);var c=Math.cos(t),u=Math.asin(g_AAParallax_C1/i),d=CT.h2R(h-r/15-e),_=Math.cos(d),g=Math.sin(d),f=new COR;return f.x=CT.r2H(-u*l*g/c),f.y=CT.r2D(-u*(o*c-l*_*Math.sin(t))),f},CAAParallax.equatorial2Topocentric=function(e,t,i,r,n,s,a){var o=CAAGlobe.rhoSinThetaPrime(n,s),l=CAAGlobe.rhoCosThetaPrime(n,s),h=CAASidereal.apparentGreenwichSiderealTime(a);t=CT.d2R(t);var c=Math.cos(t),u=Math.asin(g_AAParallax_C1/i),d=Math.sin(u),_=CT.h2R(h-r/15-e),g=Math.cos(_),f=Math.sin(_),m=Math.atan2(-l*d*f,c-l*d*g),p=new COR;return p.x=CT.m24(e+CT.r2H(m)),p.y=CT.r2D(Math.atan2((Math.sin(t)-o*d)*Math.cos(m),c-l*d*g)),p},CAAParallax.ecliptic2Topocentric=function(e,t,i,r,n,s,a,o,l){var h=CAAGlobe.rhoSinThetaPrime(a,o),c=CAAGlobe.rhoCosThetaPrime(a,o);e=CT.d2R(e),t=CT.d2R(t),n=CT.d2R(n),s=CT.d2R(s),a=CT.d2R(a),i=CT.d2R(i);var u=Math.sin(n),d=Math.cos(n),_=Math.cos(t),g=Math.sin(t),f=CAASidereal.apparentGreenwichSiderealTime(l);f=CT.h2R(f);var m=Math.sin(f),p=Math.asin(g_AAParallax_C1/r),C=Math.sin(p),S=Math.cos(e)*_-c*C*Math.cos(f),w=new CAATopocentricEclipticDetails;w.lambda=Math.atan2(Math.sin(e)*_-C*(h*u+c*d*m),S);var T=Math.cos(w.lambda);return w.beta=Math.atan(T*(g-C*(h*d-c*u*m))/S),w.semidiameter=Math.asin(T*Math.cos(w.beta)*Math.sin(i)/S),w.semidiameter=CT.r2D(w.semidiameter),w.lambda=CT.m360(CT.r2D(w.lambda)),w.beta=CT.r2D(w.beta),w},CAAParallax.parallaxToDistance=function(e){return g_AAParallax_C1/Math.sin(CT.d2R(e))},CAAParallax.distanceToParallax=function(e){var t=Math.asin(g_AAParallax_C1/e);return CT.r2D(t)};var CAAParallax$={};function CAAPhysicalJupiterDetails(){this.DE=0,this.DS=0,this.geometricw1=0,this.geometricw2=0,this.apparentw1=0,this.apparentw2=0,this.p=0,this.DE=0,this.DS=0,this.geometricw1=0,this.geometricw2=0,this.apparentw1=0,this.apparentw2=0,this.p=0}registerType("CAAParallax",[CAAParallax,CAAParallax$,null]);var CAAPhysicalJupiterDetails$={};function CAAPhysicalJupiter(){}registerType("CAAPhysicalJupiterDetails",[CAAPhysicalJupiterDetails,CAAPhysicalJupiterDetails$,null]),CAAPhysicalJupiter.calculate=function(e){var t=new CAAPhysicalJupiterDetails,i=e-2433282.5,r=i/36525,n=268+.1061*r,s=CT.d2R(n),a=64.5-.0164*r,o=CT.d2R(a),l=CT.m360(17.71+877.90003539*i),h=CT.m360(16.838+870.27003539*i),c=CAAEarth.eclipticLongitude(e),u=CT.d2R(c),d=CAAEarth.eclipticLatitude(e),_=CT.d2R(d),g=CAAEarth.radiusVector(e),f=CAAJupiter.eclipticLongitude(e),m=CT.d2R(f),p=CAAJupiter.eclipticLatitude(e),C=CT.d2R(p),S=CAAJupiter.radiusVector(e),w=S*Math.cos(C)*Math.cos(m)-g*Math.cos(u),T=S*Math.cos(C)*Math.sin(m)-g*Math.sin(u),y=S*Math.sin(C)-g*Math.sin(_),b=Math.sqrt(w*w+T*T+y*y);f-=.01299*b/(S*S),m=CT.d2R(f),w=S*Math.cos(C)*Math.cos(m)-g*Math.cos(u),T=S*Math.cos(C)*Math.sin(m)-g*Math.sin(u),y=S*Math.sin(C)-g*Math.sin(_),b=Math.sqrt(w*w+T*T+y*y);var v=CAANutation.meanObliquityOfEcliptic(e),M=CT.d2R(v),x=Math.atan2(Math.cos(M)*Math.sin(m)-Math.sin(M)*Math.tan(C),Math.cos(m)),L=Math.asin(Math.cos(M)*Math.sin(C)+Math.sin(M)*Math.cos(C)*Math.sin(m));t.DS=CT.r2D(Math.asin(-Math.sin(o)*Math.sin(L)-Math.cos(o)*Math.cos(L)*Math.cos(s-x)));var A=T*Math.cos(M)-y*Math.sin(M),V=T*Math.sin(M)+y*Math.cos(M),P=Math.atan2(A,w),E=CT.r2D(P),I=Math.atan2(V,Math.sqrt(w*w+A*A)),R=CT.r2D(I),D=Math.atan2(Math.sin(o)*Math.cos(I)*Math.cos(s-P)-Math.sin(I)*Math.cos(o),Math.cos(I)*Math.sin(s-P));t.DE=CT.r2D(Math.asin(-Math.sin(o)*Math.sin(I)-Math.cos(o)*Math.cos(I)*Math.cos(s-P))),t.geometricw1=CT.m360(l-CT.r2D(D)-5.07033*b),t.geometricw2=CT.m360(h-CT.r2D(D)-5.02626*b);var k=57.2958*(2*S*b+g*g-S*S-b*b)/(4*S*b);Math.sin(m-u)>0?(t.apparentw1=CT.m360(t.geometricw1+k),t.apparentw2=CT.m360(t.geometricw2+k)):(t.apparentw1=CT.m360(t.geometricw1-k),t.apparentw2=CT.m360(t.geometricw2-k));var F=CAANutation.nutationInLongitude(e),B=CAANutation.nutationInObliquity(e);v+=B/3600,M=CT.d2R(v),E+=.005693*(Math.cos(P)*Math.cos(u)*Math.cos(M)+Math.sin(P)*Math.sin(u))/Math.cos(I),E=CT.m360(E),P=CT.d2R(E),R+=.005693*(Math.cos(u)*Math.cos(M)*(Math.tan(M)*Math.cos(I)-Math.sin(P)*Math.sin(I))+Math.cos(P)*Math.sin(I)*Math.sin(u)),I=CT.d2R(R);var N=CAANutation.nutationInRightAscension(E/15,R,v,F,B),$=E+N/3600,U=CT.d2R($),O=CAANutation.nutationInDeclination(E/15,R,v,F,B),z=R+O/3600,G=CT.d2R(z),W=n+(N=CAANutation.nutationInRightAscension(n/15,a,v,F,B))/3600,H=CT.d2R(W),X=a+(O=CAANutation.nutationInDeclination(n/15,a,v,F,B))/3600,j=CT.d2R(X);return t.p=CT.m360(CT.r2D(Math.atan2(Math.cos(j)*Math.sin(H-U),Math.sin(j)*Math.cos(G)-Math.cos(j)*Math.sin(G)*Math.cos(H-U)))),t};var CAAPhysicalJupiter$={};function CAAPhysicalMarsDetails(){this.DE=0,this.DS=0,this.w=0,this.p=0,this.x=0,this.k=0,this.q=0,this.d=0,this.DE=0,this.DS=0,this.w=0,this.p=0,this.x=0,this.k=0,this.q=0,this.d=0}registerType("CAAPhysicalJupiter",[CAAPhysicalJupiter,CAAPhysicalJupiter$,null]);var CAAPhysicalMarsDetails$={};function CAAPhysicalMars(){}registerType("CAAPhysicalMarsDetails",[CAAPhysicalMarsDetails,CAAPhysicalMarsDetails$,null]),CAAPhysicalMars.calculate=function(e){for(var t=new CAAPhysicalMarsDetails,i=(e-2451545)/36525,r=352.9065+1.1733*i,n=CT.d2R(r),s=63.2818-.00394*i,a=CT.d2R(s),o=CAAEarth.eclipticLongitude(e),l=CT.d2R(o),h=CAAEarth.eclipticLatitude(e),c=CT.d2R(h),u=CAAEarth.radiusVector(e),d=0,_=0,g=0,f=0,m=0,p=!0,C=0,S=0,w=0,T=0,y=0,b=0;p;){var v=e-_;S=CAAMars.eclipticLongitude(v),w=CT.d2R(S),T=CAAMars.eclipticLatitude(v),y=CT.d2R(T),g=(b=CAAMars.radiusVector(v))*Math.cos(y)*Math.cos(w)-u*Math.cos(l),f=b*Math.cos(y)*Math.sin(w)-u*Math.sin(l),m=b*Math.sin(y)-u*Math.sin(c),C=Math.sqrt(g*g+f*f+m*m),_=ELL.distanceToLightTime(C),(p=Math.abs(_-d)>2e-6)&&(d=_)}var M=Math.atan2(f,g),x=CT.r2D(M),L=Math.atan2(m,Math.sqrt(g*g+f*f)),A=CT.r2D(L);t.DE=CT.r2D(Math.asin(-Math.sin(a)*Math.sin(L)-Math.cos(a)*Math.cos(L)*Math.cos(n-M)));var V=49.5581+.7721*i,P=CT.d2R(V),E=S-.00697/b,I=CT.d2R(E),R=T-Math.cos(w-P)/b*225e-6,D=CT.d2R(R);t.DS=CT.r2D(Math.asin(-Math.sin(a)*Math.sin(D)-Math.cos(a)*Math.cos(D)*Math.cos(n-I)));var k=CT.m360(11.504+350.89200025*(e-_-2433282.5)),F=CAANutation.meanObliquityOfEcliptic(e),B=CT.d2R(F),N=CT.ec2Eq(r,s,F),$=CT.h2R(N.x),U=CT.d2R(N.y),O=f*Math.cos(B)-m*Math.sin(B),z=f*Math.sin(B)+m*Math.cos(B),G=Math.atan2(O,g),W=CT.r2H(G),H=Math.atan2(z,Math.sqrt(g*g+O*O)),X=CT.r2D(H),j=Math.atan2(Math.sin(U)*Math.cos(H)*Math.cos($-G)-Math.sin(H)*Math.cos(U),Math.cos(H)*Math.sin($-G));t.w=CT.m360(k-CT.r2D(j));var Y=CAANutation.nutationInLongitude(e),q=CAANutation.nutationInObliquity(e);x+=.005693*Math.cos(l-M)/Math.cos(L),A+=.005693*Math.sin(l-M)*Math.sin(L),r+=Y/3600,n=CT.d2R(r),x+=Y/3600,M=CT.d2R(x),F+=q/3600,B=CT.d2R(B);var K=CT.ec2Eq(r,s,F),J=CT.h2R(K.x),Z=CT.d2R(K.y),Q=CT.ec2Eq(x,A,F),ee=CT.h2R(Q.x),te=CT.d2R(Q.y);t.p=CT.m360(CT.r2D(Math.atan2(Math.cos(Z)*Math.sin(J-ee),Math.sin(Z)*Math.cos(te)-Math.cos(Z)*Math.sin(te)*Math.cos(J-ee))));var ie=CAASun.geometricEclipticLongitude(e),re=CAASun.geometricEclipticLatitude(e),ne=CT.ec2Eq(ie,re,F);return t.x=MIFR.positionAngle(ne.x,ne.y,W,X),t.d=9.36/C,t.k=IFR.illuminatedFraction2(b,u,C),t.q=(1-t.k)*t.d,t};var CAAPhysicalMars$={};function CAAPhysicalSunDetails(){this.p=0,this.b0=0,this.l0=0,this.p=0,this.b0=0,this.l0=0}registerType("CAAPhysicalMars",[CAAPhysicalMars,CAAPhysicalMars$,null]);var CAAPhysicalSunDetails$={};function CAAPhysicalSun(){}registerType("CAAPhysicalSunDetails",[CAAPhysicalSunDetails,CAAPhysicalSunDetails$,null]),CAAPhysicalSun.calculate=function(e){var t=CT.m360(360*(e-2398220)/25.38),i=7.25,r=73.6667+1.3958333*(e-2396758)/36525,n=CAAEarth.eclipticLongitude(e),s=CAAEarth.radiusVector(e),a=n+180-CT.dmS2D(0,0,20.4898/s),o=a+CT.dmS2D(0,0,CAANutation.nutationInLongitude(e)),l=CAANutation.trueObliquityOfEcliptic(e);l=CT.d2R(l),a=CT.d2R(a),o=CT.d2R(o),r=CT.d2R(r),i=CT.d2R(i),t=CT.d2R(t);var h=Math.atan(-Math.cos(a)*Math.tan(l)),c=Math.atan(-Math.cos(a-r)*Math.tan(i)),u=new CAAPhysicalSunDetails;u.p=CT.r2D(h+c),u.b0=CT.r2D(Math.asin(Math.sin(a-r)*Math.sin(i)));var d=Math.atan(Math.tan(a-r)*Math.cos(i));return u.l0=CT.m360(CT.r2D(d-t)),u},CAAPhysicalSun.timeOfStartOfRotation=function(e){var t=2398140.227+27.2752316*e,i=CT.m360(281.96+26.882476*e);return i=CT.d2R(i),t+(.1454*Math.sin(i)-.0085*Math.sin(2*i)-.0141*Math.cos(2*i))};var CAAPhysicalSun$={};function CAAPrecession(){}registerType("CAAPhysicalSun",[CAAPhysicalSun,CAAPhysicalSun$,null]),CAAPrecession.precessEquatorial=function(e,t,i,r){var n=(i-2451545)/36525,s=n*n,a=(r-i)/36525,o=a*a,l=o*a;e=CT.h2R(e),t=CT.d2R(t);var h=(2306.2181+1.39656*n-139e-6*s)*a+(.30188-344e-7*n)*o+.017988*l;h=CT.d2R(CT.dmS2D(0,0,h));var c=(2306.2181+1.39656*n-138e-6*s)*a+(1.09468+66e-6*n)*o+.018203*l;c=CT.d2R(CT.dmS2D(0,0,c));var u=(2004.3109-.8533*n-217e-6*s)*a-(.42665+217e-6*n)*o-.041833*l;u=CT.d2R(CT.dmS2D(0,0,u));var d=Math.cos(t)*Math.sin(e+h),_=Math.cos(u)*Math.cos(t)*Math.cos(e+h)-Math.sin(u)*Math.sin(t),g=Math.sin(u)*Math.cos(t)*Math.cos(e+h)+Math.cos(u)*Math.sin(t),f=new COR;return f.x=CT.r2H(Math.atan2(d,_)+c),f.x<0&&(f.x+=24),f.y=CT.r2D(Math.asin(g)),f},CAAPrecession.precessEquatorialFK4=function(e,t,i,r){var n=(i-2415020.3135)/36524.2199,s=(r-i)/36524.2199,a=s*s,o=a*s;e=CT.h2R(e),t=CT.d2R(t);var l=(2304.25+1.396*n)*s+.302*a+.018*o;l=CT.d2R(CT.dmS2D(0,0,l));var h=.791*a+.001*o;h=CT.d2R(CT.dmS2D(0,0,h)),h+=l;var c=(2004.682-.853*n)*s-.426*a-.042*o;c=CT.d2R(CT.dmS2D(0,0,c));var u=Math.cos(t)*Math.sin(e+l),d=Math.cos(c)*Math.cos(t)*Math.cos(e+l)-Math.sin(c)*Math.sin(t),_=Math.sin(c)*Math.cos(t)*Math.cos(e+l)+Math.cos(c)*Math.sin(t),g=new COR;return g.x=CT.r2H(Math.atan2(u,d)+h),g.x<0&&(g.x+=24),g.y=CT.r2D(Math.asin(_)),g},CAAPrecession.precessEcliptic=function(e,t,i,r){var n=(i-2451545)/36525,s=n*n,a=(r-i)/36525,o=a*a,l=o*a;e=CT.d2R(e),t=CT.d2R(t);var h=(47.0029-.06603*n+598e-6*s)*a+(598e-6*n-.03302)*o+6e-5*l;h=CT.d2R(CT.dmS2D(0,0,h));var c=629554.9824+3289.4789*n+.60622*s-(869.8089+.50491*n)*a+.03536*o;c=CT.d2R(CT.dmS2D(0,0,c));var u=(5029.0966+2.22226*n-42e-6*s)*a+(1.11113-42e-6*n)*o-6e-6*l;u=CT.d2R(CT.dmS2D(0,0,u));var d=Math.cos(h)*Math.cos(t)*Math.sin(c-e)-Math.sin(h)*Math.sin(t),_=Math.cos(t)*Math.cos(c-e),g=Math.cos(h)*Math.sin(t)+Math.sin(h)*Math.cos(t)*Math.sin(c-e),f=new COR;return f.x=CT.r2D(u+c-Math.atan2(d,_)),f.x<0&&(f.x+=360),f.y=CT.r2D(Math.asin(g)),f},CAAPrecession.equatorialPMToEcliptic=function(e,t,i,r,n,s){s=CT.d2R(s),e=CT.h2R(e),t=CT.d2R(t),i=CT.d2R(i);var a=Math.cos(i),o=Math.sin(s),l=new COR;return l.x=(n*o*Math.cos(e)+r*Math.cos(t)*(Math.cos(s)*Math.cos(t)+o*Math.sin(t)*Math.sin(e)))/(a*a),l.y=(n*(Math.cos(s)*Math.cos(t)+o*Math.sin(t)*Math.sin(e))-r*o*Math.cos(e)*Math.cos(t))/a,l},CAAPrecession.adjustPositionUsingUniformProperMotion=function(e,t,i,r,n){var s=new COR;return s.x=t+r*e/3600,s.y=i+n*e/3600,s},CAAPrecession.adjustPositionUsingMotionInSpace=function(e,t,i,r,n,s,a){t/=977792,s/=13751,a/=206265,r=CT.h2R(r),n=CT.d2R(n);var o=e*Math.cos(n)*Math.cos(r),l=e*Math.cos(n)*Math.sin(r),h=e*Math.sin(n),c=o/e*t-h*a*Math.cos(r)-l*s,u=l/e*t-h*a*Math.sin(r)+o*s;o+=i*c,l+=i*u,h+=i*(h/e*t+e*a*Math.cos(n));var d=new COR;return d.x=CT.r2H(Math.atan2(l,o)),d.x<0&&(d.x+=24),d.y=CT.r2D(Math.atan2(h,Math.sqrt(o*o+l*l))),d};var CAAPrecession$={};function CAARiseTransitSetDetails(){this.bValid=!1,this.rise=0,this.transit=0,this.set=0,this.bValid=!1,this.rise=0,this.transit=0,this.set=0}registerType("CAAPrecession",[CAAPrecession,CAAPrecession$,null]);var CAARiseTransitSetDetails$={};function CAARiseTransitSet(){}registerType("CAARiseTransitSetDetails",[CAARiseTransitSetDetails,CAARiseTransitSetDetails$,null]),CAARiseTransitSet.constraintM=function(e){for(;e>1;)e-=1;for(;e<0;)e+=1;return e},CAARiseTransitSet.correctRAValuesForInterpolation=function(e,t,i){return e=CT.m24(e),t=CT.m24(t),i=CT.m24(i),Math.abs(t-e)>12&&(t>e?e+=24:t+=24),Math.abs(i-t)>12&&(i>t?t+=24:i+=24),Math.abs(t-e)>12&&(t>e?e+=24:t+=24),Math.abs(i-t)>12&&(i>t?t+=24:i+=24),[e,t,i]},CAARiseTransitSet.rise=function(e,t,i,r,n,s,a,o,l,h){var c=new CAARiseTransitSetDetails;c.bValid=!1;var u=CAASidereal.apparentGreenwichSiderealTime(e);u*=15;var d=DYT.deltaT(e),_=CT.d2R(n),g=CT.d2R(l),f=CT.d2R(h),m=(Math.sin(f)-Math.sin(g)*Math.sin(_))/(Math.cos(g)*Math.cos(_));if(m>1||m<-1)return c;var p=Math.acos(m);p=CT.r2D(p);var C=(15*r+o-u)/360,S=(C=CAARiseTransitSet.constraintM(C))-p/360,w=C+p/360;S=CAARiseTransitSet.constraintM(S),w=CAARiseTransitSet.constraintM(w),[t,r,s]=CAARiseTransitSet.correctRAValuesForInterpolation(t,r,s);for(var T=0;T<2;T++){var y=u+360.985647*S;y=CT.m360(y);var b=S+d/86400,v=INTP.interpolate(b,t,r,s),M=INTP.interpolate(b,i,n,a),x=y-o-15*v,L=CT.eq2H(x/15,M,l),A=(L.y-h)/(360*Math.cos(CT.d2R(M))*Math.cos(g)*Math.sin(CT.d2R(x)));S+=A,y=u+360.985647*C,b=C+d/86400,x=(y=CT.m360(y))-o-15*(v=INTP.interpolate(b,t,r,s)),(x=CT.m360(x))>180&&(x-=360),C+=A=-x/360,y=u+360.985647*w,y=CT.m360(y),b=w+d/86400,v=INTP.interpolate(b,t,r,s),M=INTP.interpolate(b,i,n,a),x=y-o-15*v,w+=A=((L=CT.eq2H(x/15,M,l)).y-h)/(360*Math.cos(CT.d2R(M))*Math.cos(g)*Math.sin(CT.d2R(x)))}return c.bValid=!0,c.rise=24*S,c.set=24*w,c.transit=24*C,c};var CAARiseTransitSet$={};function CAASaturnRingDetails(){this.b=0,this.bdash=0,this.p=0,this.a=0,this.b=0,this.deltaU=0,this.b=0,this.bdash=0,this.p=0,this.a=0,this.b=0,this.deltaU=0}registerType("CAARiseTransitSet",[CAARiseTransitSet,CAARiseTransitSet$,null]);var CAASaturnRingDetails$={};function CAASaturnRings(){}registerType("CAASaturnRingDetails",[CAASaturnRingDetails,CAASaturnRingDetails$,null]),CAASaturnRings.calculate=function(e){var t=new CAASaturnRingDetails,i=(e-2451545)/36525,r=i*i,n=28.075216-.012998*i+4e-6*r,s=CT.d2R(n),a=169.50847+1.394681*i+412e-6*r,o=CT.d2R(a),l=CAAEarth.eclipticLongitude(e),h=CAAEarth.eclipticLatitude(e);l+=CAAFK5.correctionInLongitude(l,h,e);var c=CT.d2R(l);h+=CAAFK5.correctionInLatitude(l,e);for(var u=CT.d2R(h),d=CAAEarth.radiusVector(e),_=9,g=0,f=ELL.distanceToLightTime(_),m=e-f,p=!0,C=0,S=0,w=0,T=0,y=0,b=0;p;){T=CAASaturn.eclipticLongitude(m),y=CAASaturn.eclipticLatitude(m),T+=CAAFK5.correctionInLongitude(T,y,m),y+=CAAFK5.correctionInLatitude(T,m);var v=CT.d2R(T),M=CT.d2R(y);C=(b=CAASaturn.radiusVector(m))*Math.cos(M)*Math.cos(v)-d*Math.cos(c),S=b*Math.cos(M)*Math.sin(v)-d*Math.sin(c),w=b*Math.sin(M)-d*Math.sin(u),_=Math.sqrt(C*C+S*S+w*w),f=ELL.distanceToLightTime(_),(p=Math.abs(f-g)>2e-6)&&(m=e-f,g=f)}var x=Math.atan2(S,C),L=Math.atan2(w,Math.sqrt(C*C+S*S));t.b=Math.asin(Math.sin(s)*Math.cos(L)*Math.sin(x-o)-Math.cos(s)*Math.sin(L)),t.a=375.35/_,t.b=t.a*Math.sin(Math.abs(t.b)),t.b=CT.r2D(t.b);var A=113.6655+.8771*i,V=CT.d2R(A),P=T-.01759/b,E=CT.d2R(P),I=y-764e-6*Math.cos(E-V)/b,R=CT.d2R(I);t.bdash=CT.r2D(Math.asin(Math.sin(s)*Math.cos(R)*Math.sin(E-o)-Math.cos(s)*Math.sin(R)));var D=Math.atan2(Math.sin(s)*Math.sin(R)+Math.cos(s)*Math.cos(R)*Math.sin(E-o),Math.cos(R)*Math.cos(E-o)),k=Math.atan2(Math.sin(s)*Math.sin(L)+Math.cos(s)*Math.cos(L)*Math.sin(x-o),Math.cos(L)*Math.cos(x-o));t.deltaU=CT.r2D(Math.abs(D-k));var F=CAANutation.trueObliquityOfEcliptic(e),B=CAANutation.nutationInLongitude(e),N=a-90,$=90-n;x+=CT.d2R(.005693*Math.cos(c-x)/Math.cos(L)),L+=CT.d2R(.005693*Math.sin(c-x)*Math.sin(L)),x=CT.r2D(x),x+=B/3600,x=CT.m360(x),N+=B/3600,N=CT.m360(N),L=CT.r2D(L);var U=CT.ec2Eq(x,L,F),O=CT.h2R(U.x),z=CT.d2R(U.y),G=CT.ec2Eq(N,$,F),W=CT.h2R(G.x),H=CT.d2R(G.y);return t.p=CT.r2D(Math.atan2(Math.cos(H)*Math.sin(W-O),Math.sin(H)*Math.cos(z)-Math.cos(H)*Math.sin(z)*Math.cos(W-O))),t};var CAASaturnRings$={};function CAAStellarMagnitudes(){}registerType("CAASaturnRings",[CAASaturnRings,CAASaturnRings$,null]),CAAStellarMagnitudes.combinedMagnitude=function(e,t){var i=.4*(t-e);return t-2.5*Util.log10(Math.pow(10,i)+1)},CAAStellarMagnitudes.combinedMagnitude2=function(e,t){for(var i=0,r=0;r<e;r++)i+=Math.pow(10,-.4*t[r]);return-2.5*Util.log10(i)},CAAStellarMagnitudes.brightnessRatio=function(e,t){var i=.4*(t-e);return Math.pow(10,i)},CAAStellarMagnitudes.magnitudeDifference=function(e){return 2.5*Util.log10(e)};var CAAStellarMagnitudes$={};function BlendState(){this._switchedTime=new Date(1990,0,0,0,0,0,0),this._state=!1,this._targetState=this._state,this._delayTime=1e3}registerType("CAAStellarMagnitudes",[CAAStellarMagnitudes,CAAStellarMagnitudes$,null]),BlendState.create=function(e,t){var i=new BlendState;return i._state=e,i._targetState=e,i._delayTime=t,i};var BlendState$={get_state:function(){return this._targetState!==this._state?(ss.ss.now()-this._switchedTime>this._delayTime&&(this._state=this._targetState),!0):this._state},set_state:function(e){return this._switchedTime=new Date(1990,0,0,0,0,0,0),this._state=e,this._targetState=this._state,e},get_targetState:function(){return this._targetState},set_targetState:function(e){return this._targetState!==e&&(this._switchedTime=ss.ss.now(),this._targetState=e),e},get_opacity:function(){if(this._targetState!==this._state){var e=ss.ss.now()-this._switchedTime;if(!(e>this._delayTime)){var t=e/this._delayTime;return this._targetState?t:1-t}this._state=this._targetState}return this._state?1:0},get_delayTime:function(){return this._delayTime},set_delayTime:function(e){return this._delayTime=e,e}};registerType("BlendState",[BlendState,BlendState$,null]);var freestandingMode=!1;function set_freestandingMode(e){freestandingMode=!!e}var makeNewHipsProperties=null;function set_makeNewHipsProperties(e){makeNewHipsProperties=e}var makeNewFolder=null;function set_makeNewFolder(e){makeNewFolder=e}var createPlace=null;function set_createPlace(e){createPlace=e}var globalWWTControl=null;function set_globalWWTControl(e){globalWWTControl=e}var globalScriptInterface=null;function set_globalScriptInterface(e){globalScriptInterface=e}var setManagerVisibleLayerList=null;function set_setManagerVisibleLayerList(e){setManagerVisibleLayerList=e}var tourDocumentFromUrlRaw=null;function set_tourDocumentFromUrlRaw(e){tourDocumentFromUrlRaw=e}var layerManagerGetAllMaps=null;function set_layerManagerGetAllMaps(e){layerManagerGetAllMaps=e}var loadWtmlFile=null;function set_loadWtmlFile(e){loadWtmlFile=e}var DomainHandling={wwtFlagship:0,localhost:1,neverProxy:2,tryNoProxy:3,proxy:4},URLRewriteMode={asIfAbsolute:0,originRelative:1};function URLHelpers(){switch(this._origin_protocol="undefined"==typeof window?"https:":window.location.protocol,this._force_https="https:"===this._origin_protocol,this._origin_domain="undefined"==typeof window?"":window.location.hostname,this._domain_handling={},this._domain_handling["worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["www.worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["cdn.worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["content.worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["beta.worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["beta-cdn.worldwidetelescope.org"]=DomainHandling.wwtFlagship,this._domain_handling["wwtstaging.azurewebsites.net"]=DomainHandling.wwtFlagship,this._domain_handling["wwtfiles.blob.core.windows.net"]=DomainHandling.neverProxy,this._domain_handling["wwttiles.blob.core.windows.net"]=DomainHandling.neverProxy,this._domain_handling["web.wwtassets.org"]=DomainHandling.neverProxy,this._domain_handling["data1.wwtassets.org"]=DomainHandling.neverProxy,this._domain_handling.localhost=DomainHandling.localhost,this._domain_handling["127.0.0.1"]=DomainHandling.localhost,this._origin_domain){case"worldwidetelescope.org":case"www.worldwidetelescope.org":case"cdn.worldwidetelescope.org":default:this._core_static_baseurl=this._origin_protocol+"//cdn.worldwidetelescope.org",this._core_dynamic_baseurl=this._origin_protocol+"//worldwidetelescope.org";break;case"beta.worldwidetelescope.org":case"beta-cdn.worldwidetelescope.org":this._core_static_baseurl=this._origin_protocol+"//beta-cdn.worldwidetelescope.org",this._core_dynamic_baseurl=this._origin_protocol+"//beta.worldwidetelescope.org"}this._engine_asset_baseurl=this._origin_protocol+"//web.wwtassets.org/engine/assets",this._flagship_static_lcpaths={},this._flagship_static_lcpaths["/wwtweb/2massoct.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/bingdemtile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/bingdemtile2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/catalog.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/catalog2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/dem.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/dembath.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/demmars.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/demtile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/dss.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/dsstoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/dusttoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/earthblend.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/earthmerbath.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/fixedaltitudedemtile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/g360.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/galex4far.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/galex4near.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/galextoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/gettile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/gettour.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/gettourfile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/gettours.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/glimpse.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/halphatoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/hirise.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/hirisedem2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/hirisedem3.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/jupiter.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/mandel.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/mandel1.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/mars.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/marsdem.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/marshirise.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/marsmoc.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/martiantile.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/martiantile2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/mipsgal.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/moondem.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/moonoct.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/moontoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/moontoastdem.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/postmars.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/postmarsdem.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/postmarsdem2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/rasstoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/sdsstoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/sdsstoast2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/sdsstoast2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/thumbnail.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/tiles.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/tiles2.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/tilesthumb.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/twomasstoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/tychooct.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/veblend.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/vlsstoast.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/wmap.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/wmsmoon.aspx"]=!0,this._flagship_static_lcpaths["/wwtweb/wmstoast.aspx"]=!0}registerType("URLRewriteMode",URLRewriteMode),registerEnum("URLRewriteMode",URLRewriteMode);var URLHelpers$={overrideAssetBaseurl:function(e){this._engine_asset_baseurl=e},rewrite:function(e,t){var i,r,n,s,a=e.toLowerCase();if(ss.ss.startsWith(a,"http://"))i="http:",r=e.substring(7);else if(ss.ss.startsWith(a,"https://"))i="https:",r=e.substring(8);else if(ss.ss.startsWith(a,"//"))i="",r=e.substring(2);else{if(ss.ss.startsWith(a,"blob:"))return e;switch(t){case URLRewriteMode.asIfAbsolute:default:i="",r=e;break;case URLRewriteMode.originRelative:return e=new URL(e,window.location.href).toString(),this.rewrite(e,0)}}if(freestandingMode)return e;var o=r.indexOf("/");o<0?(n=r,s="/"):(n=r.substring(0,o),s=r.substring(o));var l=n.toLowerCase(),h=s.toLowerCase().split("?")[0];switch(ss.ss.keyExists(this._domain_handling,l)||(ss.ss.startsWith(l,"localhost:")||ss.ss.startsWith(l,"127.0.0.1:")?this._domain_handling[l]=DomainHandling.localhost:this._domain_handling[l]=DomainHandling.tryNoProxy),this._domain_handling[l]){case DomainHandling.localhost:return e;case DomainHandling.neverProxy:case DomainHandling.tryNoProxy:default:if(this._force_https&&"https:"!==i){var c=n;if(ss.ss.endsWith(n,":80"))c=n.substring(0,n.length-3);else if(n.indexOf(":")>=0)return e;return"https://"+c+s}return e;case DomainHandling.proxy:return i||(e="http://"+e),e=ss.ss.replaceString(ss.ss.replaceString(encodeURIComponent(e),"%7B","{"),"%7D","}"),this._core_dynamic_baseurl+"/webserviceproxy.aspx?targeturl="+e;case DomainHandling.wwtFlagship:var u=!1;return(ss.ss.startsWith(h,"/data/")||ss.ss.keyExists(this._flagship_static_lcpaths,h)||ss.ss.startsWith(h,"/content/")||ss.ss.startsWith(h,"/engine/assets/"))&&(u=!0),u?this._core_static_baseurl+s:this._core_dynamic_baseurl+s}},activateProxy:function(e){if(freestandingMode)return null;var t,i,r=e.toLowerCase(),n=(t=ss.ss.startsWith(r,"http://")?e.substring(7):ss.ss.startsWith(r,"https://")?e.substring(8):ss.ss.startsWith(r,"//")?e.substring(2):e).indexOf("/");i=n<0?t:t.substring(0,n).toLowerCase(),ss.ss.keyExists(this._domain_handling,i)||(ss.ss.startsWith(i,"localhost:")||ss.ss.startsWith(i,"127.0.0.1:")?this._domain_handling[i]=DomainHandling.localhost:this._domain_handling[i]=DomainHandling.tryNoProxy);var s=this._domain_handling[i];return s===DomainHandling.wwtFlagship||s===DomainHandling.neverProxy||s===DomainHandling.localhost?null:(this._domain_handling[i]=DomainHandling.proxy,this.rewrite(e,0))},engineAssetUrl:function(e){return ss.ss.format("{0}/{1}",this._engine_asset_baseurl,e)},coreDynamicUrl:function(e){return ss.ss.format("{0}/{1}",this._core_dynamic_baseurl,e)},coreStaticUrl:function(e){return ss.ss.format("{0}/{1}",this._core_static_baseurl,e)}};registerType("URLHelpers",[URLHelpers,URLHelpers$,null]),URLHelpers.singleton=new URLHelpers;var galDetails=new GMDS,jupDetails=new EPD,jupPhisical=new CAAPhysicalJupiterDetails,jDateLast=0;function AstroRaDec(e,t,i,r,n){this.RA=0,this.dec=0,this.distance=0,this.shadow=!1,this.eclipsed=!1,this.RA=e,this.dec=t,this.distance=i,this.shadow=r,this.eclipsed=n}var AstroRaDec$={};function RiseSetDetails(e,t,i,r,n){this.bValid=!1,this.rise=0,this.transit=0,this.set=0,this.bNeverRises=!1,this.bValid=e,this.rise=t,this.transit=i,this.set=r,this.bNeverRises=n}registerType("AstroRaDec",[AstroRaDec,AstroRaDec$,null]);var RiseSetDetails$={};function AstroCalc(){}registerType("RiseSetDetails",[RiseSetDetails,RiseSetDetails$,null]),AstroCalc.getPlanet=function(e,t,i,r,n){var s=t;if(r=-r,s<9){var a=ELL.calculate(e,t);return new AstroRaDec((d=CAAParallax.equatorial2Topocentric(a.apparentGeocentricRA,a.apparentGeocentricDeclination,a.apparentGeocentricDistance,r,i,n,e)).x,d.y,a.apparentGeocentricDistance,!1,!1)}if(9===s){var o=CAAMoon.eclipticLatitude(e),l=CAAMoon.eclipticLongitude(e),h=CAAMoon.radiusVector(e)/149598e3,c=CAANutation.trueObliquityOfEcliptic(e),u=CT.ec2Eq(l,o,c);return new AstroRaDec((d=CAAParallax.equatorial2Topocentric(u.x,u.y,h,r,i,n,e)).x,d.y,h,!1,!1)}if(e!==jDateLast){jupDetails=ELL.calculate(e,4),jupPhisical=CAAPhysicalJupiter.calculate(e);var d=CAAParallax.equatorial2Topocentric(jupDetails.apparentGeocentricRA,jupDetails.apparentGeocentricDeclination,jupDetails.apparentGeocentricDistance,r,i,n,e);jupDetails.apparentGeocentricRA=d.x,jupDetails.apparentGeocentricDeclination=d.y,galDetails=GM.calculate(e),jDateLast=e}var _,g,f=954501e-9,m=Math.atan(f/jupDetails.apparentGeocentricDistance*.5)/3.1415927*180,p=m/Math.cos(jupDetails.apparentGeocentricDeclination/180*3.1415927)/15,C=0,S=0,w=0,T=!1,y=!1;switch(s){case 10:C=galDetails.satellite1.apparentRectangularCoordinates.x,S=galDetails.satellite1.apparentRectangularCoordinates.y,w=galDetails.satellite1.apparentRectangularCoordinates.z,y=galDetails.satellite1.bInEclipse,T=galDetails.satellite1.bInShadowTransit;break;case 11:C=galDetails.satellite2.apparentRectangularCoordinates.x,S=galDetails.satellite2.apparentRectangularCoordinates.y,w=galDetails.satellite2.apparentRectangularCoordinates.z,y=galDetails.satellite2.bInEclipse,T=galDetails.satellite2.bInShadowTransit;break;case 12:C=galDetails.satellite3.apparentRectangularCoordinates.x,S=galDetails.satellite3.apparentRectangularCoordinates.y,w=galDetails.satellite3.apparentRectangularCoordinates.z,y=galDetails.satellite3.bInEclipse,T=galDetails.satellite3.bInShadowTransit;break;case 13:C=galDetails.satellite4.apparentRectangularCoordinates.x,S=galDetails.satellite4.apparentRectangularCoordinates.y,w=galDetails.satellite4.apparentRectangularCoordinates.z,y=galDetails.satellite4.bInEclipse,T=galDetails.satellite4.bInShadowTransit;break;case 14:C=galDetails.satellite1.apparentShadowRectangularCoordinates.x,S=galDetails.satellite1.apparentShadowRectangularCoordinates.y,w=.9*galDetails.satellite1.apparentShadowRectangularCoordinates.z,T=galDetails.satellite1.bInShadowTransit;break;case 15:C=galDetails.satellite2.apparentShadowRectangularCoordinates.x,S=galDetails.satellite2.apparentShadowRectangularCoordinates.y,w=.9*galDetails.satellite2.apparentShadowRectangularCoordinates.z,T=galDetails.satellite2.bInShadowTransit;break;case 16:C=galDetails.satellite3.apparentShadowRectangularCoordinates.x,S=galDetails.satellite3.apparentShadowRectangularCoordinates.y,w=.9*galDetails.satellite3.apparentShadowRectangularCoordinates.z,T=galDetails.satellite3.bInShadowTransit;break;case 17:C=galDetails.satellite4.apparentShadowRectangularCoordinates.x,S=galDetails.satellite4.apparentShadowRectangularCoordinates.y,w=.9*galDetails.satellite4.apparentShadowRectangularCoordinates.z,T=galDetails.satellite4.bInShadowTransit}var b=jupPhisical.p/180*3.1415927;return _=C*Math.cos(b)-S*Math.sin(b),g=C*Math.sin(b)+S*Math.cos(b),C=_,S=g,new AstroRaDec(jupDetails.apparentGeocentricRA-C*p,jupDetails.apparentGeocentricDeclination+S*m,jupDetails.apparentGeocentricDistance+w*f/2,T,y)},AstroCalc.getJulianDay=function(e,t,i){return DT.dateToJD(ss.ss.truncate(e),ss.ss.truncate(t),i,!0)},AstroCalc.eclipticToJ2000=function(e,t,i){var r=CT.ec2Eq(e,t,CAANutation.trueObliquityOfEcliptic(i));return new AstroRaDec(r.x,r.y,0,!1,!1)},AstroCalc.galacticToJ2000=function(e,t){var i=CT.g2Eq(e,t);return new AstroRaDec(i.x,i.y,0,!1,!1)},AstroCalc.j2000ToGalactic=function(e,t){var i=CT.eq2G(e,t);return new AstroRaDec(i.x,i.y,0,!1,!1)},AstroCalc.getRiseTrinsitSet=function(e,t,i,r,n,s,a,o,l,h){var c=-.5667;switch(h){case 0:c=-.5667;break;case 1:c=-.8333;break;case 2:c=.125}var u=CAARiseTransitSet.rise(e,r,n,s,a,o,l,i,t,c),d=!1;return u.bValid||(d=Util.sign(t)!==Util.sign(a)),new RiseSetDetails(u.bValid,u.rise,u.transit,u.set,d)},AstroCalc.getRiseTransitSet=AstroCalc.getRiseTrinsitSet;var AstroCalc$={};registerType("AstroCalc",[AstroCalc,AstroCalc$,null]);const WEBGL={ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_ATTRIBUTES:35721,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORM_MAX_LENGTH:35719,ACTIVE_UNIFORMS:35718,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,EXTENSIONS:7939,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HIGH_FLOAT:36338,HIGH_INT:36341,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NO_ERROR:0,NONE:0,NOTEQUAL:517,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB8:32849,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA8:32856,RGBA16I:36232,RED_INTEGER:36244,RED:6403,R32F:33326,R16I:33331,RGBA4:32854,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,UNPACK_FLIP_Y_WEBGL:37440,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRIANGLES:4,UNPACK_ALIGNMENT:3317,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0};function ShortIndexBuffer(e){this.buffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this.buffer),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}var ShortIndexBuffer$={};function IndexBuffer(e){this.buffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this.buffer),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}registerType("ShortIndexBuffer",[ShortIndexBuffer,ShortIndexBuffer$,null]);var IndexBuffer$={dispose:function(){tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),tilePrepDevice.deleteBuffer(this.buffer),this.buffer=null}};function VertexBufferBase(){}registerType("IndexBuffer",[IndexBuffer,IndexBuffer$,null,ss.ss.IDisposable]);var VertexBufferBase$={dispose:function(){tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,null),tilePrepDevice.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null}};function PositionVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("VertexBufferBase",[VertexBufferBase,VertexBufferBase$,null,ss.ss.IDisposable]);var PositionVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(3*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.x,t[i++]=n.y,t[i++]=n.z}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function PositionTextureVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("PositionVertexBuffer",[PositionVertexBuffer,PositionVertexBuffer$,VertexBufferBase]),PositionTextureVertexBuffer.create=function(e){var t=new PositionTextureVertexBuffer(e.length);return t._verts$1=e,t.unlock(),t};var PositionTextureVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(5*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.position.z,t[i++]=n.tu,t[i++]=n.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function PositionNormalTexturedVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("PositionTextureVertexBuffer",[PositionTextureVertexBuffer,PositionTextureVertexBuffer$,VertexBufferBase]),PositionNormalTexturedVertexBuffer.create=function(e){var t=new PositionNormalTexturedVertexBuffer(e.length);return t._verts$1=e,t.unlock(),t};var PositionNormalTexturedVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(8*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.nx,t[i++]=n.ny,t[i++]=n.nz,t[i++]=n.tu,t[i++]=n.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function PositionNormalTexturedTangentVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("PositionNormalTexturedVertexBuffer",[PositionNormalTexturedVertexBuffer,PositionNormalTexturedVertexBuffer$,VertexBufferBase]),PositionNormalTexturedTangentVertexBuffer.create=function(e){var t=new PositionNormalTexturedTangentVertexBuffer(e.length);return t._verts$1=e,t.unlock(),t};var PositionNormalTexturedTangentVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(11*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.x,t[i++]=n.y,t[i++]=n.z,t[i++]=n.nx,t[i++]=n.ny,t[i++]=n.nz,t[i++]=n.tanx,t[i++]=n.tany,t[i++]=n.tanz,t[i++]=n.tu,t[i++]=n.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function KeplerVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("PositionNormalTexturedTangentVertexBuffer",[PositionNormalTexturedTangentVertexBuffer,PositionNormalTexturedTangentVertexBuffer$,VertexBufferBase]),KeplerVertexBuffer.create=function(e){var t=new KeplerVertexBuffer(e.length);return t._verts$1=e,t};var KeplerVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(19*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.ABC.x,t[i++]=n.ABC.y,t[i++]=n.ABC.z,t[i++]=n.abc1.x,t[i++]=n.abc1.y,t[i++]=n.abc1.z,t[i++]=n.pointSize,t[i++]=n.color.r/255,t[i++]=n.color.g/255,t[i++]=n.color.b/255,t[i++]=n.color.a/255,t[i++]=n.w,t[i++]=n.e,t[i++]=n.n,t[i++]=n.t,t[i++]=n.a,t[i++]=n.z,t[i++]=n.orbitPos,t[i++]=n.orbits}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function TimeSeriesLineVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("KeplerVertexBuffer",[KeplerVertexBuffer,KeplerVertexBuffer$,VertexBufferBase]);var TimeSeriesLineVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(9*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.position.z,t[i++]=n.get_color().r/255,t[i++]=n.get_color().g/255,t[i++]=n.get_color().b/255,t[i++]=n.get_color().a/255,t[i++]=n.tu,t[i++]=n.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function TimeSeriesPointVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("TimeSeriesLineVertexBuffer",[TimeSeriesLineVertexBuffer,TimeSeriesLineVertexBuffer$,VertexBufferBase]);var TimeSeriesPointVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(10*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.position.z,t[i++]=n.get_color().r/255,t[i++]=n.get_color().g/255,t[i++]=n.get_color().b/255,t[i++]=n.get_color().a/255,t[i++]=n.tu,t[i++]=n.tv,t[i++]=n.pointSize}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)},dispose:function(){tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,null),tilePrepDevice.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null}};function PositionColoredVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("TimeSeriesPointVertexBuffer",[TimeSeriesPointVertexBuffer,TimeSeriesPointVertexBuffer$,VertexBufferBase]);var PositionColoredVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(7*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.position.z,t[i++]=n.color.r/255,t[i++]=n.color.g/255,t[i++]=n.color.b/255,t[i++]=n.color.a/255}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function PositionColoredTexturedVertexBuffer(e){this.count=0,this._verts$1=null,VertexBufferBase.call(this),this.count=e}registerType("PositionColoredVertexBuffer",[PositionColoredVertexBuffer,PositionColoredVertexBuffer$,VertexBufferBase]);var PositionColoredTexturedVertexBuffer$={lock:function(){return this._verts$1=new Array(this.count),this._verts$1},unlock:function(){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var e=new Float32Array(9*this.count),t=e,i=0,r=ss.ss.enumerate(this._verts$1);r.moveNext();){var n=r.current;t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.position.z,t[i++]=n.color.r/255,t[i++]=n.color.g/255,t[i++]=n.color.b/255,t[i++]=n.color.a/255,t[i++]=n.tu,t[i++]=n.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)}};function Texture(){this.imageElement=null,this.texture2d=null,this._downloading=!1,this._ready=!1,this._errored=!1,this.URL=""}registerType("PositionColoredTexturedVertexBuffer",[PositionColoredTexturedVertexBuffer,PositionColoredTexturedVertexBuffer$,VertexBufferBase]),Texture.empty=null,Texture.getEmpty=function(){return null==Texture.empty&&(Texture.empty=tilePrepDevice.createTexture(),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,Texture.empty),tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGBA,1,1,0,WEBGL.RGBA,WEBGL.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,null)),Texture.empty},Texture.fromUrl=function(e){var t=new Texture;return t.load(e),t},Texture.isPowerOfTwo=function(e){return!(e&e-1)},Texture.fitPowerOfTwo=function(e){e--;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1};var Texture$={cleanUp:function(){this.imageElement=null,tilePrepDevice.deleteTexture(this.texture2d)},dispose:function(){this.cleanUp()},load:function(e){var t=this;if(this.URL=e,"undefined"!=typeof document&&!this._downloading){this._downloading=!0,this.imageElement=document.createElement("img");var i=this.imageElement;this.imageElement.addEventListener("load",(function(e){t._ready=!0,t._downloading=!1,t._errored=!1,t.makeTexture()}),!1),this.imageElement.addEventListener("error",(function(e){if(!t.imageElement.hasAttribute("proxyattempt")){t.imageElement.setAttribute("proxyattempt",!0);var i=URLHelpers.singleton.activateProxy(t.URL);if(null!=i)return void(t.imageElement.src=i)}t._downloading=!1,t._ready=!1,t._errored=!0}),!1),i.crossOrigin="anonymous",this.imageElement.src=this.URL}},makeTexture:function(){if(null!=tilePrepDevice)try{this.texture2d=tilePrepDevice.createTexture(),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,this.texture2d);var e=this.imageElement;if(1==(!Texture.isPowerOfTwo(this.imageElement.height)|!Texture.isPowerOfTwo(this.imageElement.width))){var t=document.createElement("canvas");t.height=Texture.fitPowerOfTwo(e.height),t.width=Texture.fitPowerOfTwo(e.width),t.getContext("2d").drawImage(e,0,0,t.width,t.height),e=t}tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_S,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_T,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGBA,WEBGL.RGBA,WEBGL.UNSIGNED_BYTE,e),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.LINEAR_MIPMAP_NEAREST),tilePrepDevice.generateMipmap(WEBGL.TEXTURE_2D),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,null)}catch(e){this._errored=!0}}};function Tessellator(){}registerType("Texture",[Texture,Texture$,null,ss.ss.IDisposable]),Tessellator.tesselateSimplePoly=function(e){var t=[];return(new Tessellator).process(e,t),t};var Tessellator$={_isLeftOfHalfSpace:function(e,t,i){e.normalize(),t.normalize();var r=Vector3d.cross(e,t);return Vector3d.dot(r,i)>0},_insideTriangle:function(e,t,i,r){return!!this._isLeftOfHalfSpace(e,t,r)&&!!this._isLeftOfHalfSpace(t,i,r)&&!!this._isLeftOfHalfSpace(i,e,r)},_canClipEar:function(e,t,i,r,n,s){var a,o,l=e[s[t]].copy(),h=e[s[i]].copy(),c=e[s[r]].copy(),u=Vector3d.subtractVectors(h,l);u.normalize();var d=Vector3d.subtractVectors(h,c);d.normalize();var _=Vector3d.cross(u,d),g=h.copy();if(g.normalize(),Vector3d.dot(_,g)>0)return!1;for(a=0;a<n;a++)if(a!==t&&a!==i&&a!==r&&(o=e[s[a]].copy(),this._insideTriangle(l,h,c,o)))return!1;return!0},process:function(e,t){var i=e.length;if(e.length<3)return!1;for(var r=new Array(e.length),n=0;n<i;n++)r[n]=n;for(var s=i,a=2*s,o=s-1;s>2;){if(0>=a--)return!1;var l=o;s<=l&&(l=0),s<=(o=l+1)&&(o=0);var h=o+1;if(s<=h&&(h=0),this._canClipEar(e,l,o,h,s,r)){var c,u;for(t.push(r[l]),t.push(r[o]),t.push(r[h]),c=o,u=o+1;u<s;c++,u++)r[c]=r[u];a=2*--s}}return!0}};function SimpleLineShader(){}registerType("Tessellator",[Tessellator,Tessellator$,null]),SimpleLineShader.vertLoc=0,SimpleLineShader.initialized=!1,SimpleLineShader._prog=null,SimpleLineShader.init=function(e){var t=e.gl;SimpleLineShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(SimpleLineShader._frag,"        precision highp float;\n        uniform vec4 lineColor;\n\n        void main(void) {\n            gl_FragColor = lineColor;\n        }\n    "),t.compileShader(SimpleLineShader._frag),t.getShaderParameter(SimpleLineShader._frag,WEBGL.COMPILE_STATUS),SimpleLineShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(SimpleLineShader._vert,"        attribute vec3 aVertexPosition;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n        }\n    "),t.compileShader(SimpleLineShader._vert),t.getShaderParameter(SimpleLineShader._vert,WEBGL.COMPILE_STATUS),SimpleLineShader._prog=t.createProgram(),t.attachShader(SimpleLineShader._prog,SimpleLineShader._vert),t.attachShader(SimpleLineShader._prog,SimpleLineShader._frag),t.linkProgram(SimpleLineShader._prog),t.getProgramParameter(SimpleLineShader._prog,WEBGL.LINK_STATUS),t.useProgram(SimpleLineShader._prog),SimpleLineShader.vertLoc=t.getAttribLocation(SimpleLineShader._prog,"aVertexPosition"),SimpleLineShader.lineColorLoc=t.getUniformLocation(SimpleLineShader._prog,"lineColor"),SimpleLineShader.projMatLoc=t.getUniformLocation(SimpleLineShader._prog,"uPMatrix"),SimpleLineShader.mvMatLoc=t.getUniformLocation(SimpleLineShader._prog,"uMVMatrix"),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),SimpleLineShader.initialized=!0},SimpleLineShader.use=function(e,t,i,r){var n=e.gl;if(null!=n){SimpleLineShader.initialized||SimpleLineShader.init(e),n.useProgram(SimpleLineShader._prog);var s=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());n.uniformMatrix4fv(SimpleLineShader.mvMatLoc,!1,s.floatArray()),n.uniformMatrix4fv(SimpleLineShader.projMatLoc,!1,e.get_projection().floatArray()),n.uniform4f(SimpleLineShader.lineColorLoc,i.r/255,i.g/255,i.b/255,1),e.space||!r?n.disable(WEBGL.DEPTH_TEST):n.enable(WEBGL.DEPTH_TEST),n.disableVertexAttribArray(0),n.disableVertexAttribArray(1),n.disableVertexAttribArray(2),n.disableVertexAttribArray(3),n.enableVertexAttribArray(SimpleLineShader.vertLoc),n.bindBuffer(WEBGL.ARRAY_BUFFER,t),n.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),n.vertexAttribPointer(SimpleLineShader.vertLoc,3,WEBGL.FLOAT,!1,0,0),n.lineWidth(1),n.enable(WEBGL.BLEND),n.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var SimpleLineShader$={};function SimpleLineShader2D(){}registerType("SimpleLineShader",[SimpleLineShader,SimpleLineShader$,null]),SimpleLineShader2D.vertLoc=0,SimpleLineShader2D.initialized=!1,SimpleLineShader2D._prog=null,SimpleLineShader2D.init=function(e){var t=e.gl;SimpleLineShader2D._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(SimpleLineShader2D._frag,"       precision highp float;\n       uniform vec4 lineColor;\n\n       void main(void) {\n           gl_FragColor = lineColor;\n       }\n    "),t.compileShader(SimpleLineShader2D._frag),t.getShaderParameter(SimpleLineShader2D._frag,WEBGL.COMPILE_STATUS),SimpleLineShader2D._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(SimpleLineShader2D._vert,"        attribute vec3 aVertexPosition;\n\n        void main(void) {\n            gl_Position = vec4(aVertexPosition, 1.0);\n        }\n    "),t.compileShader(SimpleLineShader2D._vert),t.getShaderParameter(SimpleLineShader2D._vert,WEBGL.COMPILE_STATUS),SimpleLineShader2D._prog=t.createProgram(),t.attachShader(SimpleLineShader2D._prog,SimpleLineShader2D._vert),t.attachShader(SimpleLineShader2D._prog,SimpleLineShader2D._frag),t.linkProgram(SimpleLineShader2D._prog),t.getProgramParameter(SimpleLineShader2D._prog,WEBGL.LINK_STATUS),t.useProgram(SimpleLineShader2D._prog),SimpleLineShader2D.vertLoc=t.getAttribLocation(SimpleLineShader2D._prog,"aVertexPosition"),SimpleLineShader2D.lineColorLoc=t.getUniformLocation(SimpleLineShader2D._prog,"lineColor"),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),SimpleLineShader2D.initialized=!0},SimpleLineShader2D.use=function(e,t,i,r){var n=e.gl;null!=n&&(SimpleLineShader2D.initialized||SimpleLineShader2D.init(e),n.useProgram(SimpleLineShader2D._prog),Matrix3d.multiplyMatrix(e.get_world(),e.get_view()),n.uniform4f(SimpleLineShader2D.lineColorLoc,i.r/255,i.g/255,i.b/255,1),e.space||!r?n.disable(WEBGL.DEPTH_TEST):n.enable(WEBGL.DEPTH_TEST),n.disableVertexAttribArray(0),n.disableVertexAttribArray(1),n.disableVertexAttribArray(2),n.disableVertexAttribArray(3),n.enableVertexAttribArray(SimpleLineShader2D.vertLoc),n.bindBuffer(WEBGL.ARRAY_BUFFER,t),n.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),n.vertexAttribPointer(SimpleLineShader2D.vertLoc,3,WEBGL.FLOAT,!1,0,0),n.lineWidth(1),n.enable(WEBGL.BLEND),n.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA))};var SimpleLineShader2D$={};function OrbitLineShader(){}registerType("SimpleLineShader2D",[SimpleLineShader2D,SimpleLineShader2D$,null]),OrbitLineShader.vertLoc=0,OrbitLineShader.colorLoc=0,OrbitLineShader.initialized=!1,OrbitLineShader._prog=null,OrbitLineShader.init=function(e){var t=e.gl;OrbitLineShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(OrbitLineShader._frag,"        precision highp float;\n        uniform vec4 lineColor;\n        varying lowp vec4 vColor;\n\n        void main(void) {\n            gl_FragColor = lineColor * vColor;\n        }\n    "),t.compileShader(OrbitLineShader._frag),t.getShaderParameter(OrbitLineShader._frag,WEBGL.COMPILE_STATUS),OrbitLineShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(OrbitLineShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec4 aVertexColor;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        varying lowp vec4 vColor;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vColor = aVertexColor;\n        }\n    "),t.compileShader(OrbitLineShader._vert),t.getShaderParameter(OrbitLineShader._vert,WEBGL.COMPILE_STATUS),OrbitLineShader._prog=t.createProgram(),t.attachShader(OrbitLineShader._prog,OrbitLineShader._vert),t.attachShader(OrbitLineShader._prog,OrbitLineShader._frag),t.linkProgram(OrbitLineShader._prog),t.getProgramParameter(OrbitLineShader._prog,WEBGL.LINK_STATUS),t.useProgram(OrbitLineShader._prog),OrbitLineShader.vertLoc=t.getAttribLocation(OrbitLineShader._prog,"aVertexPosition"),OrbitLineShader.colorLoc=t.getAttribLocation(OrbitLineShader._prog,"aVertexColor"),OrbitLineShader.lineColorLoc=t.getUniformLocation(OrbitLineShader._prog,"lineColor"),OrbitLineShader.projMatLoc=t.getUniformLocation(OrbitLineShader._prog,"uPMatrix"),OrbitLineShader.mvMatLoc=t.getUniformLocation(OrbitLineShader._prog,"uMVMatrix"),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),OrbitLineShader.initialized=!0},OrbitLineShader.use=function(e,t,i){var r=e.gl;if(null!=r){OrbitLineShader.initialized||OrbitLineShader.init(e),r.useProgram(OrbitLineShader._prog);var n=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());r.uniformMatrix4fv(OrbitLineShader.mvMatLoc,!1,n.floatArray()),r.uniformMatrix4fv(OrbitLineShader.projMatLoc,!1,e.get_projection().floatArray()),r.uniform4f(OrbitLineShader.lineColorLoc,i.r/255,i.g/255,i.b/255,1),e.space?r.disable(WEBGL.DEPTH_TEST):r.enable(WEBGL.DEPTH_TEST),r.disableVertexAttribArray(0),r.disableVertexAttribArray(1),r.disableVertexAttribArray(2),r.disableVertexAttribArray(3),r.bindBuffer(WEBGL.ARRAY_BUFFER,t),r.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),r.enableVertexAttribArray(OrbitLineShader.vertLoc),r.enableVertexAttribArray(OrbitLineShader.colorLoc),r.vertexAttribPointer(OrbitLineShader.vertLoc,3,WEBGL.FLOAT,!1,28,0),r.vertexAttribPointer(OrbitLineShader.colorLoc,4,WEBGL.FLOAT,!1,28,12),r.lineWidth(1),r.enable(WEBGL.BLEND),r.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var OrbitLineShader$={};function LineShaderNormalDates(){}registerType("OrbitLineShader",[OrbitLineShader,OrbitLineShader$,null]),LineShaderNormalDates.vertLoc=0,LineShaderNormalDates.colorLoc=0,LineShaderNormalDates.timeLoc=0,LineShaderNormalDates.initialized=!1,LineShaderNormalDates._prog=null,LineShaderNormalDates.init=function(e){var t=e.gl;LineShaderNormalDates._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(LineShaderNormalDates._frag,"        precision highp float;\n        uniform vec4 lineColor;\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            gl_FragColor = lineColor * vColor;\n        }\n    "),t.compileShader(LineShaderNormalDates._frag),t.getShaderParameter(LineShaderNormalDates._frag,WEBGL.COMPILE_STATUS),LineShaderNormalDates._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(LineShaderNormalDates._vert,"        attribute vec3 aVertexPosition;\n        attribute vec4 aVertexColor;\n        attribute vec2 aTime;\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform float jNow;\n        uniform float decay;\n\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            float dAlpha = 1.0;\n\n            if (decay > 0.0)\n            {\n                    dAlpha = 1.0 - ((jNow - aTime.y) / decay);\n                    if (dAlpha > 1.0 )\n                    {\n                        dAlpha = 1.0;\n                    }\n            }\n\n            if (jNow < aTime.x && decay > 0.0)\n            {\n                vColor = vec4(1, 1, 1, 1);\n            }\n            else\n            {\n                vColor = vec4(aVertexColor.r, aVertexColor.g, aVertexColor.b, dAlpha * aVertexColor.a);\n            }\n        }\n    "),t.compileShader(LineShaderNormalDates._vert),t.getShaderParameter(LineShaderNormalDates._vert,WEBGL.COMPILE_STATUS),LineShaderNormalDates._prog=t.createProgram(),t.attachShader(LineShaderNormalDates._prog,LineShaderNormalDates._vert),t.attachShader(LineShaderNormalDates._prog,LineShaderNormalDates._frag),t.linkProgram(LineShaderNormalDates._prog),t.getProgramParameter(LineShaderNormalDates._prog,WEBGL.LINK_STATUS),t.useProgram(LineShaderNormalDates._prog),LineShaderNormalDates.vertLoc=t.getAttribLocation(LineShaderNormalDates._prog,"aVertexPosition"),LineShaderNormalDates.colorLoc=t.getAttribLocation(LineShaderNormalDates._prog,"aVertexColor"),LineShaderNormalDates.timeLoc=t.getAttribLocation(LineShaderNormalDates._prog,"aTime"),LineShaderNormalDates.lineColorLoc=t.getUniformLocation(LineShaderNormalDates._prog,"lineColor"),LineShaderNormalDates.projMatLoc=t.getUniformLocation(LineShaderNormalDates._prog,"uPMatrix"),LineShaderNormalDates.mvMatLoc=t.getUniformLocation(LineShaderNormalDates._prog,"uMVMatrix"),LineShaderNormalDates.jNowLoc=t.getUniformLocation(LineShaderNormalDates._prog,"jNow"),LineShaderNormalDates.decayLoc=t.getUniformLocation(LineShaderNormalDates._prog,"decay"),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),LineShaderNormalDates.initialized=!0},LineShaderNormalDates.use=function(e,t,i,r,n,s){var a=e.gl;if(null!=a){LineShaderNormalDates.initialized||LineShaderNormalDates.init(e),a.useProgram(LineShaderNormalDates._prog);var o=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());a.uniformMatrix4fv(LineShaderNormalDates.mvMatLoc,!1,o.floatArray()),a.uniformMatrix4fv(LineShaderNormalDates.projMatLoc,!1,e.get_projection().floatArray()),a.uniform4f(LineShaderNormalDates.lineColorLoc,i.r/255,i.g/255,i.b/255,1),a.uniform1f(LineShaderNormalDates.jNowLoc,n),a.uniform1f(LineShaderNormalDates.decayLoc,s),r?a.enable(WEBGL.DEPTH_TEST):a.disable(WEBGL.DEPTH_TEST),a.disableVertexAttribArray(0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.bindBuffer(WEBGL.ARRAY_BUFFER,t),a.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),a.enableVertexAttribArray(LineShaderNormalDates.vertLoc),a.enableVertexAttribArray(LineShaderNormalDates.colorLoc),a.vertexAttribPointer(LineShaderNormalDates.vertLoc,3,WEBGL.FLOAT,!1,36,0),a.vertexAttribPointer(LineShaderNormalDates.colorLoc,4,WEBGL.FLOAT,!1,36,12),a.vertexAttribPointer(LineShaderNormalDates.timeLoc,2,WEBGL.FLOAT,!1,36,28),a.lineWidth(1),a.enable(WEBGL.BLEND),a.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var LineShaderNormalDates$={};function TimeSeriesPointSpriteShader(){}registerType("LineShaderNormalDates",[LineShaderNormalDates,LineShaderNormalDates$,null]),TimeSeriesPointSpriteShader.vertLoc=0,TimeSeriesPointSpriteShader.colorLoc=0,TimeSeriesPointSpriteShader.pointSizeLoc=0,TimeSeriesPointSpriteShader.timeLoc=0,TimeSeriesPointSpriteShader.initialized=!1,TimeSeriesPointSpriteShader._prog=null,TimeSeriesPointSpriteShader.init=function(e){var t=e.gl;TimeSeriesPointSpriteShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(TimeSeriesPointSpriteShader._frag,"        precision mediump float;\n        uniform vec4 lineColor;\n        varying lowp vec4 vColor;\n        uniform sampler2D uSampler;\n\n        void main(void)\n        {\n            vec4 texColor;\n            texColor = texture2D(uSampler, gl_PointCoord);\n            gl_FragColor = lineColor * vColor * texColor;\n        }\n    "),t.compileShader(TimeSeriesPointSpriteShader._frag),t.getShaderParameter(TimeSeriesPointSpriteShader._frag,WEBGL.COMPILE_STATUS),TimeSeriesPointSpriteShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(TimeSeriesPointSpriteShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec4 aVertexColor;\n        attribute vec2 aTime;\n        attribute float aPointSize;\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform float jNow;\n        uniform vec3 cameraPosition;\n        uniform float decay;\n        uniform float scale;\n        uniform float minSize;\n        uniform float sky;\n        uniform float showFarSide;\n\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            float dotCam = dot( normalize(cameraPosition-aVertexPosition), normalize(aVertexPosition));\n            float dist = distance(aVertexPosition, cameraPosition);\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            float dAlpha = 1.0;\n\n            if ( decay > 0.0)\n            {\n                    dAlpha = 1.0 - ((jNow - aTime.y) / decay);\n                    if (dAlpha > 1.0 )\n                    {\n                        dAlpha = 1.0;\n                    }\n            }\n\n            if ( showFarSide == 0.0 && (dotCam * sky) < 0.0 || (jNow < aTime.x && decay > 0.0))\n            {\n                vColor = vec4(0.0, 0.0, 0.0, 0.0);\n            }\n            else\n            {\n                vColor = vec4(aVertexColor.r, aVertexColor.g, aVertexColor.b, dAlpha);\n            }\n\n            float lSize = scale;\n\n            if (scale < 0.0)\n            {\n                lSize = -scale;\n                dist = 1.0;\n            }\n\n            gl_PointSize = max(minSize, (lSize * ( aPointSize ) / dist));\n        }\n    "),t.compileShader(TimeSeriesPointSpriteShader._vert),t.getShaderParameter(TimeSeriesPointSpriteShader._vert,WEBGL.COMPILE_STATUS),t.getShaderInfoLog(TimeSeriesPointSpriteShader._vert),TimeSeriesPointSpriteShader._prog=t.createProgram(),t.attachShader(TimeSeriesPointSpriteShader._prog,TimeSeriesPointSpriteShader._vert),t.attachShader(TimeSeriesPointSpriteShader._prog,TimeSeriesPointSpriteShader._frag),t.linkProgram(TimeSeriesPointSpriteShader._prog),t.getProgramParameter(TimeSeriesPointSpriteShader._prog,WEBGL.LINK_STATUS),t.useProgram(TimeSeriesPointSpriteShader._prog),TimeSeriesPointSpriteShader.vertLoc=t.getAttribLocation(TimeSeriesPointSpriteShader._prog,"aVertexPosition"),TimeSeriesPointSpriteShader.colorLoc=t.getAttribLocation(TimeSeriesPointSpriteShader._prog,"aVertexColor"),TimeSeriesPointSpriteShader.pointSizeLoc=t.getAttribLocation(TimeSeriesPointSpriteShader._prog,"aPointSize"),TimeSeriesPointSpriteShader.timeLoc=t.getAttribLocation(TimeSeriesPointSpriteShader._prog,"aTime"),TimeSeriesPointSpriteShader.projMatLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"uPMatrix"),TimeSeriesPointSpriteShader.mvMatLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"uMVMatrix"),TimeSeriesPointSpriteShader.sampLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"uSampler"),TimeSeriesPointSpriteShader.jNowLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"jNow"),TimeSeriesPointSpriteShader.decayLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"decay"),TimeSeriesPointSpriteShader.lineColorLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"lineColor"),TimeSeriesPointSpriteShader.cameraPosLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"cameraPosition"),TimeSeriesPointSpriteShader.scaleLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"scale"),TimeSeriesPointSpriteShader.skyLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"sky"),TimeSeriesPointSpriteShader.showFarSideLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"showFarSide"),TimeSeriesPointSpriteShader.minSizeLoc=t.getUniformLocation(TimeSeriesPointSpriteShader._prog,"minSize"),t.enable(WEBGL.BLEND),TimeSeriesPointSpriteShader.initialized=!0},TimeSeriesPointSpriteShader.use=function(e,t,i,r,n,s,a,o,l,h,c,u){null==i&&(i=Texture.getEmpty());var d=e.gl;if(null!=d){TimeSeriesPointSpriteShader.initialized||TimeSeriesPointSpriteShader.init(e),d.useProgram(TimeSeriesPointSpriteShader._prog);var _=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());d.uniformMatrix4fv(TimeSeriesPointSpriteShader.mvMatLoc,!1,_.floatArray()),d.uniformMatrix4fv(TimeSeriesPointSpriteShader.projMatLoc,!1,e.get_projection().floatArray()),d.uniform1i(TimeSeriesPointSpriteShader.sampLoc,0),d.uniform1f(TimeSeriesPointSpriteShader.jNowLoc,s),d.uniform1f(TimeSeriesPointSpriteShader.decayLoc,a),d.uniform4f(TimeSeriesPointSpriteShader.lineColorLoc,r.r/255,r.g/255,r.b/255,r.a/255),d.uniform3f(TimeSeriesPointSpriteShader.cameraPosLoc,o.x,o.y,o.z),d.uniform1f(TimeSeriesPointSpriteShader.scaleLoc,l),d.uniform1f(TimeSeriesPointSpriteShader.minSizeLoc,h),d.uniform1f(TimeSeriesPointSpriteShader.showFarSideLoc,c?1:0),d.uniform1f(TimeSeriesPointSpriteShader.skyLoc,u?-1:1),n?d.enable(WEBGL.DEPTH_TEST):d.disable(WEBGL.DEPTH_TEST),d.disableVertexAttribArray(0),d.disableVertexAttribArray(1),d.disableVertexAttribArray(2),d.disableVertexAttribArray(3),d.bindBuffer(WEBGL.ARRAY_BUFFER,t),d.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),d.enableVertexAttribArray(TimeSeriesPointSpriteShader.vertLoc),d.enableVertexAttribArray(TimeSeriesPointSpriteShader.colorLoc),d.enableVertexAttribArray(TimeSeriesPointSpriteShader.pointSizeLoc),d.enableVertexAttribArray(TimeSeriesPointSpriteShader.timeLoc),d.vertexAttribPointer(TimeSeriesPointSpriteShader.vertLoc,3,WEBGL.FLOAT,!1,40,0),d.vertexAttribPointer(TimeSeriesPointSpriteShader.colorLoc,4,WEBGL.FLOAT,!1,40,12),d.vertexAttribPointer(TimeSeriesPointSpriteShader.pointSizeLoc,1,WEBGL.FLOAT,!1,40,36),d.vertexAttribPointer(TimeSeriesPointSpriteShader.timeLoc,2,WEBGL.FLOAT,!1,40,28),d.activeTexture(WEBGL.TEXTURE0),d.bindTexture(WEBGL.TEXTURE_2D,i),d.lineWidth(1),d.enable(WEBGL.BLEND),d.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE)}};var TimeSeriesPointSpriteShader$={};function KeplerPointSpriteShader(){}registerType("TimeSeriesPointSpriteShader",[TimeSeriesPointSpriteShader,TimeSeriesPointSpriteShader$,null]),KeplerPointSpriteShader.abcLoc=0,KeplerPointSpriteShader.abcLoc1=0,KeplerPointSpriteShader.pointSizeLoc=0,KeplerPointSpriteShader.colorLoc=0,KeplerPointSpriteShader.weLoc=0,KeplerPointSpriteShader.nTLoc=0,KeplerPointSpriteShader.azLoc=0,KeplerPointSpriteShader.orbitLoc=0,KeplerPointSpriteShader.initialized=!1,KeplerPointSpriteShader._prog=null,KeplerPointSpriteShader.init=function(e){var t=e.gl;KeplerPointSpriteShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(KeplerPointSpriteShader._frag,"        precision mediump float;\n        uniform vec4 lineColor;\n        varying lowp vec4 vColor;\n        uniform sampler2D uSampler;\n\n        void main(void)\n        {\n            vec4 texColor;\n            texColor = texture2D(uSampler, gl_PointCoord);\n            gl_FragColor = lineColor * vColor * texColor;\n        }\n    "),t.compileShader(KeplerPointSpriteShader._frag),t.getShaderParameter(KeplerPointSpriteShader._frag,WEBGL.COMPILE_STATUS),KeplerPointSpriteShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(KeplerPointSpriteShader._vert,"        attribute vec3 ABC;\n        attribute vec3 abc;\n        attribute float PointSize;\n        attribute vec4 Color;\n        attribute vec2 we;\n        attribute vec2 nT;\n        attribute vec2 az;\n        attribute vec2 orbit;\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform float jNow;\n        uniform vec3 cameraPosition;\n        uniform float MM;\n        uniform float scaling;\n        uniform float minSize;\n        uniform float opacity;\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            float M = nT.x * (jNow - nT.y) * 0.01745329251994;\n            float e = we.y;\n            float a = az.x;\n            float PI = 3.1415926535897932384;\n            float w = we.x* 0.01745329251994;\n            float F = 1.0;\n\n            if (M < 0.0)\n                F = -1.0;\n\n            M = abs(M) / (2.0 * PI);\n            M = (M - float(int(M)))*2.0 *PI *F;\n\n            if (MM != 0.0)\n            {\n                M = MM + (1.0- orbit.x) *2.0 *PI;\n                if (M > (2.0*PI))\n                    M = M - (2.0*PI);\n            }\n\n            if (M < 0.0)\n                M += 2.0 *PI;\n\n            F = 1.0;\n            if (M > PI)\n                F = -1.0;\n\n            if (M > PI)\n                M = 2.0 *PI - M;\n\n            float E = PI / 2.0;\n            float scale = PI / 4.0;\n\n            for (int i =0; i<23; i++)\n            {\n                float R = E - e *sin(E);\n                if (M > R)\n                    E += scale;\n                else\n                    E -= scale;\n                scale /= 2.0;\n            }\n\n            E = E * F;\n\n            float v = 2.0 * atan(sqrt((1.0 + e) / (1.0 -e )) * tan(E/2.0));\n            float r = a * (1.0-e * cos(E));\n\n            vec4 pnt;\n            pnt.x = r * abc.x * sin(ABC.x + w + v);\n            pnt.z = r * abc.y * sin(ABC.y + w + v);\n            pnt.y = r * abc.z * sin(ABC.z + w + v);\n            pnt.w = 1.0;\n\n            float dist = distance(pnt.xyz, cameraPosition.xyz);\n            gl_Position = uPMatrix * uMVMatrix * pnt;\n            vColor.a = opacity * (1.0-(orbit.x));\n            vColor.r = Color.r;\n            vColor.g = Color.g;\n            vColor.b = Color.b;\n            gl_PointSize = max(minSize, scaling * (PointSize / dist));\n        }\n    "),t.compileShader(KeplerPointSpriteShader._vert),t.getShaderParameter(KeplerPointSpriteShader._vert,WEBGL.COMPILE_STATUS),t.getShaderInfoLog(KeplerPointSpriteShader._vert),KeplerPointSpriteShader._prog=t.createProgram(),t.attachShader(KeplerPointSpriteShader._prog,KeplerPointSpriteShader._vert),t.attachShader(KeplerPointSpriteShader._prog,KeplerPointSpriteShader._frag),t.linkProgram(KeplerPointSpriteShader._prog),t.getProgramParameter(KeplerPointSpriteShader._prog,WEBGL.LINK_STATUS),t.useProgram(KeplerPointSpriteShader._prog),KeplerPointSpriteShader.abcLoc1=t.getAttribLocation(KeplerPointSpriteShader._prog,"abc"),KeplerPointSpriteShader.abcLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"ABC"),KeplerPointSpriteShader.pointSizeLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"PointSize"),KeplerPointSpriteShader.colorLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"Color"),KeplerPointSpriteShader.weLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"we"),KeplerPointSpriteShader.nTLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"nT"),KeplerPointSpriteShader.azLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"az"),KeplerPointSpriteShader.orbitLoc=t.getAttribLocation(KeplerPointSpriteShader._prog,"orbit"),KeplerPointSpriteShader.projMatLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"uPMatrix"),KeplerPointSpriteShader.mvMatLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"uMVMatrix"),KeplerPointSpriteShader.jNowLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"jNow"),KeplerPointSpriteShader.cameraPosLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"cameraPosition"),KeplerPointSpriteShader.mmLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"MM"),KeplerPointSpriteShader.scaleLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"scaling"),KeplerPointSpriteShader.minSizeLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"minSize"),KeplerPointSpriteShader.lineColorLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"lineColor"),KeplerPointSpriteShader.opacityLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"opacity"),KeplerPointSpriteShader.sampLoc=t.getUniformLocation(KeplerPointSpriteShader._prog,"uSampler"),t.enable(WEBGL.BLEND),KeplerPointSpriteShader.initialized=!0},KeplerPointSpriteShader.use=function(e,t,i,r,n,s,a,o,l,h,c,u){null==r&&(r=Texture.getEmpty());var d=e.gl;null!=d&&(KeplerPointSpriteShader.initialized||KeplerPointSpriteShader.init(e),d.useProgram(KeplerPointSpriteShader._prog),d.uniformMatrix4fv(KeplerPointSpriteShader.mvMatLoc,!1,t.floatArray()),d.uniformMatrix4fv(KeplerPointSpriteShader.projMatLoc,!1,e.get_projection().floatArray()),d.uniform1i(KeplerPointSpriteShader.sampLoc,0),d.uniform1f(KeplerPointSpriteShader.jNowLoc,o),d.uniform1f(KeplerPointSpriteShader.mmLoc,l),d.uniform4f(KeplerPointSpriteShader.lineColorLoc,n.r/255,n.g/255,n.b/255,n.a/255),d.uniform1f(KeplerPointSpriteShader.opacityLoc,s),d.uniform3f(KeplerPointSpriteShader.cameraPosLoc,h.x,h.y,h.z),d.uniform1f(KeplerPointSpriteShader.scaleLoc,c),d.uniform1f(KeplerPointSpriteShader.minSizeLoc,u),a?d.enable(WEBGL.DEPTH_TEST):d.disable(WEBGL.DEPTH_TEST),d.disableVertexAttribArray(0),d.disableVertexAttribArray(1),d.disableVertexAttribArray(2),d.disableVertexAttribArray(3),d.bindBuffer(WEBGL.ARRAY_BUFFER,i),d.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),d.enableVertexAttribArray(KeplerPointSpriteShader.abcLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.abcLoc1),d.enableVertexAttribArray(KeplerPointSpriteShader.colorLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.pointSizeLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.weLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.nTLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.azLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.orbitLoc),d.enableVertexAttribArray(KeplerPointSpriteShader.weLoc),d.vertexAttribPointer(KeplerPointSpriteShader.abcLoc,3,WEBGL.FLOAT,!1,76,0),d.vertexAttribPointer(KeplerPointSpriteShader.abcLoc1,3,WEBGL.FLOAT,!1,76,12),d.vertexAttribPointer(KeplerPointSpriteShader.pointSizeLoc,1,WEBGL.FLOAT,!1,76,24),d.vertexAttribPointer(KeplerPointSpriteShader.colorLoc,4,WEBGL.FLOAT,!1,76,28),d.vertexAttribPointer(KeplerPointSpriteShader.weLoc,2,WEBGL.FLOAT,!1,76,44),d.vertexAttribPointer(KeplerPointSpriteShader.nTLoc,2,WEBGL.FLOAT,!1,76,52),d.vertexAttribPointer(KeplerPointSpriteShader.azLoc,2,WEBGL.FLOAT,!1,76,60),d.vertexAttribPointer(KeplerPointSpriteShader.orbitLoc,2,WEBGL.FLOAT,!1,76,68),d.activeTexture(WEBGL.TEXTURE0),d.bindTexture(WEBGL.TEXTURE_2D,r),d.lineWidth(1),d.enable(WEBGL.BLEND),d.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE))};var KeplerPointSpriteShader$={};function EllipseShader(){}registerType("KeplerPointSpriteShader",[KeplerPointSpriteShader,KeplerPointSpriteShader$,null]),EllipseShader.angleLoc=0,EllipseShader.initialized=!1,EllipseShader._prog=null,EllipseShader.init=function(e){var t=e.gl;EllipseShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(EllipseShader._frag,"        precision mediump float;\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            gl_FragColor = vColor;\n        }\n    "),t.compileShader(EllipseShader._frag),t.getShaderParameter(EllipseShader._frag,WEBGL.COMPILE_STATUS),EllipseShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(EllipseShader._vert,"        attribute vec3 Angle;\n        uniform mat4 matWVP;\n        uniform mat4 matPosition;\n        uniform vec3 positionNow;\n        uniform float semiMajorAxis;\n        uniform float eccentricity;\n        uniform vec4 color;\n        uniform float eccentricAnomaly;\n        varying lowp vec4 vColor;\n\n        void main(void)\n        {\n            float fade = (1.0 - Angle.x);\n            float PI = 3.1415927;\n            float E = eccentricAnomaly - Angle.x * 2.0 * PI;\n            vec2 semiAxes = vec2(1.0, sqrt(1.0 - eccentricity * eccentricity)) * semiMajorAxis;\n            vec2 planePos = semiAxes * vec2(cos(E) - eccentricity, sin(E));\n\n            if (Angle.x == 0.0)\n                gl_Position =  matPosition * vec4(positionNow, 1.0);\n            else\n                gl_Position = matWVP * vec4(planePos.x, planePos.y, 0.0, 1.0);\n\n            vColor = vec4(color.rgb, fade * color.a);\n        }\n    "),t.compileShader(EllipseShader._vert),t.getShaderParameter(EllipseShader._vert,WEBGL.COMPILE_STATUS),t.getShaderInfoLog(EllipseShader._vert),EllipseShader._prog=t.createProgram(),t.attachShader(EllipseShader._prog,EllipseShader._vert),t.attachShader(EllipseShader._prog,EllipseShader._frag),t.linkProgram(EllipseShader._prog),t.getProgramParameter(EllipseShader._prog,WEBGL.LINK_STATUS),t.useProgram(EllipseShader._prog),EllipseShader.angleLoc=t.getAttribLocation(EllipseShader._prog,"Angle"),EllipseShader.matWVPLoc=t.getUniformLocation(EllipseShader._prog,"matWVP"),EllipseShader.matPositionLoc=t.getUniformLocation(EllipseShader._prog,"matPosition"),EllipseShader.positionNowLoc=t.getUniformLocation(EllipseShader._prog,"positionNow"),EllipseShader.colorLoc=t.getUniformLocation(EllipseShader._prog,"color"),EllipseShader.semiMajorAxisLoc=t.getUniformLocation(EllipseShader._prog,"semiMajorAxis"),EllipseShader.eccentricityLoc=t.getUniformLocation(EllipseShader._prog,"eccentricity"),EllipseShader.eccentricAnomalyLoc=t.getUniformLocation(EllipseShader._prog,"eccentricAnomaly"),t.enable(WEBGL.BLEND),EllipseShader.initialized=!0},EllipseShader.use=function(e,t,i,r,n,s,a,o){var l=e.gl;if(null!=l){EllipseShader.initialized||EllipseShader.init(e),l.useProgram(EllipseShader._prog);var h=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(a,e.get_view()),e.get_projection()),c=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(e.get_world(),e.get_view()),e.get_projection());l.uniformMatrix4fv(EllipseShader.matWVPLoc,!1,c.floatArray()),l.uniformMatrix4fv(EllipseShader.matPositionLoc,!1,h.floatArray()),l.uniform3f(EllipseShader.positionNowLoc,o.x,o.y,o.z),l.uniform4f(EllipseShader.colorLoc,n.r/255,n.g/255,n.b/255,n.a/255),l.uniform1f(EllipseShader.semiMajorAxisLoc,t),l.uniform1f(EllipseShader.eccentricityLoc,i),l.uniform1f(EllipseShader.eccentricAnomalyLoc,r),l.disable(WEBGL.DEPTH_TEST),l.disableVertexAttribArray(0),l.disableVertexAttribArray(1),l.disableVertexAttribArray(2),l.disableVertexAttribArray(3),l.enableVertexAttribArray(EllipseShader.angleLoc),l.vertexAttribPointer(EllipseShader.angleLoc,3,WEBGL.FLOAT,!1,0,0),l.lineWidth(1),l.enable(WEBGL.BLEND),l.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE)}};var EllipseShader$={};function ModelShader(){}registerType("EllipseShader",[EllipseShader,EllipseShader$,null]),ModelShader.vertLoc=0,ModelShader.normalLoc=0,ModelShader.textureLoc=0,ModelShader.initialized=!1,ModelShader._prog=null,ModelShader.sunPosition=Vector3d.create(-1,-1,-1),ModelShader.minLightingBrightness=1,ModelShader.atmosphereColor=Color.fromArgb(0,0,0,0),ModelShader.init=function(e){var t=e.gl;ModelShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(ModelShader._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        uniform sampler2D uSampler;\n        uniform float opacity;\n        uniform vec3 uSunPosition;\n        uniform float uMinBrightness;\n        uniform vec3 uAtmosphereColor;\n\n        void main(void) {\n            vec3 normal = normalize(vNormal);\n            vec3 camVN = normalize(vCamVector);\n            vec3 cam = normalize(vec3(0.0,0.0,-1.0));\n            float dt = uMinBrightness + pow(max(0.0,- dot(normal,uSunPosition)),0.5);\n            float atm = max(0.0, 1.0 - 2.5 * dot(cam,camVN)) + 0.3 * dt;\n            atm = (dt > uMinBrightness) ? atm : 0.0;\n            if ( uMinBrightness == 1.0 ) { dt = 1.0; atm= 0.0; }\n            vec4 col = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n            gl_FragColor = col * opacity;\n            gl_FragColor.rgb *= dt;\n            gl_FragColor.rgb += atm * uAtmosphereColor;\n        }\n    "),t.compileShader(ModelShader._frag),t.getShaderParameter(ModelShader._frag,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ModelShader._frag),ModelShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(ModelShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec3 aNormal;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vCamVector = normalize((mat3(uMVMatrix) * aVertexPosition).xyz);\n            vec3 normalT = normalize(mat3(uMVMatrix) * aNormal);\n            vTextureCoord = aTextureCoord;\n            vNormal = normalT;\n        }\n    "),t.compileShader(ModelShader._vert),t.getShaderParameter(ModelShader._vert,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ModelShader._vert),ModelShader._prog=t.createProgram(),t.attachShader(ModelShader._prog,ModelShader._vert),t.attachShader(ModelShader._prog,ModelShader._frag),t.linkProgram(ModelShader._prog),t.getProgramParameter(ModelShader._prog,WEBGL.LINK_STATUS),t.useProgram(ModelShader._prog),ModelShader.vertLoc=t.getAttribLocation(ModelShader._prog,"aVertexPosition"),ModelShader.normalLoc=t.getAttribLocation(ModelShader._prog,"aNormal"),ModelShader.textureLoc=t.getAttribLocation(ModelShader._prog,"aTextureCoord"),ModelShader.projMatLoc=t.getUniformLocation(ModelShader._prog,"uPMatrix"),ModelShader.mvMatLoc=t.getUniformLocation(ModelShader._prog,"uMVMatrix"),ModelShader.sampLoc=t.getUniformLocation(ModelShader._prog,"uSampler"),ModelShader.sunLoc=t.getUniformLocation(ModelShader._prog,"uSunPosition"),ModelShader.minBrightnessLoc=t.getUniformLocation(ModelShader._prog,"uMinBrightness"),ModelShader.opacityLoc=t.getUniformLocation(ModelShader._prog,"opacity"),ModelShader.atmosphereColorLoc=t.getUniformLocation(ModelShader._prog,"uAtmosphereColor"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),ModelShader.initialized=!0},ModelShader.use=function(e,t,i,r,n,s,a){null==r&&(r=Texture.getEmpty());var o=e.gl;if(null!=o){ModelShader.initialized||ModelShader.init(e),o.useProgram(ModelShader._prog);var l=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());o.uniform1f(ModelShader.opacityLoc,n),o.uniform1f(ModelShader.minBrightnessLoc,e.lighting?ModelShader.minLightingBrightness:1),e.lighting?o.uniform3f(ModelShader.atmosphereColorLoc,ModelShader.atmosphereColor.r/255,ModelShader.atmosphereColor.g/255,ModelShader.atmosphereColor.b/255):o.uniform3f(ModelShader.atmosphereColorLoc,0,0,0),o.uniformMatrix4fv(ModelShader.mvMatLoc,!1,l.floatArray()),o.uniformMatrix4fv(ModelShader.projMatLoc,!1,e.get_projection().floatArray()),ModelShader.sunPosition.normalize();var h=e.get_view().clone();h.set_m41(0),h.set_m42(0),h.set_m43(0),h.set_m44(1);var c=Vector3d._transformCoordinate(ModelShader.sunPosition,h);c.normalize(),o.uniform3f(ModelShader.sunLoc,c.x,c.y,c.z),o.uniform1i(ModelShader.sampLoc,0),e.space||s?o.disable(WEBGL.DEPTH_TEST):o.enable(WEBGL.DEPTH_TEST),o.disableVertexAttribArray(0),o.disableVertexAttribArray(1),o.disableVertexAttribArray(2),o.disableVertexAttribArray(3),o.bindBuffer(WEBGL.ARRAY_BUFFER,t),o.enableVertexAttribArray(ModelShader.vertLoc),o.enableVertexAttribArray(ModelShader.normalLoc),o.enableVertexAttribArray(ModelShader.textureLoc),o.vertexAttribPointer(ModelShader.vertLoc,3,WEBGL.FLOAT,!1,a,0),o.vertexAttribPointer(ModelShader.normalLoc,3,WEBGL.FLOAT,!1,a,12),o.vertexAttribPointer(ModelShader.textureLoc,2,WEBGL.FLOAT,!1,a,a-8),o.activeTexture(WEBGL.TEXTURE0),o.bindTexture(WEBGL.TEXTURE_2D,r),o.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),o.enable(WEBGL.BLEND),s?o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var ModelShader$={};function ModelShaderTan(){}registerType("ModelShader",[ModelShader,ModelShader$,null]),ModelShaderTan.vertLoc=0,ModelShaderTan.normalLoc=0,ModelShaderTan.textureLoc=0,ModelShaderTan.initialized=!1,ModelShaderTan._prog=null,ModelShaderTan.sunPosition=Vector3d.create(-1,-1,-1),ModelShaderTan.minLightingBrightness=1,ModelShaderTan.atmosphereColor=Color.fromArgb(0,0,0,0),ModelShaderTan.init=function(e){var t=e.gl;ModelShaderTan._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(ModelShaderTan._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        uniform sampler2D uSampler;\n        uniform float opacity;\n        uniform vec3 uSunPosition;\n        uniform float uMinBrightness;\n        uniform vec3 uAtmosphereColor;\n\n        void main(void) {\n            vec3 normal = normalize(vNormal);\n            vec3 camVN = normalize(vCamVector);\n            vec3 cam = normalize(vec3(0.0,0.0,-1.0));\n            float dt = uMinBrightness + pow(max(0.0,- dot(normal,uSunPosition)),0.5);\n            float atm = max(0.0, 1.0 - 2.5 * dot(cam,camVN)) + 0.3 * dt;\n            atm = (dt > uMinBrightness) ? atm : 0.0;\n            if ( uMinBrightness == 1.0 ) { dt = 1.0; atm= 0.0; }\n            vec4 col = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n            gl_FragColor = col * opacity;\n            gl_FragColor.rgb *= dt;\n            gl_FragColor.rgb += atm * uAtmosphereColor;\n        }\n    "),t.compileShader(ModelShaderTan._frag),t.getShaderParameter(ModelShaderTan._frag,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ModelShaderTan._frag),ModelShaderTan._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(ModelShaderTan._vert,"        attribute vec3 aVertexPosition;\n        attribute vec3 aNormal;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vCamVector = normalize((mat3(uMVMatrix) * aVertexPosition).xyz);\n            vec3 normalT = normalize(mat3(uMVMatrix) * aNormal);\n            vTextureCoord = aTextureCoord;\n            vNormal = normalT;\n        }\n    "),t.compileShader(ModelShaderTan._vert),t.getShaderParameter(ModelShaderTan._vert,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ModelShaderTan._vert),ModelShaderTan._prog=t.createProgram(),t.attachShader(ModelShaderTan._prog,ModelShaderTan._vert),t.attachShader(ModelShaderTan._prog,ModelShaderTan._frag),t.linkProgram(ModelShaderTan._prog),t.getProgramParameter(ModelShaderTan._prog,WEBGL.LINK_STATUS),t.useProgram(ModelShaderTan._prog),ModelShaderTan.vertLoc=t.getAttribLocation(ModelShaderTan._prog,"aVertexPosition"),ModelShaderTan.normalLoc=t.getAttribLocation(ModelShaderTan._prog,"aNormal"),ModelShaderTan.textureLoc=t.getAttribLocation(ModelShaderTan._prog,"aTextureCoord"),ModelShaderTan.projMatLoc=t.getUniformLocation(ModelShaderTan._prog,"uPMatrix"),ModelShaderTan.mvMatLoc=t.getUniformLocation(ModelShaderTan._prog,"uMVMatrix"),ModelShaderTan.sampLoc=t.getUniformLocation(ModelShaderTan._prog,"uSampler"),ModelShaderTan.sunLoc=t.getUniformLocation(ModelShaderTan._prog,"uSunPosition"),ModelShaderTan.minBrightnessLoc=t.getUniformLocation(ModelShaderTan._prog,"uMinBrightness"),ModelShaderTan.opacityLoc=t.getUniformLocation(ModelShaderTan._prog,"opacity"),ModelShaderTan.atmosphereColorLoc=t.getUniformLocation(ModelShaderTan._prog,"uAtmosphereColor"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),ModelShaderTan.initialized=!0},ModelShaderTan.use=function(e,t,i,r,n,s,a){null==r&&(r=Texture.getEmpty());var o=e.gl;if(null!=o){ModelShaderTan.initialized||ModelShaderTan.init(e),o.useProgram(ModelShaderTan._prog);var l=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());o.uniform1f(ModelShaderTan.opacityLoc,n),o.uniform1f(ModelShaderTan.minBrightnessLoc,e.lighting?ModelShaderTan.minLightingBrightness:1),e.lighting?o.uniform3f(ModelShaderTan.atmosphereColorLoc,ModelShaderTan.atmosphereColor.r/255,ModelShaderTan.atmosphereColor.g/255,ModelShaderTan.atmosphereColor.b/255):o.uniform3f(ModelShaderTan.atmosphereColorLoc,0,0,0),o.uniformMatrix4fv(ModelShaderTan.mvMatLoc,!1,l.floatArray()),o.uniformMatrix4fv(ModelShaderTan.projMatLoc,!1,e.get_projection().floatArray()),ModelShaderTan.sunPosition.normalize();var h=e.get_view().clone();h.set_m41(0),h.set_m42(0),h.set_m43(0),h.set_m44(1);var c=Vector3d._transformCoordinate(ModelShaderTan.sunPosition,h);c.normalize(),o.uniform3f(ModelShaderTan.sunLoc,-c.x,-c.y,-c.z),o.uniform1i(ModelShaderTan.sampLoc,0),e.space||s?o.disable(WEBGL.DEPTH_TEST):o.enable(WEBGL.DEPTH_TEST),o.disableVertexAttribArray(0),o.disableVertexAttribArray(1),o.disableVertexAttribArray(2),o.disableVertexAttribArray(3),o.bindBuffer(WEBGL.ARRAY_BUFFER,t),o.enableVertexAttribArray(ModelShaderTan.vertLoc),o.enableVertexAttribArray(ModelShaderTan.normalLoc),o.enableVertexAttribArray(ModelShaderTan.textureLoc),o.vertexAttribPointer(ModelShaderTan.vertLoc,3,WEBGL.FLOAT,!1,a,0),o.vertexAttribPointer(ModelShaderTan.normalLoc,3,WEBGL.FLOAT,!1,a,12),o.vertexAttribPointer(ModelShaderTan.textureLoc,2,WEBGL.FLOAT,!1,a,a-8),o.activeTexture(WEBGL.TEXTURE0),o.bindTexture(WEBGL.TEXTURE_2D,r),o.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),o.enable(WEBGL.BLEND),s?o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var ModelShaderTan$={};function TileShader(){}registerType("ModelShaderTan",[ModelShaderTan,ModelShaderTan$,null]),TileShader.vertLoc=0,TileShader.textureLoc=0,TileShader.initialized=!1,TileShader._prog=null,TileShader.sunPosition=Vector3d.create(-1,-1,-1),TileShader.minLightingBrightness=1,TileShader.atmosphereColor=Color.fromArgb(0,0,0,0),TileShader.init=function(e){var t=e.gl;TileShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(TileShader._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        uniform sampler2D uSampler;\n        uniform float opacity;\n        uniform vec3 uSunPosition;\n        uniform float uMinBrightness;\n        uniform vec3 uAtmosphereColor;\n\n        void main(void) {\n            vec3 normal = normalize(vNormal);\n            vec3 camVN = normalize(vCamVector);\n            vec3 cam = normalize(vec3(0.0,0.0,-1.0));\n            float dt = uMinBrightness + pow(max(0.0,- dot(normal,uSunPosition)),0.5);\n            float atm = max(0.0, 1.0 - 2.5 * dot(cam,camVN)) + 0.3 * dt;\n            atm = (dt > uMinBrightness) ? atm : 0.0;\n            if ( uMinBrightness == 1.0 ) { dt = 1.0; atm = 0.0; }\n            vec4 col = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n            gl_FragColor = col * opacity;\n            gl_FragColor.rgb *= dt;\n            gl_FragColor.rgb += atm * uAtmosphereColor;\n        }\n    "),t.compileShader(TileShader._frag),t.getShaderParameter(TileShader._frag,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(TileShader._frag),TileShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(TileShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform vec3 uCenterScreen;\n        uniform vec3 uCenterWorld;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        void main(void) {\n            vec3 normal;\n\n            if (length(uCenterWorld) > 0.00001) {\n                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 0.0) + vec4(uCenterScreen, 1.0);\n                vCamVector = normalize((mat3(uMVMatrix) * (aVertexPosition + uCenterWorld)).xyz);\n                normal = normalize(aVertexPosition + uCenterWorld);\n            } else {\n                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n                vCamVector = normalize((mat3(uMVMatrix) * aVertexPosition).xyz);\n                normal = normalize(aVertexPosition);\n            }\n\n            vec3 normalT = normalize(mat3(uMVMatrix) * normal);\n            vTextureCoord = aTextureCoord;\n            vNormal = normalT;\n        }\n    "),t.compileShader(TileShader._vert),t.getShaderParameter(TileShader._vert,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(TileShader._vert),TileShader._prog=t.createProgram(),t.attachShader(TileShader._prog,TileShader._vert),t.attachShader(TileShader._prog,TileShader._frag),t.linkProgram(TileShader._prog),t.getProgramParameter(TileShader._prog,WEBGL.LINK_STATUS),t.useProgram(TileShader._prog),TileShader.vertLoc=t.getAttribLocation(TileShader._prog,"aVertexPosition"),TileShader.textureLoc=t.getAttribLocation(TileShader._prog,"aTextureCoord"),TileShader.projMatLoc=t.getUniformLocation(TileShader._prog,"uPMatrix"),TileShader.mvMatLoc=t.getUniformLocation(TileShader._prog,"uMVMatrix"),TileShader.sampLoc=t.getUniformLocation(TileShader._prog,"uSampler"),TileShader.centerScreenLoc=t.getUniformLocation(TileShader._prog,"uCenterScreen"),TileShader.centerWorldLoc=t.getUniformLocation(TileShader._prog,"uCenterWorld"),TileShader.sunLoc=t.getUniformLocation(TileShader._prog,"uSunPosition"),TileShader.minBrightnessLoc=t.getUniformLocation(TileShader._prog,"uMinBrightness"),TileShader.opacityLoc=t.getUniformLocation(TileShader._prog,"opacity"),TileShader.atmosphereColorLoc=t.getUniformLocation(TileShader._prog,"uAtmosphereColor"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),TileShader.initialized=!0},TileShader.use=function(e,t,i,r,n,s,a){null==r&&(r=Texture.getEmpty());var o=e.gl;if(null!=o){TileShader.initialized||TileShader.init(e),o.useProgram(TileShader._prog);var l=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());if(o.uniform1f(TileShader.opacityLoc,n),o.uniform1f(TileShader.minBrightnessLoc,e.lighting?TileShader.minLightingBrightness:1),e.lighting?o.uniform3f(TileShader.atmosphereColorLoc,TileShader.atmosphereColor.r/255,TileShader.atmosphereColor.g/255,TileShader.atmosphereColor.b/255):o.uniform3f(TileShader.atmosphereColorLoc,0,0,0),o.uniform3f(TileShader.centerWorldLoc,a.x,a.y,a.z),a.lengthSq()>.001){var h=Matrix3d.multiplyMatrix(l,e.get_projection()).transform(a);o.uniform3f(TileShader.centerScreenLoc,h.x,h.y,h.z)}else o.uniform3f(TileShader.centerScreenLoc,0,0,0);o.uniformMatrix4fv(TileShader.mvMatLoc,!1,l.floatArray()),o.uniformMatrix4fv(TileShader.projMatLoc,!1,e.get_projection().floatArray()),TileShader.sunPosition.normalize();var c=e.get_view().clone();c.set_m41(0),c.set_m42(0),c.set_m43(0),c.set_m44(1);var u=Vector3d._transformCoordinate(TileShader.sunPosition,c);u.normalize(),o.uniform3f(TileShader.sunLoc,-u.x,-u.y,-u.z),o.uniform1i(TileShader.sampLoc,0),e.space||s?o.disable(WEBGL.DEPTH_TEST):o.enable(WEBGL.DEPTH_TEST),o.disableVertexAttribArray(0),o.disableVertexAttribArray(1),o.disableVertexAttribArray(2),o.disableVertexAttribArray(3),o.bindBuffer(WEBGL.ARRAY_BUFFER,t),o.enableVertexAttribArray(TileShader.vertLoc),o.enableVertexAttribArray(TileShader.textureLoc),o.vertexAttribPointer(TileShader.vertLoc,3,WEBGL.FLOAT,!1,20,0),o.vertexAttribPointer(TileShader.textureLoc,2,WEBGL.FLOAT,!1,20,12),o.activeTexture(WEBGL.TEXTURE0),o.bindTexture(WEBGL.TEXTURE_2D,r),o.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),o.enable(WEBGL.BLEND),s?o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var TileShader$={};function FitsShader(){}registerType("TileShader",[TileShader,TileShader$,null]),FitsShader.vertLoc=0,FitsShader.textureLoc=0,FitsShader.initialized=!1,FitsShader._prog=null,FitsShader.blankValue=0,FitsShader.bScale=1,FitsShader.bZero=0,FitsShader.min=0,FitsShader.max=0,FitsShader.transparentBlack=!1,FitsShader.containsBlanks=!1,FitsShader.scaleType=0,FitsShader.init=function(e){var t=e.gl;if(FitsShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(FitsShader._frag,'        #version 300 es\n\n        precision mediump float;\n        in vec2 vTextureCoord;\n        in vec3 vNormal;\n        in vec3 vCamVector;\n        out vec4 fragmentColor;\n\n        uniform sampler2D uSampler;\n        uniform sampler2D colorSampler;\n        uniform float blank;\n        uniform float bzero;\n        uniform float bscale;\n        uniform float min;\n        uniform float max;\n        uniform bool containsBlanks;\n        uniform bool transparentBlack;\n        uniform int scaleType;\n        uniform float opacity;\n\n        bool isNaN(float value) {\n            // See https://stackoverflow.com/questions/9446888/best-way-to-detect-nans-in-opengl-shaders\n            // PKGW also finds that we need "value != value" on his Dell laptop running\n            // Chrome on Linux.\n            return (value != value) || !(value < 0.0 || 0.0 < value || value == 0.0);\n        }\n\n        void main(void) {\n            //FITS images are flipped on the y axis\n            vec4 color = texture(uSampler, vec2(vTextureCoord.x, 1.0 - vTextureCoord.y));\n\n            if(isNaN(color.r) || (containsBlanks && abs(blank - color.r) < 0.00000001)){\n                fragmentColor = vec4(0.0, 0.0, 0.0, 0.0);\n            } else {\n                float physicalValue = (bzero + bscale * color.r - min) / (max - min);\n                if(transparentBlack && physicalValue <= 0.0){\n                    fragmentColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    return;\n                }\n\n                physicalValue = clamp(physicalValue, 0.0, 1.0);\n\n                switch(scaleType){\n                    case 1:\n                        physicalValue = log(physicalValue * 255.0 + 1.0 ) / log(256.0);\n                        break;\n                    case 2:\n                        physicalValue = physicalValue * physicalValue;\n                        break;\n                    case 3:\n                        physicalValue = sqrt(physicalValue);\n                        break;\n                }\n                vec4 colorFromColorMapper = texture(colorSampler, vec2(physicalValue, 0.5));\n                fragmentColor = vec4(colorFromColorMapper.rgb, opacity);\n            }\n        }\n    '),t.compileShader(FitsShader._frag),!t.getShaderParameter(FitsShader._frag,WEBGL.COMPILE_STATUS)){var i=t.getShaderInfoLog(FitsShader._frag);console.log(i)}if(FitsShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(FitsShader._vert,"        #version 300 es\n\n        in vec3 aVertexPosition;\n        in vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n        uniform vec3 uCenterScreen;\n\n        out vec2 vTextureCoord;\n\n        void main(void) {\n            if(length(uCenterScreen) > 0.0000001) {\n                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 0.0) + vec4(uCenterScreen, 1.0);\n            } else {\n                gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            }\n\n            vTextureCoord = aTextureCoord;\n        }\n    "),t.compileShader(FitsShader._vert),!t.getShaderParameter(FitsShader._vert,WEBGL.COMPILE_STATUS)){var r=t.getShaderInfoLog(FitsShader._vert);console.log(r)}FitsShader._prog=t.createProgram(),t.attachShader(FitsShader._prog,FitsShader._vert),t.attachShader(FitsShader._prog,FitsShader._frag),t.linkProgram(FitsShader._prog),t.getProgramParameter(FitsShader._prog,WEBGL.LINK_STATUS),t.useProgram(FitsShader._prog),FitsShader.vertLoc=t.getAttribLocation(FitsShader._prog,"aVertexPosition"),FitsShader.textureLoc=t.getAttribLocation(FitsShader._prog,"aTextureCoord"),FitsShader.projMatLoc=t.getUniformLocation(FitsShader._prog,"uPMatrix"),FitsShader.mvMatLoc=t.getUniformLocation(FitsShader._prog,"uMVMatrix"),FitsShader.sampLoc=t.getUniformLocation(FitsShader._prog,"uSampler"),FitsShader.colorLoc=t.getUniformLocation(FitsShader._prog,"colorSampler"),FitsShader.centerScreenLoc=t.getUniformLocation(FitsShader._prog,"uCenterScreen"),FitsShader.blank=t.getUniformLocation(FitsShader._prog,"blank"),FitsShader.bzero=t.getUniformLocation(FitsShader._prog,"bzero"),FitsShader.bscale=t.getUniformLocation(FitsShader._prog,"bscale"),FitsShader.minLoc=t.getUniformLocation(FitsShader._prog,"min"),FitsShader.maxLoc=t.getUniformLocation(FitsShader._prog,"max"),FitsShader.transparentBlackLoc=t.getUniformLocation(FitsShader._prog,"transparentBlack"),FitsShader.containsBlanksLoc=t.getUniformLocation(FitsShader._prog,"containsBlanks"),FitsShader.scalingLocation=t.getUniformLocation(FitsShader._prog,"scaleType"),FitsShader.opacityLoc=t.getUniformLocation(FitsShader._prog,"opacity"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),FitsShader.initialized=!0},FitsShader.use=function(e,t,i,r,n,s,a){null==r&&(r=Texture.getEmpty());var o=e.gl;if(null!=o){FitsShader.initialized||FitsShader.init(e),o.useProgram(FitsShader._prog);var l=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());if(o.uniform1f(FitsShader.opacityLoc,n),o.uniformMatrix4fv(FitsShader.mvMatLoc,!1,l.floatArray()),o.uniformMatrix4fv(FitsShader.projMatLoc,!1,e.get_projection().floatArray()),a.lengthSq()>.001){var h=Matrix3d.multiplyMatrix(l,e.get_projection()).transform(a);o.uniform3f(FitsShader.centerScreenLoc,h.x,h.y,h.z)}else o.uniform3f(FitsShader.centerScreenLoc,0,0,0);o.uniform1i(FitsShader.sampLoc,0),o.uniform1i(FitsShader.colorLoc,1),o.uniform1f(FitsShader.blank,FitsShader.blankValue),o.uniform1f(FitsShader.bzero,FitsShader.bZero),o.uniform1f(FitsShader.bscale,FitsShader.bScale),o.uniform1f(FitsShader.minLoc,FitsShader.min),o.uniform1f(FitsShader.maxLoc,FitsShader.max),o.uniform1i(FitsShader.transparentBlackLoc,FitsShader.transparentBlack),o.uniform1i(FitsShader.containsBlanksLoc,FitsShader.containsBlanks),o.uniform1i(FitsShader.scalingLocation,FitsShader.scaleType),e.space||s?o.disable(WEBGL.DEPTH_TEST):o.enable(WEBGL.DEPTH_TEST),o.disableVertexAttribArray(0),o.disableVertexAttribArray(1),o.disableVertexAttribArray(2),o.disableVertexAttribArray(3),o.bindBuffer(WEBGL.ARRAY_BUFFER,t),o.enableVertexAttribArray(FitsShader.vertLoc),o.enableVertexAttribArray(FitsShader.textureLoc),o.vertexAttribPointer(FitsShader.vertLoc,3,WEBGL.FLOAT,!1,20,0),o.vertexAttribPointer(FitsShader.textureLoc,2,WEBGL.FLOAT,!1,20,12),o.activeTexture(WEBGL.TEXTURE0),o.bindTexture(WEBGL.TEXTURE_2D,r),o.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),o.enable(WEBGL.BLEND),s?o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):o.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var FitsShader$={};function ImageShader(){}registerType("FitsShader",[FitsShader,FitsShader$,null]),ImageShader.vertLoc=0,ImageShader.textureLoc=0,ImageShader.initialized=!1,ImageShader._prog=null,ImageShader.init=function(e){var t=e.gl;ImageShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(ImageShader._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n\n        uniform sampler2D uSampler;\n        uniform float opacity;\n\n        void main(void) {\n            vec4 col = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n            gl_FragColor = col * opacity;\n        }\n    "),t.compileShader(ImageShader._frag),t.getShaderParameter(ImageShader._frag,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ImageShader._frag),ImageShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(ImageShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vTextureCoord = aTextureCoord;\n        }\n    "),t.compileShader(ImageShader._vert),t.getShaderParameter(ImageShader._vert,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ImageShader._vert),ImageShader._prog=t.createProgram(),t.attachShader(ImageShader._prog,ImageShader._vert),t.attachShader(ImageShader._prog,ImageShader._frag),t.linkProgram(ImageShader._prog),t.getProgramParameter(ImageShader._prog,WEBGL.LINK_STATUS),t.useProgram(ImageShader._prog),ImageShader.vertLoc=t.getAttribLocation(ImageShader._prog,"aVertexPosition"),ImageShader.textureLoc=t.getAttribLocation(ImageShader._prog,"aTextureCoord"),ImageShader.projMatLoc=t.getUniformLocation(ImageShader._prog,"uPMatrix"),ImageShader.mvMatLoc=t.getUniformLocation(ImageShader._prog,"uMVMatrix"),ImageShader.sampLoc=t.getUniformLocation(ImageShader._prog,"uSampler"),ImageShader.opacityLoc=t.getUniformLocation(ImageShader._prog,"opacity"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),ImageShader.initialized=!0},ImageShader.use=function(e,t,i,r,n,s){null==r&&(r=Texture.getEmpty());var a=e.gl;if(null!=a){ImageShader.initialized||ImageShader.init(e),a.useProgram(ImageShader._prog);var o=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());a.uniform1f(ImageShader.opacityLoc,n),a.uniformMatrix4fv(ImageShader.mvMatLoc,!1,o.floatArray()),a.uniformMatrix4fv(ImageShader.projMatLoc,!1,e.get_projection().floatArray()),a.uniform1i(ImageShader.sampLoc,0),e.space||s?a.disable(WEBGL.DEPTH_TEST):a.enable(WEBGL.DEPTH_TEST),a.disableVertexAttribArray(0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.bindBuffer(WEBGL.ARRAY_BUFFER,t),a.enableVertexAttribArray(ImageShader.vertLoc),a.enableVertexAttribArray(ImageShader.textureLoc),a.vertexAttribPointer(ImageShader.vertLoc,3,WEBGL.FLOAT,!1,20,0),a.vertexAttribPointer(ImageShader.textureLoc,2,WEBGL.FLOAT,!1,20,12),a.activeTexture(WEBGL.TEXTURE0),a.bindTexture(WEBGL.TEXTURE_2D,r),a.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),a.enable(WEBGL.BLEND),s?a.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):a.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var ImageShader$={};function ImageShader2(){}registerType("ImageShader",[ImageShader,ImageShader$,null]),ImageShader2.vertLoc=0,ImageShader2.textureLoc=0,ImageShader2.initialized=!1,ImageShader2._prog=null,ImageShader2.init=function(e){var t=e.gl;ImageShader2._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(ImageShader2._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n\n        uniform sampler2D uSampler;\n        uniform float opacity;\n\n        void main(void) {\n            vec4 col = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n            gl_FragColor = col * opacity;\n        }\n    "),t.compileShader(ImageShader2._frag),t.getShaderParameter(ImageShader2._frag,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ImageShader2._frag),ImageShader2._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(ImageShader2._vert,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec3 vNormal;\n        varying vec3 vCamVector;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vTextureCoord = aTextureCoord;\n        }\n    "),t.compileShader(ImageShader2._vert),t.getShaderParameter(ImageShader2._vert,WEBGL.COMPILE_STATUS)||t.getShaderInfoLog(ImageShader2._vert),ImageShader2._prog=t.createProgram(),t.attachShader(ImageShader2._prog,ImageShader2._vert),t.attachShader(ImageShader2._prog,ImageShader2._frag),t.linkProgram(ImageShader2._prog),t.getProgramParameter(ImageShader2._prog,WEBGL.LINK_STATUS),t.useProgram(ImageShader2._prog),ImageShader2.vertLoc=t.getAttribLocation(ImageShader2._prog,"aVertexPosition"),ImageShader2.textureLoc=t.getAttribLocation(ImageShader2._prog,"aTextureCoord"),ImageShader2.projMatLoc=t.getUniformLocation(ImageShader2._prog,"uPMatrix"),ImageShader2.mvMatLoc=t.getUniformLocation(ImageShader2._prog,"uMVMatrix"),ImageShader2.sampLoc=t.getUniformLocation(ImageShader2._prog,"uSampler"),ImageShader2.opacityLoc=t.getUniformLocation(ImageShader2._prog,"opacity"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),ImageShader2.initialized=!0},ImageShader2.use=function(e,t,i,r,n,s){null==r&&(r=Texture.getEmpty());var a=e.gl;if(null!=a){ImageShader2.initialized||ImageShader2.init(e),a.useProgram(ImageShader2._prog);var o=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());a.uniform1f(ImageShader2.opacityLoc,n),a.uniformMatrix4fv(ImageShader2.mvMatLoc,!1,o.floatArray()),a.uniformMatrix4fv(ImageShader2.projMatLoc,!1,e.get_projection().floatArray()),a.uniform1i(ImageShader2.sampLoc,0),e.space||s?a.disable(WEBGL.DEPTH_TEST):a.enable(WEBGL.DEPTH_TEST),a.disableVertexAttribArray(0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.bindBuffer(WEBGL.ARRAY_BUFFER,t),a.enableVertexAttribArray(ImageShader2.vertLoc),a.enableVertexAttribArray(ImageShader2.textureLoc),a.vertexAttribPointer(ImageShader2.vertLoc,3,WEBGL.FLOAT,!1,32,0),a.vertexAttribPointer(ImageShader2.textureLoc,2,WEBGL.FLOAT,!1,32,24),a.activeTexture(WEBGL.TEXTURE0),a.bindTexture(WEBGL.TEXTURE_2D,r),a.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,i),a.enable(WEBGL.BLEND),s?a.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE):a.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var ImageShader2$={};function SpriteShader(){}registerType("ImageShader2",[ImageShader2,ImageShader2$,null]),SpriteShader.vertLoc=0,SpriteShader.textureLoc=0,SpriteShader.colorLoc=0,SpriteShader.initialized=!1,SpriteShader._prog=null,SpriteShader.init=function(e){var t=e.gl;SpriteShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(SpriteShader._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n        varying lowp vec4 vColor;\n        uniform sampler2D uSampler;\n\n        void main(void) {\n            gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * vColor;\n        }\n    "),t.compileShader(SpriteShader._frag),t.getShaderParameter(SpriteShader._frag,WEBGL.COMPILE_STATUS),SpriteShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(SpriteShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n        attribute lowp vec4 aColor;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vTextureCoord = aTextureCoord;\n            vColor = aColor;\n        }\n    "),t.compileShader(SpriteShader._vert),t.getShaderParameter(SpriteShader._vert,WEBGL.COMPILE_STATUS),SpriteShader._prog=t.createProgram(),t.attachShader(SpriteShader._prog,SpriteShader._vert),t.attachShader(SpriteShader._prog,SpriteShader._frag),t.linkProgram(SpriteShader._prog),t.getProgramParameter(SpriteShader._prog,WEBGL.LINK_STATUS),t.useProgram(SpriteShader._prog),SpriteShader.vertLoc=t.getAttribLocation(SpriteShader._prog,"aVertexPosition"),SpriteShader.textureLoc=t.getAttribLocation(SpriteShader._prog,"aTextureCoord"),SpriteShader.colorLoc=t.getAttribLocation(SpriteShader._prog,"aColor"),SpriteShader.projMatLoc=t.getUniformLocation(SpriteShader._prog,"uPMatrix"),SpriteShader.mvMatLoc=t.getUniformLocation(SpriteShader._prog,"uMVMatrix"),SpriteShader.sampLoc=t.getUniformLocation(SpriteShader._prog,"uSampler"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),SpriteShader.initialized=!0},SpriteShader.use=function(e,t,i){null==i&&(i=Texture.getEmpty());var r=e.gl;if(null!=r){SpriteShader.initialized||SpriteShader.init(e),r.useProgram(SpriteShader._prog);var n=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());r.uniformMatrix4fv(SpriteShader.mvMatLoc,!1,n.floatArray()),r.uniformMatrix4fv(SpriteShader.projMatLoc,!1,e.get_projection().floatArray()),r.uniform1i(SpriteShader.sampLoc,0),r.disable(WEBGL.DEPTH_TEST),r.disableVertexAttribArray(0),r.disableVertexAttribArray(1),r.disableVertexAttribArray(2),r.disableVertexAttribArray(3),r.bindBuffer(WEBGL.ARRAY_BUFFER,t),r.enableVertexAttribArray(SpriteShader.vertLoc),r.enableVertexAttribArray(SpriteShader.textureLoc),r.enableVertexAttribArray(SpriteShader.colorLoc),r.vertexAttribPointer(SpriteShader.vertLoc,3,WEBGL.FLOAT,!1,36,0),r.vertexAttribPointer(SpriteShader.colorLoc,4,WEBGL.FLOAT,!1,36,12),r.vertexAttribPointer(SpriteShader.textureLoc,2,WEBGL.FLOAT,!1,36,28),r.activeTexture(WEBGL.TEXTURE0),r.bindTexture(WEBGL.TEXTURE_2D,i),r.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),r.enable(WEBGL.BLEND),r.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var SpriteShader$={};function ShapeSpriteShader(){}registerType("SpriteShader",[SpriteShader,SpriteShader$,null]),ShapeSpriteShader.vertLoc=0,ShapeSpriteShader.textureLoc=0,ShapeSpriteShader.colorLoc=0,ShapeSpriteShader.initialized=!1,ShapeSpriteShader._prog=null,ShapeSpriteShader.init=function(e){var t=e.gl;ShapeSpriteShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(ShapeSpriteShader._frag,"        precision mediump float;\n\n        varying lowp vec4 vColor;\n\n        void main(void) {\n            gl_FragColor =  vColor;\n        }\n    "),t.compileShader(ShapeSpriteShader._frag),t.getShaderParameter(ShapeSpriteShader._frag,WEBGL.COMPILE_STATUS),ShapeSpriteShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(ShapeSpriteShader._vert,"        attribute vec3 aVertexPosition;\n        attribute lowp vec4 aColor;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n        varying vec4 vColor;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vColor = aColor;\n        }\n    "),t.compileShader(ShapeSpriteShader._vert),t.getShaderParameter(ShapeSpriteShader._vert,WEBGL.COMPILE_STATUS),ShapeSpriteShader._prog=t.createProgram(),t.attachShader(ShapeSpriteShader._prog,ShapeSpriteShader._vert),t.attachShader(ShapeSpriteShader._prog,ShapeSpriteShader._frag),t.linkProgram(ShapeSpriteShader._prog),t.getProgramParameter(ShapeSpriteShader._prog,WEBGL.LINK_STATUS),t.useProgram(ShapeSpriteShader._prog),ShapeSpriteShader.vertLoc=t.getAttribLocation(ShapeSpriteShader._prog,"aVertexPosition"),ShapeSpriteShader.colorLoc=t.getAttribLocation(ShapeSpriteShader._prog,"aColor"),ShapeSpriteShader.projMatLoc=t.getUniformLocation(ShapeSpriteShader._prog,"uPMatrix"),ShapeSpriteShader.mvMatLoc=t.getUniformLocation(ShapeSpriteShader._prog,"uMVMatrix"),t.disable(WEBGL.DEPTH_TEST),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),ShapeSpriteShader.initialized=!0},ShapeSpriteShader.use=function(e,t){var i=e.gl;if(null!=i){ShapeSpriteShader.initialized||ShapeSpriteShader.init(e),i.useProgram(ShapeSpriteShader._prog);var r=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());i.uniformMatrix4fv(ShapeSpriteShader.mvMatLoc,!1,r.floatArray()),i.uniformMatrix4fv(ShapeSpriteShader.projMatLoc,!1,e.get_projection().floatArray()),i.uniform1i(ShapeSpriteShader.sampLoc,0),i.disable(WEBGL.DEPTH_TEST),i.disableVertexAttribArray(0),i.disableVertexAttribArray(1),i.disableVertexAttribArray(2),i.disableVertexAttribArray(3),i.bindBuffer(WEBGL.ARRAY_BUFFER,t),i.enableVertexAttribArray(ShapeSpriteShader.vertLoc),i.enableVertexAttribArray(ShapeSpriteShader.textureLoc),i.enableVertexAttribArray(ShapeSpriteShader.colorLoc),i.vertexAttribPointer(ShapeSpriteShader.vertLoc,3,WEBGL.FLOAT,!1,36,0),i.vertexAttribPointer(ShapeSpriteShader.colorLoc,4,WEBGL.FLOAT,!1,36,12),i.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),i.enable(WEBGL.BLEND),i.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var ShapeSpriteShader$={};function TextShader(){}registerType("ShapeSpriteShader",[ShapeSpriteShader,ShapeSpriteShader$,null]),TextShader.vertLoc=0,TextShader.textureLoc=0,TextShader.initialized=!1,TextShader._prog=null,TextShader.init=function(e){var t=e.gl;TextShader._frag=t.createShader(WEBGL.FRAGMENT_SHADER),t.shaderSource(TextShader._frag,"        precision mediump float;\n\n        varying vec2 vTextureCoord;\n\n        uniform sampler2D uSampler;\n\n        void main(void) {\n            gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n        }\n    "),t.compileShader(TextShader._frag),t.getShaderParameter(TextShader._frag,WEBGL.COMPILE_STATUS),TextShader._vert=t.createShader(WEBGL.VERTEX_SHADER),t.shaderSource(TextShader._vert,"        attribute vec3 aVertexPosition;\n        attribute vec2 aTextureCoord;\n\n        uniform mat4 uMVMatrix;\n        uniform mat4 uPMatrix;\n\n        varying vec2 vTextureCoord;\n\n        void main(void) {\n            gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n            vTextureCoord = aTextureCoord;\n        }\n    "),t.compileShader(TextShader._vert),t.getShaderParameter(TextShader._vert,WEBGL.COMPILE_STATUS),TextShader._prog=t.createProgram(),t.attachShader(TextShader._prog,TextShader._vert),t.attachShader(TextShader._prog,TextShader._frag),t.linkProgram(TextShader._prog),t.getProgramParameter(TextShader._prog,WEBGL.LINK_STATUS),t.useProgram(TextShader._prog),TextShader.vertLoc=t.getAttribLocation(TextShader._prog,"aVertexPosition"),TextShader.textureLoc=t.getAttribLocation(TextShader._prog,"aTextureCoord"),TextShader.projMatLoc=t.getUniformLocation(TextShader._prog,"uPMatrix"),TextShader.mvMatLoc=t.getUniformLocation(TextShader._prog,"uMVMatrix"),TextShader.sampLoc=t.getUniformLocation(TextShader._prog,"uSampler"),set_tileUvMultiple(1),set_tileDemEnabled(!0),t.enable(WEBGL.BLEND),t.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA),TextShader.initialized=!0},TextShader.use=function(e,t,i){null==i&&(i=Texture.getEmpty());var r=e.gl;if(null!=r){TextShader.initialized||TextShader.init(e),r.useProgram(TextShader._prog);var n=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());r.uniformMatrix4fv(TextShader.mvMatLoc,!1,n.floatArray()),r.uniformMatrix4fv(TextShader.projMatLoc,!1,e.get_projection().floatArray()),r.uniform1i(TextShader.sampLoc,0),e.space?r.disable(WEBGL.DEPTH_TEST):r.enable(WEBGL.DEPTH_TEST),r.disableVertexAttribArray(0),r.disableVertexAttribArray(1),r.disableVertexAttribArray(2),r.disableVertexAttribArray(3),r.bindBuffer(WEBGL.ARRAY_BUFFER,t),r.enableVertexAttribArray(TextShader.vertLoc),r.enableVertexAttribArray(TextShader.textureLoc),r.vertexAttribPointer(TextShader.vertLoc,3,WEBGL.FLOAT,!1,20,0),r.vertexAttribPointer(TextShader.textureLoc,2,WEBGL.FLOAT,!1,20,12),r.activeTexture(WEBGL.TEXTURE0),r.bindTexture(WEBGL.TEXTURE_2D,i),r.enable(WEBGL.BLEND),r.blendFunc(WEBGL.SRC_ALPHA,WEBGL.ONE_MINUS_SRC_ALPHA)}};var TextShader$={};registerType("TextShader",[TextShader,TextShader$,null]);var CullMode={none:0,counterClockwise:2,clockwise:1};registerType("CullMode",CullMode),registerEnum("CullMode",CullMode);var PointScaleTypes={linear:0,power:1,log:2,constant:3,stellarMagnitude:4};function DataItem(){this.size=0}registerType("PointScaleTypes",PointScaleTypes),registerEnum("PointScaleTypes",PointScaleTypes);var DataItem$={getColor:function(){return"Red"}};function Dates(e,t){this.startDate=0,this.endDate=0,this.startDate=e,this.endDate=t}registerType("DataItem",[DataItem,DataItem$,null]),Dates.empty=function(){return new Dates(0,0)};var Dates$={copy:function(){return new Dates(this.startDate,this.endDate)}};function SimpleLineList(){this._zBuffer=!0,this._linePoints=[],this._usingLocalCenter=!1,this.sky=!0,this.aaFix=!0,this.pure2D=!1,this.viewTransform=Matrix3d.get_identity(),this._lineBuffers=[],this._lineBufferCounts=[],this.useLocalCenters=!1}registerType("Dates",[Dates,Dates$,null]);var SimpleLineList$={get_depthBuffered:function(){return this._zBuffer},set_depthBuffered:function(e){return this._zBuffer=e,e},addLine:function(e,t){this._linePoints.push(e),this._linePoints.push(t),this._emptyLineBuffer()},clear:function(){this._linePoints.length=0,this._emptyLineBuffer()},drawLines:function(e,t,i){if(!(this._linePoints.length<2)){this._initLineBuffer(e);var r=this._linePoints.length;if(null==e.gl){var n=Vector3d._transformCoordinate(e.get_viewPoint(),this.viewTransform),s=e.device;s.save(),s.strokeStyle=i.toString(),s.lineWidth=2,s.globalAlpha=.25;for(var a=new Vector3d,o=new Vector3d,l=0;l<r;l+=2)a=e.WVP.transform(this._linePoints[l]),o=e.WVP.transform(this._linePoints[l+1]),Vector3d.dot(this._linePoints[l],n)>.6&&(s.beginPath(),s.moveTo(a.x,a.y),s.lineTo(o.x,o.y),s.stroke());s.restore()}else for(var h=ss.ss.enumerate(this._lineBuffers);h.moveNext();){var c=h.current;this.pure2D?SimpleLineShader2D.use(e,c.vertexBuffer,i,this._zBuffer):SimpleLineShader.use(e,c.vertexBuffer,i,this._zBuffer),e.gl.drawArrays(WEBGL.LINES,0,c.count)}}},_initLineBuffer:function(e){if(null!=e.gl&&!this._lineBuffers.length){var t=this._linePoints.length,i=null,r=null;if(this._localCenter=new Vector3d,this.get_depthBuffered()){for(var n=ss.ss.enumerate(this._linePoints);n.moveNext();){var s=n.current;this._localCenter.add(s)}this._localCenter.x/=t,this._localCenter.y/=t,this._localCenter.z/=t}for(var a,o=t,l=0,h=ss.ss.enumerate(this._linePoints);h.moveNext();){if(s=h.current,l>=1e5||null==r){null!=i&&i.unlock();var c=Math.min(1e5,o);o-=c,r=(i=new PositionVertexBuffer(c)).lock(),this._lineBuffers.push(i),this._lineBufferCounts.push(c),l=0}this.useLocalCenters?(a=Vector3d.subtractVectors(s,this._localCenter),r[l]=a):r[l]=s,l++}null!=i&&i.unlock()}},_emptyLineBuffer:function(){}};function OrbitLineList(){this._zBuffer=!0,this._linePoints=[],this._lineColors=[],this.sky=!0,this.aaFix=!0,this.viewTransform=Matrix3d.get_identity(),this._lineBuffers=[],this._lineBufferCounts=[],this.useLocalCenters=!1}registerType("SimpleLineList",[SimpleLineList,SimpleLineList$,null]);var OrbitLineList$={get_depthBuffered:function(){return this._zBuffer},set_depthBuffered:function(e){return this._zBuffer=e,e},addLine:function(e,t,i,r){this._linePoints.push(e),this._lineColors.push(i),this._linePoints.push(t),this._lineColors.push(r),this._emptyLineBuffer()},clear:function(){this._linePoints.length=0,this._emptyLineBuffer()},drawLines:function(e,t,i){if(!(this._linePoints.length<2)){this._initLineBuffer(e),this._linePoints.length;for(var r=ss.ss.enumerate(this._lineBuffers);r.moveNext();){var n=r.current;OrbitLineShader.use(e,n.vertexBuffer,i),e.gl.drawArrays(WEBGL.LINES,0,n.count)}}},_initLineBuffer:function(e){if(null!=e.gl&&!this._lineBuffers.length){var t=this._linePoints.length,i=null,r=null;if(this._localCenter=new Vector3d,this.get_depthBuffered()){for(var n=ss.ss.enumerate(this._linePoints);n.moveNext();){var s=n.current;this._localCenter.add(s)}this._localCenter.x/=t,this._localCenter.y/=t,this._localCenter.z/=t}for(var a,o=t,l=0,h=0,c=ss.ss.enumerate(this._linePoints);c.moveNext();){if(s=c.current,h>=1e5||null==r){null!=i&&i.unlock();var u=Math.min(1e5,o);o-=u,r=(i=new PositionColoredVertexBuffer(u)).lock(),this._lineBuffers.push(i),this._lineBufferCounts.push(u),h=0}this.useLocalCenters?(a=Vector3d.subtractVectors(s,this._localCenter),r[h]=new PositionColored(a,this._lineColors[l])):r[h]=new PositionColored(s,this._lineColors[l]),l++,h++}null!=i&&i.unlock()}},_emptyLineBuffer:function(){for(var e=ss.ss.enumerate(this._lineBuffers);e.moveNext();)e.current.dispose();this._lineBuffers.length=0}};function LineList(){this._zBuffer=!0,this.timeSeries=!1,this.showFarSide=!0,this.sky=!1,this.decay=0,this.useNonRotatingFrame=!1,this.jNow=0,this._linePoints=[],this._lineColors=[],this._lineDates=[],this._usingLocalCenter=!0,this._lineBuffers=[],this._lineBufferCounts=[]}registerType("OrbitLineList",[OrbitLineList,OrbitLineList$,null]);var LineList$={get_depthBuffered:function(){return this._zBuffer},set_depthBuffered:function(e){return this._zBuffer=e,e},addLine:function(e,t,i,r){this._linePoints.push(e),this._linePoints.push(t),this._lineColors.push(i),this._lineDates.push(r),this._emptyLineBuffer()},addLineNoDate:function(e,t,i){this._linePoints.push(e),this._linePoints.push(t),this._lineColors.push(i),this._lineDates.push(new Dates(0,0)),this._emptyLineBuffer()},clear:function(){this._linePoints.length=0,this._lineColors.length=0,this._lineDates.length=0},drawLines:function(e,t){if(!(this._linePoints.length<2||t<=0))if(null==e.gl);else{this._initLineBuffer();for(var i=ss.ss.enumerate(this._lineBuffers);i.moveNext();){var r=i.current;LineShaderNormalDates.use(e,r.vertexBuffer,Color.fromArgb(255,255,255,255),this._zBuffer,this.jNow,this.timeSeries?this.decay:0),e.gl.drawArrays(WEBGL.LINES,0,r.count)}}},_initLineBuffer:function(){if(!this._lineBuffers.length){for(var e,t=null,i=null,r=this._linePoints.length,n=0,s=0,a=ss.ss.enumerate(this._linePoints);a.moveNext();){var o=a.current;if(s>=1e5||null==i){null!=t&&t.unlock();var l=Math.min(1e5,r);r-=l,i=(t=new TimeSeriesLineVertexBuffer(l)).lock(),this._lineBuffers.push(t),this._lineBufferCounts.push(l),s=0}var h=ss.ss.truncate(n/2);e=o,i[s]=new TimeSeriesLineVertex,i[s].position=e,i[s].normal=o,i[s].tu=this._lineDates[h].startDate,i[s].tv=this._lineDates[h].endDate,i[s].set_color(this._lineColors[h]),n++,s++}null!=t&&t.unlock()}},_emptyLineBuffer:function(){}};function TriangleList(){this._trianglePoints=[],this._triangleColors=[],this._triangleDates=[],this.timeSeries=!1,this.showFarSide=!1,this.sky=!1,this.depthBuffered=!0,this.writeZbuffer=!1,this.decay=0,this.autoTime=!0,this.jNow=0,this._dataToDraw=!1,this._triangleBuffers=[],this._triangleBufferCounts=[]}registerType("LineList",[LineList,LineList$,null]);var TriangleList$={addTriangle:function(e,t,i,r,n){this._trianglePoints.push(e),this._trianglePoints.push(t),this._trianglePoints.push(i),this._triangleColors.push(r),this._triangleDates.push(n),this._emptyTriangleBuffer()},addSubdividedTriangles:function(e,t,i,r,n,s){var a,o,l;--s<0?this.addTriangle(e,t,i,r,n):(a=Vector3d.midPointByLength(e,t),o=Vector3d.midPointByLength(t,i),l=Vector3d.midPointByLength(i,e),this.addSubdividedTriangles(e,a,l,r,n,s),this.addSubdividedTriangles(a,o,l,r,n,s),this.addSubdividedTriangles(a,t,o,r,n,s),this.addSubdividedTriangles(o,i,l,r,n,s))},addQuad:function(e,t,i,r,n,s){this._trianglePoints.push(e),this._trianglePoints.push(i),this._trianglePoints.push(t),this._trianglePoints.push(t),this._trianglePoints.push(i),this._trianglePoints.push(r),this._triangleColors.push(n),this._triangleDates.push(s),this._triangleColors.push(n),this._triangleDates.push(s),this._emptyTriangleBuffer()},clear:function(){this._triangleColors.length=0,this._trianglePoints.length=0,this._triangleDates.length=0,this._emptyTriangleBuffer()},_emptyTriangleBuffer:function(){},_initTriangleBuffer:function(){if(!this._triangleBuffers.length){for(var e=null,t=null,i=this._trianglePoints.length,r=0,n=0,s=ss.ss.enumerate(this._trianglePoints);s.moveNext();){var a=s.current;if(n>=9e4||null==e){null!=e&&e.unlock();var o=Math.min(9e4,i);i-=o,e=new TimeSeriesLineVertexBuffer(o),this._triangleBuffers.push(e),this._triangleBufferCounts.push(o),t=e.lock(),n=0}t[n]=new TimeSeriesLineVertex,t[n].position=a,t[n].normal=a;var l=ss.ss.truncate(r/3);t[n].set_color(this._triangleColors[l]),t[n].tu=this._triangleDates[l].startDate,t[n].tv=this._triangleDates[l].endDate,r++,n++}null!=e&&e.unlock(),this._triangleColors.length=0,this._triangleDates.length=0,this._trianglePoints.length=0,this._dataToDraw=!0}},draw:function(e,t,i){if(!(this._trianglePoints.length<1)||this._dataToDraw)if(null==e.gl);else{this._initTriangleBuffer();for(var r=ss.ss.enumerate(this._triangleBuffers);r.moveNext();){var n=r.current;LineShaderNormalDates.use(e,n.vertexBuffer,Color.fromArgb(255,255,255,255),this.depthBuffered,this.jNow,this.timeSeries?this.decay:0),e.gl.drawArrays(WEBGL.TRIANGLES,0,n.count)}}}};function TriangleFanList(){this._zBuffer=!0,this.timeSeries=!1,this.decay=0,this.jNow=0,this._shapes=[],this._colors=[],this._dates=[],this._buffers=[],this._bufferCounts=[]}registerType("TriangleList",[TriangleList,TriangleList$,null]);var TriangleFanList$={get_depthBuffered:function(){return this._zBuffer},set_depthBuffered:function(e){return this._zBuffer=e,e},addShape:function(e,t,i){this._shapes.push(e),this._colors.push(t),this._dates.push(i)},draw:function(e,t){if(!(t<=0)&&null!=e.gl){this._initBuffer();for(var i=ss.ss.enumerate(this._buffers);i.moveNext();){var r=i.current;LineShaderNormalDates.use(e,r.vertexBuffer,Color.fromArgb(255,255,255,255),this._zBuffer,this.jNow,this.timeSeries?this.decay:0),e.gl.drawArrays(WEBGL.TRIANGLE_FAN,0,r.count)}}},_initBuffer:function(){if(this._buffers.length!==this._shapes.length){this._buffers.length=0;for(var e=0,t=ss.ss.enumerate(this._shapes);t.moveNext();){var i=t.current,r=new TimeSeriesLineVertexBuffer(i.length),n=r.lock();this._buffers.push(r),this._bufferCounts.push(i.length);for(var s=0,a=ss.ss.enumerate(i);a.moveNext();){var o=a.current;n[s]=new TimeSeriesLineVertex,n[s].position=o,n[s].tu=this._dates[e].startDate,n[s].tv=this._dates[e].endDate,n[s].set_color(this._colors[e]),s++}e++,null!=r&&r.unlock()}}}};function PointList(e){this._points=[],this._colors=[],this._dates=[],this._sizes=[],this.timeSeries=!1,this.showFarSide=!1,this.sky=!1,this.depthBuffered=!0,this.decay=0,this.scale=1,this.autoTime=!0,this.jNow=0,this._dataToDraw=!1,this.items=[],this._imageReady=!1,this._init=!1,this.minSize=2,this._pointBuffers=[],this._pointBufferCounts=[],this._device=e}registerType("TriangleFanList",[TriangleFanList,TriangleFanList$,null]),PointList.starTexture=null;var PointList$={addPoint:function(e,t,i,r){this._points.push(e),this._colors.push(t._clone()),this._dates.push(i),this._sizes.push(r),this._emptyPointBuffer()},clear:function(){this._colors.length=0,this._points.length=0,this._dates.length=0,this._sizes.length=0,this._emptyPointBuffer()},_emptyPointBuffer:function(){for(var e=ss.ss.enumerate(this._pointBuffers);e.moveNext();)e.current.dispose();this._pointBuffers.length=0,this._init=!1},_initBuffer:function(e){var t=this;if(!this._init){if(null==e.gl){this._starProfile=document.createElement("img"),this._starProfile.addEventListener("load",(function(e){t._imageReady=!0}),!1),this._starProfile.src=URLHelpers.singleton.engineAssetUrl("StarProfileAlpha.png"),this._worldList=new Array(this._points.length),this._transformedList=new Array(this._points.length);for(var i=0,r=ss.ss.enumerate(this._points);r.moveNext();){var n=r.current,s=new DataItem;s.location=n,s.tranformed=new Vector3d,s.size=this._sizes[i],s.color=this._colors[i],this._worldList[i]=s.location,this._transformedList[i]=s.tranformed,this.items.push(s),i++}}else if(!this._pointBuffers.length){null==PointList.starTexture&&(PointList.starTexture=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("StarProfileAlpha.png")));for(var a=null,o=null,l=this._points.length,h=(i=0,0),c=ss.ss.enumerate(this._points);c.moveNext();){var u=c.current;if(h>=1e5||null==o){null!=a&&a.unlock();var d=Math.min(1e5,l);l-=d,o=(a=new TimeSeriesPointVertexBuffer(d)).lock(),this._pointBuffers.push(a),this._pointBufferCounts.push(d),h=0}o[h]=new TimeSeriesPointVertex,o[h].position=u,o[h].pointSize=this._sizes[i],o[h].tu=this._dates[i].startDate,o[h].tv=this._dates[i].endDate,o[h].set_color(this._colors[i]),i++,h++}null!=a&&a.unlock()}this._init=!0}},draw:function(e,t,i){if(this._initBuffer(e),null==e.gl){if(!this._imageReady)return;e.device.save(),e.WVP.projectArrayToScreen(this._worldList,this._transformedList);var r=e.device;r.globalAlpha=.4;for(var n=e.width,s=e.height,a=(Vector3d.makeCopy(e.get_viewPoint()),e.get_fovScale()/100),o=ss.ss.enumerate(this.items);o.moveNext();){var l=o.current;if(l.tranformed.z<1){var h=l.tranformed.x,c=l.tranformed.y,u=.1*l.size/a,d=u/2;h>-d&&h<n+d&&c>-d&&c<s+d&&(r.beginPath(),r.fillStyle=l.color.toFormat(),r.arc(h,c,u,0,2*Math.PI,!0),r.fill())}}e.device.restore()}else{var _=new Vector3d,g=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());g.invert();for(var f=Vector3d._transformCoordinate(_,g),m=ss.ss.enumerate(this._pointBuffers);m.moveNext();){var p=m.current;TimeSeriesPointSpriteShader.use(e,p.vertexBuffer,PointList.starTexture.texture2d,Color.fromArgb(255*t,255,255,255),this.depthBuffered,this.jNow,this.timeSeries?this.decay:0,f,this.scale*(e.height/960),this.minSize,this.showFarSide,this.sky),e.gl.drawArrays(WEBGL.POINTS,0,p.count)}}},drawTextured:function(e,t,i){this._initBuffer(e);var r=new Vector3d,n=Matrix3d.multiplyMatrix(e.get_world(),e.get_view());n.invert();for(var s=Vector3d._transformCoordinate(r,n),a=ss.ss.enumerate(this._pointBuffers);a.moveNext();){var o=a.current;TimeSeriesPointSpriteShader.use(e,o.vertexBuffer,t,Color.fromArgb(255*i,255,255,255),this.depthBuffered,this.jNow,this.decay,s,this.scale*(e.height/960),this.minSize,this.showFarSide,this.sky),e.gl.drawArrays(WEBGL.POINTS,0,o.count)}}};function TimeSeriesLineVertex(){this.position=new Vector3d,this.normal=new Vector3d,this.tu=0,this.tv=0}registerType("PointList",[PointList,PointList$,null]),TimeSeriesLineVertex.create=function(e,t,i,r){var n=new TimeSeriesLineVertex;return n.position=e,n.normal=t,n.tu=i,n.tv=0,n.color=r,n};var TimeSeriesLineVertex$={get_color:function(){return this.color},set_color:function(e){return this.color=e,e}};function TimeSeriesPointVertex(){this.pointSize=0,this.tu=0,this.tv=0}registerType("TimeSeriesLineVertex",[TimeSeriesLineVertex,TimeSeriesLineVertex$,null]),TimeSeriesPointVertex.create=function(e,t,i,r){var n=new TimeSeriesPointVertex;return n.position=e,n.pointSize=t,n.tu=i,n.tv=0,n.color=r,n};var TimeSeriesPointVertex$={get_color:function(){return this.color},set_color:function(e){return this.color=e,e}};function Bitmap(){this.width=0,this.height=0}registerType("TimeSeriesPointVertex",[TimeSeriesPointVertex,TimeSeriesPointVertex$,null]),Bitmap.create=function(e,t){t=Texture.fitPowerOfTwo(t),e=Texture.fitPowerOfTwo(e);var i=new Bitmap;return i.height=t,i.width=e,i._buffer=new Uint8Array(e*t*4),i};var Bitmap$={setPixel:function(e,t,i,r,n,s){var a=4*(e+t*this.width);this._buffer[a++]=i,this._buffer[a++]=r,this._buffer[a++]=n,this._buffer[a++]=s},getTexture:function(){var e=tilePrepDevice.createTexture();return tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,e),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_S,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_T,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGBA,this.width,this.height,0,WEBGL.RGBA,WEBGL.UNSIGNED_BYTE,this._buffer),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.LINEAR_MIPMAP_NEAREST),tilePrepDevice.generateMipmap(WEBGL.TEXTURE_2D),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,null),e}};function ContextMenuStrip(){this.items=[]}registerType("Bitmap",[Bitmap,Bitmap$,null]);var ContextMenuStrip$={_dispose:function(){},_nonMenuClick:function(e){document.getElementById("contextmenu").style.display="none",window.removeEventListener("click",ss.ss.bind("_nonMenuClick",this),!1);for(var t=document.getElementById("popoutmenu");null!=t.firstChild;)t.removeChild(t.firstChild);t.style.display="none"},_menuItemClicked:function(e){var t=e.currentTarget;t.itemTag.click(t.itemTag,new ss.ss.EventArgs)},_show:function(e){for(var t=document.getElementById("contextmenu");null!=t.firstChild;)t.removeChild(t.firstChild);t.className="contextmenu",t.style.display="block",t.style.left=e.x.toString()+"px",t.style.top=e.y.toString()+"px",window.addEventListener("click",ss.ss.bind("_nonMenuClick",this),!0);for(var i=ss.ss.enumerate(this.items);i.moveNext();){var r=i.current;if(r.visible){var n=document.createElement("div");r.dropDownItems.length>0?n.className="contextmenuitem submenu":r.checked?n.className="contextmenuitem checkedmenu":n.className="contextmenuitem",n.innerText=r.name,n.itemTag=r,n.addEventListener("mouseover",ss.ss.bind("_openSubMenu",this),!1),null!=r.click&&n.addEventListener("click",ss.ss.bind("_menuItemClicked",this),!1),t.appendChild(n)}}},_openSubMenu:function(e){for(var t=e.currentTarget.itemTag,i=document.getElementById("popoutmenu");null!=i.firstChild;)i.removeChild(i.firstChild);if(i.style.display="none",t.dropDownItems.length){var r=new Vector2d;r.x=e.currentTarget.parentNode.offsetLeft+e.currentTarget.parentNode.clientWidth,r.y=e.currentTarget.parentNode.offsetTop+e.currentTarget.offsetTop,i.className="contextmenu",i.style.display="block",i.style.left=r.x.toString()+"px",i.style.top=r.y.toString()+"px",window.addEventListener("click",ss.ss.bind("_nonMenuClick",this),!0);for(var n=ss.ss.enumerate(t.dropDownItems);n.moveNext();){var s=n.current;if(s.visible){var a=document.createElement("div");a.className=s.checked?"contextmenuitem checkedmenu":"contextmenuitem",a.innerText=s.name,a.itemTag=s,a.addEventListener("click",ss.ss.bind("_menuItemClicked",this),!1),i.appendChild(a)}}}}};function ToolStripMenuItem(){this.tag=null,this.dropDownItems=[],this.checked=!1,this.enabled=!0,this.visible=!0}registerType("ContextMenuStrip",[ContextMenuStrip,ContextMenuStrip$,null]),ToolStripMenuItem.create=function(e){var t=new ToolStripMenuItem;return t.name=e,t};var ToolStripMenuItem$={};function ToolStripSeparator(){ToolStripMenuItem.call(this),this.name="--------------------------------------"}registerType("ToolStripMenuItem",[ToolStripMenuItem,ToolStripMenuItem$,null]);var ToolStripSeparator$={};function TagMe(){}registerType("ToolStripSeparator",[ToolStripSeparator,ToolStripSeparator$,ToolStripMenuItem]);var TagMe$={};function BinaryReader(e){this.position=0,this._data=null,this._data=e}registerType("TagMe",[TagMe,TagMe$,null]),BinaryReader.id=1;var BinaryReader$={get_position:function(){return this.position},seek:function(e){this.position=e},seekRelative:function(e){this.position+=e},get_length:function(){return this._data.length},get_endOfStream:function(){return this.position>=this.get_length()},readByte:function(){var e;return e=this._data[this.position],this.position+=1,e},readSByte:function(){var e;return e=this._data[this.position],this.position+=1,e},readBytes:function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this._data[this.position+i];return this.position+=e,t},readRemainingI16:function(e){for(var t=new Float32Array(e),i=0;i<e;i++)t[i]=this.readInt16(!0);return t},readByteString:function(e){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this._data[this.position+i]);return this.position+=e,t},readSingle:function(){var e=new Uint8Array(4);e[0]=this._data[this.position],e[1]=this._data[this.position+1],e[2]=this._data[this.position+2],e[3]=this._data[this.position+3];var t=new Float32Array(e.buffer,0,1)[0];return this.position+=4,t},readUInt32:function(){var e=this._data[this.position]+(this._data[this.position+1]<<8)+(this._data[this.position+2]<<16)+(this._data[this.position+3]<<24);return this.position+=4,e},readUInt16:function(){var e=this._data[this.position]+(this._data[this.position+1]<<8);return this.position+=2,e},readUInt16LittleEndian:function(){var e=(this._data[this.position]<<8)+this._data[this.position+1];return this.position+=2,e},readInt16:function(e){var t=e?this.readUInt16LittleEndian():this.readUInt16();return 32768&t?-(t-1^65535):t},readInt32:function(){var e=this.readUInt32();return 2147483648&e?-(e-1^4294967295):e},readInt64:function(){return this.position+=8,BinaryReader.id++},close:function(){}};function SimpleInput(e,t,i,r){this.title="Tile",this.label="Enter Text Below",this.text="",this._textElement=null,this._ignoreNextClick=!1,this.title=e,this.label=t,this.text=i}registerType("BinaryReader",[BinaryReader,BinaryReader$,null]);var SimpleInput$={showDialog:function(){return 1},nonMenuClick:function(e){this._ignoreNextClick||this._close(),this._ignoreNextClick=!1},show:function(e,t){var i=document.getElementById("simpleinput");document.getElementById("simplemodal").style.display="block",i.style.display="block",i.style.marginLeft=e.x.toString()+"px",i.style.marginTop=e.y.toString()+"px",this._textElement=document.getElementById("inputtext"),this._textElement.value=this.text;var r=document.getElementById("simpletitle"),n=document.getElementById("inputlabel");r.innerText=this.title,n.innerText=this.label,this._textElement.addEventListener("change",ss.ss.bind("textChanged",this),!1),this._textElement.addEventListener("click",ss.ss.bind("ignoreMe",this),!0);var s=document.getElementById("simpleinputok"),a=document.getElementById("simpleinputcancel");s.addEventListener("click",ss.ss.bind("okClicked",this),!1),a.addEventListener("click",ss.ss.bind("cancelClicked",this),!1),this._okCallback=t},okClicked:function(e){this._close(),null!=this._okCallback&&this._okCallback()},cancelClicked:function(e){this._close()},_close:function(){document.getElementById("simplemodal").style.display="none",this._textElement.removeEventListener("change",ss.ss.bind("textChanged",this),!1);var e=document.getElementById("simpleinputok"),t=document.getElementById("simpleinputcancel");e.removeEventListener("click",ss.ss.bind("okClicked",this),!1),t.removeEventListener("click",ss.ss.bind("cancelClicked",this),!1)},ignoreMe:function(e){this._ignoreNextClick=!0},textChanged:function(e){this.text=this._textElement.value,this._ignoreNextClick=!0}};registerType("SimpleInput",[SimpleInput,SimpleInput$,null]);var Formatting={indented:1};function XmlTextWriter(){this.body="<?xml version='1.0' encoding='UTF-8'?>\r\n",this.formatting=1,this._elementStack=new ss.ss.Stack,this._pending=!1,this._currentName="",this._attributes={},this._value=""}registerType("Formatting",Formatting),registerEnum("Formatting",Formatting);var XmlTextWriter$={_pushNewElement:function(e){this._writePending(!1),this._elementStack.push(e),this._pending=!0,this._currentName=e},_writePending:function(e){var t=!0;if(this._pending){for(var i=1;i<this._elementStack.count;i++)this.body+="  ";if(this.body+="<"+this._currentName,ss.ss.keyCount(this._attributes)>0)for(var r=ss.ss.enumerate(ss.ss.keys(this._attributes));r.moveNext();){var n=r.current;this.body+=ss.ss.format(' {0}="{1}"',n,this._attributes[n])}return ss.ss.emptyString(this._value)?e?(this.body+=" />\r\n",t=!0):this.body+=">\r\n":(this.body+=">",t=!1,ss.ss.emptyString(this._value)||(this.body+=this._value)),this._pending=!1,this._currentName="",this._value="",this._attributes={},t}return!1},_writeProcessingInstruction:function(e,t){},_writeStartElement:function(e){this._pushNewElement(e)},_writeAttributeString:function(e,t){this._attributes[e]=null!=t?ss.ss.replaceString(t.toString(),"&","&amp;"):""},_writeEndElement:function(){if(this._writePending(!0))this._elementStack.pop();else{for(var e=1;e<this._elementStack.count;e++)this.body+="  ";this.body+=ss.ss.format("</{0}>\r\n",this._elementStack.pop())}},_writeString:function(e){this._value=ss.ss.replaceString(e,"&","&amp;")},_writeFullEndElement:function(){this._writePending(!1);for(var e=1;e<this._elementStack.count;e++)this.body+="  ";this.body+=ss.ss.format("</{0}>\r\n",this._elementStack.pop())},_close:function(){},_writeElementString:function(e,t){this._writeStartElement(e),this._writeValue(ss.ss.replaceString(t,"&","&amp;")),this._writeEndElement()},_writeValue:function(e){this._value=ss.ss.replaceString(e,"&","&amp;")},_writeCData:function(e){this._value=ss.ss.format("<![CDATA[{0}]]>",e)}};function Coordinates(e,t){this._ascention=0,this._declination=0,this._ascention=e+80*Math.PI%(2*Math.PI),this._declination=t}registerType("XmlTextWriter",[XmlTextWriter,XmlTextWriter$,null]),Coordinates.RC=3.1415927/180,Coordinates.RCRA=3.1415927/12,Coordinates.radius=1,Coordinates._rotationMatrix=null,Coordinates.geoTo3d=function(e,t){return Vector3d.create(Math.cos(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*1,1*Math.sin(e*Coordinates.RC),Math.sin(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*1)},Coordinates.geoTo3dDouble=function(e,t){return Vector3d.create(Math.cos(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*1,1*Math.sin(e*Coordinates.RC),Math.sin(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*1)},Coordinates.geoTo3dRad=function(e,t,i){return Vector3d.create(Math.cos(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*i,Math.sin(e*Coordinates.RC)*i,Math.sin(t*Coordinates.RC)*Math.cos(e*Coordinates.RC)*i)},Coordinates.raDecTo3d=function(e,t){return Vector3d.create(Math.cos(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*1,1*Math.sin(t*Coordinates.RC),Math.sin(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*1)},Coordinates.raDecTo3dAu=function(e,t,i){return Vector3d.create(Math.cos(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*i,Math.sin(t*Coordinates.RC)*i,Math.sin(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*i)},Coordinates.raDecTo3dMat=function(e,t,i){return Vector3d._transformCoordinate(Vector3d.create(Math.cos(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*1,1*Math.sin(t*Coordinates.RC),Math.sin(e*Coordinates.RCRA)*Math.cos(t*Coordinates.RC)*1),i)},Coordinates.raDecTo3dPointRad=function(e,t){return e.set_dec(-e.get_dec()),Vector3d.create(Math.cos(e.get_RA()*Coordinates.RCRA)*Math.cos(e.get_dec()*Coordinates.RC)*t,Math.sin(e.get_dec()*Coordinates.RC)*t,Math.sin(e.get_RA()*Coordinates.RCRA)*Math.cos(e.get_dec()*Coordinates.RC)*t)},Coordinates.sterographicTo3d=function(e,t,i,r,n,s,a,o,l){var h=90,c=0;if(t-=a,(e-=s)||t){var u=6371e3*(1+Math.sin(Math.abs(r)/180*Math.PI))/o,d=u*u,_=180/Math.PI;c=e?Math.atan2(t,e)*_:90*t<0?-1:1;var g=e*e+t*t;h=(d-g)/(d+g),h=Math.asin(h)*_,l||(h=-h,c=-c,n=-n)}return Coordinates.geoTo3dRad(h,90+c+n,i)},Coordinates.equitorialToHorizon=function(e,t,i){var r=Coordinates.mstFromUTC2(i,t.get_lng())-15*e.get_RA();r<0&&(r+=360);var n=r*Coordinates.RC,s=e.get_dec()*Coordinates.RC,a=t.get_lat()*Coordinates.RC,o=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos(n),l=Math.asin(o),h=(Math.sin(s)-Math.sin(l)*Math.sin(a))/(Math.cos(l)*Math.cos(a)),c=new Coordinates(Math.acos(h),l);return Math.sin(n)>0&&c.set_az(360-c.get_az()),c},Coordinates.horizonToEquitorial=function(e,t,i){var r,n,s=Coordinates.mstFromUTC2(i,t.get_lng()),a=Coordinates._altAzToRaDec(e.get_alt()*Coordinates.RC,e.get_az()*Coordinates.RC,t.get_lat()*Coordinates.RC);return r=a.x,n=a.y,(s+=r/Coordinates.RC)<0&&(s+=360),s>360&&(s-=360),Coordinates.fromRaDec(s/15,n/Coordinates.RC)},Coordinates._altAzToRaDec=function(e,t,i){var r,n=0;return(t=Math.PI-t)<0&&(t+=2*Math.PI),(n=Math.atan2(Math.sin(t),Math.cos(t)*Math.sin(i)+Math.tan(e)*Math.cos(i)))<0&&(n+=2*Math.PI),r=Math.asin(Math.sin(i)*Math.sin(e)-Math.cos(i)*Math.cos(e)*Math.cos(t)),Vector2d.create(n,r)},Coordinates.mstFromUTC2=function(e,t){var i=e.getUTCFullYear(),r=e.getUTCMonth()+1,n=e.getUTCDate(),s=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds()+e.getUTCMilliseconds()/1e3;1!==r&&2!==r||(i-=1,r+=12);var l,h,c,u=ss.ss.truncate(i/100);if((c=280.46061837+360.98564736629*(l=2-u+Math.floor(u/4)+Math.floor(365.25*i)+Math.floor(30.6001*(r+1))-730550.5+n+(s+a/60+o/3600)/24)+387933e-9*(h=l/36525)*h-h*h*h/3871e4+t)>0)for(;c>360;)c-=360;else for(;c<0;)c+=360;return c},Coordinates.cartesianToSpherical=function(e){var t,i=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),r=Math.sqrt(e.x*e.x+e.z*e.z);return t=Math.asin(e.y/i),new Coordinates(0<e.x?Math.asin(e.z/r):0>e.x?Math.PI-Math.asin(e.z/r):0,t)},Coordinates.cartesianToSpherical2=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return new Coordinates(Math.atan2(e.z,e.x),Math.asin(e.y/t))},Coordinates.cartesianToSphericalSky=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i=Math.atan2(e.z,e.x),r=Math.asin(e.y/t);return Vector2d.create(i/Math.PI*12,r/Math.PI*180)},Coordinates.sphericalSkyToCartesian=function(e){var t=e.x*(Math.PI/12),i=e.y*(Math.PI/180),r=Math.cos(t)*Math.cos(i),n=Math.sin(i),s=Math.sin(t)*Math.cos(i);return Vector3d.create(r,n,s)},Coordinates.cartesianToLatLng=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),i=Math.atan2(e.z,e.x),r=Math.asin(e.y/t);return Vector2d.create(180*i/Math.PI,180*r/Math.PI)},Coordinates.cartesianToSpherical3=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);return new Coordinates(Math.atan2(e.z,e.x),Math.asin(e.y/t))},Coordinates.sign=function(e){return e<0?-1:1},Coordinates.formatDMSSign=function(e,t){try{e+=.0001388888888889*Coordinates.sign(e);var i=ss.ss.truncate(e),r=60*(e-ss.ss.truncate(e)),n=60*(r-ss.ss.truncate(r));if(t){var s=e>0?"+":"-";return ss.ss.format("{3}{0:00;00}:{1:00}:{2:00}",i,Math.abs(ss.ss.truncate(r)),Math.abs(ss.ss.truncate(n)),s)}return ss.ss.format("{0:00}:{1:00}:{2:00}",i,Math.abs(ss.ss.truncate(r)),Math.abs(ss.ss.truncate(n)))}catch(e){return""}},Coordinates.twoPlaces=function(e){var t=e.toString();return t.length<2&&(t="0"+t),t},Coordinates.formatDMS=function(e){try{e+=.0001388888888889*(e<0?-1:1);var t=Math.abs(ss.ss.truncate(e)),i=60*(e-ss.ss.truncate(e)),r=60*(i-ss.ss.truncate(i)),n=e<0?"-":"";return ss.ss.format("{3}{0}:{1}:{2}",Math.abs(t),Coordinates.twoPlaces(Math.abs(ss.ss.truncate(i))),Coordinates.twoPlaces(Math.abs(ss.ss.truncate(r))),n)}catch(e){return""}},Coordinates.formatDMSWide=function(e){try{e+=.0001388888888889*Coordinates.sign(e);var t=Math.abs(ss.ss.truncate(e)),i=60*(e-ss.ss.truncate(e)),r=60*(i-ss.ss.truncate(i)),n=e<0?"-":"";return ss.ss.format("{3}{0:00} : {1:00} : {2:00}",t,Math.abs(ss.ss.truncate(i)),Math.abs(ss.ss.truncate(r)),n)}catch(e){return""}},Coordinates.formatHMS=function(e){try{e+=.0001388888888889*Coordinates.sign(e);var t=ss.ss.truncate(e),i=60*(e-ss.ss.truncate(e)),r=60*(i-ss.ss.truncate(i));return ss.ss.format("{0:00}h{1:00}m{2:00}s",t,Math.abs(ss.ss.truncate(i)),Math.abs(ss.ss.truncate(r)))}catch(e){return""}},Coordinates.parseRA=function(e,t){((e=ss.ss.trim(e).toLowerCase()).indexOf("d")>-1||e.indexOf("")>-1)&&(t=!0),(e.indexOf("h")>-1||e.indexOf(":")>-1)&&(t=!1);var i=Coordinates.parse(e)/(t?15:1);return Math.max(Math.min(i,24),0)},Coordinates.parseDec=function(e){var t=Coordinates.parse(e);return Math.max(Math.min(t,90),-90)},Coordinates.parse=function(e){try{if(e=ss.ss.trim(e).toLowerCase(),e=ss.ss.replaceString(ss.ss.replaceString(ss.ss.replaceString(ss.ss.replaceString(ss.ss.replaceString(ss.ss.replaceString(e,"d ","d"),"h ","h"),"m ","m"),"s ","s"),"' ","'"),'" ','"'),Util.stringContains(e,[":"," ","d","h","m","s","'",'"',""])){var t=0,i=0,r=0,n=0,s=Util.splitString(e,[":"," ","d","h","m","s","'",'"',""]);return s.length>0&&(ss.ss.emptyString(s[0])||(t=Math.abs(parseFloat(s[0])),n=parseFloat(s[0])<0?-1:1,s[0].indexOf("-")>-1&&(n=-1))),s.length>1&&(ss.ss.emptyString(s[1])||(i=parseFloat(s[1]))),s.length>2&&(ss.ss.emptyString(s[2])||(r=parseFloat(s[2]))),n||(n=1),n*(t+i/60+r/3600)}var a=0;try{a=parseFloat(e)}catch(e){a=0}return a}catch(e){return 0}},Coordinates.fromRaDec=function(e,t){return new Coordinates(15*(e-12)*Coordinates.RC,t*Coordinates.RC)},Coordinates.fromLatLng=function(e,t){return new Coordinates(t*Coordinates.RC,e*Coordinates.RC)},Coordinates.dmsToDegrees=function(e,t,i){return e+t/60+i/3600},Coordinates.degreesToRadians=function(e){return.0174532925199433*e},Coordinates.radiansToDegrees=function(e){return 57.2957795130823*e},Coordinates.radiansToHours=function(e){return 3.81971863420549*e},Coordinates.hoursToRadians=function(e){return.261799387799149*e},Coordinates.hoursToDegrees=function(e){return 15*e},Coordinates.degreesToHours=function(e){return e/15},Coordinates.PI=function(){return 3.14159265358979},Coordinates.mapTo0To360Range=function(e){for(var t=e;t<0;)t+=360;for(;t>360;)t-=360;return t},Coordinates.mapTo0To24Range=function(e){for(var t=e;t<0;)t+=24;for(;t>24;)t-=24;return t},Coordinates.meanObliquityOfEcliptic=function(e){var t=(e-2451545)/3652500,i=t*t,r=i*t,n=r*t,s=n*t,a=s*t,o=a*t,l=o*t,h=l*t,c=h*t;return Coordinates.dmsToDegrees(23,26,21.448)-Coordinates.dmsToDegrees(0,0,4680.93)*t-Coordinates.dmsToDegrees(0,0,1.55)*i+Coordinates.dmsToDegrees(0,0,1999.25)*r-Coordinates.dmsToDegrees(0,0,51.38)*n-Coordinates.dmsToDegrees(0,0,249.67)*s-Coordinates.dmsToDegrees(0,0,39.05)*a+Coordinates.dmsToDegrees(0,0,7.12)*o+Coordinates.dmsToDegrees(0,0,27.87)*l+Coordinates.dmsToDegrees(0,0,5.79)*h+Coordinates.dmsToDegrees(0,0,2.45)*c},Coordinates.j2000toGalactic=function(e,t){var i=[Math.cos(e/180*Math.PI)*Math.cos(t/180*Math.PI),Math.sin(e/180*Math.PI)*Math.cos(t/180*Math.PI),Math.sin(t/180*Math.PI)];null==Coordinates._rotationMatrix&&(Coordinates._rotationMatrix=new Array(3),Coordinates._rotationMatrix[0]=[-.0548755604,-.8734370902,-.4838350155],Coordinates._rotationMatrix[1]=[.4941094279,-.44482963,.7469822445],Coordinates._rotationMatrix[2]=[-.867666149,-.1980763734,.4559837762]);for(var r=new Array(3),n=0;n<3;n++)r[n]=i[0]*Coordinates._rotationMatrix[n][0]+i[1]*Coordinates._rotationMatrix[n][1]+i[2]*Coordinates._rotationMatrix[n][2];var s=Math.atan2(r[1],r[0]);s<0&&(s+=2*Math.PI),s>2*Math.PI&&(s-=2*Math.PI);var a=Math.atan2(r[2],Math.sqrt(r[0]*r[0]+r[1]*r[1]));return[s/Math.PI*180,a/Math.PI*180]},Coordinates.galacticTo3dDouble=function(e,t){var i=Coordinates.galactictoJ2000(e,t);return Coordinates.raDecTo3dAu(i[0]/15,i[1],1)},Coordinates.galactictoJ2000=function(e,t){var i=[Math.cos(e/180*Math.PI)*Math.cos(t/180*Math.PI),Math.sin(e/180*Math.PI)*Math.cos(t/180*Math.PI),Math.sin(t/180*Math.PI)];null==Coordinates._rotationMatrix&&(Coordinates._rotationMatrix=new Array(3),Coordinates._rotationMatrix[0]=[-.0548755604,-.8734370902,-.4838350155],Coordinates._rotationMatrix[1]=[.4941094279,-.44482963,.7469822445],Coordinates._rotationMatrix[2]=[-.867666149,-.1980763734,.4559837762]);for(var r=new Array(3),n=0;n<3;n++)r[n]=i[0]*Coordinates._rotationMatrix[0][n]+i[1]*Coordinates._rotationMatrix[1][n]+i[2]*Coordinates._rotationMatrix[2][n];var s=Math.atan2(r[1],r[0]);s<0&&(s+=2*Math.PI),s>2*Math.PI&&(s-=2*Math.PI);var a=Math.atan2(r[2],Math.sqrt(r[0]*r[0]+r[1]*r[1]));return[s/Math.PI*180,a/Math.PI*180]};var Coordinates$={distance:function(e){var t=this.get_lat(),i=this.get_lng()*Math.cos(t*Coordinates.RC),r=e.get_lat(),n=e.get_lng()*Math.cos(r*Coordinates.RC);return Math.sqrt((t-r)*(t-r)+(i-n)*(i-n))},distance3d:function(e){var t=Coordinates.geoTo3dDouble(e.get_lat(),e.get_lng()),i=Coordinates.geoTo3dDouble(this.get_lat(),this.get_lng());return Vector3d.subtractVectors(t,i).length()/Coordinates.RC},angle:function(e){var t=this.get_lat(),i=this.get_lng()*Math.cos(t*Coordinates.RC),r=e.get_lat(),n=e.get_lng()*Math.cos(r*Coordinates.RC);return Math.atan2(r-t,n-i)},get_RA:function(){return(this._ascention/Math.PI*12+12)%24},set_RA:function(e){return this._ascention=e/12*Math.PI,e},get_dec:function(){return this._declination/Coordinates.RC},set_dec:function(e){return this._declination=e*Coordinates.RC,e},get_lat:function(){return this._declination/Coordinates.RC},set_lat:function(e){return this._declination=e*Coordinates.RC,e},get_lng:function(){var e=this._ascention/Coordinates.RC;return e<=180?e:180-e-180},set_lng:function(e){return this._ascention=e*Coordinates.RC+2*Math.PI%(2*Math.PI),e},get_alt:function(){return this._declination/Coordinates.RC},set_alt:function(e){return this._declination=e*Coordinates.RC,e},get_az:function(){return this._ascention/Coordinates.RC},set_az:function(e){return this._ascention=e*Coordinates.RC,e},toString:function(){return ss.ss.format("Lat: {0}, Lng: {1}",this.get_lat(),this.get_lng())}};function FastMath(){}registerType("Coordinates",[Coordinates,Coordinates$,null]);const pI4_A=.785398155450821,pI4_B=7.94662735614793e-9,pI4_C=306161699786838e-31,m_1_PI=.318309886183791;FastMath._mulsign=function(e,t){return FastMath._sign(t)*e},FastMath._isnan=function(e){return e!=e},FastMath._isinf=function(e){return Math.abs(e)===Number.POSITIVE_INFINITY},FastMath._sign=function(e){return e?e>0?1:-1:0},FastMath._atanhelper=function(e){var t=e*e,i=-188796008463073e-19;return(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i*t+.000209850076645817)*t-.00110611831486672)*t+.00370026744188713)*t-.00889896195887655)*t+.0165993297735292)*t-.0254517624932313)*t+.0337852580001353)*t-.0407629191276837)*t+.0466667150077841)*t-.0523674852303482)*t+.0587666392926674)*t-.0666573579361081)*t+.076921953831177)*t-.090908995008245)*t+.111111105648261)*t-.142857142667713)*t+.199999999996591)*t-.333333333333311)*t*e+e},FastMath._atan2k=function(e,t){var i=0;if(t<0&&(t=-t,i=-2),e>t){var r=t;t=e,e=-r,i+=1}return FastMath._atanhelper(e/t)+i*(Math.PI/2)},FastMath.atan2=function(e,t){var i=FastMath._atan2k(Math.abs(e),t);return i=FastMath._mulsign(i,t),!FastMath._isinf(t)&&t||(i=Math.PI/2-(FastMath._isinf(t)?FastMath._sign(t)*(Math.PI/2):0)),FastMath._isinf(e)&&(i=Math.PI/2-(FastMath._isinf(t)?FastMath._sign(t)*(1*Math.PI/4):0)),e||(i=-1===FastMath._sign(t)?Math.PI:0),FastMath._isnan(t)||FastMath._isnan(e)?Number.NaN:FastMath._mulsign(i,e)},FastMath.asin=function(e){return FastMath._mulsign(FastMath._atan2k(Math.abs(e),Math.sqrt((1+e)*(1-e))),e)},FastMath.acos=function(e){return FastMath._mulsign(FastMath._atan2k(Math.sqrt((1+e)*(1-e)),Math.abs(e)),e)+(e<0?Math.PI:0)},FastMath.atan=function(e){var t=0;e<0&&(e=-e,t=2),e>1&&(e=1/e,t|=1);var i=FastMath._atanhelper(e);return 1&t&&(i=1.5707963267949-i),2&t&&(i=-i),i},FastMath._sincoshelper=function(e){var t=e*e,i=-797255955009038e-32;return t*(i=(i=(i=(i=(i=(i=(i=(i=i*t+281009972710863e-29)*t-764712219118159e-27)*t+1.60590430605665e-10)*t-2.50521083763502e-8)*t+275573192239199e-20)*t-.000198412698412696)*t+.00833333333333333)*t-.166666666666667)*e+e},FastMath.sin=function(e){var t=e*m_1_PI,i=Math.floor(t<0?t-.5:t+.5),r=4*i;return e-=r*pI4_A,e-=r*pI4_B,e-=r*pI4_C,1&i&&(e=-e),FastMath._sincoshelper(e)},FastMath.cos=function(e){var t=e*m_1_PI-.5,i=1+2*Math.floor(t<0?t-.5:t+.5),r=2*i;return e-=r*pI4_A,e-=r*pI4_B,e-=r*pI4_C,2&i||(e=-e),FastMath._sincoshelper(e)};var FastMath$={};function HealpixTables(){}registerType("FastMath",[FastMath,FastMath$,null]),HealpixTables.ctab=[0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855],HealpixTables.utab=[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845],HealpixTables.jrll=[2,2,2,2,3,3,3,3,4,4,4,4],HealpixTables.jpll=[1,3,5,7,0,2,4,6,1,3,5,7],HealpixTables.xoffset=[-1,-1,0,1,1,1,0,-1],HealpixTables.yoffset=[0,1,1,1,0,-1,-1,-1];var HealpixTables$={};function HealpixUtils(){}registerType("HealpixTables",[HealpixTables,HealpixTables$,null]),HealpixUtils.check=function(e,t){if(!e)throw new Error(t)},HealpixUtils.isqrt=function(e){var t=Math.sqrt(e+.5);return e<1<<50||(t*t>e?--t:(t+1)*(t+1)<=e&&++t),t},HealpixUtils.cosdist_zphi=function(e,t,i,r){return e*i+FastMath.cos(t-r)*Math.sqrt((1-e*e)*(1-i*i))},HealpixUtils.fmodulo=function(e,t){if(e>=0)return e<t?e:e%t;var i=e%t+t;return i===t?0:i};var HealpixUtils$={};function Hploc(){this.z=0,this.phi=0,this.sth=0,this.have_sth=!1}registerType("HealpixUtils",[HealpixUtils,HealpixUtils$,null]),Hploc.create=function(e){var t=new Hploc,i=1/e.length();return t.z=e.z*i,t.phi=FastMath.atan2(e.y,e.x),Math.abs(t.z)>.99&&(t.sth=Math.sqrt(e.x*e.x+e.y*e.y)*i,t.have_sth=!0),t};var Hploc$={toVec3:function(){var e,t=(e=this.have_sth?this.sth:Math.sqrt((1-this.z)*(1+this.z)))*FastMath.cos(this.phi),i=e*FastMath.sin(this.phi);return Vector3d.create(t,this.z,i)}};function Fxyf(){this.fx=0,this.fy=0,this.face=0,HealpixTables.call(this)}registerType("Hploc",[Hploc,Hploc$,null]),Fxyf._halfpi$1=Math.PI/2,Fxyf._inv_halfpi$1=2/Math.PI,Fxyf._twothird$1=2/3,Fxyf.create=function(e,t,i){var r=new Fxyf;return r.fx=e,r.fy=t,r.face=i,r},Fxyf._fromHploc$1=function(e){var t=new Fxyf,i=e.z,r=e.phi,n=Math.abs(i),s=HealpixUtils.fmodulo(r*Fxyf._inv_halfpi$1,4);if(n<=Fxyf._twothird$1){var a=.5+s,o=.75*i,l=(c=a-o)===(u=a+o)?4|c:c<u?c:u+8;t.fx=HealpixUtils.fmodulo(u,1),t.fy=1-HealpixUtils.fmodulo(c,1),t.face=l}else{var h,c,u,d=Math.min(3,ss.ss.truncate(s)),_=s-d;(c=_*(h=n<.99||!e.have_sth?Math.sqrt(3*(1-n)):e.sth/Math.sqrt((1+n)/3)))>=1&&(c=1),(u=(1-_)*h)>=1&&(u=1),i>=0?(t.fx=1-u,t.fy=1-c,t.face=d):(t.fx=c,t.fy=u,t.face=d+8)}return t},Fxyf.fromVector=function(e){return Fxyf._fromHploc$1(Hploc.create(e))};var Fxyf$={toHploc:function(){var e,t,i=new Hploc,r=HealpixTables.jrll[this.face]-this.fx-this.fy;return r<1?(t=(e=r)*e/3,i.z=1-t,i.z>.99&&(i.sth=Math.sqrt(t*(2-t)),i.have_sth=!0)):r>3?(t=(e=4-r)*e/3,i.z=t-1,i.z<-.99&&(i.sth=Math.sqrt(t*(2-t)),i.have_sth=!0)):(e=1,i.z=2*(2-r)/3),(t=HealpixTables.jpll[this.face]*e+this.fx-this.fy)<0&&(t+=8),t>=8&&(t-=8),i.phi=e<1e-15?0:.5*Fxyf._halfpi$1*t/e,i},toVec3:function(){return this.toHploc().toVec3()}};function IFolder(){}function IThumbnail(){}function IPlace(){}function IUiController(){}function IViewMover(){}function IUIServicesCallbacks(){}function ISettings(){}function IUndoStep(){}function Annotation(){this.addedToPrimitives=!1,this.annotationDirty=!0,this._opacity=1,this._showHoverLabel=!1}registerType("Fxyf",[Fxyf,Fxyf$,HealpixTables]),registerType("IFolder",[IFolder]),registerType("IThumbnail",[IThumbnail]),registerType("IPlace",[IPlace]),registerType("IUiController",[IUiController]),registerType("IViewMover",[IViewMover]),registerType("IUIServicesCallbacks",[IUIServicesCallbacks]),registerType("ISettings",[ISettings]),registerType("IUndoStep",[IUndoStep]),Annotation.pointList=null,Annotation.lineList=null,Annotation.triangleFanPointList=null,Annotation.triangleList=null,Annotation.batchDirty=!0,Annotation.prepBatch=function(e){(null==Annotation.pointList||Annotation.batchDirty)&&(Annotation.pointList=new PointList(e),Annotation.lineList=new LineList,Annotation.triangleFanPointList=new TriangleFanList,Annotation.triangleList=new TriangleList,Annotation.lineList.set_depthBuffered(!1),Annotation.triangleList.depthBuffered=!1)},Annotation.drawBatch=function(e){Annotation.batchDirty=!1,null!=e.gl&&(null!=Annotation.pointList&&Annotation.pointList.draw(e,1,!1),null!=Annotation.lineList&&Annotation.lineList.drawLines(e,1),null!=Annotation.triangleFanPointList&&Annotation.triangleFanPointList.draw(e,1),null!=Annotation.triangleList&&Annotation.triangleList.draw(e,1,0))},Annotation.separation=function(e,t,i,r){t=t/180*Math.PI,r=r/180*Math.PI,e=e/12*Math.PI,i=i/12*Math.PI;var n=Math.cos(t)*Math.sin(r)-Math.sin(t)*Math.cos(r)*Math.cos(i-e),s=Math.cos(r)*Math.sin(i-e),a=Math.sin(t)*Math.sin(r)+Math.cos(t)*Math.cos(r)*Math.cos(i-e),o=Math.atan2(Math.sqrt(n*n+s*s),a);return(o=o/Math.PI*180)<0&&(o+=180),o},Annotation.colorToUint=function(e){return e.a<<24|e.r<<16|e.g<<8|e.b},Annotation.colorToUintAlpha=function(e,t){return t<<24|e.r<<16|e.g<<8|e.b};var Annotation$={draw:function(e){},get_opacity:function(){return this._opacity},set_opacity:function(e){return Annotation.batchDirty=!0,this._opacity=e,e},get_id:function(){return this._id},set_id:function(e){return this._id=e,e},get_tag:function(){return this._tag},set_tag:function(e){return this._tag=e,e},get_label:function(){return this._label},set_label:function(e){return this._label=e,e},get_showHoverLabel:function(){return this._showHoverLabel},set_showHoverLabel:function(e){return this._showHoverLabel=e,e},hitTest:function(e,t,i,r,n){return!1},get_center:function(){return this.center},set_center:function(e){return this.center=e,e}};function Circle(){this._fill$1=!1,this._skyRelative$1=!1,this._strokeWidth$1=1,this._radius$1=10,this._lineColor$1=Colors.get_white(),this._fillColor$1=Colors.get_white(),this._ra$1=0,this._dec$1=0,Annotation.call(this)}registerType("Annotation",[Annotation,Annotation$,null]);var Circle$={get_fill:function(){return this._fill$1},set_fill:function(e){return Annotation.batchDirty=!0,this._fill$1=e,e},get_skyRelative:function(){return this._skyRelative$1},set_skyRelative:function(e){return Annotation.batchDirty=!0,this._skyRelative$1=e,e},get_lineWidth:function(){return this._strokeWidth$1},set_lineWidth:function(e){return Annotation.batchDirty=!0,this._strokeWidth$1=e,e},get_radius:function(){return this._radius$1},set_radius:function(e){return Annotation.batchDirty=!0,this._radius$1=e,e},get_lineColor:function(){return this._lineColor$1.toString()},set_lineColor:function(e){return Annotation.batchDirty=!0,this._lineColor$1=Color.load(e),e},get_fillColor:function(){return this._fillColor$1.toString()},set_fillColor:function(e){return Annotation.batchDirty=!0,this._fillColor$1=Color.fromName(e),e},setCenter:function(e,t){Annotation.batchDirty=!0,this._ra$1=e/15,this._dec$1=t,this.center=Coordinates.raDecTo3d(this._ra$1,this._dec$1)},draw:function(e){var t=!0,i=this._radius$1;this._skyRelative$1&&(i/=e.get_fovScale()/3600);var r=e.WVP.transform(this.center);if(r.z<0&&(t=!1),Vector3d.dot(e.get_viewPoint(),this.center)<.55&&(t=!1),null!=e.gl){if(Annotation.batchDirty||this.annotationDirty){var n=Vector3d.create(0,1,0),s=Vector3d.cross(this.center,n),a=Vector3d.cross(this.center,s),o=Math.cos(this._dec$1*Math.PI/180);o=Math.max(o,1e-5);for(var l=this._radius$1*Math.PI/(180*o),h=2*Math.PI/72,c=[],u=0;u<=72;u++){var d=Math.cos(u*h)*l,_=Math.sin(u*h)*l;c.push(Vector3d.create(this.center.x+d*s.x+_*a.x,this.center.y+d*s.y+_*a.y,this.center.z+d*s.z+_*a.z))}if(this._strokeWidth$1>0&&c.length>1){var g=this._lineColor$1._clone();g.a=Math.round(g.a*this.get_opacity());for(var f=0;f<c.length-1;f++)Annotation.lineList.addLine(c[f],c[f+1],g,new Dates(0,1))}if(this._fill$1){var m=this._fillColor$1._clone();m.a=Math.round(m.a*this.get_opacity());var p=Vector3d.create(this.center.x,this.center.y,this.center.z);c.splice(0,0,p),Annotation.triangleFanPointList.addShape(c,m,new Dates(0,1))}this.annotationDirty=!1}}else if(t){var C=e.device;C.save(),C.globalAlpha=this.get_opacity(),C.beginPath(),C.arc(r.x,r.y,i,0,2*Math.PI,!0),C.lineWidth=this._strokeWidth$1,C.fillStyle=this._fillColor$1.toString(),this._fill$1&&C.fill(),C.globalAlpha=1,C.strokeStyle=this._lineColor$1.toString(),C.stroke(),C.restore()}},hitTest:function(e,t,i,r,n){if(ss.ss.emptyString(this.get_id()))return!1;var s=this._radius$1;return this._skyRelative$1||(s*=e.get_fovScale()/3600),Annotation.separation(t,i,this._ra$1,this._dec$1)<s}};function Poly(){this._points$1=[],this._fill$1=!1,this._strokeWidth$1=1,this._lineColor$1=Colors.get_white(),this._fillColor$1=Colors.get_white(),Annotation.call(this)}registerType("Circle",[Circle,Circle$,Annotation]);var Poly$={addPoint:function(e,t){Annotation.batchDirty=!0,this._points$1.push(Coordinates.raDecTo3d(e/15,t))},get_fill:function(){return this._fill$1},set_fill:function(e){return Annotation.batchDirty=!0,this._fill$1=e,e},get_lineWidth:function(){return this._strokeWidth$1},set_lineWidth:function(e){return Annotation.batchDirty=!0,this._strokeWidth$1=e,e},get_lineColor:function(){return this._lineColor$1.toString()},set_lineColor:function(e){return Annotation.batchDirty=!0,this._lineColor$1=Color.fromName(e),e},get_fillColor:function(){return this._fillColor$1.toString()},set_fillColor:function(e){return Annotation.batchDirty=!0,this._fillColor$1=Color.fromName(e),e},draw:function(e){if(null!=e.gl){if(Annotation.batchDirty||this.annotationDirty){var t=this._points$1;if(this._strokeWidth$1>0&&this._points$1.length>1){var i=this._lineColor$1._clone();i.a=Math.round(i.a*this.get_opacity());for(var r=0;r<this._points$1.length-1;r++)Annotation.lineList.addLine(t[r],t[r+1],i,new Dates(0,1));Annotation.lineList.addLine(t[this._points$1.length-1],t[0],i,new Dates(0,1))}if(this._fill$1){var n=this._fillColor$1._clone();n.a=Math.round(n.a*this.get_opacity());var s=Tessellator.tesselateSimplePoly(t);for(r=0;r<s.length;r+=3)Annotation.triangleList.addSubdividedTriangles(t[s[r]],t[s[r+1]],t[s[r+2]],n,new Dates(0,1),2)}this.annotationDirty=!1}}else{var a=e.device;a.save(),a.globalAlpha=this.get_opacity(),a.beginPath();for(var o=!0,l=ss.ss.enumerate(this._points$1);l.moveNext();){var h=l.current,c=e.WVP.transform(h);if(c.z<0)return void a.restore();if(Vector3d.dot(e.get_viewPoint(),h)<.75)return void a.restore();o?(o=!1,a.moveTo(c.x,c.y)):a.lineTo(c.x,c.y)}a.closePath(),a.lineWidth=this._strokeWidth$1,this._fill$1&&(a.fillStyle=this._fillColor$1.toString(),a.fill()),a.strokeStyle=this._lineColor$1.toString(),a.globalAlpha=1,a.stroke(),a.restore()}}};function PolyLine(){this._points$1=[],this._strokeWidth$1=1,this._lineColor$1=Colors.get_white(),Annotation.call(this)}registerType("Poly",[Poly,Poly$,Annotation]);var PolyLine$={addPoint:function(e,t){Annotation.batchDirty=!0,this._points$1.push(Coordinates.raDecTo3d(e/15,t))},get_lineWidth:function(){return this._strokeWidth$1},set_lineWidth:function(e){return Annotation.batchDirty=!0,this._strokeWidth$1=e,e},get_lineColor:function(){return this._lineColor$1.toString()},set_lineColor:function(e){return Annotation.batchDirty=!0,this._lineColor$1=Color.fromName(e),e},draw:function(e){if(null!=e.gl){if(Annotation.batchDirty||this.annotationDirty){var t=this._points$1;if(this._strokeWidth$1>0){var i=this._lineColor$1._clone();i.a=Math.round(i.a*this.get_opacity());for(var r=0;r<this._points$1.length-1;r++)Annotation.lineList.addLine(t[r],t[r+1],i,new Dates(0,1))}this.annotationDirty=!1}}else{var n=e.device;n.save(),n.globalAlpha=this.get_opacity();for(var s=!0,a=ss.ss.enumerate(this._points$1);a.moveNext();){var o=a.current,l=e.WVP.transform(o);if(l.z<0)return void n.restore();if(Vector3d.dot(e.get_viewPoint(),o)<.75)return void n.restore();s?(s=!1,n.beginPath(),n.moveTo(l.x,l.y)):n.lineTo(l.x,l.y)}n.lineWidth=this._strokeWidth$1,n.strokeStyle=this._lineColor$1.toString(),n.stroke(),n.restore()}}};registerType("PolyLine",[PolyLine,PolyLine$,Annotation]);var SolarSystemObjects={sun:0,mercury:1,venus:2,mars:3,jupiter:4,saturn:5,uranus:6,neptune:7,pluto:8,moon:9,io:10,europa:11,ganymede:12,callisto:13,ioShadow:14,europaShadow:15,ganymedeShadow:16,callistoShadow:17,sunEclipsed:18,earth:19,custom:20,undefined:65536};registerType("SolarSystemObjects",SolarSystemObjects),registerEnum("SolarSystemObjects",SolarSystemObjects);var InterpolationType={linear:0,easeIn:1,easeOut:2,easeInOut:3,exponential:4,defaultV:5};function CameraParameters(){this.lat=0,this.lng=0,this.zoom=0,this.rotation=0,this.angle=0,this.raDec=!1,this.opacity=0,this.target=0,this.zoom=360,this.viewTarget=new Vector3d}registerType("InterpolationType",InterpolationType),registerEnum("InterpolationType",InterpolationType),CameraParameters.create=function(e,t,i,r,n,s){var a=new CameraParameters;return a.lat=e,a.lng=t,a.zoom=i,a.rotation=r,a.angle=n,a.raDec=!1,a.opacity=s,a.viewTarget=Vector3d.create(0,0,0),a.target=20,a.targetReferenceFrame="",a},CameraParameters.logN=function(e,t){return Math.log(e)/Math.log(t)},CameraParameters.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2},CameraParameters.interpolate=function(e,t,i,r,n){var s=new CameraParameters,a=CameraParameters.easeCurve(i,r),o=Math.min(1,2*i),l=CameraParameters.easeCurve(o,r);return s.angle=t.angle*a+e.angle*(1-a),s.rotation=t.rotation*a+e.rotation*(1-a),n?(s.lat=t.lat*l+e.lat*(1-l),s.lng=t.lng*l+e.lng*(1-l)):(s.lat=t.lat*a+e.lat*(1-a),s.lng=t.lng*a+e.lng*(1-a)),s.zoom=Math.pow(2,CameraParameters.logN(t.zoom,2)*a+CameraParameters.logN(e.zoom,2)*(1-a)),s.opacity=t.opacity*a+e.opacity*(1-a),s.viewTarget=Vector3d.lerp(e.viewTarget,t.viewTarget,a),s.targetReferenceFrame=t.targetReferenceFrame,t.target===e.target?s.target=t.target:s.target=20,s},CameraParameters.interpolateGreatCircle=function(e,t,i,r,n){var s=new CameraParameters,a=CameraParameters.easeCurve(i,r),o=Math.min(1,2*i);CameraParameters.easeCurve(o,r),s.angle=t.angle*a+e.angle*(1-a),s.rotation=t.rotation*a+e.rotation*(1-a);var l=Coordinates.geoTo3dDouble(e.lat,e.lng),h=Coordinates.geoTo3dDouble(t.lat,t.lng),c=Vector3d.slerp(l,h,a),u=Coordinates.cartesianToLatLng(c);return s.lat=u.y,s.lng=u.x,s.zoom=Math.pow(2,CameraParameters.logN(t.zoom,2)*a+CameraParameters.logN(e.zoom,2)*(1-a)),s.opacity=t.opacity*a+e.opacity*(1-a),s.viewTarget=Vector3d.lerp(e.viewTarget,t.viewTarget,a),s.targetReferenceFrame=t.targetReferenceFrame,t.target===e.target?s.target=t.target:s.target=20,s},CameraParameters.easeCurve=function(e,t){switch(t){case 0:default:return e;case 4:return Math.pow(e,2);case 1:return(1-e)*CameraParameters.sinh(e/.2171424688)/100+e*e;case 2:return e*(1-CameraParameters.sinh((1-e)/.2171424688)/100)+(1-e)*e;case 3:return e<.5?CameraParameters.sinh(e/.1085712344)/100:1-CameraParameters.sinh((1-e)/.1085712344)/100}};var CameraParameters$={copy:function(){var e=new CameraParameters;return e.lat=this.lat,e.lng=this.lng,e.zoom=this.zoom,e.rotation=this.rotation,e.angle=this.angle,e.raDec=this.raDec,e.opacity=this.opacity,e.viewTarget=this.viewTarget.copy(),e.target=this.target,e.targetReferenceFrame=this.targetReferenceFrame,e},get_RA:function(){return(180-(this.lng-180))/360*24%24},set_RA:function(e){return this.lng=180-e/24*360-180,this.raDec=!0,e},get_dec:function(){return this.lat},set_dec:function(e){return this.lat=e,e},equals:function(e){if(ss.ss.canCast(e,CameraParameters)){var t=e;return!(Math.abs(t.angle-this.angle)>.01||Math.abs(t.lat-this.lat)>t.zoom/1e4||Math.abs(t.get_RA()-this.get_RA())>t.zoom/1e3||Math.abs(t.rotation-this.rotation)>.1||Math.abs(t.zoom-this.zoom)>Math.abs(t.zoom)/1e3)}return!1}};function ConstellationFilter(){this.bits=new Array(3),this.oldBits=new Array(3),this.blendState=BlendState.create(!1,1e3),this.internal=!1,this.settingsOwned=!1;for(var e=0;e<3;e++)this.bits[e]=~this.bits[e],this.oldBits[e]=this.bits[e]}registerType("CameraParameters",[CameraParameters,CameraParameters$,null]),ConstellationFilter.families={},ConstellationFilter.bitIDs={},ConstellationFilter.buildConstellationFilters=function(){var e=ConstellationFilter.get_allConstellation();e.internal=!0,ConstellationFilter.families.AllConstellation=e,ConstellationFilter.families.Zodiacal=ConstellationFilter.get_zodiacal(),ConstellationFilter.families["Ursa Major Family"]=ConstellationFilter.get_ursaMajorFamily(),ConstellationFilter.families["Perseus Family"]=ConstellationFilter.get_perseusFamily(),ConstellationFilter.families["Hercules Family"]=ConstellationFilter.get_herculesFamily(),ConstellationFilter.families["Orion Family"]=ConstellationFilter.get_orionFamily(),ConstellationFilter.families["Heavenly Waters"]=ConstellationFilter.get_heavenlyWaters(),ConstellationFilter.families["Bayer Family"]=ConstellationFilter.get_bayerFamily(),ConstellationFilter.families["La Caille Family"]=ConstellationFilter.get_laCaileFamily()},ConstellationFilter.saveCustomFilters=function(){var e=new ss.ss.StringBuilder,t=ConstellationFilter.families;for(var i in t){var r={key:i,value:t[i]};r.value.internal||(e.append(r.key),e.append(";"),e.appendLine(r.value.toString()))}},ConstellationFilter.get_allConstellation=function(){var e=new ConstellationFilter;return e.setAll(!0),e},ConstellationFilter.get_zodiacal=function(){var e=new ConstellationFilter;return e.set("ARI",!0),e.set("TAU",!0),e.set("GEM",!0),e.set("CNC",!0),e.set("LEO",!0),e.set("VIR",!0),e.set("LIB",!0),e.set("SCO",!0),e.set("SGR",!0),e.set("CAP",!0),e.set("AQR",!0),e.set("PSC",!0),e.internal=!0,e},ConstellationFilter.get_ursaMajorFamily=function(){var e=new ConstellationFilter;return e.set("UMA",!0),e.set("UMI",!0),e.set("DRA",!0),e.set("CVN",!0),e.set("BOO",!0),e.set("COM",!0),e.set("CRB",!0),e.set("CAM",!0),e.set("LYN",!0),e.set("LMI",!0),e.internal=!0,e},ConstellationFilter.get_perseusFamily=function(){var e=new ConstellationFilter;return e.set("CAS",!0),e.set("CEP",!0),e.set("AND",!0),e.set("PER",!0),e.set("PEG",!0),e.set("CET",!0),e.set("AUR",!0),e.set("LAC",!0),e.set("TRI",!0),e.internal=!0,e},ConstellationFilter.get_herculesFamily=function(){var e=new ConstellationFilter;return e.set("HER",!0),e.set("SGE",!0),e.set("AQL",!0),e.set("LYR",!0),e.set("CYG",!0),e.set("VUL",!0),e.set("HYA",!0),e.set("SEX",!0),e.set("CRT",!0),e.set("CRV",!0),e.set("OPH",!0),e.set("SER1",!0),e.set("SER2",!0),e.set("SCT",!0),e.set("CEN",!0),e.set("LUP",!0),e.set("CRA",!0),e.set("ARA",!0),e.set("TRA",!0),e.set("CRU",!0),e.internal=!0,e},ConstellationFilter.get_orionFamily=function(){var e=new ConstellationFilter;return e.set("ORI",!0),e.set("CMA",!0),e.set("CMI",!0),e.set("MON",!0),e.set("LEP",!0),e.internal=!0,e},ConstellationFilter.get_heavenlyWaters=function(){var e=new ConstellationFilter;return e.set("DEL",!0),e.set("EQU",!0),e.set("ERI",!0),e.set("PSA",!0),e.set("CAR",!0),e.set("PUP",!0),e.set("VEL",!0),e.set("PYX",!0),e.set("COL",!0),e.internal=!0,e},ConstellationFilter.get_bayerFamily=function(){var e=new ConstellationFilter;return e.set("HYA",!0),e.set("DOR",!0),e.set("VOL",!0),e.set("APS",!0),e.set("PAV",!0),e.set("GRU",!0),e.set("PHE",!0),e.set("TUC",!0),e.set("IND",!0),e.set("CHA",!0),e.set("MUS",!0),e.internal=!0,e},ConstellationFilter.get_laCaileFamily=function(){var e=new ConstellationFilter;return e.set("NOR",!0),e.set("CIR",!0),e.set("TEL",!0),e.set("MIC",!0),e.set("SCL",!0),e.set("FOR",!0),e.set("CAE",!0),e.set("HOR",!0),e.set("OCT",!0),e.set("MEN",!0),e.set("RET",!0),e.set("PIC",!0),e.set("ANT",!0),e.internal=!0,e},ConstellationFilter.parse=function(e){var t=e.split(","),i=new ConstellationFilter;try{for(var r=0;r<3;r++)i.bits[r]=parseInt(t[r])}catch(e){}return i};var ConstellationFilter$={_saveBits:function(){for(var e=0;e<3;e++)this.oldBits[e]=this.bits[e]},_isChanged:function(){for(var e=0;e<3;e++)if(this.oldBits[e]!==this.bits[e])return!0;return!1},_checkChanged:function(){this._isChanged()&&this._fireChanged()},isEnabled:function(e){var t=ConstellationFilter.bitIDs[e],i=t/32;return t%=32,this.blendState.get_state()&&!!(1<<t&this.bits[i])},isSet:function(e){this._saveBits();var t=ConstellationFilter.bitIDs[e],i=ss.ss.truncate(t/32);return!!(1<<(t%=32)&this.bits[i])},set:function(e,t){this._saveBits();var i=ConstellationFilter.bitIDs[e],r=i/32;i%=32,this.bits[r]=t?this.bits[r]|1<<i:this.bits[r]^1<<i,this._checkChanged()},setAll:function(e){this._saveBits();for(var t=0;t<89;t++){var i=t/32,r=t%32;this.bits[i]=e?this.bits[i]|1<<r:this.bits[i]^1<<r}this._checkChanged()},setBits:function(e){this._saveBits();for(var t=0;t<3;t++)this.bits[t]=e[4*t]+(e[4*t+1]<<8)+(e[4*t+2]<<16)+(e[4*t+3]<<24);this._checkChanged()},getBits:function(){for(var e=new Array(12),t=0,i=0;i<3;i++)e[t++]=this.bits[i],e[t++]=this.bits[i]>>8,e[t++]=this.bits[i]>>16,e[t++]=this.bits[i]>>24;return e},cloneFilter:function(e){this._saveBits();for(var t=0;t<3;t++)this.bits[t]=e.bits[t];this._checkChanged()},clone:function(){var e=new ConstellationFilter;return e.cloneFilter(this),e},combine:function(e){this._saveBits();for(var t=0;t<3;t++)this.bits[t]=this.bits[t]|e.bits[t];this._checkChanged()},remove:function(e){this._saveBits();for(var t=0;t<3;t++)this.bits[t]=this.bits[t]&~e.bits[t];this._checkChanged()},_fireChanged:function(){this.settingsOwned},toString:function(){return ss.ss.format("{0},{1},{2}",this.bits[0],this.bits[1],this.bits[2])}};registerType("ConstellationFilter",[ConstellationFilter,ConstellationFilter$,null]);var ScaleTypes={linear:0,log:1,power:2,squareRoot:3,histogramEqualization:4};function FitsProperties(){this.bZero=0,this.bScale=1,this.containsBlanks=!1,this.blankValue=Number.MIN_VALUE,this.maxVal=Number.MIN_VALUE,this.minVal=Number.MAX_VALUE,this.upperCut=Number.MIN_VALUE,this.lowerCut=Number.MAX_VALUE,this.transparentBlack=!1,this.colorMapName="viridis",this.scaleType=0,this.onMainImageLoaded=null,this.mainImageLoadedEventHasFired=!1}registerType("ScaleTypes",ScaleTypes),registerEnum("ScaleTypes",ScaleTypes);var FitsProperties$={_fireMainImageLoaded:function(e){null==this.onMainImageLoaded||this.mainImageLoadedEventHasFired||(this.mainImageLoadedEventHasFired=!0,this.onMainImageLoaded(e))}};function Star(e){this.magnitude=0,this.RA=0,this.dec=0,this.BMV=0,this.id=0,this.absoluteMagnitude=0,this.par=0,this.distance=0;var t=e.split("\t");if(this.id=parseInt(ss.ss.replaceString(t[0],"HIP","")),this.dec=parseFloat(t[3]),this.RA=parseFloat(t[2])/15,t.length>4)try{"NULL"!==t[4].toUpperCase()&&t[4]&&(this.magnitude=parseFloat(t[4]))}catch(e){}if(t.length>5)try{this.BMV=parseFloat(t[5]),this._makeColor(this.BMV)}catch(e){}t.length>6&&(this.par=parseFloat(t[6]),this._makeDistanceAndMagnitude())}registerType("FitsProperties",[FitsProperties,FitsProperties$,null]);var Star$={get_name:function(){return"HIP"+this.id.toString()},get_coordinates:function(){return Coordinates.fromRaDec(this.RA,this.dec)},stars:function(e,t){var i=e.split("\t");if(this.id=parseInt(i[0]),this.RA=parseFloat(i[1])/15,this.dec=parseFloat(i[2]),i.length>3)try{this.magnitude=parseFloat(i[3])}catch(e){}if(i.length>4)try{this.col=Color.load(i[4])}catch(e){}},_makeDistanceAndMagnitude:function(){this.distance=1/(this.par/1e3),this.absoluteMagnitude=this.magnitude-5*(Util.logN(this.distance,10)-1),this.distance*=206264.806},_makeColor:function(e){var t=4294967295;e<=-.32?t=4288854271:e<=-.31?t=4288919807:e<=-.3?t=4288985855:e<=-.28?t=4289182975:e<=-.26?t=4289314303:e<=-.24?t=4289445887:e<=-.2?t=4289708799:e<=-.16?t=4290037503:e<=-.14?t=4290169087:e<=-.12?t=4290366207:e<=-.09?t=4290563583:e<=-.06?t=4290892031:e<=0?t=4291483391:e<=.06?t=4292009215:e<=.14?t=4292732159:e<=.19?t=4293126399:e<=.31?t=4294111999:e<=.36?t=4294571775:e<=.43?t=4294965756:e<=.54?t=4294964979:e<=.59?t=4294964203:e<=.63?t=4294963687:e<=.66?t=4294963169:e<=.74?t=4294962909:e<=.82?t=4294961877:e<=.92?t=4294960324:e<=1.15?t=68719468472:e<=1.3?t=4294958516:e<=1.41?t=4294955933:e<=1.48?t=4294954385:e<=1.52?t=4294953351:e<=1.55?t=4294952319:e<=1.56?t=4294951287:e<=1.61?t=4294950257:e<=1.72?t=4294948966:e<=1.84?t=4294947419:e<=2&&(t=4294946129),this.col=Color.fromInt(t)}};function Galaxy(e){this.RA=0,this.dec=0,this.distance=0,this.type=0,this.eTypeBucket=0,this.size=5,this.sdssID=0,this.sdssID=e.readInt64(),this.RA=e.readSingle(),this.dec=e.readSingle(),this.distance=e.readSingle(),this.eTypeBucket=e.readByte(),this.size=e.readSingle()}registerType("Star",[Star,Star$,null]),Galaxy._eTypeBuckets=[-3,-.186,-.168,-.158,-.15,-.143,-.137,-.13,-.123,-.115,-.104,-.089,-.068,-.042,-.011,.024,.064,.111,.169,.252,3],Galaxy.getEType=function(e){for(var t=0,i=Galaxy._eTypeBuckets.length-1;i-t>1;){var r=(t+i)/2;e>Galaxy._eTypeBuckets[r]?t=r:i=r}return t};var Galaxy$={};function UiTools(){}registerType("Galaxy",[Galaxy,Galaxy$,null]),UiTools.kilometersPerAu=149598e3,UiTools.auPerParsec=206264.806,UiTools.auPerLightYear=63239.6717,UiTools.ssmUnitConversion=370,UiTools.gamma=function(e,t){return Math.min(255,ss.ss.truncate(255*Math.pow(e/255,1/t)+.5))},UiTools.getNamesStringFromArray=function(e){for(var t="",i="",r=ss.ss.enumerate(e);r.moveNext();)t+=i,t+=r.current,i=";";return t},UiTools.solarSystemToMeters=function(e){return 149598e3*e*370},UiTools.metersToSolarSystemDistance=function(e){return e/370*149598e3},UiTools.metersToZoom=function(e){return(e/1e3/370-1e-6)/4*9},UiTools.formatDistance=function(e){if(e<.1){var t=149598e3*e;if(t<10){var i=ss.ss.truncate(1e3*t);return ss.ss.format("{0} m",i)}return t=ss.ss.truncate(t),ss.ss.format("{0} km",t)}if(e<10){var r=ss.ss.truncate(10*e)/10;return ss.ss.format("{0} au",r)}if(e<6323.96717)return r=ss.ss.truncate(e),ss.ss.format("{0} au",r);if(e<632396.717){var n=ss.ss.truncate(10*e/63239.6717)/10;return ss.ss.format("{0} ly",n)}if(e<63239671700)return n=ss.ss.truncate(e/63239.6717),ss.ss.format("{0} ly",n);if(e<206264806e4){var s=ss.ss.truncate(10*e/206264806e3)/10;return ss.ss.format("{0} Mpc",s)}return e<206264806e6?(s=ss.ss.truncate(e/206264806e3),ss.ss.format("{0} Mpc",s)):(s=ss.ss.truncate(10*e/206264806e6)/10,ss.ss.format("{0} Gpc",s))},UiTools.formatDecimalHours=function(e){ss.ss.now().getTimezoneOffset();for(var t=e-0+.0083333334;t>24;)t-=24;for(;t<0;)t+=24;var i=ss.ss.truncate(t),r=ss.ss.truncate(60*t-60*i),n=ss.ss.truncate(3600*t-(3600*i+60*r));return ss.ss.format("{0}:{1}",i,r,n)},UiTools.splitString=function(e,t){for(var i=[],r=0,n=0,s=0,a=0;n<e.length;){if("("===e.substr(n,1)&&r++,")"===e.substr(n,1)&&r--,n===e.length-1){if(e.substr(n,1)===t)return i.push(e.substr(a,s)),i.push(""),i;s++}n===e.length-1||e.substr(n,1)===t&&"\t"===t||!r&&e.substr(n,1)===t?(i.push(e.substr(a,s)),a=n+1,s=0):s++,n++}return i},UiTools.split=function(e,t){for(var i=[],r=0,n=0,s=0;r<e.length;)r===e.length-1&&n++,r===e.length-1||t.indexOf(e.substr(r,1))>-1?(i.push(e.substr(s,n)),s=r+1,n=0):n++,r++;return i},UiTools._beep=function(){};var UiTools$={};registerType("UiTools",[UiTools,UiTools$,null]);var StateType={pending:0,received:1,error:2};function WebFile(e){this._state=0,this.responseType="",this._triedOnce=!1,this._url=e}registerType("StateType",StateType),registerEnum("StateType",StateType);var WebFile$={send:function(){"undefined"!=typeof navigator&&(this._CORS(),this.set_state(StateType.pending))},get_message:function(){return this._message},get_state:function(){return this._state},set_state:function(e){return this._state=e,null!=this.onStateChange&&this.onStateChange(),e},_loadData:function(e){this._data=e,this.set_state(StateType.received)},_loadBlob:function(e){this._blobdata=e,this.set_state(StateType.received)},_error:function(){this._message=ss.ss.format("Error encountered loading {0}",this._url),this.set_state(StateType.error)},_timeOut:function(){this._message=ss.ss.format("Timeout encountered loading {0}",this._url),this.set_state(StateType.error)},_CORS:function(){var e=this;this._xhr=new XMLHttpRequest;try{this._xhr.open("GET",this._url),null!=this.responseType&&(this._xhr.responseType=this.responseType),this._xhr.onreadystatechange=function(){if(4===e._xhr.readyState)if(e._xhr.status)e._xhr.status>=400?(e._message=e._xhr.statusText,e.set_state(StateType.error)):e.responseType?e._loadBlob(e._xhr.response):e._loadData(e._xhr.responseText);else if(!e._triedOnce){e._triedOnce=!0,e._xhr.onreadystatechange=null;var t=URLHelpers.singleton.activateProxy(e._url);null!==t?(e._url=t,e._CORS()):(e._message=e._xhr.statusText,e.set_state(StateType.error))}},this._xhr.send()}catch(e){throw this._message=e.message,this.set_state(StateType.error),e}},getText:function(){return this._data},getBlob:function(){return this._blobdata},getXml:function(){return(new DOMParser).parseFromString(this._data,"text/xml")}};function ColorMapContainer(){this.colors=[]}registerType("WebFile",[WebFile,WebFile$,null]),ColorMapContainer.colorTextures={},ColorMapContainer.fromArgbList=function(e){for(var t=new ColorMapContainer,i=ss.ss.enumerate(e);i.moveNext();){var r=i.current;t.colors.push(Color.fromArgb(r[0],r[1],r[2],r[3]))}return t},ColorMapContainer.fromStringList=function(e){for(var t=new ColorMapContainer,i=ss.ss.enumerate(e);i.moveNext();){var r=i.current;t.colors.push(Color.load(r))}return t},ColorMapContainer.fromNamedColormap=function(e){if(null==e)return null;switch(e.toLowerCase()){case"viridis":return ColorMapContainer.viridis;case"plasma":return ColorMapContainer.plasma;case"inferno":return ColorMapContainer.inferno;case"magma":return ColorMapContainer.magma;case"cividis":return ColorMapContainer.cividis;case"greys":return ColorMapContainer.greys;case"gray":return ColorMapContainer.gray;case"purples":return ColorMapContainer.purples;case"blues":return ColorMapContainer.blues;case"greens":return ColorMapContainer.greens;case"oranges":return ColorMapContainer.oranges;case"reds":return ColorMapContainer.reds;case"rdylbu":return ColorMapContainer.rdYlBu}return null},ColorMapContainer._getTextureFromName=function(e,t){var i=ColorMapContainer.colorTextures[t];if(null==i){var r=ColorMapContainer.fromNamedColormap(t);null!=r&&(i=ColorMapContainer._initColorTexture(e,r),ColorMapContainer.colorTextures[t.toLowerCase()]=i)}return i},ColorMapContainer.bindColorMapTexture=function(e,t){var i=ColorMapContainer._getTextureFromName(e,t);null==i&&(i=ColorMapContainer._getTextureFromName(e,"gray")),e.activeTexture(WEBGL.TEXTURE1),e.bindTexture(WEBGL.TEXTURE_2D,i)},ColorMapContainer._initColorTexture=function(e,t){var i=e.createTexture();e.activeTexture(WEBGL.TEXTURE1),e.bindTexture(WEBGL.TEXTURE_2D,i),e.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_S,WEBGL.CLAMP_TO_EDGE),e.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_T,WEBGL.CLAMP_TO_EDGE);var r=ColorMapContainer._extractColorArray(t.colors);return e.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGB8,r.length/3,1,0,WEBGL.RGB,WEBGL.UNSIGNED_BYTE,r),e.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.NEAREST),e.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MAG_FILTER,WEBGL.NEAREST),i},ColorMapContainer._extractColorArray=function(e){for(var t=0,i=new Uint8Array(3*e.length),r=ss.ss.enumerate(e);r.moveNext();){var n=r.current;i[t++]=n.r,i[t++]=n.g,i[t++]=n.b}return i};var ColorMapContainer$={findClosestColor:function(e){var t;return e<=0?this.colors[0]:e>=1?this.colors[this.colors.length-1]:(t=ss.ss.truncate(e*this.colors.length),this.colors[t])}};function WcsImage(){this.copyright="",this.creditsUrl="",this._validWcs=!1,this.keywords=[],this.description="",this.scaleX=0,this.scaleY=0,this.centerX=0,this.centerY=0,this.rotation=0,this.referenceX=0,this.referenceY=0,this.sizeX=0,this.sizeY=0,this.cd1_1=0,this.cd1_2=0,this.cd2_1=0,this.cd2_2=0,this.hasRotation=!1,this.hasSize=!1,this.hasScale=!1,this.hasLocation=!1,this.hasPixel=!1,this.filename="",this._colorCombine=!1}registerType("ColorMapContainer",[ColorMapContainer,ColorMapContainer$,null]),ColorMapContainer.viridis=ColorMapContainer.fromStringList(["#440154","#440256","#450457","#450559","#46075a","#46085c","#460a5d","#460b5e","#470d60","#470e61","#471063","#471164","#471365","#481467","#481668","#481769","#48186a","#481a6c","#481b6d","#481c6e","#481d6f","#481f70","#482071","#482173","#482374","#482475","#482576","#482677","#482878","#482979","#472a7a","#472c7a","#472d7b","#472e7c","#472f7d","#46307e","#46327e","#46337f","#463480","#453581","#453781","#453882","#443983","#443a83","#443b84","#433d84","#433e85","#423f85","#424086","#424186","#414287","#414487","#404588","#404688","#3f4788","#3f4889","#3e4989","#3e4a89","#3e4c8a","#3d4d8a","#3d4e8a","#3c4f8a","#3c508b","#3b518b","#3b528b","#3a538b","#3a548c","#39558c","#39568c","#38588c","#38598c","#375a8c","#375b8d","#365c8d","#365d8d","#355e8d","#355f8d","#34608d","#34618d","#33628d","#33638d","#32648e","#32658e","#31668e","#31678e","#31688e","#30698e","#306a8e","#2f6b8e","#2f6c8e","#2e6d8e","#2e6e8e","#2e6f8e","#2d708e","#2d718e","#2c718e","#2c728e","#2c738e","#2b748e","#2b758e","#2a768e","#2a778e","#2a788e","#29798e","#297a8e","#297b8e","#287c8e","#287d8e","#277e8e","#277f8e","#27808e","#26818e","#26828e","#26828e","#25838e","#25848e","#25858e","#24868e","#24878e","#23888e","#23898e","#238a8d","#228b8d","#228c8d","#228d8d","#218e8d","#218f8d","#21908d","#21918c","#20928c","#20928c","#20938c","#1f948c","#1f958b","#1f968b","#1f978b","#1f988b","#1f998a","#1f9a8a","#1e9b8a","#1e9c89","#1e9d89","#1f9e89","#1f9f88","#1fa088","#1fa188","#1fa187","#1fa287","#20a386","#20a486","#21a585","#21a685","#22a785","#22a884","#23a983","#24aa83","#25ab82","#25ac82","#26ad81","#27ad81","#28ae80","#29af7f","#2ab07f","#2cb17e","#2db27d","#2eb37c","#2fb47c","#31b57b","#32b67a","#34b679","#35b779","#37b878","#38b977","#3aba76","#3bbb75","#3dbc74","#3fbc73","#40bd72","#42be71","#44bf70","#46c06f","#48c16e","#4ac16d","#4cc26c","#4ec36b","#50c46a","#52c569","#54c568","#56c667","#58c765","#5ac864","#5cc863","#5ec962","#60ca60","#63cb5f","#65cb5e","#67cc5c","#69cd5b","#6ccd5a","#6ece58","#70cf57","#73d056","#75d054","#77d153","#7ad151","#7cd250","#7fd34e","#81d34d","#84d44b","#86d549","#89d548","#8bd646","#8ed645","#90d743","#93d741","#95d840","#98d83e","#9bd93c","#9dd93b","#a0da39","#a2da37","#a5db36","#a8db34","#aadc32","#addc30","#b0dd2f","#b2dd2d","#b5de2b","#b8de29","#bade28","#bddf26","#c0df25","#c2df23","#c5e021","#c8e020","#cae11f","#cde11d","#d0e11c","#d2e21b","#d5e21a","#d8e219","#dae319","#dde318","#dfe318","#e2e418","#e5e419","#e7e419","#eae51a","#ece51b","#efe51c","#f1e51d","#f4e61e","#f6e620","#f8e621","#fbe723","#fde725"]),ColorMapContainer.plasma=ColorMapContainer.fromStringList(["#0d0887","#100788","#130789","#16078a","#19068c","#1b068d","#1d068e","#20068f","#220690","#240691","#260591","#280592","#2a0593","#2c0594","#2e0595","#2f0596","#310597","#330597","#350498","#370499","#38049a","#3a049a","#3c049b","#3e049c","#3f049c","#41049d","#43039e","#44039e","#46039f","#48039f","#4903a0","#4b03a1","#4c02a1","#4e02a2","#5002a2","#5102a3","#5302a3","#5502a4","#5601a4","#5801a4","#5901a5","#5b01a5","#5c01a6","#5e01a6","#6001a6","#6100a7","#6300a7","#6400a7","#6600a7","#6700a8","#6900a8","#6a00a8","#6c00a8","#6e00a8","#6f00a8","#7100a8","#7201a8","#7401a8","#7501a8","#7701a8","#7801a8","#7a02a8","#7b02a8","#7d03a8","#7e03a8","#8004a8","#8104a7","#8305a7","#8405a7","#8606a6","#8707a6","#8808a6","#8a09a5","#8b0aa5","#8d0ba5","#8e0ca4","#8f0da4","#910ea3","#920fa3","#9410a2","#9511a1","#9613a1","#9814a0","#99159f","#9a169f","#9c179e","#9d189d","#9e199d","#a01a9c","#a11b9b","#a21d9a","#a31e9a","#a51f99","#a62098","#a72197","#a82296","#aa2395","#ab2494","#ac2694","#ad2793","#ae2892","#b02991","#b12a90","#b22b8f","#b32c8e","#b42e8d","#b52f8c","#b6308b","#b7318a","#b83289","#ba3388","#bb3488","#bc3587","#bd3786","#be3885","#bf3984","#c03a83","#c13b82","#c23c81","#c33d80","#c43e7f","#c5407e","#c6417d","#c7427c","#c8437b","#c9447a","#ca457a","#cb4679","#cc4778","#cc4977","#cd4a76","#ce4b75","#cf4c74","#d04d73","#d14e72","#d24f71","#d35171","#d45270","#d5536f","#d5546e","#d6556d","#d7566c","#d8576b","#d9586a","#da5a6a","#da5b69","#db5c68","#dc5d67","#dd5e66","#de5f65","#de6164","#df6263","#e06363","#e16462","#e26561","#e26660","#e3685f","#e4695e","#e56a5d","#e56b5d","#e66c5c","#e76e5b","#e76f5a","#e87059","#e97158","#e97257","#ea7457","#eb7556","#eb7655","#ec7754","#ed7953","#ed7a52","#ee7b51","#ef7c51","#ef7e50","#f07f4f","#f0804e","#f1814d","#f1834c","#f2844b","#f3854b","#f3874a","#f48849","#f48948","#f58b47","#f58c46","#f68d45","#f68f44","#f79044","#f79143","#f79342","#f89441","#f89540","#f9973f","#f9983e","#f99a3e","#fa9b3d","#fa9c3c","#fa9e3b","#fb9f3a","#fba139","#fba238","#fca338","#fca537","#fca636","#fca835","#fca934","#fdab33","#fdac33","#fdae32","#fdaf31","#fdb130","#fdb22f","#fdb42f","#fdb52e","#feb72d","#feb82c","#feba2c","#febb2b","#febd2a","#febe2a","#fec029","#fdc229","#fdc328","#fdc527","#fdc627","#fdc827","#fdca26","#fdcb26","#fccd25","#fcce25","#fcd025","#fcd225","#fbd324","#fbd524","#fbd724","#fad824","#fada24","#f9dc24","#f9dd25","#f8df25","#f8e125","#f7e225","#f7e425","#f6e626","#f6e826","#f5e926","#f5eb27","#f4ed27","#f3ee27","#f3f027","#f2f227","#f1f426","#f1f525","#f0f724","#f0f921"]),ColorMapContainer.inferno=ColorMapContainer.fromStringList(["#000004","#010005","#010106","#010108","#02010a","#02020c","#02020e","#030210","#040312","#040314","#050417","#060419","#07051b","#08051d","#09061f","#0a0722","#0b0724","#0c0826","#0d0829","#0e092b","#10092d","#110a30","#120a32","#140b34","#150b37","#160b39","#180c3c","#190c3e","#1b0c41","#1c0c43","#1e0c45","#1f0c48","#210c4a","#230c4c","#240c4f","#260c51","#280b53","#290b55","#2b0b57","#2d0b59","#2f0a5b","#310a5c","#320a5e","#340a5f","#360961","#380962","#390963","#3b0964","#3d0965","#3e0966","#400a67","#420a68","#440a68","#450a69","#470b6a","#490b6a","#4a0c6b","#4c0c6b","#4d0d6c","#4f0d6c","#510e6c","#520e6d","#540f6d","#550f6d","#57106e","#59106e","#5a116e","#5c126e","#5d126e","#5f136e","#61136e","#62146e","#64156e","#65156e","#67166e","#69166e","#6a176e","#6c186e","#6d186e","#6f196e","#71196e","#721a6e","#741a6e","#751b6e","#771c6d","#781c6d","#7a1d6d","#7c1d6d","#7d1e6d","#7f1e6c","#801f6c","#82206c","#84206b","#85216b","#87216b","#88226a","#8a226a","#8c2369","#8d2369","#8f2469","#902568","#922568","#932667","#952667","#972766","#982766","#9a2865","#9b2964","#9d2964","#9f2a63","#a02a63","#a22b62","#a32c61","#a52c60","#a62d60","#a82e5f","#a92e5e","#ab2f5e","#ad305d","#ae305c","#b0315b","#b1325a","#b3325a","#b43359","#b63458","#b73557","#b93556","#ba3655","#bc3754","#bd3853","#bf3952","#c03a51","#c13a50","#c33b4f","#c43c4e","#c63d4d","#c73e4c","#c83f4b","#ca404a","#cb4149","#cc4248","#ce4347","#cf4446","#d04545","#d24644","#d34743","#d44842","#d54a41","#d74b3f","#d84c3e","#d94d3d","#da4e3c","#db503b","#dd513a","#de5238","#df5337","#e05536","#e15635","#e25734","#e35933","#e45a31","#e55c30","#e65d2f","#e75e2e","#e8602d","#e9612b","#ea632a","#eb6429","#eb6628","#ec6726","#ed6925","#ee6a24","#ef6c23","#ef6e21","#f06f20","#f1711f","#f1731d","#f2741c","#f3761b","#f37819","#f47918","#f57b17","#f57d15","#f67e14","#f68013","#f78212","#f78410","#f8850f","#f8870e","#f8890c","#f98b0b","#f98c0a","#f98e09","#fa9008","#fa9207","#fa9407","#fb9606","#fb9706","#fb9906","#fb9b06","#fb9d07","#fc9f07","#fca108","#fca309","#fca50a","#fca60c","#fca80d","#fcaa0f","#fcac11","#fcae12","#fcb014","#fcb216","#fcb418","#fbb61a","#fbb81d","#fbba1f","#fbbc21","#fbbe23","#fac026","#fac228","#fac42a","#fac62d","#f9c72f","#f9c932","#f9cb35","#f8cd37","#f8cf3a","#f7d13d","#f7d340","#f6d543","#f6d746","#f5d949","#f5db4c","#f4dd4f","#f4df53","#f4e156","#f3e35a","#f3e55d","#f2e661","#f2e865","#f2ea69","#f1ec6d","#f1ed71","#f1ef75","#f1f179","#f2f27d","#f2f482","#f3f586","#f3f68a","#f4f88e","#f5f992","#f6fa96","#f8fb9a","#f9fc9d","#fafda1","#fcffa4"]),ColorMapContainer.magma=ColorMapContainer.fromStringList(["#000004","#010005","#010106","#010108","#020109","#02020b","#02020d","#03030f","#030312","#040414","#050416","#060518","#06051a","#07061c","#08071e","#090720","#0a0822","#0b0924","#0c0926","#0d0a29","#0e0b2b","#100b2d","#110c2f","#120d31","#130d34","#140e36","#150e38","#160f3b","#180f3d","#19103f","#1a1042","#1c1044","#1d1147","#1e1149","#20114b","#21114e","#221150","#241253","#251255","#271258","#29115a","#2a115c","#2c115f","#2d1161","#2f1163","#311165","#331067","#341069","#36106b","#38106c","#390f6e","#3b0f70","#3d0f71","#3f0f72","#400f74","#420f75","#440f76","#451077","#471078","#491078","#4a1079","#4c117a","#4e117b","#4f127b","#51127c","#52137c","#54137d","#56147d","#57157e","#59157e","#5a167e","#5c167f","#5d177f","#5f187f","#601880","#621980","#641a80","#651a80","#671b80","#681c81","#6a1c81","#6b1d81","#6d1d81","#6e1e81","#701f81","#721f81","#732081","#752181","#762181","#782281","#792282","#7b2382","#7c2382","#7e2482","#802582","#812581","#832681","#842681","#862781","#882781","#892881","#8b2981","#8c2981","#8e2a81","#902a81","#912b81","#932b80","#942c80","#962c80","#982d80","#992d80","#9b2e7f","#9c2e7f","#9e2f7f","#a02f7f","#a1307e","#a3307e","#a5317e","#a6317d","#a8327d","#aa337d","#ab337c","#ad347c","#ae347b","#b0357b","#b2357b","#b3367a","#b5367a","#b73779","#b83779","#ba3878","#bc3978","#bd3977","#bf3a77","#c03a76","#c23b75","#c43c75","#c53c74","#c73d73","#c83e73","#ca3e72","#cc3f71","#cd4071","#cf4070","#d0416f","#d2426f","#d3436e","#d5446d","#d6456c","#d8456c","#d9466b","#db476a","#dc4869","#de4968","#df4a68","#e04c67","#e24d66","#e34e65","#e44f64","#e55064","#e75263","#e85362","#e95462","#ea5661","#eb5760","#ec5860","#ed5a5f","#ee5b5e","#ef5d5e","#f05f5e","#f1605d","#f2625d","#f2645c","#f3655c","#f4675c","#f4695c","#f56b5c","#f66c5c","#f66e5c","#f7705c","#f7725c","#f8745c","#f8765c","#f9785d","#f9795d","#f97b5d","#fa7d5e","#fa7f5e","#fa815f","#fb835f","#fb8560","#fb8761","#fc8961","#fc8a62","#fc8c63","#fc8e64","#fc9065","#fd9266","#fd9467","#fd9668","#fd9869","#fd9a6a","#fd9b6b","#fe9d6c","#fe9f6d","#fea16e","#fea36f","#fea571","#fea772","#fea973","#feaa74","#feac76","#feae77","#feb078","#feb27a","#feb47b","#feb67c","#feb77e","#feb97f","#febb81","#febd82","#febf84","#fec185","#fec287","#fec488","#fec68a","#fec88c","#feca8d","#fecc8f","#fecd90","#fecf92","#fed194","#fed395","#fed597","#fed799","#fed89a","#fdda9c","#fddc9e","#fddea0","#fde0a1","#fde2a3","#fde3a5","#fde5a7","#fde7a9","#fde9aa","#fdebac","#fcecae","#fceeb0","#fcf0b2","#fcf2b4","#fcf4b6","#fcf6b8","#fcf7b9","#fcf9bb","#fcfbbd","#fcfdbf"]),ColorMapContainer.cividis=ColorMapContainer.fromStringList(["#00224e","#00234f","#002451","#002553","#002554","#002656","#002758","#002859","#00285b","#00295d","#002a5f","#002a61","#002b62","#002c64","#002c66","#002d68","#002e6a","#002e6c","#002f6d","#00306f","#003070","#003170","#003171","#013271","#053371","#083370","#0c3470","#0f3570","#123570","#143670","#163770","#18376f","#1a386f","#1c396f","#1e3a6f","#203a6f","#213b6e","#233c6e","#243c6e","#263d6e","#273e6e","#293f6e","#2a3f6d","#2b406d","#2d416d","#2e416d","#2f426d","#31436d","#32436d","#33446d","#34456c","#35456c","#36466c","#38476c","#39486c","#3a486c","#3b496c","#3c4a6c","#3d4a6c","#3e4b6c","#3f4c6c","#404c6c","#414d6c","#424e6c","#434e6c","#444f6c","#45506c","#46516c","#47516c","#48526c","#49536c","#4a536c","#4b546c","#4c556c","#4d556c","#4e566c","#4f576c","#50576c","#51586d","#52596d","#535a6d","#545a6d","#555b6d","#555c6d","#565c6d","#575d6d","#585e6d","#595e6e","#5a5f6e","#5b606e","#5c616e","#5d616e","#5e626e","#5e636f","#5f636f","#60646f","#61656f","#62656f","#636670","#646770","#656870","#656870","#666970","#676a71","#686a71","#696b71","#6a6c71","#6b6d72","#6c6d72","#6c6e72","#6d6f72","#6e6f73","#6f7073","#707173","#717274","#727274","#727374","#737475","#747475","#757575","#767676","#777776","#777777","#787877","#797977","#7a7a78","#7b7a78","#7c7b78","#7d7c78","#7e7c78","#7e7d78","#7f7e78","#807f78","#817f78","#828079","#838179","#848279","#858279","#868379","#878478","#888578","#898578","#8a8678","#8b8778","#8c8878","#8d8878","#8e8978","#8f8a78","#908b78","#918b78","#928c78","#928d78","#938e78","#948e77","#958f77","#969077","#979177","#989277","#999277","#9a9376","#9b9476","#9c9576","#9d9576","#9e9676","#9f9775","#a09875","#a19975","#a29975","#a39a74","#a49b74","#a59c74","#a69c74","#a79d73","#a89e73","#a99f73","#aaa073","#aba072","#aca172","#ada272","#aea371","#afa471","#b0a571","#b1a570","#b3a670","#b4a76f","#b5a86f","#b6a96f","#b7a96e","#b8aa6e","#b9ab6d","#baac6d","#bbad6d","#bcae6c","#bdae6c","#beaf6b","#bfb06b","#c0b16a","#c1b26a","#c2b369","#c3b369","#c4b468","#c5b568","#c6b667","#c7b767","#c8b866","#c9b965","#cbb965","#ccba64","#cdbb63","#cebc63","#cfbd62","#d0be62","#d1bf61","#d2c060","#d3c05f","#d4c15f","#d5c25e","#d6c35d","#d7c45c","#d9c55c","#dac65b","#dbc75a","#dcc859","#ddc858","#dec958","#dfca57","#e0cb56","#e1cc55","#e2cd54","#e4ce53","#e5cf52","#e6d051","#e7d150","#e8d24f","#e9d34e","#ead34c","#ebd44b","#edd54a","#eed649","#efd748","#f0d846","#f1d945","#f2da44","#f3db42","#f5dc41","#f6dd3f","#f7de3e","#f8df3c","#f9e03a","#fbe138","#fce236","#fde334","#fee434","#fee535","#fee636","#fee838"]),ColorMapContainer.greys=ColorMapContainer.fromStringList(["#ffffff","#ffffff","#fefefe","#fefefe","#fdfdfd","#fdfdfd","#fcfcfc","#fcfcfc","#fbfbfb","#fbfbfb","#fafafa","#fafafa","#f9f9f9","#f9f9f9","#f8f8f8","#f8f8f8","#f7f7f7","#f7f7f7","#f7f7f7","#f6f6f6","#f6f6f6","#f5f5f5","#f5f5f5","#f4f4f4","#f4f4f4","#f3f3f3","#f3f3f3","#f2f2f2","#f2f2f2","#f1f1f1","#f1f1f1","#f0f0f0","#f0f0f0","#efefef","#eeeeee","#eeeeee","#ededed","#ececec","#ececec","#ebebeb","#eaeaea","#e9e9e9","#e9e9e9","#e8e8e8","#e7e7e7","#e7e7e7","#e6e6e6","#e5e5e5","#e4e4e4","#e4e4e4","#e3e3e3","#e2e2e2","#e1e1e1","#e1e1e1","#e0e0e0","#dfdfdf","#dfdfdf","#dedede","#dddddd","#dcdcdc","#dcdcdc","#dbdbdb","#dadada","#dadada","#d9d9d9","#d8d8d8","#d7d7d7","#d6d6d6","#d5d5d5","#d4d4d4","#d4d4d4","#d3d3d3","#d2d2d2","#d1d1d1","#d0d0d0","#cfcfcf","#cecece","#cdcdcd","#cccccc","#cccccc","#cbcbcb","#cacaca","#c9c9c9","#c8c8c8","#c7c7c7","#c6c6c6","#c5c5c5","#c5c5c5","#c4c4c4","#c3c3c3","#c2c2c2","#c1c1c1","#c0c0c0","#bfbfbf","#bebebe","#bebebe","#bdbdbd","#bbbbbb","#bababa","#b9b9b9","#b8b8b8","#b6b6b6","#b5b5b5","#b4b4b4","#b3b3b3","#b2b2b2","#b0b0b0","#afafaf","#aeaeae","#adadad","#ababab","#aaaaaa","#a9a9a9","#a8a8a8","#a7a7a7","#a5a5a5","#a4a4a4","#a3a3a3","#a2a2a2","#a0a0a0","#9f9f9f","#9e9e9e","#9d9d9d","#9c9c9c","#9a9a9a","#999999","#989898","#979797","#959595","#949494","#939393","#929292","#919191","#909090","#8f8f8f","#8e8e8e","#8d8d8d","#8c8c8c","#8a8a8a","#898989","#888888","#878787","#868686","#858585","#848484","#838383","#828282","#818181","#7f7f7f","#7e7e7e","#7d7d7d","#7c7c7c","#7b7b7b","#7a7a7a","#797979","#787878","#777777","#767676","#757575","#737373","#727272","#717171","#707070","#6f6f6f","#6e6e6e","#6d6d6d","#6c6c6c","#6b6b6b","#6a6a6a","#696969","#686868","#676767","#666666","#656565","#646464","#636363","#626262","#616161","#606060","#5f5f5f","#5e5e5e","#5d5d5d","#5c5c5c","#5b5b5b","#5a5a5a","#585858","#575757","#565656","#555555","#545454","#535353","#525252","#515151","#505050","#4e4e4e","#4d4d4d","#4b4b4b","#4a4a4a","#484848","#474747","#464646","#444444","#434343","#414141","#404040","#3f3f3f","#3d3d3d","#3c3c3c","#3a3a3a","#393939","#383838","#363636","#353535","#333333","#323232","#303030","#2f2f2f","#2e2e2e","#2c2c2c","#2b2b2b","#292929","#282828","#272727","#252525","#242424","#232323","#222222","#212121","#1f1f1f","#1e1e1e","#1d1d1d","#1c1c1c","#1b1b1b","#1a1a1a","#181818","#171717","#161616","#151515","#141414","#131313","#111111","#101010","#0f0f0f","#0e0e0e","#0d0d0d","#0c0c0c","#0a0a0a","#090909","#080808","#070707","#060606","#050505","#030303","#020202","#010101","#000000"]),ColorMapContainer.gray=ColorMapContainer.fromStringList(["#000000","#010101","#020202","#030303","#040404","#050505","#060606","#070707","#080808","#090909","#0a0a0a","#0b0b0b","#0c0c0c","#0d0d0d","#0e0e0e","#0f0f0f","#101010","#111111","#121212","#131313","#141414","#151515","#161616","#171717","#181818","#191919","#1a1a1a","#1b1b1b","#1c1c1c","#1d1d1d","#1e1e1e","#1f1f1f","#202020","#212121","#222222","#232323","#242424","#252525","#262626","#272727","#282828","#292929","#2a2a2a","#2b2b2b","#2c2c2c","#2d2d2d","#2e2e2e","#2f2f2f","#303030","#313131","#323232","#333333","#343434","#353535","#363636","#373737","#383838","#393939","#3a3a3a","#3b3b3b","#3c3c3c","#3d3d3d","#3e3e3e","#3f3f3f","#404040","#414141","#424242","#434343","#444444","#454545","#464646","#474747","#484848","#494949","#4a4a4a","#4b4b4b","#4c4c4c","#4d4d4d","#4e4e4e","#4f4f4f","#505050","#515151","#525252","#535353","#545454","#555555","#565656","#575757","#585858","#595959","#5a5a5a","#5b5b5b","#5c5c5c","#5d5d5d","#5e5e5e","#5f5f5f","#606060","#616161","#626262","#636363","#646464","#656565","#666666","#676767","#686868","#696969","#6a6a6a","#6b6b6b","#6c6c6c","#6d6d6d","#6e6e6e","#6f6f6f","#707070","#717171","#727272","#737373","#747474","#757575","#767676","#777777","#787878","#797979","#7a7a7a","#7b7b7b","#7c7c7c","#7d7d7d","#7e7e7e","#7f7f7f","#808080","#818181","#828282","#838383","#848484","#858585","#868686","#878787","#888888","#898989","#8a8a8a","#8b8b8b","#8c8c8c","#8d8d8d","#8e8e8e","#8f8f8f","#909090","#919191","#929292","#939393","#949494","#959595","#969696","#979797","#989898","#999999","#9a9a9a","#9b9b9b","#9c9c9c","#9d9d9d","#9e9e9e","#9f9f9f","#a0a0a0","#a1a1a1","#a2a2a2","#a3a3a3","#a4a4a4","#a5a5a5","#a6a6a6","#a7a7a7","#a8a8a8","#a9a9a9","#aaaaaa","#ababab","#acacac","#adadad","#aeaeae","#afafaf","#b0b0b0","#b1b1b1","#b2b2b2","#b3b3b3","#b4b4b4","#b5b5b5","#b6b6b6","#b7b7b7","#b8b8b8","#b9b9b9","#bababa","#bbbbbb","#bcbcbc","#bdbdbd","#bebebe","#bfbfbf","#c0c0c0","#c1c1c1","#c2c2c2","#c3c3c3","#c4c4c4","#c5c5c5","#c6c6c6","#c7c7c7","#c8c8c8","#c9c9c9","#cacaca","#cbcbcb","#cccccc","#cdcdcd","#cecece","#cfcfcf","#d0d0d0","#d1d1d1","#d2d2d2","#d3d3d3","#d4d4d4","#d5d5d5","#d6d6d6","#d7d7d7","#d8d8d8","#d9d9d9","#dadada","#dbdbdb","#dcdcdc","#dddddd","#dedede","#dfdfdf","#e0e0e0","#e1e1e1","#e2e2e2","#e3e3e3","#e4e4e4","#e5e5e5","#e6e6e6","#e7e7e7","#e8e8e8","#e9e9e9","#eaeaea","#ebebeb","#ececec","#ededed","#eeeeee","#efefef","#f0f0f0","#f1f1f1","#f2f2f2","#f3f3f3","#f4f4f4","#f5f5f5","#f6f6f6","#f7f7f7","#f8f8f8","#f9f9f9","#fafafa","#fbfbfb","#fcfcfc","#fdfdfd","#fefefe","#ffffff"]),ColorMapContainer.purples=ColorMapContainer.fromStringList(["#fcfbfd","#fcfbfd","#fbfafc","#fbfafc","#faf9fc","#faf9fc","#faf8fb","#f9f8fb","#f9f7fb","#f8f7fb","#f8f7fa","#f8f6fa","#f7f6fa","#f7f5fa","#f6f5f9","#f6f4f9","#f5f4f9","#f5f4f9","#f5f3f8","#f4f3f8","#f4f2f8","#f3f2f8","#f3f1f7","#f3f1f7","#f2f0f7","#f2f0f7","#f1f0f6","#f1eff6","#f1eff6","#f0eef6","#f0eef5","#efedf5","#efedf5","#eeecf5","#eeecf4","#edebf4","#ecebf4","#eceaf3","#ebe9f3","#eae9f3","#eae8f2","#e9e8f2","#e8e7f2","#e8e6f2","#e7e6f1","#e6e5f1","#e6e5f1","#e5e4f0","#e4e3f0","#e4e3f0","#e3e2ef","#e2e2ef","#e2e1ef","#e1e0ee","#e0e0ee","#e0dfee","#dfdfed","#dedeed","#dedded","#ddddec","#dcdcec","#dcdcec","#dbdbec","#dadaeb","#dadaeb","#d9d9ea","#d8d8ea","#d7d7e9","#d6d6e9","#d5d5e9","#d4d4e8","#d3d3e8","#d2d2e7","#d1d2e7","#d0d1e6","#cfd0e6","#cecfe5","#cecee5","#cdcde4","#cccce4","#cbcbe3","#cacae3","#c9c9e2","#c8c8e2","#c7c8e1","#c6c7e1","#c5c6e1","#c4c5e0","#c3c4e0","#c2c3df","#c1c2df","#c0c1de","#bfc0de","#bebfdd","#bebedd","#bdbedc","#bcbddc","#bbbbdb","#babadb","#b9b9da","#b8b8d9","#b7b7d9","#b6b6d8","#b5b5d7","#b4b4d7","#b3b3d6","#b2b2d5","#b1b1d5","#b0afd4","#afaed4","#aeadd3","#aeacd2","#adabd2","#acaad1","#aba9d0","#aaa8d0","#a9a7cf","#a8a6cf","#a7a4ce","#a6a3cd","#a5a2cd","#a4a1cc","#a3a0cb","#a29fcb","#a19eca","#a09dca","#9f9cc9","#9e9bc8","#9e9ac8","#9d99c7","#9c98c7","#9b97c6","#9a96c6","#9995c6","#9894c5","#9793c5","#9692c4","#9591c4","#9490c3","#9390c3","#928fc3","#918ec2","#908dc2","#8f8cc1","#8e8bc1","#8e8ac0","#8d89c0","#8c88bf","#8b87bf","#8a86bf","#8986be","#8885be","#8784bd","#8683bd","#8582bc","#8481bc","#8380bb","#827fbb","#817ebb","#807dba","#807cba","#7f7bb9","#7e79b8","#7d78b7","#7d77b7","#7c75b6","#7b74b5","#7b72b4","#7a71b4","#7970b3","#796eb2","#786db2","#776cb1","#776ab0","#7669af","#7567af","#7566ae","#7465ad","#7363ad","#7262ac","#7261ab","#715faa","#705eaa","#705ca9","#6f5ba8","#6e5aa8","#6e58a7","#6d57a6","#6c55a5","#6c54a5","#6b53a4","#6a51a3","#6950a3","#694fa2","#684da1","#674ca1","#674ba0","#66499f","#65489f","#65479e","#64459e","#63449d","#63439c","#62429c","#61409b","#613f9a","#603e9a","#5f3c99","#5e3b98","#5e3a98","#5d3897","#5c3797","#5c3696","#5b3495","#5a3395","#5a3294","#593093","#582f93","#582e92","#572c92","#562b91","#552a90","#552890","#54278f","#53268f","#53258e","#52238d","#51228d","#51218c","#50208c","#4f1f8b","#4f1d8b","#4e1c8a","#4d1b89","#4d1a89","#4c1888","#4c1788","#4b1687","#4a1587","#4a1486","#491285","#481185","#481084","#470f84","#460d83","#460c83","#450b82","#440a82","#440981","#430780","#420680","#42057f","#41047f","#40027e","#40017e","#3f007d"]),ColorMapContainer.blues=ColorMapContainer.fromStringList(["#f7fbff","#f6faff","#f5fafe","#f5f9fe","#f4f9fe","#f3f8fe","#f2f8fd","#f2f7fd","#f1f7fd","#f0f6fd","#eff6fc","#eef5fc","#eef5fc","#edf4fc","#ecf4fb","#ebf3fb","#eaf3fb","#eaf2fb","#e9f2fa","#e8f1fa","#e7f1fa","#e7f0fa","#e6f0f9","#e5eff9","#e4eff9","#e3eef9","#e3eef8","#e2edf8","#e1edf8","#e0ecf8","#dfecf7","#dfebf7","#deebf7","#ddeaf7","#dceaf6","#dce9f6","#dbe9f6","#dae8f6","#d9e8f5","#d9e7f5","#d8e7f5","#d7e6f5","#d6e6f4","#d6e5f4","#d5e5f4","#d4e4f4","#d3e4f3","#d3e3f3","#d2e3f3","#d1e2f3","#d0e2f2","#d0e1f2","#cfe1f2","#cee0f2","#cde0f1","#cddff1","#ccdff1","#cbdef1","#cadef0","#caddf0","#c9ddf0","#c8dcf0","#c7dcef","#c7dbef","#c6dbef","#c4daee","#c3daee","#c2d9ee","#c1d9ed","#bfd8ed","#bed8ec","#bdd7ec","#bcd7eb","#bad6eb","#b9d6ea","#b8d5ea","#b7d4ea","#b5d4e9","#b4d3e9","#b3d3e8","#b2d2e8","#b0d2e7","#afd1e7","#aed1e7","#add0e6","#abd0e6","#aacfe5","#a9cfe5","#a8cee4","#a6cee4","#a5cde3","#a4cce3","#a3cce3","#a1cbe2","#a0cbe2","#9fcae1","#9dcae1","#9cc9e1","#9ac8e0","#99c7e0","#97c6df","#95c5df","#94c4df","#92c4de","#91c3de","#8fc2de","#8dc1dd","#8cc0dd","#8abfdd","#89bedc","#87bddc","#85bcdc","#84bcdb","#82bbdb","#81badb","#7fb9da","#7db8da","#7cb7da","#7ab6d9","#79b5d9","#77b5d9","#75b4d8","#74b3d8","#72b2d8","#71b1d7","#6fb0d7","#6dafd7","#6caed6","#6aaed6","#69add5","#68acd5","#66abd4","#65aad4","#64a9d3","#63a8d3","#61a7d2","#60a7d2","#5fa6d1","#5da5d1","#5ca4d0","#5ba3d0","#5aa2cf","#58a1cf","#57a0ce","#56a0ce","#549fcd","#539ecd","#529dcc","#519ccc","#4f9bcb","#4e9acb","#4d99ca","#4b98ca","#4a98c9","#4997c9","#4896c8","#4695c8","#4594c7","#4493c7","#4292c6","#4191c6","#4090c5","#3f8fc5","#3e8ec4","#3d8dc4","#3c8cc3","#3b8bc2","#3a8ac2","#3989c1","#3888c1","#3787c0","#3686c0","#3585bf","#3484bf","#3383be","#3282be","#3181bd","#3080bd","#2f7fbc","#2e7ebc","#2d7dbb","#2c7cba","#2b7bba","#2a7ab9","#2979b9","#2777b8","#2676b8","#2575b7","#2474b7","#2373b6","#2272b6","#2171b5","#2070b4","#206fb4","#1f6eb3","#1e6db2","#1d6cb1","#1c6bb0","#1c6ab0","#1b69af","#1a68ae","#1967ad","#1966ad","#1865ac","#1764ab","#1663aa","#1562a9","#1561a9","#1460a8","#135fa7","#125ea6","#125da6","#115ca5","#105ba4","#0f5aa3","#0e59a2","#0e58a2","#0d57a1","#0c56a0","#0b559f","#0a549e","#0a539e","#09529d","#08519c","#08509b","#084f99","#084e98","#084d96","#084c95","#084b93","#084a91","#084990","#08488e","#08478d","#08468b","#08458a","#084488","#084387","#084285","#084184","#084082","#083e81","#083d7f","#083c7d","#083b7c","#083a7a","#083979","#083877","#083776","#083674","#083573","#083471","#083370","#08326e","#08316d","#08306b"]),ColorMapContainer.greens=ColorMapContainer.fromStringList(["#f7fcf5","#f6fcf4","#f6fcf4","#f5fbf3","#f5fbf2","#f4fbf2","#f4fbf1","#f3faf0","#f2faf0","#f2faef","#f1faee","#f1faee","#f0f9ed","#f0f9ec","#eff9ec","#eff9eb","#eef8ea","#edf8ea","#edf8e9","#ecf8e8","#ecf8e8","#ebf7e7","#ebf7e7","#eaf7e6","#e9f7e5","#e9f7e5","#e8f6e4","#e8f6e3","#e7f6e3","#e7f6e2","#e6f5e1","#e5f5e1","#e5f5e0","#e4f5df","#e3f4de","#e2f4dd","#e1f3dc","#e0f3db","#dff3da","#def2d9","#ddf2d8","#dcf2d7","#dbf1d6","#dbf1d5","#daf0d4","#d9f0d3","#d8f0d2","#d7efd1","#d6efd0","#d5efcf","#d4eece","#d3eecd","#d2edcc","#d1edcb","#d0edca","#cfecc9","#ceecc8","#cdecc7","#ccebc6","#cbebc5","#cbeac4","#caeac3","#c9eac2","#c8e9c1","#c7e9c0","#c6e8bf","#c4e8bd","#c3e7bc","#c2e7bb","#c1e6ba","#c0e6b9","#bee5b8","#bde5b6","#bce4b5","#bbe4b4","#bae3b3","#b8e3b2","#b7e2b1","#b6e2af","#b5e1ae","#b4e1ad","#b2e0ac","#b1e0ab","#b0dfaa","#afdfa8","#aedea7","#acdea6","#abdda5","#aadda4","#a9dca3","#a8dca2","#a7dba0","#a5db9f","#a4da9e","#a3da9d","#a2d99c","#a0d99b","#9fd899","#9ed798","#9cd797","#9bd696","#99d595","#98d594","#97d492","#95d391","#94d390","#92d28f","#91d28e","#90d18d","#8ed08b","#8dd08a","#8bcf89","#8ace88","#88ce87","#87cd86","#86cc85","#84cc83","#83cb82","#81ca81","#80ca80","#7fc97f","#7dc87e","#7cc87c","#7ac77b","#79c67a","#78c679","#76c578","#75c477","#73c476","#72c375","#70c274","#6ec173","#6dc072","#6bc072","#6abf71","#68be70","#66bd6f","#65bd6f","#63bc6e","#62bb6d","#60ba6c","#5eb96b","#5db96b","#5bb86a","#5ab769","#58b668","#56b567","#55b567","#53b466","#52b365","#50b264","#4eb264","#4db163","#4bb062","#4aaf61","#48ae60","#46ae60","#45ad5f","#43ac5e","#42ab5d","#40aa5d","#3fa95c","#3fa85b","#3ea75a","#3da65a","#3ca559","#3ba458","#3aa357","#39a257","#38a156","#37a055","#369f54","#359e53","#349d53","#339c52","#329b51","#319a50","#309950","#2f984f","#2f974e","#2e964d","#2d954d","#2c944c","#2b934b","#2a924a","#29914a","#289049","#278f48","#268e47","#258d47","#248c46","#238b45","#228a44","#218944","#208843","#1f8742","#1e8741","#1d8640","#1c8540","#1a843f","#19833e","#18823d","#17813d","#16803c","#157f3b","#147e3a","#137d39","#127c39","#117b38","#107a37","#0e7936","#0d7836","#0c7735","#0b7734","#0a7633","#097532","#087432","#077331","#067230","#05712f","#03702e","#026f2e","#016e2d","#006d2c","#006c2c","#006b2b","#00692a","#00682a","#006729","#006529","#006428","#006328","#006227","#006027","#005f26","#005e26","#005c25","#005b25","#005a24","#005924","#005723","#005622","#005522","#005321","#005221","#005120","#005020","#004e1f","#004d1f","#004c1e","#004a1e","#00491d","#00481d","#00471c","#00451c","#00441b"]),ColorMapContainer.oranges=ColorMapContainer.fromStringList(["#fff5eb","#fff5ea","#fff4e9","#fff4e8","#fff3e7","#fff3e6","#fff2e6","#fff2e5","#fff1e4","#fff1e3","#fff0e2","#fff0e1","#ffefe0","#ffefdf","#ffeede","#ffeedd","#feeddc","#feeddc","#feeddb","#feecda","#feecd9","#feebd8","#feebd7","#feead6","#feead5","#fee9d4","#fee9d3","#fee8d2","#fee8d2","#fee7d1","#fee7d0","#fee6cf","#fee6ce","#fee5cc","#fee5cb","#fee4ca","#fee3c8","#fee2c7","#fee2c6","#fee1c4","#fee0c3","#fee0c1","#fedfc0","#fedebf","#fedebd","#feddbc","#fedcbb","#fedcb9","#fddbb8","#fddab6","#fdd9b5","#fdd9b4","#fdd8b2","#fdd7b1","#fdd7af","#fdd6ae","#fdd5ad","#fdd5ab","#fdd4aa","#fdd3a9","#fdd3a7","#fdd2a6","#fdd1a4","#fdd1a3","#fdd0a2","#fdcfa0","#fdce9e","#fdcd9c","#fdcb9b","#fdca99","#fdc997","#fdc895","#fdc794","#fdc692","#fdc590","#fdc48f","#fdc38d","#fdc28b","#fdc189","#fdc088","#fdbf86","#fdbe84","#fdbd83","#fdbb81","#fdba7f","#fdb97d","#fdb87c","#fdb77a","#fdb678","#fdb576","#fdb475","#fdb373","#fdb271","#fdb170","#fdb06e","#fdaf6c","#fdae6a","#fdad69","#fdac67","#fdab66","#fda965","#fda863","#fda762","#fda660","#fda55f","#fda45d","#fda35c","#fda25a","#fda159","#fda057","#fd9f56","#fd9e54","#fd9d53","#fd9c51","#fd9b50","#fd9a4e","#fd994d","#fd984b","#fd974a","#fd9649","#fd9547","#fd9446","#fd9344","#fd9243","#fd9141","#fd9040","#fd8f3e","#fd8e3d","#fd8c3b","#fc8b3a","#fc8a39","#fc8937","#fb8836","#fb8735","#fb8634","#fa8532","#fa8331","#f98230","#f9812e","#f9802d","#f87f2c","#f87e2b","#f87d29","#f77b28","#f77a27","#f67925","#f67824","#f67723","#f57622","#f57520","#f5741f","#f4721e","#f4711c","#f3701b","#f36f1a","#f36e19","#f26d17","#f26c16","#f26b15","#f16913","#f16813","#f06712","#ef6612","#ee6511","#ee6410","#ed6310","#ec620f","#eb610f","#eb600e","#ea5f0e","#e95e0d","#e85d0c","#e75c0c","#e75b0b","#e65a0b","#e5590a","#e4580a","#e45709","#e35608","#e25508","#e15407","#e15307","#e05206","#df5106","#de5005","#de4e05","#dd4d04","#dc4c03","#db4b03","#db4a02","#da4902","#d94801","#d84801","#d64701","#d54601","#d34601","#d14501","#d04501","#ce4401","#cd4401","#cb4302","#c94202","#c84202","#c64102","#c54102","#c34002","#c14002","#c03f02","#be3f02","#bd3e02","#bb3d02","#b93d02","#b83c02","#b63c02","#b53b02","#b33b02","#b13a03","#b03903","#ae3903","#ad3803","#ab3803","#a93703","#a83703","#a63603","#a53603","#a43503","#a23503","#a13403","#a03403","#9f3303","#9e3303","#9c3203","#9b3203","#9a3103","#993103","#973003","#963003","#952f03","#942f03","#932f03","#912e04","#902e04","#8f2d04","#8e2d04","#8c2c04","#8b2c04","#8a2b04","#892b04","#882a04","#862a04","#852904","#842904","#832804","#812804","#802704","#7f2704"]),ColorMapContainer.reds=ColorMapContainer.fromStringList(["#fff5f0","#fff4ef","#fff4ee","#fff3ed","#fff2ec","#fff2eb","#fff1ea","#fff0e9","#fff0e8","#ffefe8","#ffeee7","#ffeee6","#ffede5","#ffece4","#ffece3","#ffebe2","#feeae1","#feeae0","#fee9df","#fee8de","#fee8dd","#fee7dc","#fee7db","#fee6da","#fee5d9","#fee5d8","#fee4d8","#fee3d7","#fee3d6","#fee2d5","#fee1d4","#fee1d3","#fee0d2","#fedfd0","#fedecf","#fedccd","#fedbcc","#fedaca","#fed9c9","#fed8c7","#fdd7c6","#fdd5c4","#fdd4c2","#fdd3c1","#fdd2bf","#fdd1be","#fdd0bc","#fdcebb","#fdcdb9","#fdccb8","#fdcbb6","#fdcab5","#fdc9b3","#fdc7b2","#fdc6b0","#fdc5ae","#fcc4ad","#fcc3ab","#fcc2aa","#fcc1a8","#fcbfa7","#fcbea5","#fcbda4","#fcbca2","#fcbba1","#fcb99f","#fcb89e","#fcb79c","#fcb69b","#fcb499","#fcb398","#fcb296","#fcb095","#fcaf93","#fcae92","#fcad90","#fcab8f","#fcaa8d","#fca98c","#fca78b","#fca689","#fca588","#fca486","#fca285","#fca183","#fca082","#fc9e80","#fc9d7f","#fc9c7d","#fc9b7c","#fc997a","#fc9879","#fc9777","#fc9576","#fc9474","#fc9373","#fc9272","#fc9070","#fc8f6f","#fc8e6e","#fc8d6d","#fc8b6b","#fc8a6a","#fc8969","#fc8767","#fc8666","#fc8565","#fc8464","#fc8262","#fc8161","#fc8060","#fc7f5f","#fb7d5d","#fb7c5c","#fb7b5b","#fb7a5a","#fb7858","#fb7757","#fb7656","#fb7555","#fb7353","#fb7252","#fb7151","#fb7050","#fb6e4e","#fb6d4d","#fb6c4c","#fb6b4b","#fb694a","#fa6849","#fa6648","#fa6547","#f96346","#f96245","#f96044","#f85f43","#f85d42","#f75c41","#f75b40","#f7593f","#f6583e","#f6563d","#f6553c","#f5533b","#f5523a","#f4503a","#f44f39","#f44d38","#f34c37","#f34a36","#f34935","#f24734","#f24633","#f14432","#f14331","#f14130","#f0402f","#f03f2e","#f03d2d","#ef3c2c","#ee3a2c","#ed392b","#ec382b","#eb372a","#ea362a","#e93529","#e83429","#e63328","#e53228","#e43027","#e32f27","#e22e27","#e12d26","#e02c26","#de2b25","#dd2a25","#dc2924","#db2824","#da2723","#d92523","#d82422","#d72322","#d52221","#d42121","#d32020","#d21f20","#d11e1f","#d01d1f","#cf1c1f","#ce1a1e","#cc191e","#cb181d","#ca181d","#c9181d","#c8171c","#c7171c","#c5171c","#c4161c","#c3161b","#c2161b","#c1161b","#bf151b","#be151a","#bd151a","#bc141a","#bb141a","#b91419","#b81419","#b71319","#b61319","#b51318","#b31218","#b21218","#b11218","#b01217","#af1117","#ad1117","#ac1117","#ab1016","#aa1016","#a91016","#a81016","#a60f15","#a50f15","#a30f15","#a10e15","#9f0e14","#9d0d14","#9c0d14","#9a0c14","#980c13","#960b13","#940b13","#920a13","#900a12","#8e0912","#8c0912","#8a0812","#880811","#860811","#840711","#820711","#800610","#7e0610","#7c0510","#7a0510","#79040f","#77040f","#75030f","#73030f","#71020e","#6f020e","#6d010e","#6b010e","#69000d","#67000d"]),ColorMapContainer.rdYlBu=ColorMapContainer.fromStringList(["#a50026","#a70226","#a90426","#ab0626","#ad0826","#af0926","#b10b26","#b30d26","#b50f26","#b71126","#b91326","#bb1526","#bd1726","#be1827","#c01a27","#c21c27","#c41e27","#c62027","#c82227","#ca2427","#cc2627","#ce2827","#d02927","#d22b27","#d42d27","#d62f27","#d83128","#d93429","#da362a","#db382b","#dc3b2c","#dd3d2d","#de402e","#e0422f","#e14430","#e24731","#e34933","#e44c34","#e54e35","#e65036","#e75337","#e95538","#ea5739","#eb5a3a","#ec5c3b","#ed5f3c","#ee613e","#ef633f","#f16640","#f26841","#f36b42","#f46d43","#f47044","#f57245","#f57547","#f57748","#f67a49","#f67c4a","#f67f4b","#f7814c","#f7844e","#f8864f","#f88950","#f88c51","#f98e52","#f99153","#f99355","#fa9656","#fa9857","#fa9b58","#fb9d59","#fba05b","#fba35c","#fca55d","#fca85e","#fcaa5f","#fdad60","#fdaf62","#fdb164","#fdb366","#fdb567","#fdb769","#fdb96b","#fdbb6d","#fdbd6f","#fdbf71","#fdc173","#fdc374","#fdc576","#fdc778","#fec87a","#feca7c","#fecc7e","#fece7f","#fed081","#fed283","#fed485","#fed687","#fed889","#feda8a","#fedc8c","#fede8e","#fee090","#fee192","#fee294","#fee496","#fee597","#fee699","#fee79b","#fee99d","#feea9f","#feeba1","#feeca2","#feeda4","#feefa6","#fff0a8","#fff1aa","#fff2ac","#fff3ad","#fff5af","#fff6b1","#fff7b3","#fff8b5","#fffab7","#fffbb9","#fffcba","#fffdbc","#fffebe","#feffc0","#fdfec2","#fcfec5","#fbfdc7","#fafdc9","#f8fccb","#f7fcce","#f6fbd0","#f5fbd2","#f3fbd4","#f2fad6","#f1fad9","#f0f9db","#eff9dd","#edf8df","#ecf8e2","#ebf7e4","#eaf7e6","#e9f6e8","#e7f6eb","#e6f5ed","#e5f5ef","#e4f4f1","#e2f4f4","#e1f3f6","#e0f3f8","#def2f7","#dcf1f7","#daf0f6","#d8eff6","#d6eef5","#d4edf4","#d1ecf4","#cfebf3","#cdeaf3","#cbe9f2","#c9e8f2","#c7e7f1","#c5e6f0","#c3e5f0","#c1e4ef","#bfe3ef","#bde2ee","#bbe1ed","#b9e0ed","#b6dfec","#b4deec","#b2ddeb","#b0dcea","#aedbea","#acdae9","#aad8e9","#a8d6e8","#a6d5e7","#a3d3e6","#a1d1e5","#9fd0e4","#9dcee3","#9bcce2","#99cae1","#97c9e0","#94c7df","#92c5de","#90c3dd","#8ec2dc","#8cc0db","#8abeda","#87bdd9","#85bbd9","#83b9d8","#81b7d7","#7fb6d6","#7db4d5","#7ab2d4","#78b0d3","#76afd2","#74add1","#72abd0","#70a9cf","#6ea6ce","#6da4cc","#6ba2cb","#69a0ca","#679ec9","#659bc8","#6399c7","#6297c6","#6095c4","#5e93c3","#5c90c2","#5a8ec1","#588cc0","#578abf","#5588be","#5385bd","#5183bb","#4f81ba","#4d7fb9","#4b7db8","#4a7ab7","#4878b6","#4676b5","#4574b3","#4471b2","#436fb1","#426cb0","#416aaf","#4167ad","#4065ac","#3f62ab","#3e60aa","#3e5ea8","#3d5ba7","#3c59a6","#3b56a5","#3a54a4","#3a51a2","#394fa1","#384ca0","#374a9f","#36479e","#36459c","#35429b","#34409a","#333d99","#333b97","#323896","#313695"]);var WcsImage$={get_copyright:function(){return this.copyright},set_copyright:function(e){return this.copyright=e,e},get_creditsUrl:function(){return this.creditsUrl},set_creditsUrl:function(e){return this.creditsUrl=e,e},get_validWcs:function(){return this._validWcs},set_validWcs:function(e){return this._validWcs=e,e},get_keywords:function(){return this.keywords.length||this.keywords.push("Image File"),this.keywords},set_keywords:function(e){return this.keywords=e,e},get_description:function(){return this.description},set_description:function(e){return this.description=e,e},get_scaleX:function(){return this.scaleX},set_scaleX:function(e){return this.scaleX=e,e},get_scaleY:function(){return this.scaleY},set_scaleY:function(e){return this.scaleY=e,e},get_centerX:function(){return this.centerX},set_centerX:function(e){return this.centerX=e,e},get_viewCenterX:function(){return this.centerX+(this.get_sizeX()/2-this.get_referenceX())*this.get_scaleX()},get_centerY:function(){return this.centerY},set_centerY:function(e){return this.centerY=e,e},get_viewCenterY:function(){return this.centerY+(this.get_sizeY()/2-this.get_referenceY())*this.get_scaleY()},get_rotation:function(){return this.rotation},set_rotation:function(e){return this.rotation=e,e},get_referenceX:function(){return this.referenceX},set_referenceX:function(e){return this.referenceX=e,e},get_referenceY:function(){return this.referenceY},set_referenceY:function(e){return this.referenceY=e,e},get_sizeX:function(){return this.sizeX},set_sizeX:function(e){return this.sizeX=e,e},get_sizeY:function(){return this.sizeY},set_sizeY:function(e){return this.sizeY=e,e},get_cd1_1:function(){return this.cd1_1},set_cd1_1:function(e){return this.cd1_1=e,e},get_cd1_2:function(){return this.cd1_2},set_cd1_2:function(e){return this.cd1_2=e,e},get_cd2_1:function(){return this.cd2_1},set_cd2_1:function(e){return this.cd2_1=e,e},get_cd2_2:function(){return this.cd2_2},set_cd2_2:function(e){return this.cd2_2=e,e},adjustScale:function(e,t){e!==this.sizeX&&(this.scaleX*=this.sizeX/e,this.referenceX/=this.sizeX/e,this.sizeX=e),t!==this.sizeY&&(this.scaleY*=this.sizeY/t,this.referenceY/=this.sizeY/t,this.sizeY=t)},calculateScaleFromCD:function(){this.scaleX=Math.sqrt(this.cd1_1*this.cd1_1+this.cd2_1*this.cd2_1)*(this.cd1_1*this.cd2_2-this.cd1_2*this.cd2_1)<0?-1:1,this.scaleY=Math.sqrt(this.cd1_2*this.cd1_2+this.cd2_2*this.cd2_2)},calculateRotationFromCD:function(){var e=this.cd1_1*this.cd2_2-this.cd1_2*this.cd2_1<0?-1:1,t=Math.atan2(-e*this.cd1_2,this.cd2_2);this.rotation=t/Math.PI*180},get_filename:function(){return this.filename},set_filename:function(e){return this.filename=e,e},get_colorCombine:function(){return this._colorCombine},set_colorCombine:function(e){return this._colorCombine=e,e},getBitmap:function(){return null}};function FitsImage(e,t,i,r){this.errored=!1,this.numAxis=0,this.histogramMaxCount=0,this.sourceBlob=null,this.header={},this.position=0,this.bufferSize=1,this._parseSuccessful$1=!1,WcsImage.call(this),this.dataset=e,this.fitsProperties=e.get_fitsProperties(),this._callBack$1=r,this.filename=t,null!=i?this._readFromBlob$1(i):this.getFile(t)}registerType("WcsImage",[WcsImage,WcsImage$,null]),FitsImage.naN=NaN;var FitsImage$={getFile:function(e){this._webFile$1=new WebFile(e),this._webFile$1.responseType="blob",this._webFile$1.onStateChange=ss.ss.bind("fileStateChange",this),this._webFile$1.send()},fileStateChange:function(){if(2===this._webFile$1.get_state())this.errored=!0,null!=this._callBack$1&&this._callBack$1(this);else if(1===this._webFile$1.get_state()){var e=this._webFile$1.getBlob();this._readFromBlob$1(e)}},_readFromBlob$1:function(e){var t=this;this.sourceBlob=e;var i=new FileReader;i.onloadend=function(e){t.readFromBin(new DataView(i.result)),t.errored=!t._parseSuccessful$1,null!=t._callBack$1&&t._callBack$1(t)},i.readAsArrayBuffer(e)},_readByteString$1:function(e,t){for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e.getUint8(this.position)),this.position++;return i},_validateFitsSimple$1:function(e){var t=this._readByteString$1(e,8),i=ss.ss.trimEnd(t);return this.position-=8,"SIMPLE"===i.toUpperCase()},readFromBin:function(e){if(this._validateFitsSimple$1(e)){for(var t=!1;!t;)for(var i=0;i<36;i++){var r=this._readByteString$1(e,80);if(!t){var n=ss.ss.trimEnd(r.substring(0,8)),s=r.substring(10).split("/");if("END"===n.toUpperCase()){for(t=!0,i++,r=this._readByteString$1(e,80);ss.ss.whitespace(r);)i++,r=this._readByteString$1(e,80);"XTENSION"===(n=ss.ss.trimEnd(r.substring(0,8))).toUpperCase()?t=!1:this.position-=80}else this._addKeyword$1(n,s)}}if(t){this.numAxis=parseInt(this.header.NAXIS),ss.ss.keyExists(this.header,"BLANK")&&(this.fitsProperties.blankValue=parseFloat(this.header.BLANK),this.fitsProperties.containsBlanks=!0),ss.ss.keyExists(this.header,"BZERO")&&(this.fitsProperties.bZero=parseFloat(this.header.BZERO)),ss.ss.keyExists(this.header,"BSCALE")&&(this.fitsProperties.bScale=parseFloat(this.header.BSCALE)),this.axisSize=new Array(this.numAxis);for(var a=0;a<this.numAxis;a++)this.axisSize[a]=parseInt(this.header[ss.ss.format("NAXIS{0}",a+1)]),this.bufferSize*=this.axisSize[a];var o=parseInt(this.header.BITPIX);this.readDataUnit(e,o),this.numAxis>1&&(this.sizeX=this.axisSize[0],this.sizeY=this.axisSize[1],this.histogram=this.computeHistogram(256),this.histogramMaxCount=this.histogram[256]),this.computeWcs(),this._parseSuccessful$1=!0}else console.log("Unable to parse requested FITS file.")}else console.log("The requested file is not a valid FITS file.")},_addKeyword$1:function(e,t){if("CONTINUE"!==e&&"COMMENT"!==e&&"HISTORY"!==e&&!ss.ss.emptyString(e))try{ss.ss.keyExists(this.header,e)?this.header[e]=ss.ss.trim(t[0]):this.header[e.toUpperCase()]=ss.ss.trim(t[0])}catch(e){}},readDataUnit:function(e,t){switch(this.dataUnit=new Float32Array(this.bufferSize),t){case-64:this.readDataUnitFloat64(e);break;case-32:this.readDataUnitFloat32(e);break;case 8:this.readDataUnitUint8(e);break;case 16:this.readDataUnitInt16(e);break;case 32:this.readDataUnitInt32(e);break;case 64:console.log("64 bit integer FITS are not yet supported")}},readDataUnitFloat64:function(e){for(var t=0;this.position<e.byteLength;){this.dataUnit[t]=e.getFloat64(this.position,!1);var i=this.dataUnit[t]*this.fitsProperties.bScale+this.fitsProperties.bZero;this.fitsProperties.minVal>i&&(this.fitsProperties.minVal=i),this.fitsProperties.maxVal<i&&(this.fitsProperties.maxVal=i),t++,this.position+=8}this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},readDataUnitFloat32:function(e){for(var t=0;this.position<e.byteLength;){this.dataUnit[t]=e.getFloat32(this.position,!1);var i=this.dataUnit[t]*this.fitsProperties.bScale+this.fitsProperties.bZero;this.fitsProperties.minVal>i&&(this.fitsProperties.minVal=i),this.fitsProperties.maxVal<i&&(this.fitsProperties.maxVal=i),t++,this.position+=4}this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},readDataUnitUint8:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getUint8(this.position),this.fitsProperties.minVal>this.dataUnit[t]&&(this.fitsProperties.minVal=this.dataUnit[t]),this.fitsProperties.maxVal<this.dataUnit[t]&&(this.fitsProperties.maxVal=this.dataUnit[t]),t++,this.position+=1;this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},readDataUnitInt16:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getInt16(this.position,!1),this.fitsProperties.minVal>this.dataUnit[t]&&(this.fitsProperties.minVal=this.dataUnit[t]),this.fitsProperties.maxVal<this.dataUnit[t]&&(this.fitsProperties.maxVal=this.dataUnit[t]),t++,this.position+=2;this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},readDataUnitInt32:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getInt32(this.position,!1),this.fitsProperties.minVal>this.dataUnit[t]&&(this.fitsProperties.minVal=this.dataUnit[t]),this.fitsProperties.maxVal<this.dataUnit[t]&&(this.fitsProperties.maxVal=this.dataUnit[t]),t++,this.position+=4;this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},computeWcs:function(){ss.ss.keyExists(this.header,"CROTA2")&&(this.rotation=parseFloat(ss.ss.trim(this.header.CROTA2)),this.hasRotation=!0),ss.ss.keyExists(this.header,"CDELT1")&&(this.scaleX=parseFloat(ss.ss.trim(this.header.CDELT1)),ss.ss.keyExists(this.header,"CDELT2")&&(this.scaleY=parseFloat(ss.ss.trim(this.header.CDELT2)),this.hasScale=!0)),ss.ss.keyExists(this.header,"CRPIX1")&&(this.referenceX=parseFloat(ss.ss.trim(this.header.CRPIX1))-.5,ss.ss.keyExists(this.header,"CRPIX2")&&(this.referenceY=parseFloat(ss.ss.trim(this.header.CRPIX2))-.5,this.hasPixel=!0));var e=!1,t=!1;if(ss.ss.keyExists(this.header,"CTYPE1")&&(this.header.CTYPE1.indexOf("GLON-")>-1&&(e=!0,t=!0),this.header.CTYPE2.indexOf("GLAT-")>-1&&(e=!0,t=!0),this.header.CTYPE1.indexOf("-TAN")>-1&&(t=!0),this.header.CTYPE1.indexOf("-SIN")>-1&&(t=!0)),!t)throw new Error("Only TAN projected images are supported: ");if(this.hasSize=!0,ss.ss.keyExists(this.header,"CRVAL1")&&(this.centerX=parseFloat(ss.ss.trim(this.header.CRVAL1)),ss.ss.keyExists(this.header,"CRVAL2")&&(this.centerY=parseFloat(ss.ss.trim(this.header.CRVAL2)),this.hasLocation=!0)),e){var i=Coordinates.galactictoJ2000(this.centerX,this.centerY);this.centerX=i[0],this.centerY=i[1]}ss.ss.keyExists(this.header,"CD1_1")&&ss.ss.keyExists(this.header,"CD1_2")&&ss.ss.keyExists(this.header,"CD2_1")&&ss.ss.keyExists(this.header,"CD2_2")&&(this.cd1_1=parseFloat(ss.ss.trim(this.header.CD1_1)),this.cd1_2=parseFloat(ss.ss.trim(this.header.CD1_2)),this.cd2_1=parseFloat(ss.ss.trim(this.header.CD2_1)),this.cd2_2=parseFloat(ss.ss.trim(this.header.CD2_2)),this.hasRotation||this.calculateRotationFromCD(),this.hasScale||this.calculateScaleFromCD(),this.hasScale=!0,this.hasRotation=!0),this.set_validWcs(this.hasScale&&this.hasRotation&&this.hasPixel&&this.hasLocation)},applyDisplaySettings:function(){ss.ss.keyExists(this.header,"DATAMIN")&&(this.fitsProperties.lowerCut=parseFloat(ss.ss.trim(this.header.DATAMIN)),this.fitsProperties.minVal=this.fitsProperties.lowerCut),ss.ss.keyExists(this.header,"DATAMAX")&&(this.fitsProperties.upperCut=parseFloat(ss.ss.trim(this.header.DATAMAX)),this.fitsProperties.maxVal=this.fitsProperties.upperCut),ss.ss.keyExists(this.header,"PXCUTMIN")&&(this.fitsProperties.lowerCut=parseFloat(ss.ss.trim(this.header.PXCUTMIN))),ss.ss.keyExists(this.header,"PXCUTMAX")&&(this.fitsProperties.upperCut=parseFloat(ss.ss.trim(this.header.PXCUTMAX)))},computeHistogram:function(e){for(var t=new Array(e+1),i=0;i<e+1;i++)t[i]=0;this.populateHistogram(t);for(var r=1,n=ss.ss.enumerate(t);n.moveNext();){var s=n.current;s>r&&(r=s)}return t[e]=r,t},populateHistogram:function(e){for(var t=e.length,i=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,r=0;r<this.dataUnit.length;r++)this.dataUnit[r]!==FitsImage.naN&&e[Math.min(t-1,ss.ss.truncate((this.fitsProperties.bZero+this.fitsProperties.bScale*this.dataUnit[r]-this.fitsProperties.minVal)/i))]++},drawHistogram:function(e){e.clearRect(0,0,255,150),e.beginPath(),e.strokeStyle="rgba(255,255,255,255)";for(var t=Math.log(this.histogramMaxCount),i=0;i<this.histogram.length;i++){var r=Math.log(this.histogram[i])/t;r<0&&(r=0),e.moveTo(i,150),e.lineTo(i,150-150*r),e.stroke()}}};registerType("FitsImage",[FitsImage,FitsImage$,WcsImage]);var DataTypes={byteT:0,int16T:1,int32T:2,floatT:3,doubleT:4,none:5};function ScaleMap(){}registerType("DataTypes",DataTypes),registerEnum("DataTypes",DataTypes);var ScaleMap$={};function ScaleLinear(e,t){this._min$1=0,this._max$1=0,this._factor$1=0,this._logFactor$1=0,ScaleMap.call(this),this._min$1=e,this._max$1=t,this._factor$1=t-e}registerType("ScaleMap",[ScaleMap,ScaleMap$,null]);var ScaleLinear$={map:function(e){return Math.min(255,Math.max(0,ss.ss.truncate((e-this._min$1)/this._factor$1*255)))}};function ScaleLog(e,t){this._min$1=0,this._max$1=0,this._factor$1=0,this._logFactor$1=0,ScaleMap.call(this),this._min$1=e,this._max$1=t,this._factor$1=t-e,this._logFactor$1=255/Math.log(255)}registerType("ScaleLinear",[ScaleLinear,ScaleLinear$,ScaleMap]);var ScaleLog$={map:function(e){return Math.min(255,Math.max(0,ss.ss.truncate(Math.log((e-this._min$1)/this._factor$1*255)*this._logFactor$1)))}};function ScalePow(e,t){this._min$1=0,this._max$1=0,this._factor$1=0,this._powFactor$1=0,ScaleMap.call(this),this._min$1=e,this._max$1=t,this._factor$1=t-e,this._powFactor$1=255/Math.pow(255,2)}registerType("ScaleLog",[ScaleLog,ScaleLog$,ScaleMap]);var ScalePow$={map:function(e){return Math.min(255,Math.max(0,ss.ss.truncate(Math.pow((e-this._min$1)/this._factor$1*255,2)*this._powFactor$1)))}};function ScaleSqrt(e,t){this._min$1=0,this._max$1=0,this._factor$1=0,this._sqrtFactor$1=0,ScaleMap.call(this),this._min$1=e,this._max$1=t,this._factor$1=t-e,this._sqrtFactor$1=255/Math.sqrt(255)}registerType("ScalePow",[ScalePow,ScalePow$,ScaleMap]);var ScaleSqrt$={map:function(e){return Math.min(255,Math.max(0,ss.ss.truncate(Math.sqrt((e-this._min$1)/this._factor$1*255)*this._sqrtFactor$1)))}};function HistogramEqualization(e,t,i){this._min$1=0,this._max$1=0,this._factor$1=0,this._maxHistogramValue$1=1,ScaleMap.call(this),this._min$1=t,this._max$1=i,this._factor$1=i-t,this._histogram$1=e.computeHistogram(1e4),this._maxHistogramValue$1=this._histogram$1[1e4],this._lookup$1=new Array(1e4);for(var r=ss.ss.truncate(e.get_sizeX()*e.get_sizeY()),n=0,s=0;s<1e4;s++)n+=this._histogram$1[s],this._lookup$1[s]=Math.min(255,255*n/r)+.5}registerType("ScaleSqrt",[ScaleSqrt,ScaleSqrt$,ScaleMap]);var HistogramEqualization$={map:function(e){return this._lookup$1[Math.min(9999,Math.max(0,ss.ss.truncate((e-this._min$1)/this._factor$1*9999)))]}};function FitsImageJs(e,t,i,r){this.dataType=DataTypes.none,this._color$2=!1,this.isTiledFits=!1,FitsImage.call(this,e,t,i,r)}registerType("HistogramEqualization",[HistogramEqualization,HistogramEqualization$,ScaleMap]),FitsImageJs.createTiledFits=function(e,t,i){var r=new FitsImageJs(e,t,null,i);return r.isTiledFits=!0,r};var FitsImageJs$={readFromBin:function(e){FitsImage.prototype.readFromBin.call(this,e),3===this.numAxis&&3===this.axisSize[2]&&(this._color$2=!0)},readDataUnit:function(e,t){var i=new BinaryReader(new Uint8Array(e.buffer));switch(i.position=this.position,t){case-64:this.dataType=DataTypes.doubleT,this._readDataUnitFloat64$2(i);break;case-32:this.dataType=DataTypes.floatT,this._readDataUnitFloat32$2(i);break;case 8:this.dataType=DataTypes.byteT,this._readDataUnitUint8$2(i);break;case 16:this.dataType=DataTypes.int16T,this._readDataUnitInt16$2(i);break;case 32:this.dataType=DataTypes.int32T,this._readDataUnitInt32$2(i)}this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal},_readDataUnitUint8$2:function(e){var t=new Array(this.bufferSize);this._dataBuffer$2=t;for(var i=0;i<this.bufferSize;i++)t[i]=e.readByte(),this.fitsProperties.minVal>t[i]&&(this.fitsProperties.minVal=t[i]),this.fitsProperties.maxVal<t[i]&&(this.fitsProperties.maxVal=t[i])},_readDataUnitInt16$2:function(e){var t=new Array(this.bufferSize);this._dataBuffer$2=t;for(var i=0;i<this.bufferSize;i++)t[i]=256*e.readSByte()+e.readByte(),this.fitsProperties.minVal>t[i]&&(this.fitsProperties.minVal=t[i]),this.fitsProperties.maxVal<t[i]&&(this.fitsProperties.maxVal=t[i])},_readDataUnitInt32$2:function(e){var t=new Array(this.bufferSize);this._dataBuffer$2=t;for(var i=0;i<this.bufferSize;i++)t[i]=(e.readSByte()<<24)+(e.readSByte()<<16)+(e.readSByte()<<8)+e.readByte(),this.fitsProperties.minVal>t[i]&&(this.fitsProperties.minVal=t[i]),this.fitsProperties.maxVal<t[i]&&(this.fitsProperties.maxVal=t[i])},_readDataUnitFloat32$2:function(e){var t=new Array(this.bufferSize);this._dataBuffer$2=t;for(var i=new Uint8Array(4),r=0;r<this.bufferSize;r++)i[3]=e.readByte(),i[2]=e.readByte(),i[1]=e.readByte(),i[0]=e.readByte(),t[r]=new Float32Array(i.buffer,0,1)[0],this.fitsProperties.minVal>t[r]&&(this.fitsProperties.minVal=t[r]),this.fitsProperties.maxVal<t[r]&&(this.fitsProperties.maxVal=t[r])},_readDataUnitFloat64$2:function(e){var t=new Array(this.bufferSize),i=new Uint8Array(8);this._dataBuffer$2=t;for(var r=0;r<this.bufferSize;r++)i[7]=e.readByte(),i[6]=e.readByte(),i[5]=e.readByte(),i[4]=e.readByte(),i[3]=e.readByte(),i[2]=e.readByte(),i[1]=e.readByte(),i[0]=e.readByte(),t[r]=new Float64Array(i.buffer,0,1)[0],this.fitsProperties.minVal>t[r]&&(this.fitsProperties.minVal=t[r]),this.fitsProperties.maxVal<t[r]&&(this.fitsProperties.maxVal=t[r])},getBitmap:function(){return this.fitsProperties.upperCut||this.fitsProperties.lowerCut||(this.fitsProperties.lowerCut=this.fitsProperties.minVal,this.fitsProperties.upperCut=this.fitsProperties.maxVal),this.getScaledBitmap(this.fitsProperties.lowerCut,this.fitsProperties.upperCut,this.fitsProperties.scaleType,0,this.fitsProperties.colorMapName)},getScaledBitmap:function(e,t,i,r,n){var s;this.fitsProperties.scaleType=i,this.fitsProperties.lowerCut=e,this.fitsProperties.upperCut=t,this.fitsProperties.colorMapName=n;var a=ColorMapContainer.fromNamedColormap(n);switch(i){case 0:default:s=new ScaleLinear(e,t);break;case 1:s=new ScaleLog(e,t);break;case 2:s=new ScalePow(e,t);break;case 3:s=new ScaleSqrt(e,t);break;case 4:s=new HistogramEqualization(this,e,t)}try{switch(this.dataType){case DataTypes.byteT:return this._getBitmapByte$2(e,t,s,0,a);case DataTypes.int16T:return this.getBitmapShort(e,t,s,0,a);case DataTypes.int32T:return this._getBitmapInt$2(e,t,s,0,a);case DataTypes.floatT:return this._getBitmapFloat$2(e,t,s,0,a);case DataTypes.doubleT:return this._getBitmapDouble$2(e,t,s,0,a);case DataTypes.none:default:return Bitmap.create(100,100)}}catch(e){return Bitmap.create(10,10)}},_setPixelWithColorMap$2:function(e,t,i,r,n){if(null!=n){var s=r/255;if(Number.isNaN(s))e.setPixel(t,i,0,0,0,0);else{var a=n.findClosestColor(s);e.setPixel(t,i,ss.ss.truncate(a.r),ss.ss.truncate(a.g),ss.ss.truncate(a.b),this.fitsProperties.transparentBlack&&!r?0:255)}}else e.setPixel(t,i,r,r,r,this.fitsProperties.transparentBlack&&!r?0:255)},_getBitmapByte$2:function(e,t,i,r,n){for(var s=this._dataBuffer$2,a=this.axisSize[0],o=this.axisSize[0]*this.axisSize[1]*r,l=Bitmap.create(this.axisSize[0],this.axisSize[1]),h=0;h<this.axisSize[1];h++)for(var c=this.axisSize[1]-1-h,u=0;u<this.axisSize[0];u++)if(this._color$2){var d=s[u+c*a],_=s[u+c*a+o],g=s[u+c*a+2*o];if(this.fitsProperties.containsBlanks&&d===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var f=i.map(d),m=i.map(_),p=i.map(g);l.setPixel(u,h,f,m,p,255)}}else{var C=s[u+c*a+o];if(this.fitsProperties.containsBlanks&&C===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var S=i.map(C);this._setPixelWithColorMap$2(l,u,h,S,n)}}return l},_getBitmapDouble$2:function(e,t,i,r,n){for(var s=this._dataBuffer$2,a=this.axisSize[0],o=this.axisSize[0]*this.axisSize[1]*r,l=Bitmap.create(this.axisSize[0],this.axisSize[1]),h=0;h<this.axisSize[1];h++)for(var c=this.axisSize[1]-1-h,u=0;u<this.axisSize[0];u++)if(this._color$2){var d=s[u+c*a],_=s[u+c*a+o],g=s[u+c*a+2*o];if(this.fitsProperties.containsBlanks&&d===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var f=i.map(d),m=i.map(_),p=i.map(g);l.setPixel(u,h,f,m,p,255)}}else{var C=s[u+c*a+o];if(this.fitsProperties.containsBlanks&&C===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var S=i.map(C);this._setPixelWithColorMap$2(l,u,h,S,n)}}return l},_getBitmapFloat$2:function(e,t,i,r,n){for(var s=this._dataBuffer$2,a=this.axisSize[0],o=this.axisSize[0]*this.axisSize[1]*r,l=Bitmap.create(this.axisSize[0],this.axisSize[1]),h=0;h<this.axisSize[1];h++)for(var c=this.axisSize[1]-1-h,u=0;u<this.axisSize[0];u++)if(this._color$2){var d=s[u+c*a],_=s[u+c*a+o],g=s[u+c*a+2*o];if(this.fitsProperties.containsBlanks&&d===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var f=i.map(d),m=i.map(_),p=i.map(g);l.setPixel(u,h,f,m,p,255)}}else{var C=s[u+c*a+o];if(this.fitsProperties.containsBlanks&&C===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var S=i.map(C);this._setPixelWithColorMap$2(l,u,h,S,n)}}return l},_getBitmapInt$2:function(e,t,i,r,n){for(var s=this._dataBuffer$2,a=this.axisSize[0],o=this.axisSize[0]*this.axisSize[1]*r,l=Bitmap.create(this.axisSize[0],this.axisSize[1]),h=0;h<this.axisSize[1];h++)for(var c=this.axisSize[1]-1-h,u=0;u<this.axisSize[0];u++)if(this._color$2){var d=s[u+c*a],_=s[u+c*a+o],g=s[u+c*a+2*o];if(this.fitsProperties.containsBlanks&&d===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var f=i.map(d),m=i.map(_),p=i.map(g);l.setPixel(u,h,f,m,p,255)}}else{var C=s[u+c*a+o];if(this.fitsProperties.containsBlanks&&C===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var S=i.map(C);this._setPixelWithColorMap$2(l,u,h,S,n)}}return l},getBitmapShort:function(e,t,i,r,n){for(var s=this._dataBuffer$2,a=this.axisSize[0],o=this.axisSize[0]*this.axisSize[1]*r,l=Bitmap.create(this.axisSize[0],this.axisSize[1]),h=0;h<this.axisSize[1];h++)for(var c=this.axisSize[1]-1-h,u=0;u<this.axisSize[0];u++)if(this._color$2){var d=s[u+c*a],_=s[u+c*a+o],g=s[u+c*a+2*o];if(this.fitsProperties.containsBlanks&&d===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var f=i.map(d),m=i.map(_),p=i.map(g);l.setPixel(u,h,f,m,p,255)}}else{var C=s[u+c*a+o];if(this.fitsProperties.containsBlanks&&C===this.fitsProperties.blankValue)l.setPixel(u,h,0,0,0,0);else{var S=i.map(C);this._setPixelWithColorMap$2(l,u,h,S,n)}}return l},computeWcs:function(){this.isTiledFits||FitsImage.prototype.computeWcs.call(this)},populateHistogram:function(e){switch(this.dataType){case DataTypes.byteT:this._populateHistogramByte$2(e);break;case DataTypes.int16T:this._populateHistogramInt16$2(e);break;case DataTypes.int32T:this._populateHistogramInt32$2(e);break;case DataTypes.floatT:this._populateHistogramFloat$2(e);break;case DataTypes.doubleT:this._populateHistogramDouble$2(e)}},_populateHistogramDouble$2:function(e){for(var t=e.length,i=this._dataBuffer$2,r=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;Number.isNaN(s)||e[Math.min(t-1,ss.ss.truncate((s-this.fitsProperties.minVal)/r))]++}},_populateHistogramFloat$2:function(e){for(var t=e.length,i=this._dataBuffer$2,r=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;s!==FitsImage.naN&&e[Math.min(t-1,ss.ss.truncate((s-this.fitsProperties.minVal)/r))]++}},_populateHistogramInt32$2:function(e){for(var t=e.length,i=this._dataBuffer$2,r=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;e[Math.min(t-1,ss.ss.truncate((s-this.fitsProperties.minVal)/r))]++}},_populateHistogramInt16$2:function(e){for(var t=e.length,i=this._dataBuffer$2,r=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;e[Math.min(t-1,ss.ss.truncate((s-this.fitsProperties.minVal)/r))]++}},_populateHistogramByte$2:function(e){for(var t=e.length,i=this._dataBuffer$2,r=(this.fitsProperties.maxVal-this.fitsProperties.minVal)/t,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;e[Math.min(t-1,ss.ss.truncate((s-this.fitsProperties.minVal)/r))]++}}};function FitsImageTile(e,t,i){FitsImage.call(this,e,t,null,i)}registerType("FitsImageJs",[FitsImageJs,FitsImageJs$,FitsImage]);var FitsImageTile$={readDataUnitFloat64:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getFloat64(this.position,!1),t++,this.position+=8},readDataUnitFloat32:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getFloat32(this.position,!1),t++,this.position+=4},readDataUnitUint8:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getUint8(this.position),t++,this.position+=1},readDataUnitInt16:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getInt16(this.position,!1),t++,this.position+=2},readDataUnitInt32:function(e){for(var t=0;this.position<e.byteLength;)this.dataUnit[t]=e.getInt32(this.position,!1),t++,this.position+=4},computeWcs:function(){}};function Tile(){this._renderTriangleLists=new Array(4),this._indexBuffers=new Array(4),this.level=0,this.tileX=0,this.tileY=0,this.texture=null,this.texture2d=null,this.isCatalogTile=!1,this.readyToRender=!1,this.inViewFrustum=!0,this.globalCenter=Vector3d.zero,this.children=[null,null,null,null],this.parent=null,this.localCenter=new Vector3d,this.renderedAtOrBelowGeneration=0,this._demScaleFactor=6371e3,this.demIndex=0,this.demAverage=0,this.demReady=!1,this.texReady=!1,this.demTile=!1,this.demDownloading=!1,this.renderedGeneration=0,this.accomidation=0,this.accessCount=0,this.downloading=!1,this.geometryCreated=!1,this._isHdTile=!1,this.demSize=1089,this._topLeftScreen=new Vector3d,this._bottomRightScreen=new Vector3d,this._topRightScreen=new Vector3d,this._bottomLeftScreen=new Vector3d,this.sphereRadius=0,this.sphereCenter=new Vector3d,this.radius=1,this.triangleCount=0,this.requestHits=0,this.requestPending=!1,this.errored=!1,this._key=null,this._tileId=null,this._vertexCount=0,this.renderChildPart=null,this.renderChildPart=new Array(4);for(var e=0;e<4;e++)this.renderChildPart[e]=BlendState.create(!1,500)}registerType("FitsImageTile",[FitsImageTile,FitsImageTile$,FitsImage]),Tile.currentRenderGeneration=0,Tile.tileTargetX=-1,Tile.tileTargetY=-1,Tile.tileTargetLevel=-1,Tile.tilesInView=0,Tile.trianglesRendered=0,Tile.tilesTouched=0,Tile.frustumList=null,set_tileUvMultiple(1),Tile.callCount=0,Tile.useAccomidation=!0,set_tileDemEnabled(!0),Tile.maxLevel=20,Tile.meshComplexity=50,Tile.imageQuality=50,Tile.lastDeepestLevel=0,Tile.deepestLevel=0,Tile.RC=3.1415927/180,Tile.getFrustumList=function(){try{return Tile.frustumList}catch(e){return null}},Tile.get_subDivisions=function(){return 32};var Tile$={getIndexBuffer:function(e,t){return this._indexBuffers[e]},isPointInTile:function(e,t){return!1},getSurfacePointAltitude:function(e,t,i){return 0},makeTexture:function(){if(null!=tilePrepDevice)try{if(this.texture2d=tilePrepDevice.createTexture(),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,this.texture2d),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_S,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_T,WEBGL.CLAMP_TO_EDGE),this.dataset.get_extension().toLowerCase().indexOf("fits")>-1&&useGlVersion2)tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.R32F,ss.ss.truncate(this.fitsImage.get_sizeX()),ss.ss.truncate(this.fitsImage.get_sizeY()),0,WEBGL.RED,WEBGL.FLOAT,this.fitsImage.dataUnit),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.NEAREST),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MAG_FILTER,WEBGL.NEAREST);else{var e=this.texture;if(1==(!Texture.isPowerOfTwo(this.texture.height)|!Texture.isPowerOfTwo(this.texture.width))){var t=document.createElement("canvas");t.height=Texture.fitPowerOfTwo(e.height),t.width=Texture.fitPowerOfTwo(e.width),t.getContext("2d").drawImage(e,0,0,t.width,t.height),e=t}tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGBA,WEBGL.RGBA,WEBGL.UNSIGNED_BYTE,e),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.LINEAR_MIPMAP_NEAREST),tilePrepDevice.generateMipmap(WEBGL.TEXTURE_2D)}tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,null)}catch(e){this.errored=!0}},addVertex:function(e,t,i){return e[t++]=i.position.x,e[t++]=i.position.y,e[t++]=i.position.z,e[t++]=i.tu,e[t++]=i.tv,t},geoTo3dWithAlt:function(e,t,i,r){if(e=Math.max(Math.min(90,e),-90),t=Math.max(Math.min(180,t),-180),!tileDemEnabled||null==this.demData)return this.geoTo3d(e,t,i);r&&(t-=180);var n=this.demData[this.demIndex];return this.geoTo3dWithAltitude(e,t,n,i)},geoTo3dWithAltitude:function(e,t,i,r){var n=1+i/this.get__demScaleFactor(),s=Vector3d.create(Math.cos(t*Tile.RC)*Math.cos(e*Tile.RC)*n,Math.sin(e*Tile.RC)*n,Math.sin(t*Tile.RC)*Math.cos(e*Tile.RC)*n);return r&&s.subtract(this.localCenter),s},get__demScaleFactor:function(){return this._demScaleFactor},set__demScaleFactor:function(e){return this._demScaleFactor=e,e},requestImage:function(){var e=this;if(this.dataset.get_extension().toLowerCase().indexOf("fits")>-1)this.downloading||this.readyToRender||(this.downloading=!0,this.fitsImage=useGlVersion2?new FitsImageTile(this.dataset,this.get_URL(),(function(t){e.downloading=!1,e.errored=e.fitsImage.errored,tileCacheRemoveFromQueue(e.get_key(),!0),e.fitsImage.errored||(e.level||(e.dataset.get_fitsProperties()._fireMainImageLoaded(e.fitsImage),e.fitsImage.applyDisplaySettings()),e.texReady=!0,e.readyToRender=e.texReady&&(e.demReady||!e.demTile),e.requestPending=!1,e.makeTexture())})):FitsImageJs.createTiledFits(this.dataset,this.get_URL(),(function(t){e.level||e.dataset.get_fitsProperties()._fireMainImageLoaded(e.fitsImage),e.texReady=!0,e.downloading=!1,e.errored=e.fitsImage.errored,e.readyToRender=e.texReady&&(e.demReady||!e.demTile),e.requestPending=!1,tileCacheRemoveFromQueue(e.get_key(),!0),e.texture2d=t.getBitmap().getTexture()})));else{if(null!=this.get_dataset().get_wcsImage())return this.texReady=!0,this.downloading=!1,this.errored=!1,this.readyToRender=!0,this.requestPending=!1,void tileCacheRemoveFromQueue(this.get_key(),!0);if(!this.downloading&&!this.readyToRender){this.downloading=!0,this.texture=document.createElement("img");var t=this.texture;this.texture.addEventListener("load",(function(t){e.texReady=!0,e.downloading=!1,e.errored=!1,e.readyToRender=e.texReady&&(e.demReady||!e.demTile),e.requestPending=!1,tileCacheRemoveFromQueue(e.get_key(),!0),e.makeTexture()}),!1),this.texture.addEventListener("error",(function(t){if(!e.texture.hasAttribute("proxyattempt")){e.texture.setAttribute("proxyattempt",!0);var i=URLHelpers.singleton.activateProxy(e.texture.src);if(null!=i)return void(e.texture.src=i)}e.downloading=!1,e.readyToRender=!1,e.errored=!0,e.requestPending=!1,tileCacheRemoveFromQueue(e.get_key(),!0)}),!1),t.crossOrigin="anonymous",this.texture.src=this.get_URL()}}},createDemFromParent:function(){return!1},_loadDemData:function(){if(null==this.demFile)return this.createDemFromParent();if(this.demData=this.demFile,1089!==this.demFile.length&&513!==this.demFile.length)return this.createDemFromParent();for(var e=ss.ss.enumerate(this.demData);e.moveNext();)e.current;return this.demAverage/=this.demData.length,!0},requestDem:function(){var e=this;if(!this.readyToRender&&!this.demDownloading){this.demTile=!0,this.demDownloading=!0,Tile.callCount++;var t=new XMLHttpRequest;t.addEventListener("load",(function(i){e.demReady=!0,e.demDownloading=!1,e.readyToRender=e.texReady&&(e.demReady||!e.demTile),e.requestPending=!1;try{e.demFile=new Float32Array(t.response)}catch(e){}tileCacheRemoveFromQueue(e.get_key(),!0)}),!1),t.addEventListener("error",(function(t){e.demDownloading=!1,e.demReady=!1,e.readyToRender=!1,e.errored=!0,e.requestPending=!1,tileCacheRemoveFromQueue(e.get_key(),!0)}),!1),t.open("GET",this.get_demURL(),!0),t.responseType="arraybuffer",t.send()}},draw3D:function(e,t){if(this.renderedGeneration=Tile.currentRenderGeneration,Tile.tilesTouched++,this.accessCount=inc_tileCacheAccessID(),this.errored)return!1;if(this.inViewFrustum=!0,!this.readyToRender)return tileCacheAddTileToQueue(this),!1;var i=0,r=0;(this.dataset.get_mercator()||this.dataset.get_bottomsUp())&&(r=1);for(var n=!1,s=!1,a=0;a<2;a++)for(var o=0;o<2;o++)this.level<this.dataset.get_levels()?(null==this.children[i]&&(this.children[i]=tileCacheGetTile(this.level+1,2*this.tileX+(o+0)%2,2*this.tileY+(a+r)%2,this.dataset,this)),this.children[i].isTileInFrustum(e.get_frustum())?(this.inViewFrustum=!0,this.children[i].isTileBigEnough(e)?(this.renderChildPart[i].set_targetState(!this.children[i].draw3D(e,t)),this.renderChildPart[i].get_targetState()&&(s=!0)):this.renderChildPart[i].set_targetState(!0)):this.renderChildPart[i].set_targetState(this.renderChildPart[i].set_state(!1)),this.renderChildPart[i].get_targetState(),this.renderChildPart[i].get_state()):this.renderChildPart[i].set_state(!0),this.renderChildPart[i].get_state()&&(n=!0),i++;if((s||n)&&(this.renderedAtOrBelowGeneration=Tile.currentRenderGeneration,null!=this.parent&&(this.parent.renderedAtOrBelowGeneration=this.renderedAtOrBelowGeneration)),!n)return!0;if(!this.createGeometry(e))return!1;Tile.tilesInView++,this.accomidation=this._computeAccomidation();for(var l=0;l<4;l++)this.renderChildPart[l].get_targetState()&&this.renderPart(e,l,t/100,!1);return!0},_computeAccomidation:function(){var e=0;if(!Tile.useAccomidation)return 0;var t=tileCacheGetCachedTile(this.level,this.tileX,this.tileY+1,this.dataset,this);(null==t||t.renderedAtOrBelowGeneration<Tile.currentRenderGeneration-2)&&(e+=1);var i=tileCacheGetCachedTile(this.level,this.tileX+1,this.tileY,this.dataset,this);(null==i||i.renderedAtOrBelowGeneration<Tile.currentRenderGeneration-2)&&(e+=2);var r=tileCacheGetCachedTile(this.level,this.tileX,this.tileY-1,this.dataset,this);(null==r||r.renderedAtOrBelowGeneration<Tile.currentRenderGeneration-2)&&(e+=4);var n=tileCacheGetCachedTile(this.level,this.tileX-1,this.tileY,this.dataset,this);return(null==n||n.renderedAtOrBelowGeneration<Tile.currentRenderGeneration-2)&&(e+=8),e},renderPart:function(e,t,i,r){if(null==tilePrepDevice)for(var n=e.lighting&&null!=e.get_sunPosition(),s=ss.ss.enumerate(this._renderTriangleLists[t]);s.moveNext();){var a=s.current;if(a.opacity=i,n){var o=a.normal.copy();e.get_world().multiplyVector(o),o.normalize();var l=Vector3d.dot(o,e.get_sunPosition());l=l<0?0:Math.min(1,1*l),a.lighting=l}else a.lighting=1;a.draw(e.device,e.WVP)}else useGlVersion2&&null!=this.fitsImage?(ColorMapContainer.bindColorMapTexture(tilePrepDevice,this.dataset.get_fitsProperties().colorMapName),FitsShader.min=this.dataset.get_fitsProperties().lowerCut,FitsShader.max=this.dataset.get_fitsProperties().upperCut,FitsShader.containsBlanks=this.dataset.get_fitsProperties().containsBlanks,FitsShader.blankValue=this.dataset.get_fitsProperties().blankValue,FitsShader.bZero=this.dataset.get_fitsProperties().bZero,FitsShader.bScale=this.dataset.get_fitsProperties().bScale,FitsShader.scaleType=this.dataset.get_fitsProperties().scaleType,FitsShader.transparentBlack=this.dataset.get_fitsProperties().transparentBlack,FitsShader.use(e,this._vertexBuffer,this.getIndexBuffer(t,this.accomidation),this.texture2d,i,!1,this.globalCenter)):TileShader.use(e,this._vertexBuffer,this.getIndexBuffer(t,this.accomidation),this.texture2d,i,!1,this.globalCenter),e.gl.drawElements(WEBGL.TRIANGLES,3*this.triangleCount,WEBGL.UNSIGNED_SHORT,0)},cleanUp:function(e){if(this.readyToRender=!1,this.demData=null,this.demFile=null,this.demDownloading=!1,this.texReady=!1,this.demReady=!1,this.errored=!1,null!=this.texture&&(this.texture=null),this._renderTriangleLists=new Array(4),this.geometryCreated=!1,e&&null!=this.parent&&(this.parent.removeChild(this),this.parent=null),null!=tilePrepDevice){for(var t=ss.ss.enumerate(this._indexBuffers);t.moveNext();){var i=t.current;tilePrepDevice.deleteBuffer(i)}this._indexBuffers=new Array(4),null!=this._vertexBuffer&&(tilePrepDevice.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),null!=this.texture2d&&(tilePrepDevice.deleteTexture(this.texture2d),this.texture2d=null)}},removeChild:function(e){for(var t=0;t<4;t++)if(this.children[t]===e)return void(this.children[t]=null)},createGeometry:function(e){return!(tileDemEnabled&&this.demReady&&null==this.demData&&!this._loadDemData()||tileDemEnabled&&null==this.demData||(this.readyToRender=!0,0))},calcSphere:function(){var e=new Array(4);e[0]=this.topLeft,e[1]=this.bottomRight,e[2]=this.topRight,e[3]=this.bottomLeft;var t=ConvexHull.findEnclosingSphere(e);this.sphereCenter=t.center,this.sphereRadius=t.radius},isTileBigEnough:function(e){if(this.level>1){var t=e.WVP;t._transformTo(this.topLeft,this._topLeftScreen),t._transformTo(this.bottomRight,this._bottomRightScreen),t._transformTo(this.topRight,this._topRightScreen),t._transformTo(this.bottomLeft,this._bottomLeftScreen);var i=this._topLeftScreen;i.subtract(this._topRightScreen);var r=i.length(),n=this._bottomLeftScreen;n.subtract(this._bottomRightScreen);var s=n.length(),a=this._bottomLeftScreen;a.subtract(this._topLeftScreen);var o=a.length(),l=this._bottomRightScreen;l.subtract(this._topRightScreen);var h=l.length();if(Math.max(Math.max(h,o),Math.max(s,r))<300)return!1;Tile.deepestLevel=this.level>Tile.deepestLevel?this.level:Tile.deepestLevel}return!0},isTileInFrustum:function(e){this.level<2&&(!this.dataset.get_projection()||this.dataset.get_projection()),this.inViewFrustum=!1;for(var t=new Vector4d(this.sphereCenter.x,this.sphereCenter.y,this.sphereCenter.z,1),i=0;i<6;i++)if(e[i].dot(t)<-this.sphereRadius)return!1;return this.inViewFrustum=!0,!0},get_sphereRadius:function(){return this.sphereRadius},get_sphereCenter:function(){return this.sphereCenter},geoTo3d:function(e,t,i){return 3===this.dataset.get_dataSetType()?Vector3d.create(-Math.cos(t*Tile.RC)*Math.cos(e*Tile.RC)*this.radius,Math.sin(e*Tile.RC)*this.radius,Math.sin(t*Tile.RC)*Math.cos(e*Tile.RC)*this.radius):(t-=180,Vector3d.create(Math.cos(t*Tile.RC)*Math.cos(e*Tile.RC)*this.radius,Math.sin(e*Tile.RC)*this.radius,Math.sin(t*Tile.RC)*Math.cos(e*Tile.RC)*this.radius))},onCreateVertexBuffer:function(e,t){},get_dataset:function(){return this.dataset},set_dataset:function(e){return this.dataset=e,e},get_key:function(){return null==this._key&&(this._key=getTileKey(this.dataset,this.level,this.tileX,this.tileY,this.parent)),this._key},get_URL:function(){var e=URLHelpers.singleton.rewrite(this.dataset.get_url(),0),t=e;if(e.indexOf("{1}")>-1)return this.dataset.get_projection()||ss.ss.emptyString(this.dataset.get_quadTreeTileMap())?ss.ss.format(e,this.dataset.get_imageSetID(),this.level,this.tileX,this.tileY):((t=ss.ss.format(e,this.getServerID(),this.getTileID())).indexOf("virtualearth.net")>-1&&(t+="&n=z"),t);t=ss.ss.replaceString(t,"{X}",this.tileX.toString()),t=ss.ss.replaceString(t,"{Y}",this.tileY.toString());var i=0;(t=ss.ss.replaceString(t,"{L}",this.level.toString())).indexOf("{S:0}")>-1&&(i=0,t=ss.ss.replaceString(t,"{S:0}","{S}")),t.indexOf("{S:1}")>-1&&(i=1,t=ss.ss.replaceString(t,"{S:1}","{S}")),t.indexOf("{S:2}")>-1&&(i=2,t=ss.ss.replaceString(t,"{S:2}","{S}")),t.indexOf("{S:3}")>-1&&(i=3,t=ss.ss.replaceString(t,"{S:3}","{S}")),t.indexOf("a{S}")>-1&&(t=ss.ss.replaceString(t,"a{S}","r{S}")),t.indexOf("h{S}")>-1&&(t=ss.ss.replaceString(t,"h{S}","r{S}")),t.indexOf("//r{S}.ortho.tiles.virtualearth.net")>-1&&(t=ss.ss.replaceString(t,"//r{S}.ortho.tiles.virtualearth.net","//ecn.t{S}.tiles.virtualearth.net"));var r,n=this.getTileID();return r=n.length?n.substr(n.length-1,1):i.toString(),t=ss.ss.replaceString(t,"{Q}",n),(t=ss.ss.replaceString(t,"{S}",r)).indexOf("virtualearth.net")>-1&&(t+="&n=z"),t},get_demURL:function(){var e=URLHelpers.singleton.rewrite(this.dataset.get_demUrl(),0);if(this.dataset.get_projection()||freestandingMode||(URLHelpers.singleton.coreStaticUrl("wwtweb/demtile.aspx?q={0},{1},{2},M"),ss.ss.emptyString(e)),e.indexOf("{1}")>-1)return ss.ss.format(e+"&new",this.level,this.tileX,this.tileY);var t=e;t=ss.ss.replaceString(t,"{X}",this.tileX.toString()),t=ss.ss.replaceString(t,"{Y}",this.tileY.toString());var i=0;(t=ss.ss.replaceString(t,"{L}",this.level.toString())).indexOf("{S:0}")>-1&&(i=0,t=ss.ss.replaceString(t,"{S:0}","{S}")),t.indexOf("{S:1}")>-1&&(i=1,t=ss.ss.replaceString(t,"{S:1}","{S}")),t.indexOf("{S:2}")>-1&&(i=2,t=ss.ss.replaceString(t,"{S:2}","{S}")),t.indexOf("{S:3}")>-1&&(i=3,t=ss.ss.replaceString(t,"{S:3}","{S}"));var r,n=this.getTileID();return r=n.length?n.substr(n.length-1,1):i.toString(),t=ss.ss.replaceString(t,"{Q}",n),ss.ss.replaceString(t,"{S}",r)},getServerID:function(){return(1&this.tileX)+((1&this.tileY)<<1)},getTileID:function(){if(null!=this._tileId)return this._tileId;var e=this.level,t=this.tileX,i=this.tileY;1===this.dataset.get_projection()&&e++;var r=this.dataset.get_quadTreeTileMap();if(ss.ss.emptyString(r))return this._tileId="0",this._tileId;for(var n=new ss.ss.StringBuilder,s=e;s>0;--s){var a=1<<s-1,o=0;t&a&&(o=1),i&a&&(o+=2),n.append(r.substr(o,1))}return this._tileId=n.toString(),this._tileId},get_vertexCount:function(){return this._vertexCount},set_vertexCount:function(e){return this._vertexCount=e,e}};function RenderTriangle(){this.a=new PositionTexture,this.b=new PositionTexture,this.c=new PositionTexture,this.normal=new Vector3d,this.opacity=1,this.expansionInPixels=.6,this.tileLevel=0,this._ta=new Vector3d,this._tb=new Vector3d,this._tc=new Vector3d,this._expandedS0=new Vector2d,this._expandedS1=new Vector2d,this._expandedS2=new Vector2d,this.lighting=1}registerType("Tile",[Tile,Tile$,null]),RenderTriangle.width=1024,RenderTriangle.height=768,RenderTriangle._contractionInPixels=-.5,RenderTriangle.trianglesRendered=0,RenderTriangle.trianglesCulled=0,RenderTriangle.renderingOn=!0,RenderTriangle._factor=1,RenderTriangle.cullInside=!0,RenderTriangle._hw=0,RenderTriangle._qw=0,RenderTriangle._hh=0,RenderTriangle._qh=0,RenderTriangle.create=function(e,t,i,r,n){var s=new RenderTriangle;return s.a=e.copy(),s.b=t.copy(),s.c=i.copy(),s._texture=r,s.tileLevel=n,s.makeNormal(),s},RenderTriangle.createWithMiter=function(e,t,i,r,n,s){var a=new RenderTriangle;return a.expansionInPixels=s,a.a=e.copy(),a.b=t.copy(),a.c=i.copy(),a._texture=r,a.tileLevel=n,a.makeNormal(),a},RenderTriangle._getMiterPoint=function(e,t,i,r){var n=Vector2d.subtract(t,e),s=Vector2d.subtract(i,e);n.normalize(),s.normalize();var a=Vector2d.create(n.x+s.x,n.y+s.y);a.normalize();var o=Vector2d.create(n.x-s.x,n.y-s.y).get_length()/2,l=Math.min(2,r/o);return a.extend(l),Vector2d.create(e.x-a.x,e.y-a.y)},RenderTriangle._miterPoint=function(e,t,i,r,n,s,a){var o=i-e,l=r-t,h=n-e,c=s-t,u=Math.sqrt(o*o+l*l);u&&(o/=u,l/=u),(u=Math.sqrt(h*h+c*c))&&(h/=u,c/=u);var d=o+h,_=l+c;(u=Math.sqrt(d*d+_*_))&&(d/=u,_/=u);var g=o-h,f=l-c,m=(u=Math.sqrt(g*g+f*f))/2,p=Math.min(2,a/m);return d*=p,_*=p,Vector2d.create(e-d,t-_)},RenderTriangle._miterPointOut=function(e,t,i,r,n,s,a,o){var l=r-t,h=n-i,c=s-t,u=a-i,d=Math.sqrt(l*l+h*h);d&&(l/=d,h/=d),(d=Math.sqrt(c*c+u*u))&&(c/=d,u/=d);var _=l+c,g=h+u;(d=Math.sqrt(_*_+g*g))&&(_/=d,g/=d);var f=l-c,m=h-u,p=(d=Math.sqrt(f*f+m*m))/2,C=Math.min(2,o/p);_*=C,g*=C,e.x=t-_,e.y=i-g};var RenderTriangle$={makeNormal:function(){var e=this.a.position.copy(),t=this.b.position.copy(),i=this.c.position.copy();e.normalize(),t.normalize(),i.normalize();var r=e.x+t.x+i.x,n=e.y+t.y+i.y,s=e.z+t.z+i.z;this.normal=Vector3d.create(r/3,n/3,s/3),this.normal.normalize()},_checkBackface:function(){var e=Vector3d.subtractVectors(this._ta,this._tb),t=Vector3d.subtractVectors(this._ta,this._tc),i=Vector3d.cross(e,t);return i.normalize(),i.z>=0},draw:function(e,t){null!=e&&(t._transformTo(this.a.position,this._ta),t._transformTo(this.b.position,this._tb),t._transformTo(this.c.position,this._tc),this._checkBackface()!==RenderTriangle.cullInside?this._drawTriangle(e,this._texture,this._ta.x,this._ta.y,this._tb.x,this._tb.y,this._tc.x,this._tc.y,this.a.tu,this.a.tv,this.b.tu,this.b.tv,this.c.tu,this.c.tv):RenderTriangle.trianglesCulled++)},_drawTriangle:function(e,t,i,r,n,s,a,o,l,h,c,u,d,_){if(!this.intersects(0,RenderTriangle.width,0,RenderTriangle.height,i,r,n,s,a,o))return!1;RenderTriangle._miterPointOut(this._expandedS0,i,r,n,s,a,o,this.expansionInPixels),RenderTriangle._miterPointOut(this._expandedS1,n,s,i,r,a,o,this.expansionInPixels),RenderTriangle._miterPointOut(this._expandedS2,a,o,n,s,i,r,this.expansionInPixels),i=this._expandedS0.x,r=this._expandedS0.y,n=this._expandedS1.x,s=this._expandedS1.y,a=this._expandedS2.x,o=this._expandedS2.y,e.save(),RenderTriangle.renderingOn&&(e.beginPath(),e.moveTo(i,r),e.lineTo(n,s),e.lineTo(a,o),e.closePath(),e.clip());var g=l*(_-u)-c*_+d*u+(c-d)*h,f=-(h*(a-n)-u*a+_*n+(u-_)*i)/g,m=(u*o+h*(s-o)-_*s+(_-u)*r)/g,p=(l*(a-n)-c*a+d*n+(c-d)*i)/g,C=-(c*o+l*(s-o)-d*s+(d-c)*r)/g,S=(l*(_*n-u*a)+h*(c*a-d*n)+(d*u-c*_)*i)/g,w=(l*(_*s-u*o)+h*(c*o-d*s)+(d*u-c*_)*r)/g;return e.transform(f,m,p,C,S,w),RenderTriangle.renderingOn&&(e.globalAlpha=this.opacity,this.lighting<1&&(e.globalAlpha=1,e.fillStyle="Black",e.fillRect(0,0,RenderTriangle.width,RenderTriangle.height),e.globalAlpha=this.lighting*this.opacity),e.drawImage(t,0,0)),e.restore(),!0},intersects:function(e,t,i,r,n,s,a,o,l,h){if(n>e&&n<t&&s>i&&s<r)return!0;if(a>e&&a<t&&o>i&&o<r)return!0;if(l>e&&l<t&&h>i&&h<r)return!0;var c=4*RenderTriangle.height;return!(this.tileLevel<4&&(Math.abs(n-a)>c||Math.abs(s-o)>c||Math.abs(l-a)>c||Math.abs(h-o)>c||Math.abs(n-l)>c||Math.abs(s-h)>c))&&(this.lineRectangleIntersect(e,t,i,r,n,s,a,o)||this.lineRectangleIntersect(e,t,i,r,a,o,l,h)||this.lineRectangleIntersect(e,t,i,r,l,h,n,s))},lineRectangleIntersect:function(e,t,i,r,n,s,a,o){var l,h,c,u,d,_,g,f;return _=s-(d=(o-s)/(a-n))*n,d>0?(l=d*e+_,h=d*t+_):(l=d*t+_,h=d*e+_),s<o?(c=s,u=o):(c=o,u=s),(g=l>c?l:c)<(f=h<u?h:u)&&!(f<i||g>r)}};function EquirectangularTile(){this._tileDegrees$1=0,this._topDown$1=!0,this._subDivisionLevel$1=1,Tile.call(this)}registerType("RenderTriangle",[RenderTriangle,RenderTriangle$,null]),EquirectangularTile.create=function(e,t,i,r,n){var s=new EquirectangularTile;return s.parent=n,s.level=e,s.tileX=t,s.tileY=i,s.dataset=r,s._topDown$1=!r.get_bottomsUp(),s.computeBoundingSphere(),s};var EquirectangularTile$={computeBoundingSphere:function(){if(this._topDown$1){this._tileDegrees$1=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level);var e=90-this.tileY*this._tileDegrees$1,t=90-(this.tileY+1)*this._tileDegrees$1,i=this.tileX*this._tileDegrees$1-180,r=(this.tileX+1)*this._tileDegrees$1-180,n=(e+t)/2,s=(i+r)/2;this.sphereCenter=this.geoTo3d(n,s,!1),this.topLeft=this.geoTo3d(e,i,!1),this.bottomRight=this.geoTo3d(t,r,!1),this.topRight=this.geoTo3d(e,r,!1),this.bottomLeft=this.geoTo3d(t,i,!1);var a=this.geoTo3d(e,i,!1);a.subtract(this.sphereCenter),this.sphereRadius=a.length(),this._tileDegrees$1=r-i}else this.computeBoundingSphereBottomsUp()},computeBoundingSphereBottomsUp:function(){var e=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),t=(this.tileY+1)*e-90,i=this.tileY*e-90,r=this.tileX*e-180,n=(this.tileX+1)*e-180,s=(t+i)/2,a=(r+n)/2;this.sphereCenter=this.geoTo3d(s,a,!1),this.topLeft=this.geoTo3d(t,r,!1),this.bottomRight=this.geoTo3d(i,n,!1),this.topRight=this.geoTo3d(t,n,!1),this.bottomLeft=this.geoTo3d(i,r,!1);var o=this.topLeft;o.subtract(this.sphereCenter),this.sphereRadius=o.length(),e=n-r},createGeometry:function(e){Tile.prototype.createGeometry.call(this,e),null==e.gl?this.dataset.get_dataSetType()&&1!==this.dataset.get_dataSetType()||(this._subDivisionLevel$1=Math.max(2,2*(4-this.level))):this._subDivisionLevel$1=32;try{for(var t=0;t<4;t++)this._renderTriangleLists[t]=[];if(!this._topDown$1)return this._createGeometryBottomsUp$1(e);var i,r,n=0,s=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),a=90-this.tileY*s,o=90-(this.tileY+1)*s,l=this.tileX*s-180,h=(this.tileX+1)*s-180,c=h-l,u=o-a;this.topLeft=this.geoTo3d(a,l,!1),this.bottomRight=this.geoTo3d(o,h,!1),this.topRight=this.geoTo3d(a,h,!1),this.bottomLeft=this.geoTo3d(o,l,!1);var d,_,g=new Array((this._subDivisionLevel$1+1)*(this._subDivisionLevel$1+1)),f=1/this._subDivisionLevel$1;for(_=0;_<=this._subDivisionLevel$1;_++)for(i=_!==this._subDivisionLevel$1?a+f*u*_:o,d=0;d<=this._subDivisionLevel$1;d++)r=d!==this._subDivisionLevel$1?l+f*c*d:h,g[n=_*(this._subDivisionLevel$1+1)+d]=PositionTexture.createPos(this.geoTo3d(i,r,!1),d*f,_*f);this.triangleCount=this._subDivisionLevel$1*this._subDivisionLevel$1*2;var m=this._subDivisionLevel$1/2,p=0;if(null==e.gl)for(var C=0;C<2;C++)for(var S=0;S<2;S++){n=0;for(var w=m*C;w<m*(C+1);w++)for(var T=m*S;T<m*(S+1);T++){var y,b,v;y=g[w*(this._subDivisionLevel$1+1)+T],b=g[(w+1)*(this._subDivisionLevel$1+1)+T],v=g[w*(this._subDivisionLevel$1+1)+(T+1)],this._renderTriangleLists[p].push(RenderTriangle.create(y,v,b,this.texture,this.level)),y=g[w*(this._subDivisionLevel$1+1)+(T+1)],b=g[(w+1)*(this._subDivisionLevel$1+1)+T],v=g[(w+1)*(this._subDivisionLevel$1+1)+(T+1)],this._renderTriangleLists[p].push(RenderTriangle.create(y,v,b,this.texture,this.level))}p++}else{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);var M=new Float32Array(5*g.length),x=M;n=0;for(var L=ss.ss.enumerate(g);L.moveNext();){var A=L.current;n=this.addVertex(x,n,A)}for(tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,M,WEBGL.STATIC_DRAW),C=0;C<2;C++)for(S=0;S<2;S++){var V=new Uint16Array(3*this.triangleCount),P=V;for(n=0,w=m*C;w<m*(C+1);w++)for(T=m*S;T<m*(S+1);T++)P[n++]=w*(this._subDivisionLevel$1+1)+T,P[n++]=(w+1)*(this._subDivisionLevel$1+1)+T,P[n++]=w*(this._subDivisionLevel$1+1)+(T+1),P[n++]=w*(this._subDivisionLevel$1+1)+(T+1),P[n++]=(w+1)*(this._subDivisionLevel$1+1)+T,P[n++]=(w+1)*(this._subDivisionLevel$1+1)+(T+1);this._indexBuffers[p]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this._indexBuffers[p]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,V,WEBGL.STATIC_DRAW),p++}}}catch(e){}return!0},_createGeometryBottomsUp$1:function(e){var t,i,r,n,s=0,a=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),o=(this.tileY+1)*a-90,l=this.tileY*a-90,h=this.tileX*a-180,c=(this.tileX+1)*a-180,u=c-h,d=l-o,_=new Array((this._subDivisionLevel$1+1)*(this._subDivisionLevel$1+1)),g=1/this._subDivisionLevel$1;for(n=0;n<=this._subDivisionLevel$1;n++)for(t=n!==this._subDivisionLevel$1?o+g*d*n:l,r=0;r<=this._subDivisionLevel$1;r++)i=r!==this._subDivisionLevel$1?h+g*u*r:c,_[s=n*(this._subDivisionLevel$1+1)+r]=PositionTexture.createPos(this.geoTo3d(t,i,!1),r*g,n*g);this.triangleCount=this._subDivisionLevel$1*this._subDivisionLevel$1*2;var f=this._subDivisionLevel$1/2,m=0;if(null==e.gl)for(var p=0;p<2;p++)for(var C=0;C<2;C++){s=0;for(var S=f*p;S<f*(p+1);S++)for(var w=f*C;w<f*(C+1);w++){var T,y,b;T=_[S*(this._subDivisionLevel$1+1)+w],y=_[(S+1)*(this._subDivisionLevel$1+1)+w],b=_[S*(this._subDivisionLevel$1+1)+(w+1)],this._renderTriangleLists[m].push(RenderTriangle.create(T,b,y,this.texture,this.level)),T=_[S*(this._subDivisionLevel$1+1)+(w+1)],y=_[(S+1)*(this._subDivisionLevel$1+1)+w],b=_[(S+1)*(this._subDivisionLevel$1+1)+(w+1)],this._renderTriangleLists[m].push(RenderTriangle.create(T,b,y,this.texture,this.level))}m++}else{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);var v=new Float32Array(5*_.length),M=v;s=0;for(var x=ss.ss.enumerate(_);x.moveNext();){var L=x.current;s=this.addVertex(M,s,L)}for(tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,v,WEBGL.STATIC_DRAW),p=0;p<2;p++)for(C=0;C<2;C++){var A=new Uint16Array(3*this.triangleCount),V=A;for(s=0,S=f*p;S<f*(p+1);S++)for(w=f*C;w<f*(C+1);w++)V[s++]=S*(this._subDivisionLevel$1+1)+w,V[s++]=(S+1)*(this._subDivisionLevel$1+1)+w,V[s++]=S*(this._subDivisionLevel$1+1)+(w+1),V[s++]=S*(this._subDivisionLevel$1+1)+(w+1),V[s++]=(S+1)*(this._subDivisionLevel$1+1)+w,V[s++]=(S+1)*(this._subDivisionLevel$1+1)+(w+1);this._indexBuffers[m]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this._indexBuffers[m]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,A,WEBGL.STATIC_DRAW),m++}}return!0}};function Xyf(){this.ix=0,this.iy=0,this.face=0}registerType("EquirectangularTile",[EquirectangularTile,EquirectangularTile$,Tile]),Xyf.create=function(e,t,i){var r=new Xyf;return r.ix=e,r.iy=t,r.face=i,r};var Xyf$={};function HealpixTile(e,t,i,r,n){if(this.ipix=0,this.indexBuffer=new Array(4),this._vertexList$1=null,this._nside$1=0,this._tileIndex$1=0,this._face$1=0,this._faceX$1=0,this._faceY$1=0,this._step$1=0,this._subDivided$1=!1,this._catalogRows$1=[],Tile.call(this),this.level=e,this.tileX=t,this.tileY=i,this.dataset=r,set_tileDemEnabled(!1),this._nside$1=e?Math.pow(2,e+1):4,null==n)this._face$1=4*t+i,this.ipix=this._face$1;else{this.parent=n;var s=n;this._face$1=s._face$1,this._tileIndex$1=4*s._tileIndex$1+2*i+t,this.ipix=this._face$1*this._nside$1*this._nside$1/4+this._tileIndex$1,this._faceX$1=2*s._faceX$1+t,this._faceY$1=2*s._faceY$1+i}this.isCatalogTile=ss.ss.keyExists(r.get_hipsProperties().get_properties(),"dataproduct_type")&&"catalog"===r.get_hipsProperties().get_properties().dataproduct_type.toLowerCase(),this._computeBoundingSphere$1()}registerType("Xyf",[Xyf,Xyf$,null]),HealpixTile._galacticMatrix$1=Matrix3d.create(-.0548755604024359,-.483835015526738,-.873437090247923,0,-.867666148981161,.455983776232537,-.198076373464674,0,.494109427943568,.746982244476371,-.444829629919504,0,0,0,0,1);var HealpixTile$={get_URL:function(){return null==this._url$1?(this._url$1=this._getUrl$1(this.dataset,this.level,this.tileX,this.tileY),this._url$1):this._url$1},_computeBoundingSphere$1:function(){this._setStep$1(),this.createGeometry(null);for(var e=new Array(this._vertexList$1.length),t=0;t<this._vertexList$1.length;t++)e[t]=this._vertexList$1[t].position;this._calcSphere$1(e),this._setCorners$1()},createGeometry:function(e){if(null!=this._vertexList$1)return!0;if(this._vertexList$1=[],this._populateVertexList$1(this._vertexList$1,this._step$1),ss.ss.keyExists(this.dataset.get_hipsProperties().get_properties(),"hips_frame")&&"galactic"===this.dataset.get_hipsProperties().get_properties().hips_frame)for(var t=0;t<this._vertexList$1.length;t++){var i=this._vertexList$1[t];HealpixTile._galacticMatrix$1.multiplyVector(i.position)}this.triangleCount=this._step$1*this._step$1/2;var r=new Uint16Array(3*this.triangleCount);if(!this._subDivided$1)try{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);for(var n=new Float32Array(5*this._vertexList$1.length),s=n,a=0,o=ss.ss.enumerate(this._vertexList$1);o.moveNext();)i=o.current,a=this.addVertex(s,a,i);tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,n,WEBGL.STATIC_DRAW),a=0,this._vertexList$1.length,this._step$1,this._setIndexBufferForQuadrant$1(r,0,1),this._step$1>1&&(this._setIndexBufferForQuadrant$1(r,0,0),this._setIndexBufferForQuadrant$1(r,1,1),this._setIndexBufferForQuadrant$1(r,1,0))}catch(e){}return!0},_setIndexBufferForQuadrant$1:function(e,t,i){for(var r=0,n=t*this._step$1/2;n<this._step$1/2*(t+1);n++)for(var s=i*this._step$1/2;s<this._step$1/2*(i+1);s++)e[r++]=n*(this._step$1+1)+s,e[r++]=1+n*(this._step$1+1)+s,e[r++]=this._step$1+1+n*(this._step$1+1)+s,e[r++]=1+n*(this._step$1+1)+s,e[r++]=this._step$1+1+n*(this._step$1+1)+s,e[r++]=this._step$1+2+n*(this._step$1+1)+s;this._processIndexBuffer$1(e,2*t+i)},_getUrl$1:function(e,t,i,r){var n=this._getHipsFileExtension$1(),s=-1;s=t?this._face$1*this._nside$1*this._nside$1/4+this._tileIndex$1:this._face$1,new ss.ss.StringBuilder;var a=1e4*Math.floor(s/1e4);return ss.ss.format(e.get_url(),t.toString(),a.toString(),s.toString()+n)},_getHipsFileExtension$1:function(){return this.dataset.get_extension().toLowerCase().indexOf("png")>-1?".png":this.dataset.get_extension().toLowerCase().indexOf("jpeg")>-1||this.dataset.get_extension().toLowerCase().indexOf("jpg")>-1?".jpg":this.dataset.get_extension().toLowerCase().indexOf("tsv")>-1?".tsv":this.dataset.get_extension().toLowerCase().indexOf("fits")>-1?".fits":".jpg"},isTileBigEnough:function(e){if(1===this.dataset.get_dataSetType()){var t=180/(4*Math.pow(2,this.level));return e.get_fovScale()<t}return t=3600/(4*Math.pow(2,this.level)),e.get_fovScale()<t},_boundaries$1:function(e,t,i){var r=i*Math.pow(2,this.level),n=new Array(4),s=Xyf.create(e+this._faceX$1*i,t+this._faceY$1*i,this._face$1),a=.5/r,o=(s.ix+.5)/r,l=(s.iy+.5)/r;return n[0]=Fxyf.create(o+a,l+a,s.face).toVec3(),n[1]=Fxyf.create(o-a,l+a,s.face).toVec3(),n[2]=Fxyf.create(o-a,l-a,s.face).toVec3(),n[3]=Fxyf.create(o+a,l-a,s.face).toVec3(),n},_setCorners$1:function(){var e=Xyf.create(this.tileX,this.tileY,this._face$1),t=.5/this._nside$1,i=(e.ix+.5)/this._nside$1,r=(e.iy+.5)/this._nside$1;this.topLeft=Fxyf.create(i+t,r+t,e.face).toVec3(),this.bottomLeft=Fxyf.create(i-t,r+t,e.face).toVec3(),this.bottomRight=Fxyf.create(i-t,r-t,e.face).toVec3(),this.topRight=Fxyf.create(i+t,r-t,e.face).toVec3()},draw3D:function(e,t){if(this.isCatalogTile)return this.drawCatalogTile(e,t),!0;this.renderedGeneration=Tile.currentRenderGeneration,Tile.tilesTouched++,this.inViewFrustum=!0;var i=!1;if(!this.readyToRender){if(!this.errored)return tileCacheAddTileToQueue(this),!1;if(!(this.errored&&this.level<3))return!1;i=!0}var r=this.triangleCount;Tile.trianglesRendered+=r;for(var n=!1,s=!1,a=0,o=0;o<2;o++)for(var l=0;l<2;l++)this.level<this.dataset.get_levels()?(null==this.children[a]&&(this.children[a]=tileCacheGetTile(this.level+1,l,o,this.dataset,this)),this.children[a].isTileInFrustum(e.get_frustum())?(this.inViewFrustum=!0,this.children[a].isTileBigEnough(e)||i?(this.renderChildPart[a].set_targetState(!this.children[a].draw3D(e,t)),this.renderChildPart[a].get_targetState()&&(s=!0)):this.renderChildPart[a].set_targetState(!0)):this.renderChildPart[a].set_targetState(this.renderChildPart[a].set_state(!1))):this.renderChildPart[a].set_state(!0),this.renderChildPart[a].get_state()&&(n=!0),a++;if((s||n)&&(this.renderedAtOrBelowGeneration=Tile.currentRenderGeneration,null!=this.parent&&(this.parent.renderedAtOrBelowGeneration=this.renderedAtOrBelowGeneration)),!n)return!0;if(!this.createGeometry(e))return!1;if(i)return!0;Tile.tilesInView++;for(var h=0;h<4;h++)this.renderChildPart[h].get_targetState()&&this.renderPart(e,h,t/100,!1);return!0},drawCatalogTile:function(e,t){this.renderedGeneration=Tile.currentRenderGeneration,Tile.tilesTouched++,this.inViewFrustum=!0;var i=!1;if(!this.readyToRender){if(!this.errored)return void tileCacheAddTileToQueue(this);if(!(this.errored&&this.level<3))return;i=!0}for(var r=!1,n=0,s=0;s<2;s++)for(var a=0;a<2;a++)this.level<this.dataset.get_levels()&&(null==this.children[n]&&(this.children[n]=tileCacheGetTile(this.level+1,a,s,this.dataset,this)),this.children[n].isTileInFrustum(e.get_frustum())?(this.inViewFrustum=!0,r=!0,this.children[n].isTileBigEnough(e)||i?this.children[n].drawCatalogTile(e,t):this.children[n].removeCatalogTile()):this.children[n].removeCatalogTile()),n++;this.level||r||i?r&&(Tile.tilesInView++,this._addCatalogTile$1()):this.removeCatalogTile()},removeCatalogTile:function(){this.dataset.get_hipsProperties().get_catalogSpreadSheetLayer().removeTileRows(this.get_key(),this._catalogRows$1)},_addCatalogTile$1:function(){this.dataset.get_hipsProperties().get_catalogSpreadSheetLayer().addTileRows(this.get_key(),this._catalogRows$1)},_extractCatalogTileRows$1:function(){for(var e=!1,t=ss.ss.enumerate(this._catalogData$1.getText().split("\n"));t.moveNext();){var i=t.current;if(ss.ss.startsWith(i,"#")||e){if(!ss.ss.startsWith(i,"#")){var r=UiTools.splitString(i,this.dataset.get_hipsProperties().get_catalogSpreadSheetLayer().get__table().delimiter);this._catalogRows$1.push(r)}}else e=!0}},getDataInView:function(e,t,i){if(!this.readyToRender)if(this.errored){if(this.level>=3)return!0}else if(this.requestImage(),t)return!1;for(var r=!0,n=!1,s=0,a=0;a<2;a++)for(var o=0;o<2;o++)this.level<this.dataset.get_levels()&&(null==this.children[s]&&(this.children[s]=tileCacheGetTile(this.level+1,o,a,this.dataset,this)),this.children[s].isTileInFrustum(e.get_frustum())&&(n=!0,r=r&&this.children[s].getDataInView(e,t,i))),s++;return n&&i.addTileRows(this.get_key(),this._catalogRows$1),r&&!this.downloading},_setStep$1:function(){if(this.isCatalogTile)this._step$1=2;else switch(this.level){case 0:case 1:case 2:case 3:case 4:this._step$1=16;break;case 5:this._step$1=8;break;case 6:this._step$1=4;break;default:this._step$1=2}},requestImage:function(){this.isCatalogTile?this.downloading||this.readyToRender||(this.downloading=!0,this._catalogData$1=new WebFile(this.get_URL()),this._catalogData$1.onStateChange=ss.ss.bind("_loadCatalogData$1",this),this._catalogData$1.send()):Tile.prototype.requestImage.call(this)},_loadCatalogData$1:function(){2===this._catalogData$1.get_state()?(this.requestPending=!1,this.downloading=!1,this.errored=!0,tileCacheRemoveFromQueue(this.get_key(),!0)):1===this._catalogData$1.get_state()&&(this._extractCatalogTileRows$1(),this.texReady=!0,this.downloading=!1,this.errored=!1,this.readyToRender=!0,this.requestPending=!1,tileCacheRemoveFromQueue(this.get_key(),!0))},getIndexBuffer:function(e,t){return this.indexBuffer[e]},_calcSphere$1:function(e){var t=ConvexHull.findEnclosingSphere(e);this.sphereCenter=t.center,this.sphereRadius=t.radius},isPointInTile:function(e,t){if(!this.level)return!0;if(1===this.level){if(t>=0&&t<=90&&!this.tileX&&1===this.tileY)return!0;if(t>90&&t<=180&&1===this.tileX&&1===this.tileY)return!0;if(t<0&&t>=-90&&!this.tileX&&!this.tileY)return!0;if(t<-90&&t>=-180&&1===this.tileX&&!this.tileY)return!0}var i=Coordinates.geoTo3dDouble(e,t),r=this._isLeftOfHalfSpace$1(this.topLeft,this.topRight,i),n=this._isLeftOfHalfSpace$1(this.topRight,this.bottomRight,i),s=this._isLeftOfHalfSpace$1(this.bottomRight,this.bottomLeft,i),a=this._isLeftOfHalfSpace$1(this.bottomLeft,this.topLeft,i);return!!(r&&n&&s&&a)},_isLeftOfHalfSpace$1:function(e,t,i){e.normalize(),t.normalize();var r=Vector3d.cross(e,t);return Vector3d.dot(r,i)>0},getSurfacePointAltitude:function(e,t,i){if(this.level<Tile.lastDeepestLevel)for(var r=ss.ss.enumerate(this.children);r.moveNext();){var n=r.current;if(null!=n&&n.isPointInTile(e,t)){var s=n.getSurfacePointAltitude(e,t,i);if(s)return s;break}}return this._getAltitudeFromLatLng$1(e,t,i)},_getAltitudeFromLatLng$1:function(e,t,i){var r=Coordinates.geoTo3dDouble(e,t),n=DistanceCalc.getUVFromInnerPoint(this.topLeft,this.topRight,this.bottomLeft,this.bottomRight,r),s=Math.max(0,Math.min(16,16*n.x)),a=Math.max(0,Math.min(16,16*n.y)),o=Math.max(0,Math.min(15,ss.ss.truncate(16*n.x))),l=Math.max(0,Math.min(15,ss.ss.truncate(16*n.y))),h=s-o,c=a-l;return null!=this.demArray?((this.demArray[o+17*l]*(1-h)+h*this.demArray[o+1+17*l])*(1-c)+c*(this.demArray[o+17*(l+1)]*(1-h)+h*this.demArray[o+1+17*(l+1)]))/(i?1:this.get__demScaleFactor()):this.demAverage/(i?1:this.get__demScaleFactor())},_processIndexBuffer$1:function(e,t){this.indexBuffer[t]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this.indexBuffer[t]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,e,WEBGL.STATIC_DRAW)},cleanUp:function(e){Tile.prototype.cleanUp.call(this,e),this._returnBuffers$1(),this._subDivided$1=!1},_returnBuffers$1:function(){null!=this._vertexList$1&&(this._vertexList$1=null)},_populateVertexList$1:function(e,t){for(var i=0;i<t;i+=2)for(var r=0;r<t;r+=2){var n=this._boundaries$1(r,i,t);e[i*(t+1)+r]=PositionTexture.createPos(n[2],1/t*i,1/t*r),e[i*(t+1)+r+1]=PositionTexture.createPos(n[3],1/t*i,1/t+1/t*r),e[(i+1)*(t+1)+r]=PositionTexture.createPos(n[1],1/t+1/t*i,1/t*r),e[(i+1)*(t+1)+r+1]=PositionTexture.createPos(n[0],1/t+1/t*i,1/t+1/t*r),r+2>=t&&t>1&&(r=t-1,n=this._boundaries$1(r,i,t),e[i*(t+1)+t]=PositionTexture.createPos(n[3],1/t*i,1/t+1/t*r),e[(i+1)*(t+1)+t]=PositionTexture.createPos(n[0],1/t+1/t*i,1/t+1/t*r))}t>1&&this._vertexOfLastRow$1(e,t)},_vertexOfLastRow$1:function(e,t){for(var i=t-1,r=0;r<t;r+=2){var n=this._boundaries$1(r,i,t);e[(i+1)*(t+1)+r]=PositionTexture.createPos(n[1],1/t+1/t*i,1/t*r),e[(i+1)*(t+1)+r+1]=PositionTexture.createPos(n[0],1/t+1/t*i,1/t+1/t*r),r+2>=t&&(r=t-1,n=this._boundaries$1(r,i,t),e[(i+1)*(t+1)+t]=PositionTexture.createPos(n[0],1/t+1/t*i,1/t+1/t*r))}}};function MercatorTile(){this._tileDegrees$1=0,this._latMin$1=0,this._latMax$1=0,this._lngMin$1=0,this._lngMax$1=0,this._subDivisionLevel$1=32,Tile.call(this)}registerType("HealpixTile",[HealpixTile,HealpixTile$,Tile]),MercatorTile.create=function(e,t,i,r,n){var s=new MercatorTile;return s.parent=n,s.level=e,s.tileX=t,s.tileY=i,s.dataset=r,s.computeBoundingSphere(),s},MercatorTile.getCentrePointOffsetAsTileRatio=function(e,t,i){var r=MercatorTile.absoluteLonToMetersAtZoom(t,i),n=r/256-Math.floor(r/256),s=MercatorTile.absoluteLatToMetersAtZoom(e,i),a=s/256-Math.floor(s/256);return Vector2d.create(n,a)},MercatorTile.relativeMetersToLatAtZoom=function(e,t){var i=e*MercatorTile.metersPerPixel2(t);return MercatorTile._radToDeg$1(Math.PI/2-2*Math.atan(Math.exp(0-i/6378137)))},MercatorTile.relativeMetersToLonAtZoom=function(e,t){var i=e*MercatorTile.metersPerPixel2(t);return MercatorTile._radToDeg$1(i/6378137)},MercatorTile.absoluteLatToMetersAtZoom=function(e,t){var i=Math.sin(MercatorTile._degToRad$1(e)),r=3189068.5*Math.log((1+i)/(1-i)),n=MercatorTile.metersPerPixel2(t);return ss.ss.truncate(Math.round(20037508-r)/n)},MercatorTile.absoluteMetersToLatAtZoom=function(e,t){var i=20037508-e*MercatorTile.metersPerPixel2(t);return MercatorTile._radToDeg$1(Math.PI/2-2*Math.atan(Math.exp(0-i/6378137)))},MercatorTile.absoluteLonToMetersAtZoom=function(e,t){var i=6378137*MercatorTile._degToRad$1(e),r=MercatorTile.metersPerPixel2(t);return ss.ss.truncate((i+20037508)/r)},MercatorTile.absoluteMetersToLonAtZoom=function(e,t){var i=e*MercatorTile.metersPerPixel2(t)-20037508;return MercatorTile._radToDeg$1(i/6378137)},MercatorTile.absoluteLonToMetersAtZoomTile=function(e,t,i){var r=6378137*MercatorTile._degToRad$1(e),n=MercatorTile.metersPerPixel2(t);return ss.ss.truncate((r+20037508)/n)},MercatorTile.absoluteLatToMetersAtZoomTile=function(e,t,i){var r=Math.sin(MercatorTile._degToRad$1(e)),n=3189068.5*Math.log((1+r)/(1-r)),s=MercatorTile.metersPerPixel2(t);return ss.ss.truncate(Math.round(20037508-n)/s)},MercatorTile.absoluteMetersToLonAtZoomByTileY=function(e,t,i){var r=e*MercatorTile.metersPerPixel2(t)-20037508;return MercatorTile._radToDeg$1(r/6378137)},MercatorTile._degToRad$1=function(e){return e*Math.PI/180},MercatorTile.metersPerPixel2=function(e){return 156543/(1<<e)},MercatorTile._radToDeg$1=function(e){return 180*e/Math.PI};var MercatorTile$={computeBoundingSphere:function(){this._tileDegrees$1=360/Math.pow(2,this.level),this._latMin$1=MercatorTile.absoluteMetersToLatAtZoom(256*this.tileY,this.level),this._latMax$1=MercatorTile.absoluteMetersToLatAtZoom(256*(this.tileY+1),this.level),this._lngMin$1=this.tileX*this._tileDegrees$1-180,this._lngMax$1=(this.tileX+1)*this._tileDegrees$1-180;var e=(this._latMin$1+this._latMax$1)/2,t=(this._lngMin$1+this._lngMax$1)/2;this.sphereCenter=this.geoTo3d(e,t,!1),this.topLeft=this.geoTo3d(this._latMin$1,this._lngMin$1,!1),this.bottomRight=this.geoTo3d(this._latMax$1,this._lngMax$1,!1),this.topRight=this.geoTo3d(this._latMin$1,this._lngMax$1,!1),this.bottomLeft=this.geoTo3d(this._latMax$1,this._lngMin$1,!1),this.tileY||(this.topLeft=Vector3d.create(0,1,0),this.topRight=Vector3d.create(0,1,0)),this.tileY===Math.pow(2,this.level)-1&&(this.bottomRight=Vector3d.create(0,-1,0),this.bottomLeft=Vector3d.create(0,-1,0));var i=this.topLeft;i.subtract(this.sphereCenter),this.sphereRadius=i.length(),(i=this.bottomRight).subtract(this.sphereCenter);var r=i.length();this.sphereRadius<r&&(this.sphereRadius=r),this._tileDegrees$1=Math.abs(this._latMax$1-this._latMin$1)},isPointInTile:function(e,t){return!(!this.demReady||null==this.demData||e<Math.min(this._latMin$1,this._latMax$1)||e>Math.max(this._latMax$1,this._latMin$1)||t<Math.min(this._lngMin$1,this._lngMax$1)||t>Math.max(this._lngMin$1,this._lngMax$1))},getSurfacePointAltitude:function(e,t,i){if(this.level<Tile.lastDeepestLevel)for(var r=ss.ss.enumerate(this.children);r.moveNext();){var n=r.current;if(null!=n&&n.isPointInTile(e,t)){var s=n.getSurfacePointAltitude(e,t,i);if(s)return s;break}}return this._getAltitudeAtLatLng$1(e,t,i?1:this.get__demScaleFactor())},_getAltitudeAtLatLng$1:function(e,t,i){var r=Math.abs(this._latMax$1-this._latMin$1),n=Math.abs(this._lngMax$1-this._lngMin$1),s=(e-Math.min(this._latMax$1,this._latMin$1))/r*32,a=(t-Math.min(this._lngMax$1,this._lngMin$1))/n*32,o=Math.min(31,ss.ss.truncate(s)),l=Math.min(31,ss.ss.truncate(a)),h=a-l,c=s-o;return((this.demData[33*o+l]*(1-h)+h*this.demData[33*o+(l+1)])*(1-c)+c*(this.demData[33*(o+1)+l]*(1-h)+h*this.demData[33*(o+1)+(l+1)]))/i},createGeometry:function(e){if(Tile.prototype.createGeometry.call(this,e),this.geometryCreated)return!0;this.geometryCreated=!0,256==tileUvMultiple&&(this.dataset.get_dataSetType()&&1!==this.dataset.get_dataSetType()||(this._subDivisionLevel$1=Math.max(2,2*(6-this.level))));for(var t=0;t<4;t++)this._renderTriangleLists[t]=[];var i,r,n=0,s=360/Math.pow(2,this.level);this._latMin$1=MercatorTile.absoluteMetersToLatAtZoom(256*this.tileY,this.level),this._latMax$1=MercatorTile.absoluteMetersToLatAtZoom(256*(this.tileY+1),this.level),this._lngMin$1=this.tileX*s-180,this._lngMax$1=(this.tileX+1)*s-180;var a=MercatorTile.absoluteMetersToLatAtZoom(256*(2*this.tileY+1),this.level+1);this.topLeft=this.geoTo3d(this._latMin$1,this._lngMin$1,!1),this.bottomRight=this.geoTo3d(this._latMax$1,this._lngMax$1,!1),this.topRight=this.geoTo3d(this._latMin$1,this._lngMax$1,!1),this.bottomLeft=this.geoTo3d(this._latMax$1,this._lngMin$1,!1);var o,l,h=new Array((this._subDivisionLevel$1+1)*(this._subDivisionLevel$1+1)),c=(s=this._lngMax$1-this._lngMin$1,this._subDivisionLevel$1,1/this._subDivisionLevel$1),u=this._latMax$1-a;for(l=0;l<this._subDivisionLevel$1/2;l++)for(i=l!==this._subDivisionLevel$1/2?this._latMax$1-2*c*u*l:a,o=0;o<=this._subDivisionLevel$1;o++)r=o!==this._subDivisionLevel$1?this._lngMin$1+c*s*o:this._lngMax$1,h[n=l*(this._subDivisionLevel$1+1)+o]=new PositionTexture,h[n].position=this.geoTo3dWithAlt(i,r,!1,!0),h[n].tu=o*c*tileUvMultiple,h[n].tv=(MercatorTile.absoluteLatToMetersAtZoom(i,this.level)-256*this.tileY)/256*tileUvMultiple,this.demIndex++;for(u=this._latMin$1-a,l=this._subDivisionLevel$1/2;l<=this._subDivisionLevel$1;l++)for(i=l!==this._subDivisionLevel$1?a+2*c*u*(l-this._subDivisionLevel$1/2):this._latMin$1,o=0;o<=this._subDivisionLevel$1;o++)r=o!==this._subDivisionLevel$1?this._lngMin$1+c*s*o:this._lngMax$1,h[n=l*(this._subDivisionLevel$1+1)+o]=new PositionTexture,h[n].position=this.geoTo3dWithAlt(i,r,!1,!0),h[n].tu=o*c*tileUvMultiple,h[n].tv=(MercatorTile.absoluteLatToMetersAtZoom(i,this.level)-256*this.tileY)/256*tileUvMultiple,this.demIndex++;if(!this.tileY)for(l=this._subDivisionLevel$1,o=0;o<=this._subDivisionLevel$1;o++)h[n=l*(this._subDivisionLevel$1+1)+o].position=Vector3d.create(0,1,0);if(this.tileY===Math.pow(2,this.level)-1)for(l=0,o=0;o<=this._subDivisionLevel$1;o++)h[n=l*(this._subDivisionLevel$1+1)+o].position=Vector3d.create(0,-1,0);this.triangleCount=this._subDivisionLevel$1*this._subDivisionLevel$1*2;var d=this._subDivisionLevel$1/2,_=0;if(null==e.gl)for(var g=0;g<2;g++)for(var f=0;f<2;f++){for(n=0,l=d*g;l<d*(g+1);l++)for(o=d*f;o<d*(f+1);o++){var m,p,C;m=h[l*(this._subDivisionLevel$1+1)+o],p=h[(l+1)*(this._subDivisionLevel$1+1)+o],C=h[l*(this._subDivisionLevel$1+1)+(o+1)];var S=RenderTriangle.create(m,p,C,this.texture,this.level);this._renderTriangleLists[_].push(S),m=h[l*(this._subDivisionLevel$1+1)+(o+1)],p=h[(l+1)*(this._subDivisionLevel$1+1)+o],C=h[(l+1)*(this._subDivisionLevel$1+1)+(o+1)],S=RenderTriangle.create(m,p,C,this.texture,this.level),this._renderTriangleLists[_].push(S)}_++}else{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);var w=new Float32Array(5*h.length),T=w;n=0;for(var y=ss.ss.enumerate(h);y.moveNext();){var b=y.current;n=this.addVertex(T,n,b)}for(tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,w,WEBGL.STATIC_DRAW),g=0;g<2;g++)for(f=0;f<2;f++){var v=new Uint16Array(3*this.triangleCount),M=v;for(n=0,l=d*g;l<d*(g+1);l++)for(o=d*f;o<d*(f+1);o++)M[n++]=l*(this._subDivisionLevel$1+1)+o,M[n++]=(l+1)*(this._subDivisionLevel$1+1)+o,M[n++]=l*(this._subDivisionLevel$1+1)+(o+1),M[n++]=l*(this._subDivisionLevel$1+1)+(o+1),M[n++]=(l+1)*(this._subDivisionLevel$1+1)+o,M[n++]=(l+1)*(this._subDivisionLevel$1+1)+(o+1);this._indexBuffers[_]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this._indexBuffers[_]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,v,WEBGL.STATIC_DRAW),_++}}return!0},_getDemSample$1:function(e,t){return this.demData[33*(32-t)+e]},createDemFromParent:function(){var e=ss.ss.safeCast(this.parent,MercatorTile);if(null==e||null==e.demData)return!1;var t=this.tileX%2==1?16:0,i=this.tileY%2==1?16:0;this.demData=new Array(this.demSize);for(var r=0;r<33;r+=2)for(var n=!0,s=0;s<33;s++)this.demData[33*(32-r)+s]=n?e._getDemSample$1(s/2+t,r/2+i):(e._getDemSample$1(s/2+t,r/2+i)+e._getDemSample$1(s/2+t+1,r/2+i))/2,n=!n;for(r=1;r<33;r+=2)for(s=0;s<33;s++)this.demData[33*(32-r)+s]=(this._getDemSample$1(s,r-1)+this._getDemSample$1(s,r+1))/2;for(var a=ss.ss.enumerate(this.demData);a.moveNext();){var o=a.current;this.demAverage+=o}return this.demAverage/=this.demData.length,this.demReady=!0,!0}};function BasePlanets(){}function PlotTile(){this._topDown$1=!0,this.backslash=!1,this._vertexList$1=null,this._childTriangleList$1=null,this._stars$1=[],this._subDivisionLevel$1=4,this._subDivided$1=!1,Tile.call(this)}registerType("MercatorTile",[MercatorTile,MercatorTile$,Tile]),BasePlanets.drawPointPlanet=function(e,t,i,r,n){var s=t,a=i/2;if(null!=e.gl){var o=new PointList(e);o.minSize=20,o.addPoint(t.copy(),r._clone(),new Dates(0,1),i/100),o.depthBuffered=!0,o.draw(e,1,!1)}else{var l=e.WVP.transform(s);if(l.z<0)return;if(!n&&Vector3d.dot(e.get_viewPoint(),s)<.55)return;var h=e.device;h.save(),h.beginPath(),h.arc(l.x,l.y,a,0,2*Math.PI,!0),h.lineWidth=1,h.fillStyle=r.toString(),h.fill(),h.globalAlpha=1,h.strokeStyle=r.toString(),h.stroke(),h.restore()}},registerType("BasePlanets",[BasePlanets,{},null]),PlotTile.create=function(e,t,i,r,n){var s=new PlotTile;return s.parent=n,s.level=e,s.tileX=t,s.tileY=i,s.dataset=r,s._topDown$1=!r.get_bottomsUp(),s.tileX!==t&&alert("bad"),r.get_meanRadius()?s.set__demScaleFactor(r.get_meanRadius()):r.get_dataSetType()?s.set__demScaleFactor(3396010):s.set__demScaleFactor(6371e3),s.computeBoundingSphere(),s};var PlotTile$={computeBoundingSphere:function(){this._initializeGrids$1(),this.topLeft=this.bounds[0].position.copy(),this.bottomRight=this.bounds[8].position.copy(),this.topRight=this.bounds[2].position.copy(),this.bottomLeft=this.bounds[6].position.copy(),this.calcSphere()},renderPart:function(e,t,i,r){if(null!=e.gl);else if(!t)for(var n=ss.ss.enumerate(this._stars$1);n.moveNext();){var s=n.current,a=25/Math.pow(1.6,s.magnitude);BasePlanets.drawPointPlanet(e,s.position,a,s.col,!1)}},requestImage:function(){this.downloading||this.readyToRender||(this.downloading=!0,this._webFile$1=new WebFile(URLHelpers.singleton.rewrite(this.get_URL(),0)),this._webFile$1.onStateChange=ss.ss.bind("fileStateChange",this),this._webFile$1.send())},fileStateChange:function(){2===this._webFile$1.get_state()?(this.downloading=!1,this.readyToRender=!1,this.errored=!0,this.requestPending=!1,tileCacheRemoveFromQueue(this.get_key(),!0)):1===this._webFile$1.get_state()&&(this.texReady=!0,this.downloading=!1,this.errored=!1,this.readyToRender=this.texReady&&(this.demReady||!this.demTile),this.requestPending=!1,tileCacheRemoveFromQueue(this.get_key(),!0),this._loadData$1(this._webFile$1.getText()))},_loadData$1:function(e){for(var t=ss.ss.replaceString(e,"\r\n","\n").split("\n"),i=!0,r=null,n=ss.ss.enumerate(t);n.moveNext();){var s=n.current;i?i=!1:ss.ss.trim(s).length>5&&((r=new Star(s)).position=Coordinates.raDecTo3dAu(r.RA,r.dec,1),this._stars$1.push(r))}},isPointInTile:function(e,t){if(!this.level)return!0;if(1===this.level)return t>=0&&t<=90&&!this.tileX&&1===this.tileY||t>90&&t<=180&&1===this.tileX&&1===this.tileY||t<0&&t>=-90&&!this.tileX&&!this.tileY||t<-90&&t>=-180&&1===this.tileX&&!this.tileY;if(!this.demReady||null==this.demData)return!1;var i=Coordinates.geoTo3dDouble(-e,t),r=this._isLeftOfHalfSpace$1(this.topLeft.copy(),this.topRight.copy(),i),n=this._isLeftOfHalfSpace$1(this.topRight.copy(),this.bottomRight.copy(),i),s=this._isLeftOfHalfSpace$1(this.bottomRight.copy(),this.bottomLeft.copy(),i),a=this._isLeftOfHalfSpace$1(this.bottomLeft.copy(),this.topLeft.copy(),i);return!!(r&&n&&s&&a)},_isLeftOfHalfSpace$1:function(e,t,i){e.normalize(),t.normalize();var r=Vector3d.cross(e,t);return Vector3d.dot(r,i)<0},_initializeGrids$1:function(){if(this._vertexList$1=[],this._childTriangleList$1=new Array(4),this._childTriangleList$1[0]=[],this._childTriangleList$1[1]=[],this._childTriangleList$1[2]=[],this._childTriangleList$1[3]=[],this.bounds=new Array(9),this.level>0){null==this.parent&&(this.parent=tileCacheGetTile(this.level-1,this.tileX/2,this.tileY/2,this.dataset,null));var e=this.parent,t=this.tileX%2,i=this.tileY%2;this.level>1?this.backslash=e.backslash:this.backslash=1==(1===t^1===i),this.bounds[0]=e.bounds[t+3*i].copy(),this.bounds[1]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+1+3*i]),this.bounds[2]=e.bounds[t+1+3*i].copy(),this.bounds[3]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+3*(i+1)]),this.backslash?this.bounds[4]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+1+3*(i+1)]):this.bounds[4]=this._midpoint$1(e.bounds[t+1+3*i],e.bounds[t+3*(i+1)]),this.bounds[5]=this._midpoint$1(e.bounds[t+1+3*i],e.bounds[t+1+3*(i+1)]),this.bounds[6]=e.bounds[t+3*(i+1)].copy(),this.bounds[7]=this._midpoint$1(e.bounds[t+3*(i+1)],e.bounds[t+1+3*(i+1)]),this.bounds[8]=e.bounds[t+1+3*(i+1)].copy(),this.bounds[0].tu=0*tileUvMultiple,this.bounds[0].tv=0*tileUvMultiple,this.bounds[1].tu=.5*tileUvMultiple,this.bounds[1].tv=0*tileUvMultiple,this.bounds[2].tu=1*tileUvMultiple,this.bounds[2].tv=0*tileUvMultiple,this.bounds[3].tu=0*tileUvMultiple,this.bounds[3].tv=.5*tileUvMultiple,this.bounds[4].tu=.5*tileUvMultiple,this.bounds[4].tv=.5*tileUvMultiple,this.bounds[5].tu=1*tileUvMultiple,this.bounds[5].tv=.5*tileUvMultiple,this.bounds[6].tu=0*tileUvMultiple,this.bounds[6].tv=1*tileUvMultiple,this.bounds[7].tu=.5*tileUvMultiple,this.bounds[7].tv=1*tileUvMultiple,this.bounds[8].tu=1*tileUvMultiple,this.bounds[8].tv=1*tileUvMultiple}else this.bounds[0]=PositionTexture.create(0,-1,0,0,0),this.bounds[1]=PositionTexture.create(0,0,1,.5,0),this.bounds[2]=PositionTexture.create(0,-1,0,1,0),this.bounds[3]=PositionTexture.create(-1,0,0,0,.5),this.bounds[4]=PositionTexture.create(0,1,0,.5,.5),this.bounds[5]=PositionTexture.create(1,0,0,1,.5),this.bounds[6]=PositionTexture.create(0,-1,0,0,1),this.bounds[7]=PositionTexture.create(0,0,-1,.5,1),this.bounds[8]=PositionTexture.create(0,-1,0,1,1)},_midpoint$1:function(e,t){var i=Vector3d.lerp(e.position,t.position,.5),r=Vector2d.lerp(Vector2d.create(e.tu,e.tv),Vector2d.create(t.tu,t.tv),.5);return i.normalize(),PositionTexture.createPos(i,r.x,r.y)},createGeometry:function(e){return this.geometryCreated||(this.geometryCreated=!0,Tile.prototype.createGeometry.call(this,e)),!0},cleanUp:function(e){Tile.prototype.cleanUp.call(this,e),null!=this._vertexList$1&&(this._vertexList$1=null),null!=this._childTriangleList$1&&(this._childTriangleList$1=null),this._subDivided$1=!1,this.demArray=null}};function LatLngEdges(){this.latMin=0,this.latMax=0,this.lngMin=0,this.lngMax=0}registerType("PlotTile",[PlotTile,PlotTile$,Tile]);var LatLngEdges$={};function TangentTile(e,t,i,r,n){this._topDown$1=!0,Tile.call(this),this.parent=n,this.level=e,this.tileX=t,this.tileY=i,this.dataset=r,this._topDown$1=!r.get_bottomsUp(),this.computeBoundingSphere()}registerType("LatLngEdges",[LatLngEdges,LatLngEdges$,null]);var TangentTile$={computeBoundingSphere:function(){if(this._topDown$1){var e=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),t=this.dataset.get_baseTileDegrees()/2-this.tileY*e+this.dataset.get_offsetY(),i=this.dataset.get_baseTileDegrees()/2-(this.tileY+1)*e+this.dataset.get_offsetY(),r=this.tileX*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX(),n=(this.tileX+1)*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX(),s=(t+i)/2,a=(r+n)/2;this.sphereCenter=this.geoTo3dTan(s,a),this.topLeft=this.geoTo3dTan(t,r),this.bottomRight=this.geoTo3dTan(i,n),this.topRight=this.geoTo3dTan(t,n),this.bottomLeft=this.geoTo3dTan(i,r);var o=this.geoTo3dTan(t,r);o.subtract(this.sphereCenter),this.sphereRadius=o.length()}else this.computeBoundingSphereBottomsUp()},computeBoundingSphereBottomsUp:function(){var e=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),t=this.dataset.get_baseTileDegrees()/2+(this.tileY+1)*e+this.dataset.get_offsetY(),i=this.dataset.get_baseTileDegrees()/2+this.tileY*e+this.dataset.get_offsetY(),r=this.tileX*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX(),n=(this.tileX+1)*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX();this.topLeft=this.geoTo3dTan(t,r),this.bottomRight=this.geoTo3dTan(i,n),this.topRight=this.geoTo3dTan(t,n),this.bottomLeft=this.geoTo3dTan(i,r)},getLatLngEdges:function(){var e=this.dataset.get_baseTileDegrees()/Math.pow(2,this.level),t=new LatLngEdges;return t.latMin=this.dataset.get_baseTileDegrees()/2-this.tileY*e+this.dataset.get_offsetY(),t.latMax=this.dataset.get_baseTileDegrees()/2-(this.tileY+1)*e+this.dataset.get_offsetY(),t.lngMin=this.tileX*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX(),t.lngMax=(this.tileX+1)*e-this.dataset.get_baseTileDegrees()/this.dataset.get_widthFactor()+this.dataset.get_offsetX(),t},geoTo3dTan:function(e,t){t=-t;var i=this.dataset.get_baseTileDegrees()/2,r=Math.tan(i*Tile.RC);return this.dataset.get_matrix().transform(Vector3d.create(1,e/i*r,t/i*r))},requestImage:function(){this.fitsImage=ss.ss.safeCast(this.dataset.get_wcsImage(),FitsImage),null!=this.fitsImage?(this.texReady=!0,this.downloading=!1,this.errored=this.fitsImage.errored,this.requestPending=!1,tileCacheRemoveFromQueue(this.get_key(),!0),useGlVersion2?(this.makeTexture(),this.readyToRender=!0):(this.bmp=this.fitsImage.getBitmap(),this.texture2d=this.bmp.getTexture(),this.readyToRender=!0)):Tile.prototype.requestImage.call(this)},createGeometry:function(e){if(this.geometryCreated)return!0;this.geometryCreated=!0;for(var t=0;t<4;t++)this._renderTriangleLists[t]=[];this.globalCenter=this.geoTo3dTan(0,0);var i=this.getLatLngEdges();this.topLeft=this.geoTo3dTan(i.latMin,i.lngMin).subtract(this.globalCenter),this.bottomRight=this.geoTo3dTan(i.latMax,i.lngMax).subtract(this.globalCenter),this.topRight=this.geoTo3dTan(i.latMin,i.lngMax).subtract(this.globalCenter),this.bottomLeft=this.geoTo3dTan(i.latMax,i.lngMin).subtract(this.globalCenter);var r=Vector3d.midPoint(this.topLeft,this.bottomRight),n=Vector3d.midPoint(this.topLeft,this.bottomLeft),s=Vector3d.midPoint(this.topRight,this.bottomRight),a=Vector3d.midPoint(this.topLeft,this.topRight),o=Vector3d.midPoint(this.bottomLeft,this.bottomRight);if(null==e.gl)this._renderTriangleLists[0].push(RenderTriangle.create(PositionTexture.createPos(this.topLeft,0,0),PositionTexture.createPos(n,0,.5),PositionTexture.createPos(a,.5,0),this.texture,this.level)),this._renderTriangleLists[0].push(RenderTriangle.create(PositionTexture.createPos(n,0,.5),PositionTexture.createPos(r,.5,.5),PositionTexture.createPos(a,.5,0),this.texture,this.level)),this._renderTriangleLists[1].push(RenderTriangle.create(PositionTexture.createPos(a,.5,0),PositionTexture.createPos(s,1,.5),PositionTexture.createPos(this.topRight,1,0),this.texture,this.level)),this._renderTriangleLists[1].push(RenderTriangle.create(PositionTexture.createPos(a,.5,0),PositionTexture.createPos(r,.5,.5),PositionTexture.createPos(s,1,.5),this.texture,this.level)),this._renderTriangleLists[2].push(RenderTriangle.create(PositionTexture.createPos(n,0,.5),PositionTexture.createPos(o,.5,1),PositionTexture.createPos(r,.5,.5),this.texture,this.level)),this._renderTriangleLists[2].push(RenderTriangle.create(PositionTexture.createPos(n,0,.5),PositionTexture.createPos(this.bottomLeft,0,1),PositionTexture.createPos(o,.5,1),this.texture,this.level)),this._renderTriangleLists[3].push(RenderTriangle.create(PositionTexture.createPos(r,.5,.5),PositionTexture.createPos(this.bottomRight,1,1),PositionTexture.createPos(s,1,.5),this.texture,this.level)),this._renderTriangleLists[3].push(RenderTriangle.create(PositionTexture.createPos(r,.5,.5),PositionTexture.createPos(o,.5,1),PositionTexture.createPos(this.bottomRight,1,1),this.texture,this.level)),this.readyToRender=!0;else{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);var l=new Float32Array(45),h=l,c=0;for(c=this.addVertex(h,c,PositionTexture.createPos(o,.5,1)),c=this.addVertex(h,c,PositionTexture.createPos(this.bottomLeft,0,1)),c=this.addVertex(h,c,PositionTexture.createPos(this.bottomRight,1,1)),c=this.addVertex(h,c,PositionTexture.createPos(r,.5,.5)),c=this.addVertex(h,c,PositionTexture.createPos(n,0,.5)),c=this.addVertex(h,c,PositionTexture.createPos(s,1,.5)),c=this.addVertex(h,c,PositionTexture.createPos(a,.5,0)),c=this.addVertex(h,c,PositionTexture.createPos(this.topLeft,0,0)),c=this.addVertex(h,c,PositionTexture.createPos(this.topRight,1,0)),tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,l,WEBGL.STATIC_DRAW),t=0;t<4;t++){c=0,this.triangleCount=2;var u=new Uint16Array(3*this.triangleCount),d=u;switch(t){case 0:d[c++]=7,d[c++]=4,d[c++]=6,d[c++]=4,d[c++]=3,d[c++]=6;break;case 1:d[c++]=6,d[c++]=5,d[c++]=8,d[c++]=6,d[c++]=3,d[c++]=5;break;case 2:d[c++]=4,d[c++]=0,d[c++]=3,d[c++]=4,d[c++]=1,d[c++]=0;break;case 3:d[c++]=3,d[c++]=2,d[c++]=5,d[c++]=3,d[c++]=0,d[c++]=2}this._indexBuffers[t]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,this._indexBuffers[t]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,u,WEBGL.STATIC_DRAW)}}return!0}};function SkyImageTile(e,t,i,r,n){this.pixelCenterX=0,this.pixelCenterY=0,this.scaleX=.01,this.scaleY=.01,this.height=0,this.width=0,TangentTile.call(this,e,t,i,r,n),this.pixelCenterX=r.get_offsetX(),this.pixelCenterY=r.get_offsetY(),this.scaleX=-(this.scaleY=r.get_baseTileDegrees()),r.get_bottomsUp()&&(this.scaleX=-this.scaleX),this.sphereCenter=this.geoTo3dTan(0,0),this.radius=1.25,this.computeBoundingSphere()}registerType("TangentTile",[TangentTile,TangentTile$,Tile]);var SkyImageTile$={getLatLngEdges:function(){var e=new LatLngEdges,t=ss.ss.safeCast(this.dataset.get_wcsImage(),WcsImage);return null!=t&&useGl?useGlVersion2?(this.width=t.get_sizeX(),this.height=t.get_sizeY()):(this.height=this.bmp.height,this.width=this.bmp.width,this.bmp.height!==t.get_sizeY()&&(this.pixelCenterY+=this.bmp.height-t.get_sizeY())):null!=this.texture?(this.height=this.texture.naturalHeight,this.width=this.texture.naturalWidth):(this.height=256,this.width=256),e.latMin=0+this.scaleY*(this.height-this.pixelCenterY),e.latMax=0-this.scaleY*this.pixelCenterY,e.lngMin=0+this.scaleX*this.pixelCenterX,e.lngMax=0-this.scaleX*(this.width-this.pixelCenterX),e}};function Triangle(){this.a=-1,this.b=-1,this.c=-1}registerType("SkyImageTile",[SkyImageTile,SkyImageTile$,TangentTile]),Triangle.create=function(e,t,i){var r=new Triangle;return r.a=e,r.b=t,r.c=i,r};var Triangle$={subDivide:function(e,t){var i=Vector3d.lerp(t[this.b].position,t[this.c].position,.5),r=Vector3d.lerp(t[this.c].position,t[this.a].position,.5),n=Vector3d.lerp(t[this.a].position,t[this.b].position,.5),s=Vector2d.lerp(Vector2d.create(t[this.b].tu,t[this.b].tv),Vector2d.create(t[this.c].tu,t[this.c].tv),.5),a=Vector2d.lerp(Vector2d.create(t[this.c].tu,t[this.c].tv),Vector2d.create(t[this.a].tu,t[this.a].tv),.5),o=Vector2d.lerp(Vector2d.create(t[this.a].tu,t[this.a].tv),Vector2d.create(t[this.b].tu,t[this.b].tv),.5);i.normalize(),r.normalize(),n.normalize();var l=t.length,h=t.length+1,c=t.length+2;t.push(PositionTexture.createPosRaw(i,s.x,s.y)),t.push(PositionTexture.createPosRaw(r,a.x,a.y)),t.push(PositionTexture.createPosRaw(n,o.x,o.y)),e.push(Triangle.create(this.a,c,h)),e.push(Triangle.create(this.b,l,c)),e.push(Triangle.create(this.c,h,l)),e.push(Triangle.create(l,h,c))},subDivideNoNormalize:function(e,t){var i=Vector3d.lerp(t[this.b].position,t[this.c].position,.5),r=Vector3d.lerp(t[this.c].position,t[this.a].position,.5),n=Vector3d.lerp(t[this.a].position,t[this.b].position,.5),s=Vector2d.lerp(Vector2d.create(t[this.b].tu,t[this.b].tv),Vector2d.create(t[this.c].tu,t[this.c].tv),.5),a=Vector2d.lerp(Vector2d.create(t[this.c].tu,t[this.c].tv),Vector2d.create(t[this.a].tu,t[this.a].tv),.5),o=Vector2d.lerp(Vector2d.create(t[this.a].tu,t[this.a].tv),Vector2d.create(t[this.b].tu,t[this.b].tv),.5),l=t.length,h=t.length+1,c=t.length+2;t.push(PositionTexture.createPosRaw(i,s.x,s.y)),t.push(PositionTexture.createPosRaw(r,a.x,a.y)),t.push(PositionTexture.createPosRaw(n,o.x,o.y)),e.push(Triangle.create(this.a,c,h)),e.push(Triangle.create(this.b,l,c)),e.push(Triangle.create(this.c,h,l)),e.push(Triangle.create(l,h,c))}};function ToastTile(){this._topDown$1=!0,this.backslash=!1,this._vertexList$1=null,this._childTriangleList$1=null,this._subDivisionLevel$1=4,this._subDivided$1=!1,Tile.call(this)}registerType("Triangle",[Triangle,Triangle$,null]),ToastTile.slashIndexBuffer=new Array(64),ToastTile.backSlashIndexBuffer=new Array(64),ToastTile.rootIndexBuffer=new Array(4),ToastTile._cloneArray$1=function(e){for(var t=e.length,i=new Uint16Array(t),r=0;r<t;r++)i[r]=e[r];return i},ToastTile.create=function(e,t,i,r,n){var s=new ToastTile;return s.parent=n,s.level=e,s.tileX=t,s.tileY=i,s.dataset=r,s._topDown$1=!r.get_bottomsUp(),s.tileX!==t&&alert("bad"),r.get_meanRadius()?s.set__demScaleFactor(r.get_meanRadius()):r.get_dataSetType()?s.set__demScaleFactor(3396010):s.set__demScaleFactor(6371e3),s.computeBoundingSphere(),s};var ToastTile$={computeBoundingSphere:function(){this._initializeGrids$1(),this.topLeft=this.bounds[0].position.copy(),this.bottomRight=this.bounds[8].position.copy(),this.topRight=this.bounds[2].position.copy(),this.bottomLeft=this.bounds[6].position.copy(),this.calcSphere()},getIndexBuffer:function(e,t){return this.level?this.backslash?ToastTile.backSlashIndexBuffer[16*e+t]:ToastTile.slashIndexBuffer[16*e+t]:ToastTile.rootIndexBuffer[e]},_processIndexBuffer$1:function(e,t){if(!this.level)return ToastTile.rootIndexBuffer[t]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,ToastTile.rootIndexBuffer[t]),void tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,e,WEBGL.STATIC_DRAW);for(var i=0;i<16;i++){var r=ToastTile._cloneArray$1(e);this._processAccomindations$1(r,i),this.backslash?(ToastTile.backSlashIndexBuffer[16*t+i]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,ToastTile.backSlashIndexBuffer[16*t+i]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,r,WEBGL.STATIC_DRAW)):(ToastTile.slashIndexBuffer[16*t+i]=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,ToastTile.slashIndexBuffer[16*t+i]),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,r,WEBGL.STATIC_DRAW))}},_processAccomindations$1:function(e,t){for(var i={},r={},n=ss.ss.enumerate(e);n.moveNext();){var s=n.current,a=this._vertexList$1[s],o=ss.ss.truncate(16*a.tu+.5),l=(ss.ss.truncate(16*a.tv+.5)<<8)+o;ss.ss.keyExists(r,l)||(r[l]=s)}var h=16;if(1==(1&t))for(var c=1;c<h;c+=2){var u=((_=h)<<8)+c,d=(_<<8)+c+1;ss.ss.keyExists(r,u)&&(i[r[u]]=r[d])}if(2==(2&t))for(var _=1;_<h;_+=2)u=(_<<8)+(c=h),d=(_+1<<8)+c,ss.ss.keyExists(r,u)&&(i[r[u]]=r[d]);if(4==(4&t))for(c=1;c<h;c+=2)u=((_=0)<<8)+c,d=(_<<8)+c+1,ss.ss.keyExists(r,u)&&(i[r[u]]=r[d]);if(8==(8&t))for(_=1;_<h;_+=2)u=(_<<8)+(c=0),d=(_+1<<8)+c,ss.ss.keyExists(r,u)&&(i[r[u]]=r[d]);if(ss.ss.keyCount(i))for(var g=0;g<e.length;g++)ss.ss.keyExists(i,e[g])&&(e[g]=i[e[g]])},calculateFullSphere:function(e){var t=ConvexHull.findEnclosingSphere(e);this.sphereCenter=t.center,this.sphereRadius=t.radius},isPointInTile:function(e,t){if(!this.level)return!0;if(1===this.level)return t>=0&&t<=90&&!this.tileX&&1===this.tileY||t>90&&t<=180&&1===this.tileX&&1===this.tileY||t<0&&t>=-90&&!this.tileX&&!this.tileY||t<-90&&t>=-180&&1===this.tileX&&!this.tileY;if(!this.demReady||null==this.demData)return!1;var i=Coordinates.geoTo3dDouble(-e,t),r=this._isLeftOfHalfSpace$1(this.topLeft.copy(),this.topRight.copy(),i),n=this._isLeftOfHalfSpace$1(this.topRight.copy(),this.bottomRight.copy(),i),s=this._isLeftOfHalfSpace$1(this.bottomRight.copy(),this.bottomLeft.copy(),i),a=this._isLeftOfHalfSpace$1(this.bottomLeft.copy(),this.topLeft.copy(),i);return!!(r&&n&&s&&a)},_isLeftOfHalfSpace$1:function(e,t,i){e.normalize(),t.normalize();var r=Vector3d.cross(e,t);return Vector3d.dot(r,i)<0},getSurfacePointAltitude:function(e,t,i){if(this.level<Tile.lastDeepestLevel)for(var r=0;r<4;r++){var n=this.children[r];if(null!=n&&n.isPointInTile(e,t)){var s=n.getSurfacePointAltitude(e,t,i);if(s)return s;break}}Tile.tileTargetLevel=this.level,Tile.tileTargetX=this.tileX,Tile.tileTargetY=this.tileY;var a=Coordinates.geoTo3dDouble(-e,t);a=Vector3d.subtractVectors(new Vector3d,a);var o=DistanceCalc.getUVFromInnerPoint(this.topLeft.copy(),this.topRight.copy(),this.bottomLeft.copy(),this.bottomRight.copy(),a.copy()),l=Math.max(0,Math.min(16,16*o.x)),h=Math.max(0,Math.min(16,16*o.y)),c=Math.max(0,Math.min(15,ss.ss.truncate(16*o.x))),u=Math.max(0,Math.min(15,ss.ss.truncate(16*o.y))),d=l-c,_=h-u;return null!=this.demArray?((this.demArray[c+17*u]*(1-d)+d*this.demArray[c+1+17*u])*(1-_)+_*(this.demArray[c+17*(u+1)]*(1-d)+d*this.demArray[c+1+17*(u+1)]))/this.get__demScaleFactor():this.demAverage/this.get__demScaleFactor()},_initializeGrids$1:function(){if(this._vertexList$1=[],this._childTriangleList$1=new Array(4),this._childTriangleList$1[0]=[],this._childTriangleList$1[1]=[],this._childTriangleList$1[2]=[],this._childTriangleList$1[3]=[],this.bounds=new Array(9),this.level>0){null==this.parent&&(this.parent=tileCacheGetTile(this.level-1,this.tileX/2,this.tileY/2,this.dataset,null));var e=this.parent,t=this.tileX%2,i=this.tileY%2;this.level>1?this.backslash=e.backslash:this.backslash=1==(1===t^1===i),this.bounds[0]=e.bounds[t+3*i].copy(),this.bounds[1]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+1+3*i]),this.bounds[2]=e.bounds[t+1+3*i].copy(),this.bounds[3]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+3*(i+1)]),this.backslash?this.bounds[4]=this._midpoint$1(e.bounds[t+3*i],e.bounds[t+1+3*(i+1)]):this.bounds[4]=this._midpoint$1(e.bounds[t+1+3*i],e.bounds[t+3*(i+1)]),this.bounds[5]=this._midpoint$1(e.bounds[t+1+3*i],e.bounds[t+1+3*(i+1)]),this.bounds[6]=e.bounds[t+3*(i+1)].copy(),this.bounds[7]=this._midpoint$1(e.bounds[t+3*(i+1)],e.bounds[t+1+3*(i+1)]),this.bounds[8]=e.bounds[t+1+3*(i+1)].copy(),this.bounds[0].tu=0*tileUvMultiple,this.bounds[0].tv=0*tileUvMultiple,this.bounds[1].tu=.5*tileUvMultiple,this.bounds[1].tv=0*tileUvMultiple,this.bounds[2].tu=1*tileUvMultiple,this.bounds[2].tv=0*tileUvMultiple,this.bounds[3].tu=0*tileUvMultiple,this.bounds[3].tv=.5*tileUvMultiple,this.bounds[4].tu=.5*tileUvMultiple,this.bounds[4].tv=.5*tileUvMultiple,this.bounds[5].tu=1*tileUvMultiple,this.bounds[5].tv=.5*tileUvMultiple,this.bounds[6].tu=0*tileUvMultiple,this.bounds[6].tv=1*tileUvMultiple,this.bounds[7].tu=.5*tileUvMultiple,this.bounds[7].tv=1*tileUvMultiple,this.bounds[8].tu=1*tileUvMultiple,this.bounds[8].tv=1*tileUvMultiple,this._vertexList$1.push(this.bounds[0]),this._vertexList$1.push(this.bounds[1]),this._vertexList$1.push(this.bounds[2]),this._vertexList$1.push(this.bounds[3]),this._vertexList$1.push(this.bounds[4]),this._vertexList$1.push(this.bounds[5]),this._vertexList$1.push(this.bounds[6]),this._vertexList$1.push(this.bounds[7]),this._vertexList$1.push(this.bounds[8]),this.backslash?(this._childTriangleList$1[0].push(Triangle.create(4,1,0)),this._childTriangleList$1[0].push(Triangle.create(3,4,0)),this._childTriangleList$1[1].push(Triangle.create(5,2,1)),this._childTriangleList$1[1].push(Triangle.create(4,5,1)),this._childTriangleList$1[2].push(Triangle.create(7,4,3)),this._childTriangleList$1[2].push(Triangle.create(6,7,3)),this._childTriangleList$1[3].push(Triangle.create(8,5,4)),this._childTriangleList$1[3].push(Triangle.create(7,8,4))):(this._childTriangleList$1[0].push(Triangle.create(3,1,0)),this._childTriangleList$1[0].push(Triangle.create(4,1,3)),this._childTriangleList$1[1].push(Triangle.create(4,2,1)),this._childTriangleList$1[1].push(Triangle.create(5,2,4)),this._childTriangleList$1[2].push(Triangle.create(6,4,3)),this._childTriangleList$1[2].push(Triangle.create(7,4,6)),this._childTriangleList$1[3].push(Triangle.create(7,5,4)),this._childTriangleList$1[3].push(Triangle.create(8,5,7)))}else this.bounds[0]=PositionTexture.create(0,-1,0,0,0),this.bounds[1]=PositionTexture.create(0,0,1,.5,0),this.bounds[2]=PositionTexture.create(0,-1,0,1,0),this.bounds[3]=PositionTexture.create(-1,0,0,0,.5),this.bounds[4]=PositionTexture.create(0,1,0,.5,.5),this.bounds[5]=PositionTexture.create(1,0,0,1,.5),this.bounds[6]=PositionTexture.create(0,-1,0,0,1),this.bounds[7]=PositionTexture.create(0,0,-1,.5,1),this.bounds[8]=PositionTexture.create(0,-1,0,1,1),this._vertexList$1.push(this.bounds[0]),this._vertexList$1.push(this.bounds[1]),this._vertexList$1.push(this.bounds[2]),this._vertexList$1.push(this.bounds[3]),this._vertexList$1.push(this.bounds[4]),this._vertexList$1.push(this.bounds[5]),this._vertexList$1.push(this.bounds[6]),this._vertexList$1.push(this.bounds[7]),this._vertexList$1.push(this.bounds[8]),this._childTriangleList$1[0].push(Triangle.create(3,1,0)),this._childTriangleList$1[0].push(Triangle.create(4,1,3)),this._childTriangleList$1[1].push(Triangle.create(5,2,1)),this._childTriangleList$1[1].push(Triangle.create(4,5,1)),this._childTriangleList$1[2].push(Triangle.create(7,4,3)),this._childTriangleList$1[2].push(Triangle.create(6,7,3)),this._childTriangleList$1[3].push(Triangle.create(7,5,4)),this._childTriangleList$1[3].push(Triangle.create(8,5,7))},_midpoint$1:function(e,t){var i=Vector3d.lerp(e.position,t.position,.5),r=Vector2d.lerp(Vector2d.create(e.tu,e.tv),Vector2d.create(t.tu,t.tv),.5);return i.normalize(),PositionTexture.createPos(i,r.x,r.y)},createGeometry:function(e){if(this.geometryCreated)return!0;if(this.geometryCreated=!0,Tile.prototype.createGeometry.call(this,e),!this._subDivided$1){null==this._vertexList$1&&this._initializeGrids$1(),256==tileUvMultiple?(this.dataset.get_dataSetType()&&this.dataset.get_dataSetType(),this._subDivisionLevel$1=Math.min(5,Math.max(0,5-this.level))):this.demTile&&this.level>1&&(this.demArray=new Array(289),this.demSize=289,this.backslash?null==ToastTile._backslashYIndex$1&&(this._tempBackslashYIndex$1=new Array(this.demSize),this._tempBackslashXIndex$1=new Array(this.demSize)):null==ToastTile._slashYIndex$1&&(this._tempSlashYIndex$1=new Array(this.demSize),this._tempSlashXIndex$1=new Array(this.demSize)));for(var t=0;t<4;t++)for(var i=this._subDivisionLevel$1;i-- >1;){for(var r=[],n=ss.ss.enumerate(this._childTriangleList$1[t]);n.moveNext();)(a=n.current).subDivide(r,this._vertexList$1);this._childTriangleList$1[t]=r}if(null==e.gl)for(t=0;t<4;t++){this._renderTriangleLists[t]=[];for(var s=ss.ss.enumerate(this._childTriangleList$1[t]);s.moveNext();){var a=s.current,o=this._vertexList$1[a.c],l=this._vertexList$1[a.b],h=this._vertexList$1[a.a];this._renderTriangleLists[t].push(RenderTriangle.create(o,l,h,this.texture,this.level))}}else{this._vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this._vertexBuffer);for(var c=new Float32Array(5*this._vertexList$1.length),u=c,d=0,_=ss.ss.enumerate(this._vertexList$1);_.moveNext();){var g=_.current;this.demTile?(d=this.addVertex(u,d,this._getMappedVertex(g)),this.demIndex++):d=this.addVertex(u,d,g)}for(this.demTile&&(this.backslash?null!=this._tempBackslashXIndex$1&&(ToastTile._backslashXIndex$1=this._tempBackslashXIndex$1,ToastTile._backslashYIndex$1=this._tempBackslashYIndex$1,this._tempBackslashXIndex$1=null,this._tempBackslashYIndex$1=null):null!=this._tempSlashYIndex$1&&(ToastTile._slashXIndex$1=this._tempSlashXIndex$1,ToastTile._slashYIndex$1=this._tempSlashYIndex$1,this._tempSlashYIndex$1=null,this._tempSlashXIndex$1=null)),tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,c,WEBGL.STATIC_DRAW),t=0;t<4;t++)if(this.triangleCount=this._childTriangleList$1[t].length,null==this.getIndexBuffer(t,0)){var f=new Uint16Array(3*this.triangleCount);d=0;for(var m=ss.ss.enumerate(this._childTriangleList$1[t]);m.moveNext();)a=m.current,f[d++]=a.c,f[d++]=a.b,f[d++]=a.a;this._processIndexBuffer$1(f,t)}}this._subDivided$1=!0}return!0},_getMappedVertex:function(e){var t=new PositionTexture,i=Coordinates.cartesianToSpherical2(e.position);if(i.get_lng()<-180&&i.set_lng(i.get_lng()+360),i.get_lng()>180&&i.set_lng(i.get_lng()-360),this.level>1){var r=ss.ss.truncate(16*e.tu+.5),n=ss.ss.truncate(16*e.tv+.5);this.demArray[r+17*n]=this.demData[this.demIndex],this.backslash?null!=this._tempBackslashYIndex$1&&(this._tempBackslashXIndex$1[this.demIndex]=r,this._tempBackslashYIndex$1[this.demIndex]=n):null!=this._tempSlashYIndex$1&&(this._tempSlashXIndex$1[this.demIndex]=r,this._tempSlashYIndex$1[this.demIndex]=n)}var s=this.geoTo3dWithAlt(i.get_lat(),i.get_lng(),!1,!1);return t.tu=e.tu,t.tv=e.tv,s.subtract(this.localCenter),t.position=s,t},cleanUp:function(e){Tile.prototype.cleanUp.call(this,e),null!=this._vertexList$1&&(this._vertexList$1=null),null!=this._childTriangleList$1&&(this._childTriangleList$1=null),this._subDivided$1=!1,this.demArray=null},_getDemSample$1:function(e,t){return this.demArray[17*(16-t)+e]},createDemFromParent:function(){var e=ss.ss.safeCast(this.parent,ToastTile);if(null==e)return!1;var t=this.tileX%2==1?8:0,i=this.tileY%2?0:8;this.demArray=new Array(289);for(var r=0;r<17;r+=2)for(var n=!0,s=0;s<17;s++)this.demArray[17*(16-r)+s]=n?e._getDemSample$1(s/2+t,r/2+i):(e._getDemSample$1(s/2+t,r/2+i)+e._getDemSample$1(s/2+t+1,r/2+i))/2,n=!n;for(var a=1;a<17;a+=2)for(var o=0;o<17;o++)this.demArray[17*(16-a)+o]=(this._getDemSample$1(o,a-1)+this._getDemSample$1(o,a+1))/2;this.demData=new Array(this.demSize);for(var l=0;l<this.demSize;l++)this.backslash?this.demData[l]=this.demArray[ToastTile._backslashXIndex$1[l]+17*ToastTile._backslashYIndex$1[l]]:this.demData[l]=this.demArray[ToastTile._slashXIndex$1[l]+17*ToastTile._slashYIndex$1[l]],this.demAverage+=this.demData[l];return this.demAverage/=this.demData.length,this.demReady=!0,!0}};registerType("ToastTile",[ToastTile,ToastTile$,Tile]);var ProjectionType={mercator:0,equirectangular:1,tangent:2,tan:2,toast:3,spherical:4,skyImage:5,plotted:6,healpix:7};registerType("ProjectionType",ProjectionType),registerEnum("ProjectionType",ProjectionType);var ImageSetType={earth:0,planet:1,sky:2,panorama:3,solarSystem:4,sandbox:5};registerType("ImageSetType",ImageSetType),registerEnum("ImageSetType",ImageSetType);var BandPass={gamma:0,xRay:1,ultraviolet:2,visible:3,hydrogenAlpha:4,IR:4,microwave:5,radio:6,visibleNight:6};function Imageset(){this._projection=0,this._imageSetID=0,this._baseTileDegrees=0,this._widthFactor=1,this.demUrl="",this._levels=0,this._mercator=!1,this._bottomsUp=!1,this._baseLevel=1,this._quadTreeTileMap="0123",this._centerX=0,this._centerY=0,this._rotation=0,this._meanRadius=0,this._dataSetType=0,this._bandPass=3,this._altUrl="",this._singleImage=!1,this._fitsProperties=new FitsProperties,this._matrixComputed=!1,this._name="",this._sparse=!1,this._thumbnailUrl="",this._generic=!1,this._defaultSet=!1,this._elevationModel=!1,this._offsetX=0,this._offsetY=0}registerType("BandPass",BandPass),registerEnum("BandPass",BandPass),Imageset.getNewTile=function(e,t,i,r,n){switch(e.get_projection()){case ProjectionType.mercator:return MercatorTile.create(t,i,r,e,n);case ProjectionType.equirectangular:return EquirectangularTile.create(t,i,r,e,n);case ProjectionType.toast:default:return ToastTile.create(t,i,r,e,n);case ProjectionType.skyImage:return new SkyImageTile(t,i,r,e,n);case ProjectionType.plotted:return PlotTile.create(t,i,r,e,n);case ProjectionType.healpix:return null==e.get_hipsProperties()&&e.set_hipsProperties(makeNewHipsProperties(e)),e.get_hipsProperties().get_downloadComplete()?new HealpixTile(t,i,r,e,n):null;case ProjectionType.tangent:return new TangentTile(t,i,r,e,n)}},Imageset.fromXMLNode=function(e){try{var t,i,r=2;null!=e.attributes.getNamedItem("DataSetType")&&(r=Enums.parse("ImageSetType",e.attributes.getNamedItem("DataSetType").nodeValue)),i=Enums.parse("BandPass",e.attributes.getNamedItem("BandPass").nodeValue);var n=1;if(null!=e.attributes.getNamedItem("WidthFactor")&&(n=parseInt(e.attributes.getNamedItem("WidthFactor").nodeValue)),null!=e.attributes.getNamedItem("Generic")&&ss.ss.boolean(e.attributes.getNamedItem("Generic").nodeValue))return Imageset.createGeneric(r,i);t=Enums.parse("ProjectionType",e.attributes.getNamedItem("Projection").nodeValue);var s=e.attributes.getNamedItem("FileType").nodeValue;ss.ss.startsWith(s,".")||(s="."+s);var a="",o=Util.selectSingleNode(e,"ThumbnailUrl");null!=o&&(a=ss.ss.emptyString(o.text)?o.textContent:o.text);var l=!1,h=!1;null!=e.attributes.getNamedItem("StockSet")&&(l=ss.ss.boolean(e.attributes.getNamedItem("StockSet").nodeValue)),null!=e.attributes.getNamedItem("ElevationModel")&&(h=ss.ss.boolean(e.attributes.getNamedItem("ElevationModel").nodeValue));var c="";null!=e.attributes.getNamedItem("DemUrl")&&(c=e.attributes.getNamedItem("DemUrl").nodeValue);var u="";null!=e.attributes.getNamedItem("AltUrl")&&(u=e.attributes.getNamedItem("AltUrl").nodeValue);var d=0;null!=e.attributes.getNamedItem("OffsetX")&&(d=parseFloat(e.attributes.getNamedItem("OffsetX").nodeValue));var _=0;null!=e.attributes.getNamedItem("OffsetY")&&(_=parseFloat(e.attributes.getNamedItem("OffsetY").nodeValue));var g="",f=Util.selectSingleNode(e,"Credits");null!=f&&(g=Util.getInnerText(f));var m="";null!=(f=Util.selectSingleNode(e,"CreditsUrl"))&&(m=Util.getInnerText(f));var p=0;null!=e.attributes.getNamedItem("MeanRadius")&&(p=parseFloat(e.attributes.getNamedItem("MeanRadius").nodeValue));var C=null;null!=e.attributes.getNamedItem("ReferenceFrame")&&(C=e.attributes.getNamedItem("ReferenceFrame").nodeValue);var S="";null!=e.attributes.getNamedItem("Name")&&(S=e.attributes.getNamedItem("Name").nodeValue);var w="";null!=e.attributes.getNamedItem("Url")&&(w=e.attributes.getNamedItem("Url").nodeValue);var T=0;null!=e.attributes.getNamedItem("BaseTileLevel")&&(T=parseInt(e.attributes.getNamedItem("BaseTileLevel").nodeValue));var y=0;null!=e.attributes.getNamedItem("TileLevels")&&(y=parseInt(e.attributes.getNamedItem("TileLevels").nodeValue));var b=0;null!=e.attributes.getNamedItem("BaseDegreesPerTile")&&(b=parseFloat(e.attributes.getNamedItem("BaseDegreesPerTile").nodeValue));var v=!1;null!=e.attributes.getNamedItem("BottomsUp")&&(v=ss.ss.boolean(e.attributes.getNamedItem("BottomsUp").nodeValue));var M="";null!=e.attributes.getNamedItem("QuadTreeMap")&&(M=e.attributes.getNamedItem("QuadTreeMap").nodeValue);var x=0;null!=e.attributes.getNamedItem("CenterX")&&(x=parseFloat(e.attributes.getNamedItem("CenterX").nodeValue));var L=0;null!=e.attributes.getNamedItem("CenterY")&&(L=parseFloat(e.attributes.getNamedItem("CenterY").nodeValue));var A=0;null!=e.attributes.getNamedItem("Rotation")&&(A=parseFloat(e.attributes.getNamedItem("Rotation").nodeValue));var V=!1;return null!=e.attributes.getNamedItem("Sparse")&&(V=ss.ss.boolean(e.attributes.getNamedItem("Sparse").nodeValue)),Imageset.create(S,w,r,i,t,Math.abs(Util.getHashCode(w)),T,y,256,b,s,v,M,x,L,A,V,a,l,h,n,d,_,g,m,c,u,p,C)}catch(e){return null}},Imageset.saveToXml=function(e,t,i){e._writeStartElement("ImageSet"),e._writeAttributeString("Generic",t.get_generic().toString()),e._writeAttributeString("DataSetType",Enums.toXml("ImageSetType",t.get_dataSetType())),e._writeAttributeString("BandPass",Enums.toXml("BandPass",t.get_bandPass())),t.get_generic()||(e._writeAttributeString("Name",t.get_name()),ss.ss.emptyString(i)?e._writeAttributeString("Url",t.get_url()):e._writeAttributeString("Url",i),e._writeAttributeString("DemUrl",t.get_demUrl()),e._writeAttributeString("BaseTileLevel",t.get_baseLevel().toString()),e._writeAttributeString("TileLevels",t.get_levels().toString()),e._writeAttributeString("BaseDegreesPerTile",t.get_baseTileDegrees().toString()),e._writeAttributeString("FileType",t.get_extension()),e._writeAttributeString("BottomsUp",t.get_bottomsUp().toString()),e._writeAttributeString("Projection",Enums.toXml("ProjectionType",t.get_projection())),e._writeAttributeString("QuadTreeMap",t.get_quadTreeTileMap()),e._writeAttributeString("CenterX",t.get_centerX().toString()),e._writeAttributeString("CenterY",t.get_centerY().toString()),e._writeAttributeString("OffsetX",t.get_offsetX().toString()),e._writeAttributeString("OffsetY",t.get_offsetY().toString()),e._writeAttributeString("Rotation",t.get_rotation().toString()),e._writeAttributeString("Sparse",t.get_sparse().toString()),e._writeAttributeString("ElevationModel",t.get_elevationModel().toString()),e._writeAttributeString("StockSet",t.get_defaultSet().toString()),e._writeAttributeString("WidthFactor",t.get_widthFactor().toString()),e._writeAttributeString("MeanRadius",t.get_meanRadius().toString()),e._writeAttributeString("ReferenceFrame",t.get_referenceFrame()),ss.ss.emptyString(i)?e._writeElementString("ThumbnailUrl",t.get_thumbnailUrl()):e._writeElementString("ThumbnailUrl",t.get_url())),e._writeEndElement()},Imageset.createGeneric=function(e,t){var i=new Imageset;return i._generic=!0,i._name="Generic",i._sparse=!1,i._dataSetType=e,i._bandPass=t,i._quadTreeTileMap="",i.url="",i._levels=0,i._baseTileDegrees=0,i._imageSetID=0,i._extension="",i._projection=1,i._bottomsUp=!1,i._baseLevel=0,i._mercator=!i._projection,i._centerX=0,i._centerY=0,i._rotation=0,i._thumbnailUrl="",i._matrix=Matrix3d.get_identity(),i._matrix._multiply(Matrix3d._rotationX(i.get_rotation()/180*Math.PI)),i._matrix._multiply(Matrix3d._rotationZ(i.get_centerY()/180*Math.PI)),i._matrix._multiply(Matrix3d._rotationY((360-i.get_centerX()+180)/180*Math.PI)),i},Imageset.create=function(e,t,i,r,n,s,a,o,l,h,c,u,d,_,g,f,m,p,C,S,w,T,y,b,v,M,x,L,A){var V=new Imageset;return V.setInitialParameters(e,t,i,r,n,s,a,o,h,c,u,d,_,g,f,m,p,C,S,w,T,y,b,v,M,x,L,A),V};var Imageset$={get_wcsImage:function(){return this._wcsImage},set_wcsImage:function(e){return this._wcsImage=e,e},get_projection:function(){return this._projection},set_projection:function(e){return this._projection=e,e},get_referenceFrame:function(){return this._referenceFrame},set_referenceFrame:function(e){return this._referenceFrame=e,e},get_imageSetID:function(){return this._imageSetID},set_imageSetID:function(e){return this._imageSetID=e,e},get_baseTileDegrees:function(){return this._baseTileDegrees},set_baseTileDegrees:function(e){return this._baseTileDegrees=e,e},get_widthFactor:function(){return this._widthFactor},set_widthFactor:function(e){return this._widthFactor=e,e},getHashCode:function(){return Util.getHashCode(this.get_url())},get_url:function(){return this.url},set_url:function(e){return this.url=e,e},get_demUrl:function(){return!ss.ss.emptyString(this.demUrl)||this._projection||freestandingMode?this.demUrl:URLHelpers.singleton.coreStaticUrl("wwtweb/BingDemTile.aspx?Q={0},{1},{2}")},set_demUrl:function(e){return this.demUrl=e,e},get_extension:function(){return this._extension},set_extension:function(e){return this._extension=e,e},get_levels:function(){return this._levels},set_levels:function(e){return this._levels=e,e},get_bottomsUp:function(){return this._bottomsUp},set_bottomsUp:function(e){return this._bottomsUp=e,e},get_mercator:function(){return this._mercator},set_mercator:function(e){return this._mercator=e,e},get_baseLevel:function(){return this._baseLevel},set_baseLevel:function(e){return this._baseLevel=e,e},get_quadTreeTileMap:function(){return this._quadTreeTileMap},set_quadTreeTileMap:function(e){return this._quadTreeTileMap=e,e},get_centerX:function(){return this._centerX},set_centerX:function(e){return this._centerX!==e&&(this._centerX=e,this._computeMatrix()),e},get_centerY:function(){return this._centerY},set_centerY:function(e){return this._centerY!==e&&(this._centerY=e,this._computeMatrix()),e},get_rotation:function(){return this._rotation},set_rotation:function(e){return this._rotation!==e&&(this._rotation=e,this._computeMatrix()),e},get_meanRadius:function(){return this._meanRadius},set_meanRadius:function(e){return this._meanRadius=e,e},get_bandPass:function(){return this._bandPass},set_bandPass:function(e){return this._bandPass=e,e},get_dataSetType:function(){return this._dataSetType},set_dataSetType:function(e){return this._dataSetType=e,e},get_altUrl:function(){return this._altUrl},set_altUrl:function(e){return this._altUrl=e,e},get_singleImage:function(){return this._singleImage},set_singleImage:function(e){return this._singleImage=e,e},get_hipsProperties:function(){return this._hipsProperties},set_hipsProperties:function(e){return this._hipsProperties=e,e},get_fitsProperties:function(){return this._fitsProperties},set_fitsProperties:function(e){return this._fitsProperties=e,e},toString:function(){return this.get_defaultSet()?this._name+" *":this._name},get_stockImageSet:function(){return this._generic||!this._defaultSet?this:Imageset.createGeneric(this.get_dataSetType(),this.get_bandPass())},equals:function(e){if(null==e)return!1;if(!ss.ss.canCast(e,Imageset))return!1;var t=e;return Util.getHashCode(t.get_url())===Util.getHashCode(this.get_url())&&t.get_dataSetType()===this.get_dataSetType()&&t.get_bandPass()===this.get_bandPass()&&t.get_generic()===this.get_generic()},get_matrix:function(){return this._matrixComputed||this._computeMatrix(),this._matrix},set_matrix:function(e){return this._matrix=e,e},_computeMatrix:function(){this._matrixComputed=!0,this._matrix=Matrix3d.get_identity(),this._matrix._multiply(Matrix3d._rotationX(this.get_rotation()/180*Math.PI)),this._matrix._multiply(Matrix3d._rotationZ(this.get_centerY()/180*Math.PI)),this._matrix._multiply(Matrix3d._rotationY((360-this.get_centerX())/180*Math.PI))},get_name:function(){return this._name},set_name:function(e){return this._name=e,e},get_sparse:function(){return this._sparse},set_sparse:function(e){return this._sparse=e,e},get_thumbnailUrl:function(){return this._thumbnailUrl},set_thumbnailUrl:function(e){return this._thumbnailUrl=e,e},get_generic:function(){return this._generic},set_generic:function(e){return this._generic=e,e},get_elevationModel:function(){return this._elevationModel},set_elevationModel:function(e){return this._elevationModel=e,e},get_defaultSet:function(){return this._defaultSet},set_defaultSet:function(e){return this._defaultSet=e,e},get_offsetX:function(){return this._offsetX},set_offsetX:function(e){return this._offsetX=e,e},get_offsetY:function(){return this._offsetY},set_offsetY:function(e){return this._offsetY=e,e},get_creditsText:function(){return this._creditsText},set_creditsText:function(e){return this._creditsText=e,e},get_creditsUrl:function(){return this._creditsUrl},set_creditsUrl:function(e){return this._creditsUrl=e,e},get_isMandelbrot:function(){return!1},_calcViewCenterCoordinate:function(e){var t=Coordinates.degreesToRadians(this._rotation),i=Math.cos(t),r=Math.sin(t),n=0,s=0;return this.get_levels()>0?(n=-this._offsetX,s=this._offsetY):(n=(this._offsetX-400)*this._baseTileDegrees,s=(400-this._offsetY)*this._baseTileDegrees),this._bottomsUp&&(n=-n),e?this._centerX+n*i+s*r:this._centerY-n*r+s*i},get_viewCenterX:function(){return null!=this.get_wcsImage()?this.get_wcsImage().get_viewCenterX():this._calcViewCenterCoordinate(!0)},get_viewCenterY:function(){return null!=this.get_wcsImage()?this.get_wcsImage().get_viewCenterY():this._calcViewCenterCoordinate(!1)},setInitialParameters:function(e,t,i,r,n,s,a,o,l,h,c,u,d,_,g,f,m,p,C,S,w,T,y,b,v,M,x,L){this.set_referenceFrame(L),this.set_meanRadius(x),this._altUrl=M,this.demUrl=v,this._creditsText=y,this._creditsUrl=b,this._offsetY=T,this._offsetX=w,this._widthFactor=S,this._elevationModel=C,this._defaultSet=p,this._name=e,this._sparse=f,this._dataSetType=i,this._bandPass=r,this._quadTreeTileMap=u,this.url=t,this._levels=o,this._baseTileDegrees=l,this._imageSetID=s,this._extension=h,this._projection=n,this._bottomsUp=c,this._baseLevel=a,this._mercator=!n,this._centerX=d,this._centerY=_,this._rotation=g,this._thumbnailUrl=m,this._computeMatrix()},_guessZoomSetting:function(e){var t=e,i=ss.ss.safeCast(this._wcsImage,FitsImage);return this.get_projection()===ProjectionType.skyImage?null!=i&&(t=this.get_baseTileDegrees()*i.get_sizeY()*6*1.7):t=null!=i?i.get_scaleY()*i.get_sizeY()*6*1.7:6*this.get_baseTileDegrees()*1.7,t>e&&(t=e),t},get_thumbnail:function(){return this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,e},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_isImage:function(){return!0},get_isTour:function(){return!1},get_isFolder:function(){return!1},get_isCloudCommunityItem:function(){return!1},get_readOnly:function(){return!1},get_children:function(){return[]}};function TileCache(){}registerType("Imageset",[Imageset,Imageset$,null,IThumbnail]),TileCache._queue={},TileCache._tiles={},TileCache.openThreads=8,TileCache.readyToRenderCount=0,TileCache.maxTileCacheSize=800,TileCache.maxReadyToRenderSize=200,TileCache._maxTotalToPurge=0,TileCache.get_queueCount=function(){return ss.ss.keyCount(TileCache._queue)},TileCache.getTile=function(e,t,i,r,n){var s=null,a=getTileKey(r,e,t,i,n);return ss.ss.keyExists(TileCache._tiles,a)?s=TileCache._tiles[a]:null!=(s=Imageset.getNewTile(r,e,t,i,n))&&(TileCache._tiles[a]=s),s},set_tileCacheGetTile(TileCache.getTile),TileCache.getCachedTile=function(e,t,i,r,n){if(e<r.get_baseLevel())return null;var s=null,a=getTileKey(r,e,t,i,n);try{if(!ss.ss.keyExists(TileCache._tiles,a))return null;s=TileCache._tiles[a]}catch(e){}return s},set_tileCacheGetCachedTile(TileCache.getCachedTile),TileCache.clearCache=function(){for(const e of Object.values(TileCache._tiles))try{e.cleanUp(!0)}catch(e){continue}},TileCache.getReadyToRenderTileCount=function(){var e=[],t=[];try{try{for(var i=ss.ss.enumerate(ss.ss.keys(TileCache._tiles));i.moveNext();){var r=i.current,n=TileCache._tiles[r];n.renderedGeneration<Tile.currentRenderGeneration-10&&!n.requestPending&&!n.downloading&&(n.readyToRender?t.push(n):e.push(n))}}catch(e){}return t.length}catch(e){return-1}},TileCache.processQueue=function(e){for(;ss.ss.keyCount(TileCache._queue)>0&&TileCache.openThreads>0;){for(var t=1e5,i=!1,r=null,n=ss.ss.enumerate(ss.ss.keys(TileCache._queue));n.moveNext();){var s=n.current,a=TileCache._queue[s];if(!a.requestPending&&a.inViewFrustum){var o=Vector3d.makeCopy(a.get_sphereCenter());o._transformByMatrics(e.get_world()),e.space?o.subtract(Vector3d.create(0,0,-1)):o.subtract(e.cameraPosition);var l=Math.max(0,o.length()-a.get_sphereRadius()),h=a.get_dataset().get_projection()===ProjectionType.tangent||a.get_dataset().get_projection()===ProjectionType.skyImage;l<t&&(!i||h)&&(t=l,r=a.get_key(),a.level,i=h)}}if(null==r)return;var c=TileCache._queue[r];c.requestPending=!0,TileCache.openThreads--,TileCache.openThreads<0&&(TileCache.openThreads=0),c.requestImage(),c.get_dataset().get_elevationModel()&&c.requestDem()}},TileCache.addTileToQueue=function(e){return e.downloading||e.readyToRender||(ss.ss.keyExists(TileCache._queue,e.get_key())?TileCache._queue[e.get_key()].requestHits+=256:(e.requestHits=256,TileCache._queue[e.get_key()]=e)),!0},set_tileCacheAddTileToQueue(TileCache.addTileToQueue),TileCache.removeFromQueue=function(e,t){if(t){var i=TileCache._queue[e];null!=i&&(i.requestPending=!1,delete TileCache._queue[i.get_key()]),TileCache.openThreads++}delete TileCache._queue[e]},set_tileCacheRemoveFromQueue(TileCache.removeFromQueue),TileCache.clearCache=function(){ss.ss.clearKeys(TileCache._tiles)},TileCache.purgeQueue=function(){ss.ss.clearKeys(TileCache._queue)},TileCache.purgeLRU=function(){if(!(ss.ss.keyCount(TileCache._tiles)<TileCache.maxReadyToRenderSize)){var e=[],t=[];try{try{for(var i=ss.ss.enumerate(ss.ss.keys(TileCache._tiles));i.moveNext();){var r=i.current;(a=TileCache._tiles[r]).renderedGeneration<Tile.currentRenderGeneration-10&&!a.requestPending&&!a.downloading&&(a.readyToRender?t.push(a):e.push(a))}}catch(e){}if(TileCache.readyToRenderCount=t.length,t.length>TileCache.maxReadyToRenderSize){t.sort((function(e,t){return t.accessCount<e.accessCount?1:t.accessCount===e.accessCount?0:-1}));for(var n=t.length-TileCache.maxReadyToRenderSize,s=ss.ss.enumerate(t);s.moveNext();){var a=s.current;if(n<1)break;a.cleanUp(!1),n--}}if(ss.ss.keyCount(TileCache._tiles)<TileCache.maxTileCacheSize)return;if(e.length>TileCache.maxTileCacheSize){e.sort((function(e,t){return t.accessCount<e.accessCount?1:t.accessCount===e.accessCount?0:-1})),(n=e.length-TileCache.maxTileCacheSize)>20&&(n=20);for(var o=ss.ss.enumerate(e);o.moveNext()&&(a=o.current,!(n<1));)a.cleanUp(!0),delete TileCache._tiles[a.get_key()],n--}}catch(e){}}},TileCache.decimateQueue=function(){for(var e=[],t=ss.ss.enumerate(ss.ss.keys(TileCache._queue));t.moveNext();){var i=t.current;if(!(n=TileCache._queue[i]).requestPending){n.requestHits=n.requestHits/2;try{n.requestHits<2?e.push(n):n.inViewFrustum||e.push(n)}catch(e){}}}for(var r=ss.ss.enumerate(e);r.moveNext();){var n=r.current;delete TileCache._queue[n.get_key()]}};var TileCache$={};registerType("TileCache",[TileCache,TileCache$,null]);var StockSkyOverlayTypes={empty:0,equatorialGrid:1,equatorialGridText:2,galacticGrid:3,galacticGridText:4,eclipticGrid:5,eclipticGridText:6,eclipticOverview:7,eclipticOverviewText:8,precessionChart:9,altAzGrid:10,altAzGridText:11,constellationFigures:12,constellationBoundaries:13,constellationFocusedOnly:14,constellationNames:15,constellationPictures:16,fadeToBlack:17,fadeToLogo:18,fadeToGradient:19,screenBroadcast:20,fadeRemoteOnly:21,skyGrids:22,constellations:23,solarSystemStars:24,solarSystemMilkyWay:25,solarSystemCosmos:26,solarSystemOrbits:27,solarSystemPlanets:28,solarSystemAsteroids:29,solarSystemLighting:30,solarSystemMinorOrbits:31,showEarthCloudLayer:32,showElevationModel:33,showAtmosphere:34,multiResSolarSystemBodies:35,auroraBorialis:36,earthCutAway:37,showSolarSystem:38,clouds8k:39,filedOfView:40,showISSModel:41,solarSystemCMB:42,mpcZone1:43,mpcZone2:44,mpcZone3:45,mpcZone4:46,mpcZone5:47,mpcZone6:48,mpcZone7:49,orbitFilters:50};function SettingParameter(e,t,i,r){this.targetState=!1,this.edgeTrigger=!1,this.opacity=0,this.edgeTrigger=e,this.opacity=t,this.targetState=i,this.filter=r}registerType("StockSkyOverlayTypes",StockSkyOverlayTypes),registerEnum("StockSkyOverlayTypes",StockSkyOverlayTypes);var SettingParameter$={};function Settings(){this.autoRepeatTour=!1,this._localHorizonMode=!1,this._galacticMode=!1,this._constellationBoundryColor="blue",this._constellationSelectionColor="yellow",this._constellationFigureColor="red",this._showConstellationFigures=!0,this._showConstellationBoundries=!0,this._showConstellationSelection=!0,this._showCrosshairs=!0,this._crosshairsColor="white",this._showEcliptic=!1,this._showEclipticCircle=!1,this._locationLat=47.717,this._locationLng=-122.0858,this._locationAltitude=100,this._showFiledOfView=!1,this._actualPlanetScale=!0,this._fovCamera=0,this._fovEyepiece=0,this._fovTelescope=0,this._showClouds=!1,this._showGrid=!1,this._showHorizon=!0,this._showHorizonPanorama=!1,this._showMoonsAsPointSource=!0,this._showSolarSystem=!0,this._solarSystemStars=!0,this._solarSystemMilkyWay=!0,this._solarSystemCosmos=!0,this._solarSystemOrbits=!0,this._solarSystemOverlays=!0,this._solarSystemLighting=!0,this._solarSystemMultiRes=!0,this._solarSystemScale=1,this._smoothPan=!0,this._showElevationModel=!0,this._showEquatorialGridText=!1,this._showGalacticGrid=!1,this._showGalacticGridText=!1,this._showEclipticGrid=!1,this._showEclipticGridText=!1,this._showEclipticOverviewText=!1,this._showAltAzGrid=!1,this._eclipticGridColor=Colors.get_green(),this._galacticGridColor=Colors.get_cyan(),this._altAzGridColor=Colors.get_magenta(),this._precessionChartColor=Colors.get_orange(),this._eclipticColor=Colors.get_blue(),this._equatorialGridColor=Colors.get_white(),this._showAltAzGridText=!1,this._showPrecessionChart=!1,this._showConstellationPictures=!1,this._showConstellationLabels=!1,this._constellationLabelsHeight=80,this._solarSystemCMB=!0,this._solarSystemMinorPlanets=!1,this._solarSystemPlanets=!0,this._showEarthSky=!0,this._solarSystemMinorOrbits=!1,this._constellationsEnabled="",this._constellationFiguresFilter=new ConstellationFilter,this._constellationBoundariesFilter=new ConstellationFilter,this._constellationNamesFilter=new ConstellationFilter,this._constellationArtFilter=new ConstellationFilter,this._showSkyOverlays=!0,this._showConstellations=!0,this._showSkyNode=!0,this._showSkyGrids=!0,this._showSkyOverlaysIn3d=!0,this._earthCutawayView=!1,this._showISSModel=!1,this._milkyWayModel=!1,this._minorPlanetsFilter=255,this._planetOrbitsFilter=2147483647,this._constellations=!0}registerType("SettingParameter",[SettingParameter,SettingParameter$,null]),Settings._active=null,Settings.tourSettings=null,Settings.get_current=function(){return null==Settings._active&&(Settings._active=new Settings),Settings._active},Settings.get_globalSettings=function(){return null==Settings._active&&(Settings._active=new Settings),Settings._active},Settings.get_active=function(){return null==Settings._active&&(Settings._active=new Settings),null!=Settings.tourSettings?Settings.tourSettings:Settings._active};var Settings$={get_constellationFigureColor:function(){return this._constellationFigureColor},set_constellationFigureColor:function(e){return this._constellationFigureColor=e,e},get_constellationBoundryColor:function(){return this._constellationBoundryColor},set_constellationBoundryColor:function(e){return this._constellationBoundryColor=e,e},get_constellationSelectionColor:function(){return this._constellationSelectionColor},set_constellationSelectionColor:function(e){return this._constellationSelectionColor=e,e},get_showCrosshairs:function(){return this._showCrosshairs},set_showCrosshairs:function(e){return this._showCrosshairs=e,e},get_smoothPan:function(){return this._smoothPan},set_smoothPan:function(e){return this._smoothPan=e,e},get_crosshairsColor:function(){return this._crosshairsColor},set_crosshairsColor:function(e){return this._crosshairsColor=e,e},get_actualPlanetScale:function(){return this._actualPlanetScale},set_actualPlanetScale:function(e){return this._actualPlanetScale=e,e},get_fovCamera:function(){return this._fovCamera},get_fovEyepiece:function(){return this._fovEyepiece},get_fovTelescope:function(){return this._fovTelescope},get_locationAltitude:function(){return this._locationAltitude},set_locationAltitude:function(e){return this._locationAltitude=e,e},get_locationLat:function(){return this._locationLat},set_locationLat:function(e){return this._locationLat=e,e},get_locationLng:function(){return this._locationLng},set_locationLng:function(e){return this._locationLng=e,e},get_showClouds:function(){return this._showClouds},get_showConstellationBoundries:function(){return this._showConstellationBoundries},set_showConstellationBoundries:function(e){return this._showConstellationBoundries=e,e},get_showConstellationFigures:function(){return this._showConstellationFigures},set_showConstellationFigures:function(e){return this._showConstellationFigures=e,e},get_showConstellationSelection:function(){return this._showConstellationSelection},set_showConstellationSelection:function(e){return this._showConstellationSelection=e,e},get_showEcliptic:function(){return this._showEcliptic},set_showEcliptic:function(e){return this._showEcliptic=e,e},get_showEclipticCircle:function(){return this._showEclipticCircle},set_showEclipticCircle:function(e){return this._showEclipticCircle=e,e},get_showElevationModel:function(){return this._showElevationModel},set_showElevationModel:function(e){return this._showElevationModel=e,e},get_showFieldOfView:function(){return this._showFiledOfView},get_showGrid:function(){return this._showGrid},set_showGrid:function(e){return this._showGrid=e,e},get_showHorizon:function(){return this._showHorizon},set_showHorizon:function(e){return this._showHorizon=e,e},get_showHorizonPanorama:function(){return this._showHorizonPanorama},get_showMoonsAsPointSource:function(){return this._showMoonsAsPointSource},get_showSolarSystem:function(){return this._showSolarSystem},set_showSolarSystem:function(e){return this._showSolarSystem=e,e},get_localHorizonMode:function(){return this._localHorizonMode},set_localHorizonMode:function(e){return this._localHorizonMode=e,e},get_galacticMode:function(){return this._galacticMode},set_galacticMode:function(e){return this._galacticMode=e,e},get_solarSystemStars:function(){return this._solarSystemStars},set_solarSystemStars:function(e){return this._solarSystemStars=e,e},get_solarSystemMilkyWay:function(){return this._solarSystemMilkyWay},set_solarSystemMilkyWay:function(e){return this._solarSystemMilkyWay=e,e},get_solarSystemCosmos:function(){return this._solarSystemCosmos},set_solarSystemCosmos:function(e){return this._solarSystemCosmos=e,e},get_solarSystemOrbits:function(){return this._solarSystemOrbits},set_solarSystemOrbits:function(e){return this._solarSystemOrbits=e,e},get_solarSystemOverlays:function(){return this._solarSystemOverlays},set_solarSystemOverlays:function(e){return this._solarSystemOverlays=e,e},get_solarSystemLighting:function(){return this._solarSystemLighting},set_solarSystemLighting:function(e){return this._solarSystemLighting=e,e},get_solarSystemMultiRes:function(){return!0},set_solarSystemMultiRes:function(e){return this._solarSystemMultiRes=e,e},get_solarSystemScale:function(){return this._solarSystemScale},set_solarSystemScale:function(e){return this._solarSystemScale=e,e},get_showEquatorialGridText:function(){return this._showEquatorialGridText},set_showEquatorialGridText:function(e){return this._showEquatorialGridText=e,e},get_showGalacticGrid:function(){return this._showGalacticGrid},set_showGalacticGrid:function(e){return this._showGalacticGrid=e,e},get_showGalacticGridText:function(){return this._showGalacticGridText},set_showGalacticGridText:function(e){return this._showGalacticGridText=e,e},get_showEclipticGrid:function(){return this._showEclipticGrid},set_showEclipticGrid:function(e){return this._showEclipticGrid=e,e},get_showEclipticGridText:function(){return this._showEclipticGridText},set_showEclipticGridText:function(e){return this._showEclipticGridText=e,e},get_showEclipticOverviewText:function(){return this._showEclipticOverviewText},set_showEclipticOverviewText:function(e){return this._showEclipticOverviewText=e,e},get_showAltAzGrid:function(){return this._showAltAzGrid},set_showAltAzGrid:function(e){return this._showAltAzGrid=e,e},get_eclipticGridColor:function(){return this._eclipticGridColor},set_eclipticGridColor:function(e){return this._eclipticGridColor=e,e},get_galacticGridColor:function(){return this._galacticGridColor},set_galacticGridColor:function(e){return this._galacticGridColor=e,e},get_altAzGridColor:function(){return this._altAzGridColor},set_altAzGridColor:function(e){return this._altAzGridColor=e,e},get_precessionChartColor:function(){return this._precessionChartColor},set_precessionChartColor:function(e){return this._precessionChartColor=e,e},get_eclipticColor:function(){return this._eclipticColor},set_eclipticColor:function(e){return this._eclipticColor=e,e},get_equatorialGridColor:function(){return this._equatorialGridColor},set_equatorialGridColor:function(e){return this._equatorialGridColor=e,e},get_showAltAzGridText:function(){return this._showAltAzGridText},set_showAltAzGridText:function(e){return this._showAltAzGridText=e,e},get_showPrecessionChart:function(){return this._showPrecessionChart},set_showPrecessionChart:function(e){return this._showPrecessionChart=e,e},get_showConstellationPictures:function(){return this._showConstellationPictures},set_showConstellationPictures:function(e){return this._showConstellationPictures=e,e},get_showConstellationLabels:function(){return this._showConstellationLabels},set_showConstellationLabels:function(e){return this._showConstellationLabels=e,e},get_constellationLabelsHeight:function(){return this._constellationLabelsHeight},set_constellationLabelsHeight:function(e){return this._constellationLabelsHeight=e,e},get_solarSystemCMB:function(){return this._solarSystemCMB},set_solarSystemCMB:function(e){return this._solarSystemCMB=e,e},get_solarSystemMinorPlanets:function(){return this._solarSystemMinorPlanets},set_solarSystemMinorPlanets:function(e){return this._solarSystemMinorPlanets=e,e},get_solarSystemPlanets:function(){return this._solarSystemPlanets},set_solarSystemPlanets:function(e){return this._solarSystemPlanets=e,e},get_showEarthSky:function(){return this._showEarthSky},set_showEarthSky:function(e){return this._showEarthSky=e,e},get_solarSystemMinorOrbits:function(){return this._solarSystemMinorOrbits},set_solarSystemMinorOrbits:function(e){return this._solarSystemMinorOrbits=e,e},get_constellationsEnabled:function(){return this._constellationsEnabled},set_constellationsEnabled:function(e){return this._constellationsEnabled=e,e},get_constellationFiguresFilter:function(){return this._constellationFiguresFilter},set_constellationFiguresFilter:function(e){return this._constellationFiguresFilter=e,e},get_constellationBoundariesFilter:function(){return this._constellationBoundariesFilter},set_constellationBoundariesFilter:function(e){return this._constellationBoundariesFilter=e,e},get_constellationNamesFilter:function(){return this._constellationNamesFilter},set_constellationNamesFilter:function(e){return this._constellationNamesFilter=e,e},get_constellationArtFilter:function(){return this._constellationArtFilter},set_constellationArtFilter:function(e){return this._constellationArtFilter=e,e},get_showSkyOverlays:function(){return this._showSkyOverlays},set_showSkyOverlays:function(e){return this._showSkyOverlays=e,e},get_showConstellations:function(){return this._showConstellations},set_showConstellations:function(e){return this._showConstellations=e,e},get_showSkyNode:function(){return this._showSkyNode},set_showSkyNode:function(e){return this._showSkyNode=e,e},get_showSkyGrids:function(){return this._showSkyGrids},set_showSkyGrids:function(e){return this._showSkyGrids=e,e},get_showSkyOverlaysIn3d:function(){return this._showSkyOverlaysIn3d},set_showSkyOverlaysIn3d:function(e){return this._showSkyOverlaysIn3d=e,e},get_earthCutawayView:function(){return this._earthCutawayView},set_earthCutawayView:function(e){return this._earthCutawayView=e,e},get_showISSModel:function(){return this._showISSModel},set_showISSModel:function(e){return this._showISSModel=e,e},get_milkyWayModel:function(){return this._milkyWayModel},set_milkyWayModel:function(e){return this._milkyWayModel=e,e},get_minorPlanetsFilter:function(){return this._minorPlanetsFilter},set_minorPlanetsFilter:function(e){return this._minorPlanetsFilter=e,e},get_planetOrbitsFilter:function(){return this._planetOrbitsFilter},set_planetOrbitsFilter:function(e){return this._planetOrbitsFilter=e,e},get_constellations:function(){return this._constellations},set_constellations:function(e){return this._constellations=e,e},getSetting:function(e){return 17===e?new SettingParameter(!0,0,!1,null):new SettingParameter(!1,1,!1,null)}};registerType("Settings",[Settings,Settings$,null,ISettings]);var TextBorderStyle={none:0,tight:1,small:2,medium:3,large:4};function TextObject(){this.bold=!1,this.italic=!1,this.underline=!1,this.fontSize=0,this.borderStyle=0}registerType("TextBorderStyle",TextBorderStyle),registerEnum("TextBorderStyle",TextBorderStyle),TextObject.create=function(e,t,i,r,n,s,a,o,l){var h=new TextObject;return h.text=e,h.bold=t,h.italic=i,h.underline=r,h.fontSize=n,h.fontName=s,h.foregroundColor=a,h.backgroundColor=o,h.borderStyle=l,h},TextObject._fromXml=function(e){var t=new TextObject;return t.text=Util.getInnerText(e),t.borderStyle=0,t.bold=ss.ss.boolean(e.attributes.getNamedItem("Bold").nodeValue),t.italic=ss.ss.boolean(e.attributes.getNamedItem("Italic").nodeValue),t.underline=ss.ss.boolean(e.attributes.getNamedItem("Underline").nodeValue),t.fontSize=parseFloat(e.attributes.getNamedItem("FontSize").nodeValue),t.fontName=e.attributes.getNamedItem("FontName").nodeValue,t.foregroundColor=Color.load(e.attributes.getNamedItem("ForgroundColor").nodeValue),t.backgroundColor=Color.load(e.attributes.getNamedItem("BackgroundColor").nodeValue),null!=e.attributes.getNamedItem("BorderStyle")&&(t.borderStyle=Enums.parse("TextBorderStyle",e.attributes.getNamedItem("BorderStyle").nodeValue)),t};var TextObject$={toString:function(){return this.text},_saveToXml:function(e){e._writeStartElement("TextObject"),e._writeAttributeString("Bold",this.bold.toString()),e._writeAttributeString("Italic",this.italic.toString()),e._writeAttributeString("Underline",this.underline.toString()),e._writeAttributeString("FontSize",this.fontSize.toString()),e._writeAttributeString("FontName",this.fontName),e._writeAttributeString("ForgroundColor",this.foregroundColor.save()),e._writeAttributeString("BackgroundColor",this.backgroundColor.save()),e._writeAttributeString("BorderStyle",Enums.toXml("TextBorderStyle",this.borderStyle)),e._writeString(this.text),e._writeEndElement()}};registerType("TextObject",[TextObject,TextObject$,null]);var Alignment={center:0,left:1};function Text3dBatch(e){this.height=128,this.items=[],this._glyphVersion=-1,this.viewTransform=Matrix3d.get_identity(),this._textObject=new TextObject,this._vertCount=0,this.height=3*e}registerType("Alignment",Alignment),registerEnum("Alignment",Alignment);var Text3dBatch$={add:function(e){this.items.push(e)},draw:function(e,t,i){if(null==e.gl)for(var r=Vector3d._transformCoordinate(e.get_viewPoint(),this.viewTransform),n=this.height/e.get_fovAngle()*e.height/180,s=ss.ss.enumerate(this.items);s.moveNext();){var a=s.current,o=e.WVP.transform(a.center);if(!(o.z<0||Vector3d.dot(r,a.center)<.55)){var l=e.WVP.transform(a.top),h=Math.atan2(o.x-l.x,o.y-l.y),c=e.device;c.save(),c.translate(o.x,o.y),c.rotate(-h),c.globalAlpha=t,c.fillStyle=i.toString(),c.font="normal normal "+Math.round(1.2*n).toString()+"px Arial",c.textBaseline="top";var u=c.measureText(a.text);c.fillText(a.text,-u.width/2,-n/2),c.restore()}}else{if((null==this._glyphCache||this._glyphCache.get_version()>this._glyphVersion)&&this.prepareBatch(),!this._glyphCache.ready)return;TextShader.use(e,this._vertexBuffer.vertexBuffer,this._glyphCache.get_texture().texture2d),e.gl.drawArrays(WEBGL.TRIANGLES,0,this._vertexBuffer.count)}},prepareBatch:function(){if(null==this._glyphCache&&(this._glyphCache=GlyphCache.getCache(this.height)),this._glyphCache.ready){this._textObject.text="",this._textObject.fontSize=.5*this.height;for(var e=[],t=ss.ss.enumerate(this.items);t.moveNext();){for(var i=t.current,r=i.text,n=0,s=this._textObject.fontSize/128,a=.6666,o=0,l=0,h=0;h<r.length;h++)null!=(d=this._glyphCache.getGlyphItem(r.substr(h,1)))&&(o+=d.extents.x,l=Math.max(d.extents.y,l));var c=Vector2d.create(o,l);i.width=c.x*i.scale*a*s,i.height=c.y*i.scale*a*s;var u=r.length;for(h=0;h<u;h++){var d;if(null!=(d=this._glyphCache.getGlyphItem(r.substr(h,1)))){var _=Rectangle.create(n*i.scale*a,0*i.scale*a,d.extents.x*s*i.scale*a,d.extents.y*s*i.scale*a);n+=d.extents.x*s,i.addGlyphPoints(e,d.size,_,d.uvRect)}}}this._vertCount=e.length,this._vertexBuffer=new PositionTextureVertexBuffer(this._vertCount);var g=this._vertexBuffer.lock();for(h=0;h<this._vertCount;h++)g[h]=e[h];this._vertexBuffer.unlock(),this._glyphVersion=this._glyphCache.get_version()}},cleanUp:function(){null!=this._vertexBuffer&&(this._vertexBuffer=null),this.items.length=0}};function GlyphItem(e){this.referenceCount=0,this.glyph=e,this.uvRect=new Rectangle,this.size=new Vector2d,this.referenceCount=1}registerType("Text3dBatch",[Text3dBatch,Text3dBatch$,null]),GlyphItem.create=function(e,t,i,r){var n=new GlyphItem(e);return n.glyph=e,n.uvRect=t,n.size=i,n.extents=r,n.referenceCount=1,n},GlyphItem._fromXML=function(e){var t=new GlyphItem(e.attributes.getNamedItem("Glyph").nodeValue);return t.uvRect=Rectangle.create(parseFloat(e.attributes.getNamedItem("UVLeft").nodeValue),parseFloat(e.attributes.getNamedItem("UVTop").nodeValue),parseFloat(e.attributes.getNamedItem("UVWidth").nodeValue),parseFloat(e.attributes.getNamedItem("UVHeight").nodeValue)),t.size=Vector2d.create(parseFloat(e.attributes.getNamedItem("SizeWidth").nodeValue),parseFloat(e.attributes.getNamedItem("SizeHeight").nodeValue)),t.extents=Vector2d.create(parseFloat(e.attributes.getNamedItem("ExtentsWidth").nodeValue),parseFloat(e.attributes.getNamedItem("ExtentsHeight").nodeValue)),t};var GlyphItem$={addRef:function(){this.referenceCount++},release:function(){this.referenceCount--}};function GlyphCache(e){this._cellHeight=128,this._gridSize=8,this.ready=!1,this._glyphItems={},this.textObject=new TextObject,this._dirty=!0,this._textureDirty=!0,this._version=0,this._cellHeight=e,this._texture=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("glyphs1.png")),this._webFile=new WebFile(URLHelpers.singleton.engineAssetUrl("glyphs1.xml")),this._webFile.onStateChange=ss.ss.bind("_glyphXmlReady",this),this._webFile.send()}registerType("GlyphItem",[GlyphItem,GlyphItem$,null]),GlyphCache._caches={},GlyphCache._allGlyphs="",GlyphCache.getCache=function(e){return ss.ss.keyExists(GlyphCache._caches,e)||(GlyphCache._caches[e]=new GlyphCache(e)),GlyphCache._caches[e]},GlyphCache.cleanUpAll=function(){ss.ss.clearKeys(GlyphCache._caches)};var GlyphCache$={get_height:function(){return this._cellHeight},_glyphXmlReady:function(){2===this._webFile.get_state()?alert(this._webFile.get_message()):1===this._webFile.get_state()&&this._loadXmlGlyph(this._webFile.getXml())},_loadXmlGlyph:function(e){for(var t=Util.selectSingleNode(e,"GlyphItems"),i=ss.ss.enumerate(t.childNodes);i.moveNext();){var r=i.current;if("GlyphItem"===r.nodeName){var n=GlyphItem._fromXML(r);this._glyphItems[n.glyph]=n,GlyphCache._allGlyphs=GlyphCache._allGlyphs+n.glyph}}this.ready=!0},get_texture:function(){return this._texture},_makeTexture:function(){this._calcOrMake(!0)},getGlyphItem:function(e){return this._dirty&&this._calculateGlyphDetails(),this._glyphItems[e]},_calculateGlyphDetails:function(){this._calcOrMake(!1)},_calcOrMake:function(e){},get_version:function(){return this._version},set_version:function(e){return this._version=e,e},addGlyph:function(e){if(ss.ss.keyExists(this._glyphItems,e))this._glyphItems[e].addRef();else{var t=new GlyphItem(e);this._glyphItems[e]=t,this._dirty=!0,this._textureDirty=!0,this._version++,GlyphCache._allGlyphs=GlyphCache._allGlyphs+e}},cleanUp:function(){this._dirty=!0,this._texture=null},dispose:function(){this.cleanUp()},get_dirty:function(){return this._dirty},set_dirty:function(e){return this._dirty=e,e}};function Text3d(e,t,i,r,n){this.rotation=0,this.tilt=0,this.bank=0,this._matInit=!1,this.color=Colors.get_white(),this.sky=!0,this.scale=0,this.opacity=1,this.text="",this.width=1,this.height=1,this.alignment=0,this.text=i,this.up=t,this.center=e,this.scale=n,this.top=Vector3d.addVectors(e,Vector3d.scale(t,n)),r<0&&(this.sky=!1)}registerType("GlyphCache",[GlyphCache,GlyphCache$,null,ss.ss.IDisposable]);var Text3d$={addGlyphPoints:function(e,t,i,r){for(var n=new Array(6),s=0;s<6;s++)n[s]=new PositionTexture;var a=Vector3d.cross(this.center,this.up),o=Vector3d.cross(this.up,this.center);a.normalize(),o.normalize(),this.up.normalize();var l=Vector3d.cross(this.center,o);l.normalize(),this.alignment?1===this.alignment&&(a.multiply(2*-i.get_left()),o.multiply(2*i.get_right())):(a.multiply(this.width-2*i.get_left()),o.multiply(this.width-(2*this.width-2*i.get_right())));var h=l.copy(),c=Vector3d.subtractVectors(Vector3d.get_empty(),l);h.multiply(this.height-2*i.get_top()),c.multiply(this.height-(2*this.height-2*i.get_bottom()));var u=this.center.copy();u.add(h),this.sky?u.add(a):u.subtract(a);var d=this.center.copy();d.add(h),this.sky?d.add(o):d.subtract(o);var _=this.center.copy();this.sky?_.add(a):_.subtract(a),_.add(c);var g=this.center.copy();if(this.sky?g.add(o):g.subtract(o),g.add(c),n[0].position=u.copy(),n[0].tu=r.get_left(),n[0].tv=r.get_top(),n[2].tu=r.get_left(),n[2].tv=r.get_bottom(),n[2].position=_.copy(),n[1].tu=r.get_right(),n[1].tv=r.get_top(),n[1].position=d.copy(),n[3].tu=r.get_right(),n[3].tv=r.get_bottom(),n[3].position=g.copy(),n[5].tu=r.get_right(),n[5].tv=r.get_top(),n[5].position=d.copy(),n[4].tu=r.get_left(),n[4].tv=r.get_bottom(),n[4].position=_.copy(),this.rotation||this.tilt||this.bank){if(!this._matInit){var f=Matrix3d.lookAtLH(this.center,new Vector3d,this.up),m=f.clone();m.invert(),this._rtbMat=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(f,Matrix3d._rotationZ(-this.rotation/180*Math.PI)),Matrix3d._rotationX(-this.tilt/180*Math.PI)),Matrix3d._rotationY(-this.bank/180*Math.PI)),m),this._matInit=!0}for(s=0;s<6;s++)n[s].position=Vector3d._transformCoordinate(n[s].position,this._rtbMat)}for(var p=ss.ss.enumerate(n);p.moveNext();){var C=p.current;e.push(C)}}};registerType("Text3d",[Text3d,Text3d$,null]);var PointType={move:0,line:1,dash:2,start:3};function Lineset(e){this._name=e,this.points=[]}registerType("PointType",PointType),registerEnum("PointType",PointType);var Lineset$={get_name:function(){return this._name},set_name:function(e){return this._name=e,e},add:function(e,t,i,r){this.points.push(new Linepoint(e,t,i,r))}};function Linepoint(e,t,i,r){this.RA=0,this.dec=0,this.pointType=0,this.name=null,this.RA=e,this.dec=t,this.pointType=i,this.name=r}registerType("Lineset",[Lineset,Lineset$,null]);var Linepoint$={toString:function(){return ss.ss.emptyString(this.name)?Coordinates.formatDMS((this.RA/360*24+12)%24)+", "+Coordinates.formatDMS(this.dec)+", "+this.pointType.toString():this.name+", "+this.pointType.toString()}};function Constellations(){this._pointCount=0,this._boundry=!1,this._noInterpollation=!1,this.readOnly=!1,this.radius=1,this._drawCount=0,this._constellationVertexBuffers={}}registerType("Linepoint",[Linepoint,Linepoint$,null]),Constellations.RC=.017453292519943,Constellations._maxSeperation=.745,Constellations.containment=null,Constellations._constToDraw="",Constellations.selectedSegment=null,Constellations._artFile=null,Constellations.artwork=null,Constellations.boundries=null,Constellations.pictureBlendStates={},Constellations.createBasic=function(e){var t=new Constellations;t._name=e,t._url=null,t.lines=[];for(var i=ss.ss.enumerate(ss.ss.keys(Constellations.fullNames));i.moveNext();){var r=i.current;t.lines.push(new Lineset(r))}return t},Constellations.create=function(e,t,i,r,n){var s=new Constellations;return s._noInterpollation=r,s._boundry=i,s._name=e,s._url=t,s.getFile(),s},Constellations.drawConstellationNames=function(e,t,i){null==Constellations._namesBatch&&(Constellations.initializeConstellationNames(),null==Constellations._namesBatch)||Constellations._namesBatch.draw(e,t,i)},Constellations.initializeConstellationNames=function(){if(null!=Constellations.constellationCentroids){Constellations._namesBatch=new Text3dBatch(Settings.get_active().get_constellationLabelsHeight());for(var e=ss.ss.enumerate(ss.ss.keys(Constellations.constellationCentroids));e.moveNext();){var t=e.current,i=Constellations.constellationCentroids[t],r=Coordinates.raDecTo3dAu(i.get_RA(),i.get_dec(),1),n=Vector3d.create(0,1,0),s=i.get_name();"Triangulum Australe"===i.get_name()&&(s=ss.ss.replaceString(s," ","\n   ")),Constellations._namesBatch.add(new Text3d(r,n,s,Settings.get_active().get_constellationLabelsHeight(),125e-6))}}},Constellations.drawArtwork=function(e){if(null!=Constellations.artwork){Constellations._maxSeperation=Math.max(.5,Math.cos(2*e.get_fovAngle()/180*Math.PI));for(var t=ss.ss.enumerate(Constellations.artwork);t.moveNext();){var i=t.current,r=Constellations.pictureBlendStates[i.get_constellation()];if(r.set_targetState(Settings.get_active().get_constellationArtFilter().isSet(i.get_constellation())),r.get_state()){var n=Constellations.constellationCentroids[i.get_constellation()];if(null!=n){var s=Coordinates.raDecTo3d(n.get_RA(),n.get_dec());Vector3d.dot(e.get_viewPoint(),s)>Constellations._maxSeperation&&e.drawImageSet(i.get_studyImageset(),100)}}}}else null==Constellations._artFile&&(Constellations._artFile=makeNewFolder(),Constellations._artFile.loadFromUrl(URLHelpers.singleton.coreStaticUrl("wwtweb/catalog.aspx?W=hevelius"),Constellations._onArtReady))},Constellations._onArtReady=function(){Constellations._artFile.childLoadCallback(Constellations._loadArtList)},Constellations._loadArtList=function(){Constellations.artwork=Constellations._artFile.get_places()},Constellations.initializeConstellations=function(){if(null==Constellations.containment){var e=URLHelpers.singleton.engineAssetUrl("ConstellationNamePositions_EN.txt");Constellations._webFileConstNames=new WebFile(e),Constellations._webFileConstNames.onStateChange=Constellations._loadNames,Constellations._webFileConstNames.send(),Constellations.containment=Constellations.create("Constellations",URLHelpers.singleton.engineAssetUrl("constellations.txt"),!0,!0,!0)}},Constellations._loadNames=function(){2===Constellations._webFileConstNames.get_state()?alert(Constellations._webFileConstNames.get_message()):1===Constellations._webFileConstNames.get_state()&&Constellations._centroidsReady(Constellations._webFileConstNames.getText())},Constellations._centroidsReady=function(e){Constellations.constellationCentroids={},Constellations.fullNames={},Constellations.abbreviations={};for(var t=e.split("\r\n"),i=0,r=ss.ss.enumerate(t);r.moveNext();){var n=r.current.split(",");Constellations.fullNames[n[1]]=n[0],Constellations.abbreviations[n[0]]=n[1],ConstellationFilter.bitIDs[n[1]]=i++,Constellations.pictureBlendStates[n[1]]=BlendState.create(!0,1e3),Constellations.constellationCentroids[n[1]]=createPlace(n[0],parseFloat(n[3]),parseFloat(n[2]),128,n[1],2,360)}ConstellationFilter.buildConstellationFilters()},Constellations.fullName=function(e){return ss.ss.keyExists(Constellations.fullNames,e)?Constellations.fullNames[e]:e},Constellations.abbreviation=function(e){return null!=Constellations.abbreviations&&!ss.ss.emptyString(e)&&ss.ss.keyExists(Constellations.abbreviations,e)?Constellations.abbreviations[e]:e};var Constellations$={get_name:function(){return this._name},set_name:function(e){return this._name=e,e},getFile:function(){this._webFile=new WebFile(this._url),this._webFile.onStateChange=ss.ss.bind("fileStateChange",this),this._webFile.send()},fileStateChange:function(){2===this._webFile.get_state()?alert(this._webFile.get_message()):1===this._webFile.get_state()&&this._loadConstellationData(this._webFile.getText())},_loadConstellationData:function(e){this._boundry&&!this._noInterpollation&&(Constellations.boundries={}),this.lines=[];var t=null;try{for(var i,r,n,s=e.split("\r\n"),a="",o=0,l=0,h=ss.ss.enumerate(s);h.moveNext();){var c=h.current;if("- "===c.substr(11,2)&&(c=c.substr(0,11)+" -"+c.substr(13,c.length-13)),"+ "===c.substr(11,2)&&(c=c.substr(0,11)+" +"+c.substr(13,c.length-13)),n=parseFloat(c.substr(11,10)),this._noInterpollation,r=parseFloat(c.substr(0,10)),i=ss.ss.trim(c.substr(23,4)),this._boundry){if(this._noInterpollation&&"O"!==c.substr(28,1))continue}else ss.ss.trim(c.substr(28,1))&&(l=parseInt(c.substr(28,1)));i!==a&&(l=3,t=new Lineset(i),this.lines.push(t),this._boundry&&!this._noInterpollation&&(Constellations.boundries[i]=t),a=i,o=0),this._noInterpollation&&(Math.abs(r-o)>12&&(r-=24*(r-o<0?-1:1)),o=r);var u=null;c.length>30&&(u=ss.ss.trim(c.substr(30))),null!=u&&"Empty"===u||t.add(r,n,l,u),this._pointCount++,l=1}}catch(e){}},draw:function(e,t,i,r){Constellations._maxSeperation=Math.max(.6,Math.cos(2*e.get_fovAngle()/180*Math.PI)),this._drawCount=0;var n=null;if(null!=this.lines&&null!=Constellations.constellationCentroids){Constellations._constToDraw=i;for(var s=ss.ss.enumerate(this.lines);s.moveNext();){var a=s.current;Constellations._constToDraw===a.get_name()&&this._boundry?n=a:t&&this._boundry||this._drawSingleConstellation(e,a,1)}null!=n&&this._drawSingleConstellation(e,n,1)}},_drawSingleConstellation:function(e,t,i){var r=Constellations.constellationCentroids[t.get_name()];if(null!=r){var n=Coordinates.raDecTo3d(r.get_RA(),r.get_dec());if(Vector3d.dot(e.get_viewPoint(),n)<Constellations._maxSeperation)return}if(!ss.ss.keyExists(this._constellationVertexBuffers,t.get_name())){var s=t.points.length,a=new SimpleLineList;a.set_depthBuffered(!1),this._constellationVertexBuffers[t.get_name()]=a;for(var o,l=new Vector3d,h=0;h<s;h++)t.points[h].pointType&&h?(o=Coordinates.raDecTo3d(t.points[h].RA,t.points[h].dec),a.addLine(l,o),l=o):l=Coordinates.raDecTo3d(t.points[h].RA,t.points[h].dec);this._boundry&&(o=Coordinates.raDecTo3d(t.points[0].RA,t.points[0].dec),a.addLine(l,o))}var c;c=this._boundry?Constellations._constToDraw!==t.get_name()?Settings.get_globalSettings().get_constellationBoundryColor():Settings.get_globalSettings().get_constellationSelectionColor():Settings.get_globalSettings().get_constellationFigureColor(),this._constellationVertexBuffers[t.get_name()].drawLines(e,i,Color.load(c))},_drawSingleConstellationOld:function(e,t){var i,r=Constellations.constellationCentroids[t.get_name()];if(null!=r){var n=Coordinates.raDecTo3d(r.get_RA(),r.get_dec());if(Vector3d.dot(e.get_viewPoint(),n)<Constellations._maxSeperation)return}if(this._drawCount++,i=this._boundry?Constellations._constToDraw!==t.get_name()?Settings.get_globalSettings().get_constellationBoundryColor():Settings.get_globalSettings().get_constellationSelectionColor():Settings.get_globalSettings().get_constellationFigureColor(),null==e.gl){var s=e.device,a=t.points.length,o=new Vector3d;s.save();var l=!1;s.beginPath(),s.strokeStyle=i,s.lineWidth=2,s.globalAlpha=.25;for(var h=0;h<a;h++)if(t.points[h].pointType&&h){var c=e.WVP.transform(Coordinates.raDecTo3d(t.points[h].RA,t.points[h].dec));s.lineTo(c.x,c.y),l=!0}else l&&s.stroke(),o=e.WVP.transform(Coordinates.raDecTo3d(t.points[h].RA,t.points[h].dec)),s.moveTo(o.x,o.y);this._boundry&&s.closePath(),s.stroke(),s.restore()}},findConstellationForPoint:function(e,t){if(t>88.402||null==this.lines)return"UMI";for(var i=ss.ss.enumerate(this.lines);i.moveNext();){var r,n,s=i.current,a=s.points.length,o=!1;for(r=0,n=a-1;r<a;n=r++)(s.points[r].dec<=t&&t<s.points[n].dec||s.points[n].dec<=t&&t<s.points[r].dec)&&e<(s.points[n].RA-s.points[r].RA)*(t-s.points[r].dec)/(s.points[n].dec-s.points[r].dec)+s.points[r].RA&&(o=!o);if(o)return s.get_name()}return e>0?this.findConstellationForPoint(e-24,t):t>65.5?"UMI":t<-65.5?"OCT":"Error"}};function SpaceTimeController(){}registerType("Constellations",[Constellations,Constellations$,null]),SpaceTimeController.framesPerSecond=30,SpaceTimeController.frameDumping=!1,SpaceTimeController.cancelFrameDump=!1,SpaceTimeController.currentFrameNumber=0,SpaceTimeController.totalFrames=0,SpaceTimeController._offset=0,SpaceTimeController._syncToClock=!0,SpaceTimeController._timeRate=1,SpaceTimeController._altitude=0,SpaceTimeController.updateClock=function(){if(SpaceTimeController._syncToClock){var e=SpaceTimeController.get_metaNow();if(1!==SpaceTimeController._timeRate){var t=(e.getTime()-SpaceTimeController.last.getTime())*(SpaceTimeController._timeRate-1);SpaceTimeController._offset+=t}SpaceTimeController.last=e;try{SpaceTimeController._now=new Date(e.getTime()+SpaceTimeController._offset)}catch(e){SpaceTimeController._now=new Date(1,12,25,23,59,59),SpaceTimeController._offset=SpaceTimeController._now-SpaceTimeController.get_metaNow()}SpaceTimeController._now.getFullYear()>4e3&&(SpaceTimeController._now=new Date(4e3,12,31,23,59,59),SpaceTimeController._offset=SpaceTimeController._now-SpaceTimeController.get_metaNow()),SpaceTimeController._now.getFullYear()<1&&(SpaceTimeController._now=new Date(0,12,25,23,59,59),SpaceTimeController._offset=SpaceTimeController._now-SpaceTimeController.get_metaNow())}},SpaceTimeController.getTimeForFutureTime=function(e){try{return SpaceTimeController._syncToClock?new Date(SpaceTimeController.get_now().getTime()+1e3*e*SpaceTimeController._timeRate):SpaceTimeController.get_now()}catch(e){return SpaceTimeController.get_now()}},SpaceTimeController.getJNowForFutureTime=function(e){try{if(SpaceTimeController._syncToClock){var t=new Date(SpaceTimeController.get_now().getTime()+ss.ss.truncate(1e3*e*SpaceTimeController._timeRate));return SpaceTimeController.utcToJulian(t)}return SpaceTimeController.utcToJulian(SpaceTimeController.get_now())}catch(e){return SpaceTimeController.utcToJulian(SpaceTimeController.get_now())}},SpaceTimeController.get_now=function(){return SpaceTimeController._now},SpaceTimeController.set_now=function(e){return SpaceTimeController._now=e,SpaceTimeController._offset=SpaceTimeController._now-SpaceTimeController.get_metaNow(),SpaceTimeController.last=SpaceTimeController.get_metaNow(),e},SpaceTimeController.get_metaNow=function(){return SpaceTimeController._metaNow},SpaceTimeController.set_metaNow=function(e){return SpaceTimeController.frameDumping||(SpaceTimeController._metaNow=e),e},SpaceTimeController.nextFrame=function(){SpaceTimeController._metaNow.setMilliseconds(SpaceTimeController._metaNow.getMilliseconds()+Math.round(1e3/SpaceTimeController.framesPerSecond)),SpaceTimeController.currentFrameNumber+=1},SpaceTimeController.get_doneDumping=function(){return!SpaceTimeController.frameDumping||SpaceTimeController.cancelFrameDump||SpaceTimeController.currentFrameNumber>=SpaceTimeController.totalFrames},SpaceTimeController.syncTime=function(){SpaceTimeController._offset=0,SpaceTimeController._now=ss.ss.now(),SpaceTimeController._syncToClock=!0},SpaceTimeController.get_jNow=function(){return SpaceTimeController.utcToJulian(SpaceTimeController.get_now())},SpaceTimeController.get_syncToClock=function(){return SpaceTimeController._syncToClock},SpaceTimeController.set_syncToClock=function(e){return SpaceTimeController._syncToClock!==e&&(SpaceTimeController._syncToClock=e,e?(SpaceTimeController.last=ss.ss.now(),SpaceTimeController._offset=SpaceTimeController._now-ss.ss.now()):SpaceTimeController._now=new Date(ss.ss.now().getTime()+SpaceTimeController._offset)),e},SpaceTimeController.get_timeRate=function(){return SpaceTimeController._timeRate},SpaceTimeController.set_timeRate=function(e){return SpaceTimeController._timeRate=e,e},SpaceTimeController.get_altitude=function(){return SpaceTimeController._altitude},SpaceTimeController.set_altitude=function(e){return SpaceTimeController._altitude=e,e},SpaceTimeController.get_location=function(){return SpaceTimeController._location=Coordinates.fromLatLng(Settings.get_active().get_locationLat(),Settings.get_active().get_locationLng()),SpaceTimeController._altitude=Settings.get_active().get_locationAltitude(),SpaceTimeController._location},SpaceTimeController.set_location=function(e){return Settings.get_globalSettings().get_locationLat()!==e.get_lat()&&Settings.get_globalSettings().set_locationLat(e.get_lat()),Settings.get_globalSettings().get_locationLng()!==e.get_lng()&&Settings.get_globalSettings().set_locationLng(e.get_lng()),SpaceTimeController._location=e,e},SpaceTimeController.julianToUtc=function(e){var t=new DT;t.setJD(e,!0);var i=1e3*(t.second()-ss.ss.truncate(t.second()));return new Date(t.year(),t.month()-1,t.day(),t.hour(),t.minute(),ss.ss.truncate(t.second()),ss.ss.truncate(i))},SpaceTimeController._twoLineDateToJulian=function(e){var t=parseInt(e.substring(0,1))<6,i=parseInt((t?" 20":"19")+e.substring(0,2)),r=parseFloat(e.substring(2,3)),n=parseFloat(e.substr(5)),s=new Date(i,0,1,0,0);return SpaceTimeController.utcToJulian(s)+(r-1+n)},SpaceTimeController.julianToTwoLineDate=function(e){return SpaceTimeController.dateToTwoLineDate(SpaceTimeController.julianToUtc(e))},SpaceTimeController.dateToTwoLineDate=function(e){var t=new ss.ss.StringBuilder;t.append(e.getFullYear()%100);var i=new Date(e.getFullYear(),0,1,0,0),r=Math.floor((e-i)/864e5)+2+e.getHours()/24+e.getMinutes()/60/24+e.getSeconds()/60/60/24+e.getMilliseconds()/1e3/60/60/24,n=SpaceTimeController.tleDayString(r);return t.append(n),t.toString()},SpaceTimeController.tleDayString=function(e){var t=e.toString(),i=t.indexOf(".");-1===i&&(i=t.length,t+=".0");var r=t.length-i-1,n="00000000";return n.substr(0,3-i)+t+n.substr(0,8-r)},SpaceTimeController.utcToJulian=function(e){var t=e.getUTCFullYear(),i=e.getUTCMonth()+1,r=e.getUTCDate()+e.getUTCHours()/24+e.getUTCMinutes()/1440+(e.getUTCSeconds()+e.getUTCMilliseconds()/1e3)/86400;return AstroCalc.getJulianDay(t,i,r)},SpaceTimeController.dateToJD=function(e,t,i,r){var n=e,s=t;s<3&&(n-=1,s+=12);var a=0,o=0;return r&&(o=2-(a=ss.ss.truncate(n/100))+ss.ss.truncate(a/4)),ss.ss.truncate(365.25*(n+4716))+ss.ss.truncate(30.6001*(s+1))+i+o-1524.5};var SpaceTimeController$={};function Sprite2d(){this.vertCount=0}registerType("SpaceTimeController",[SpaceTimeController,SpaceTimeController$,null]);var Sprite2d$={draw:function(e,t,i,r,n,s){null==this.vertexBuffer?this.create(t):this.update(t),null==r?(ShapeSpriteShader.use(e,this.vertexBuffer),e.gl.drawArrays(n?WEBGL.TRIANGLE_STRIP:WEBGL.TRIANGLES,0,t.length)):(SpriteShader.use(e,this.vertexBuffer,null!=r?r.texture2d:null),e.gl.drawArrays(n?WEBGL.TRIANGLE_STRIP:WEBGL.TRIANGLES,0,t.length))},create:function(e){this.vertexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var t=new Float32Array(9*e.length),i=t,r=0,n=ss.ss.enumerate(e);n.moveNext();){var s=n.current;i[r++]=s.position.x,i[r++]=s.position.y,i[r++]=s.position.z,i[r++]=s.color.r/255,i[r++]=s.color.g/255,i[r++]=s.color.b/255,i[r++]=s.color.a/255,i[r++]=s.tu,i[r++]=s.tv}tilePrepDevice.bufferData(WEBGL.ARRAY_BUFFER,t,WEBGL.DYNAMIC_DRAW)},update:function(e){if(this.vertCount<e.length)return tilePrepDevice.deleteBuffer(this.vertexBuffer),void this.create(e);tilePrepDevice.bindBuffer(WEBGL.ARRAY_BUFFER,this.vertexBuffer);for(var t=new Float32Array(9*e.length),i=t,r=0,n=ss.ss.enumerate(e);n.moveNext();){var s=n.current;i[r++]=s.position.x,i[r++]=s.position.y,i[r++]=s.position.z,i[r++]=s.color.r/255,i[r++]=s.color.g/255,i[r++]=s.color.b/255,i[r++]=s.color.a/255,i[r++]=s.tu,i[r++]=s.tv}tilePrepDevice.bufferSubData(WEBGL.ARRAY_BUFFER,0,t)}};function KeplerianElements(){this.a=0,this.e=0,this.ea=0}registerType("Sprite2d",[Sprite2d,Sprite2d$,null]);var KeplerianElements$={};function BodyAngles(e,t,i,r){this.poleDec=0,this.poleRa=0,this.primeMeridian=0,this.rotationRate=0,this.poleDec=t,this.poleRa=e,this.primeMeridian=i,this.rotationRate=r}registerType("KeplerianElements",[KeplerianElements,KeplerianElements$,null]);var BodyAngles$={};function Planets(){}registerType("BodyAngles",[BodyAngles,BodyAngles$,null]),Planets.RC=Math.PI/180,Planets._jNow=0,Planets._planetAngles=[new BodyAngles(286.13,63.87,84.176,14.1844),new BodyAngles(281.0097,61.4143,329.548,6.1385025),new BodyAngles(272.76,67.16,160.2,-1.4813688),new BodyAngles(317.68143,52.8865,176.63,350.89198226),new BodyAngles(268.056595,64.495303,284.95,870.536),new BodyAngles(40.589,83.537,38.9,810.7939024),new BodyAngles(257.311,-15.175,203.81,501.1600928),new BodyAngles(299.36,43.46,253.18,536.3128492),new BodyAngles(132.993,-6.163,302.695,56.3625225),new BodyAngles(269.9949,66.5392,38.3213,13.17635815),new BodyAngles(268.05,64.5,200.39,203.4889538),new BodyAngles(268.08,64.51,36.022,101.3747235),new BodyAngles(268.2,64.57,44.064,50.3176081),new BodyAngles(268.72,64.83,259.51,21.5710715),new BodyAngles(0,0,0,0),new BodyAngles(0,0,0,0),new BodyAngles(0,0,0,0),new BodyAngles(0,0,0,0),new BodyAngles(0,0,0,0),new BodyAngles(0,90,190.147,360.9856235)],Planets._lastPlanetCenterID=-2,Planets._orbitalSampleRate=256,Planets._obliquity=23.5*Planets.RC,Planets._drawOrder={},Planets.earthMatrix=new Matrix3d,Planets.earthMatrixInv=new Matrix3d,Planets._lastUpdate=new Date,Planets._planetSprite=new Sprite2d,Planets._planetPoints=null,Planets._planet3dLocations=null,Planets.loadPlanetTexture=function(e){var t=new Texture;return t.load(e),t},Planets.getPlanet3dLocation=function(e){try{if(e<21)return Planets._planet3dLocations[e].copy()}catch(e){}return Vector3d.create(0,0,0)},Planets.getPlanet3dSufaceAltitude=function(e){try{if(e<21)return Planets.getAdjustedPlanetRadius(e)}catch(e){}return 0},Planets.getPlanetTargetPoint=function(e,t,i,r){var n;return(n=r?Planets.getPlanet3dLocationJD(e,r):Planets.getPlanet3dLocation(e)).add(Coordinates.raDecTo3dAu(i/15+6,t,Planets.getPlanet3dSufaceAltitude(e))),n},Planets.getPlanet3dLocationJD=function(e,t){try{var i=new Vector3d,r=AstroCalc.getPlanet(t,0,0,0,-6378149),n=Coordinates.raDecTo3dAu(r.RA,r.dec,r.distance);if(e===SolarSystemObjects.earth)i=Vector3d.create(-n.x,-n.y,-n.z);else{var s=AstroCalc.getPlanet(t,e,0,0,-6378149);(i=Coordinates.raDecTo3dAu(s.RA,s.dec,s.distance)).subtract(n)}if(i.rotateX(Coordinates.meanObliquityOfEcliptic(t)*Planets.RC),1!==Settings.get_active().get_solarSystemScale())switch(e){case SolarSystemObjects.moon:var a=Planets.getPlanet3dLocationJD(SolarSystemObjects.earth,t);i.subtract(a),i.multiply(Settings.get_active().get_solarSystemScale()/2),i.add(a);break;case SolarSystemObjects.io:case SolarSystemObjects.europa:case SolarSystemObjects.ganymede:case SolarSystemObjects.callisto:a=Planets.getPlanet3dLocationJD(SolarSystemObjects.jupiter,t),i.subtract(a),i.multiply(Settings.get_active().get_solarSystemScale()),i.add(a)}return i}catch(e){return Vector3d.create(0,0,0)}},Planets.getPlanetLocation=function(e){var t=Planets.getPlanetIDFromName(e);return null!=Planets._planetLocations?Planets._planetLocations[t]:AstroCalc.getPlanet(SpaceTimeController.get_jNow(),t,SpaceTimeController.get_location().get_lat(),SpaceTimeController.get_location().get_lng(),SpaceTimeController.get_altitude())},Planets.getPlanetLocationJD=function(e,t){var i=Planets.getPlanetIDFromName(e);return AstroCalc.getPlanet(t,i,SpaceTimeController.get_location().get_lat(),SpaceTimeController.get_location().get_lng(),SpaceTimeController.get_altitude())},Planets.getPlanetIDFromName=function(e){switch(e){case"Sun":return SolarSystemObjects.sun;case"Mercury":return SolarSystemObjects.mercury;case"Venus":return SolarSystemObjects.venus;case"Mars":return SolarSystemObjects.mars;case"Jupiter":return SolarSystemObjects.jupiter;case"Saturn":return SolarSystemObjects.saturn;case"Uranus":return SolarSystemObjects.uranus;case"Neptune":return SolarSystemObjects.neptune;case"Pluto":return SolarSystemObjects.pluto;case"Moon":return SolarSystemObjects.moon;case"Io":return SolarSystemObjects.io;case"Europa":return SolarSystemObjects.europa;case"Ganymede":return SolarSystemObjects.ganymede;case"Callisto":return SolarSystemObjects.callisto;case"Earth":return SolarSystemObjects.earth;case"IoShadow":return SolarSystemObjects.ioShadow;case"EuropaShadow":return SolarSystemObjects.europaShadow;case"GanymedeShadow":return SolarSystemObjects.ganymedeShadow;case"CallistoShadow":return SolarSystemObjects.callistoShadow;case"SunEclipsed":return SolarSystemObjects.sunEclipsed;case"Custom":return SolarSystemObjects.custom;case"Undefined":return SolarSystemObjects.undefined;default:return-1}},Planets.getNameFrom3dId=function(e){switch(e){case SolarSystemObjects.sun:return"Sun";case SolarSystemObjects.mercury:return"Mercury";case SolarSystemObjects.venus:return"Venus";case SolarSystemObjects.mars:return"Mars";case SolarSystemObjects.jupiter:return"Jupiter";case SolarSystemObjects.saturn:return"Saturn";case SolarSystemObjects.uranus:return"Uranus";case SolarSystemObjects.neptune:return"Neptune";case SolarSystemObjects.pluto:return"Pluto";case SolarSystemObjects.moon:return"Moon";case SolarSystemObjects.io:return"Io";case SolarSystemObjects.europa:return"Europa";case SolarSystemObjects.ganymede:return"Ganymede";case SolarSystemObjects.callisto:return"Callisto";case SolarSystemObjects.earth:return"Earth";default:return""}},Planets.updatePlanetLocations=function(e){if(Planets._jNow=SpaceTimeController.get_jNow(),e&&Planets.updateOrbits(0),null==Planets._planetDiameters&&(Planets._planetDiameters=new Array(20),Planets._planetDiameters[0]=.009291568,Planets._planetDiameters[1]=325794793734425e-19,Planets._planetDiameters[2]=808669220531394e-19,Planets._planetDiameters[3]=453785605596396e-19,Planets._planetDiameters[4]=954501e-9,Planets._planetDiameters[5]=802173e-9,Planets._planetDiameters[6]=339564e-9,Planets._planetDiameters[7]=324825e-9,Planets._planetDiameters[8]=152007379777805e-19,Planets._planetDiameters[9]=232084653538149e-19,Planets._planetDiameters[10]=243519298386342e-19,Planets._planetDiameters[11]=208692629580609e-19,Planets._planetDiameters[12]=351742670356556e-19,Planets._planetDiameters[13]=322263666626559e-19,Planets._planetDiameters[14]=243519298386342e-19,Planets._planetDiameters[15]=208692629580609e-19,Planets._planetDiameters[16]=351742670356556e-19,Planets._planetDiameters[17]=322263666626559e-19,Planets._planetDiameters[18]=.018583136,Planets._planetDiameters[SolarSystemObjects.earth]=855626412117809e-19),null==Planets.planetColors){var t=Color.fromArgb(255,255,255,221),i=Color.fromArgb(255,255,68,0);Planets.planetColors=new Array(20),Planets.planetColors[0]=Colors.get_yellow(),Planets.planetColors[1]=Colors.get_white(),Planets.planetColors[2]=t,Planets.planetColors[3]=i,Planets.planetColors[4]=Color.fromArgb(255,255,165,0),Planets.planetColors[5]=Color.fromArgb(255,184,134,11),Planets.planetColors[6]=Color.fromArgb(255,173,216,230),Planets.planetColors[7]=Colors.get_blue(),Planets.planetColors[8]=Colors.get_white(),Planets.planetColors[9]=Colors.get_white(),Planets.planetColors[10]=Colors.get_white(),Planets.planetColors[11]=Colors.get_white(),Planets.planetColors[12]=Colors.get_white(),Planets.planetColors[13]=Colors.get_white(),Planets.planetColors[14]=Colors.get_black(),Planets.planetColors[15]=Colors.get_black(),Planets.planetColors[16]=Colors.get_black(),Planets.planetColors[17]=Colors.get_black(),Planets.planetColors[18]=Colors.get_white(),Planets.planetColors[SolarSystemObjects.earth]=Color.fromArgb(255,173,216,230)}if(null==Planets._planetTilts&&(Planets._planetTilts=new Array(20),Planets._planetTilts[0]=0,Planets._planetTilts[1]=.01,Planets._planetTilts[2]=177.4,Planets._planetTilts[3]=25.19,Planets._planetTilts[4]=3.13,Planets._planetTilts[5]=26.73,Planets._planetTilts[6]=97.77,Planets._planetTilts[7]=28.32,Planets._planetTilts[8]=119.61,Planets._planetTilts[9]=23.439,Planets._planetTilts[10]=2.21,Planets._planetTilts[11]=0,Planets._planetTilts[12]=-.33,Planets._planetTilts[13]=0,Planets._planetTilts[14]=0,Planets._planetTilts[15]=0,Planets._planetTilts[16]=0,Planets._planetTilts[17]=0,Planets._planetTilts[18]=0,Planets._planetTilts[SolarSystemObjects.earth]=23.5),Planets._planetTilts[SolarSystemObjects.earth]=Planets._obliquity/Planets.RC,null==Planets.planetRotationPeriod&&(Planets.planetRotationPeriod=new Array(20),Planets.planetRotationPeriod[0]=25.37995,Planets.planetRotationPeriod[1]=58.6462,Planets.planetRotationPeriod[2]=-243.0187,Planets.planetRotationPeriod[3]=1.02595675,Planets.planetRotationPeriod[4]=.41007,Planets.planetRotationPeriod[5]=.426,Planets.planetRotationPeriod[6]=-.71833,Planets.planetRotationPeriod[7]=.67125,Planets.planetRotationPeriod[8]=-6.38718,Planets.planetRotationPeriod[9]=27.3,Planets.planetRotationPeriod[10]=1.769137786,Planets.planetRotationPeriod[11]=3.551,Planets.planetRotationPeriod[12]=7.155,Planets.planetRotationPeriod[13]=16.69,Planets.planetRotationPeriod[14]=0,Planets.planetRotationPeriod[15]=0,Planets.planetRotationPeriod[16]=0,Planets.planetRotationPeriod[17]=0,Planets.planetRotationPeriod[18]=0,Planets.planetRotationPeriod[SolarSystemObjects.earth]=.99726968),null==Planets._planetScales&&(Planets._planetScales=new Array(20)),null==Planets._planet3dLocations&&(Planets._planet3dLocations=new Array(20)),Settings.get_active().get_actualPlanetScale())Planets._planetScales[0]=.5,Planets._planetScales[1]=.25,Planets._planetScales[2]=.25,Planets._planetScales[3]=.25,Planets._planetScales[4]=.25,Planets._planetScales[5]=.5,Planets._planetScales[6]=.25,Planets._planetScales[7]=.25,Planets._planetScales[8]=.25,Planets._planetScales[9]=.25,Planets._planetScales[10]=.25,Planets._planetScales[11]=.25,Planets._planetScales[12]=.25,Planets._planetScales[13]=.25,Planets._planetScales[14]=.25,Planets._planetScales[15]=.25,Planets._planetScales[16]=.25,Planets._planetScales[17]=.25,Planets._planetScales[18]=.5,Planets._planetScales[SolarSystemObjects.earth]=.25;else{for(var r=0;r<20;r++)Planets._planetScales[r]=r<10?.25:.1;Planets._planetScales[SolarSystemObjects.sun]=.5,Planets._planetScales[SolarSystemObjects.saturn]=.5,Planets._planetScales[SolarSystemObjects.sunEclipsed]=.5}Planets._planetDrawOrder={},Planets._planetLocations=new Array(20);var n=new Vector3d,s=AstroCalc.getPlanet(Planets._jNow,0,e?0:SpaceTimeController.get_location().get_lat(),e?0:SpaceTimeController.get_location().get_lng(),e?-6378149:SpaceTimeController.get_altitude());for(n=Coordinates.raDecTo3dAu(s.RA,s.dec,s.distance),Planets._planet3dLocations[SolarSystemObjects.earth]=Vector3d.create(-n.x,-n.y,-n.z),Planets._planet3dLocations[SolarSystemObjects.earth].rotateX(Planets._obliquity),r=0;r<18;r++){if(Planets._planetLocations[r]=AstroCalc.getPlanet(Planets._jNow,r,e?0:SpaceTimeController.get_location().get_lat(),e?0:SpaceTimeController.get_location().get_lng(),e?-6378149:SpaceTimeController.get_altitude()),Planets._planet3dLocations[r]=Coordinates.raDecTo3dAu(Planets._planetLocations[r].RA,Planets._planetLocations[r].dec,Planets._planetLocations[r].distance),Planets._planet3dLocations[r].subtract(n),Planets._planet3dLocations[r].rotateX(Planets._obliquity),Settings.get_active().get_actualPlanetScale()&&(Planets._planetScales[r]=2*Math.atan(Planets._planetDiameters[r]/Planets._planetLocations[r].distance*.5)/Math.PI*180),1!==Settings.get_active().get_solarSystemScale())switch(r){case SolarSystemObjects.moon:var a=Planets._planet3dLocations[SolarSystemObjects.earth];Planets._planet3dLocations[r].subtract(a),Planets._planet3dLocations[r].multiply(Settings.get_active().get_solarSystemScale()/2),Planets._planet3dLocations[r].add(a);break;case SolarSystemObjects.io:case SolarSystemObjects.europa:case SolarSystemObjects.ganymede:case SolarSystemObjects.callisto:a=Planets._planet3dLocations[SolarSystemObjects.jupiter],Planets._planet3dLocations[r].subtract(a),Planets._planet3dLocations[r].multiply(Settings.get_active().get_solarSystemScale()),Planets._planet3dLocations[r].add(a)}for(var o=-Planets._planetLocations[r].distance;ss.ss.keyExists(Planets._planetDrawOrder,o);)o+=1e-10;Planets._planetDrawOrder[o]=r}Planets._planetLocations[SolarSystemObjects.sunEclipsed]=Planets._planetLocations[SolarSystemObjects.sun],Planets._planetScales[SolarSystemObjects.sun]*=2,Planets._planetScales[SolarSystemObjects.sunEclipsed]=Planets._planetScales[SolarSystemObjects.sun],Planets._planetScales[SolarSystemObjects.saturn]=2*Planets._planetScales[SolarSystemObjects.saturn],Planets._lastUpdate=SpaceTimeController.get_now()},Planets.planetsReady=function(){},Planets.updateOrbits=function(e){try{if(Planets._obliquity=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())*Planets.RC,e!==Planets._lastPlanetCenterID&&(Planets._orbits=null),Planets._lastPlanetCenterID=e,null==Planets._orbits&&(e<0?Planets._eclipticTilt=Matrix3d.get_identity():(Planets._eclipticTilt=Matrix3d.get_identity(),Planets._eclipticTilt=Matrix3d._rotationX(Planets._obliquity)),null==Planets.planetOrbitalYears&&(Planets.planetOrbitalYears=new Array(20),Planets.planetOrbitalYears[0]=1,Planets.planetOrbitalYears[1]=.241,Planets.planetOrbitalYears[2]=.615,Planets.planetOrbitalYears[3]=1.881,Planets.planetOrbitalYears[4]=11.87,Planets.planetOrbitalYears[5]=29.45,Planets.planetOrbitalYears[6]=84.07,Planets.planetOrbitalYears[7]=164.9,Planets.planetOrbitalYears[8]=248.1,Planets.planetOrbitalYears[9]=27.3/365.25,Planets.planetOrbitalYears[10]=16.6890184/365.25,Planets.planetOrbitalYears[11]=3.551181/365.25,Planets.planetOrbitalYears[12]=7.15455296/365.25,Planets.planetOrbitalYears[13]=16.6890184/365.25,Planets.planetOrbitalYears[SolarSystemObjects.earth]=1),!Planets.readOrbits())){Planets._orbits=new Array(20);for(var t=1;t<20;t++)if(Planets._orbits[t]=new Array(Planets._orbitalSampleRate),t<9||t===SolarSystemObjects.earth){for(var i=0;i<Planets._orbitalSampleRate;i++){var r=e,n=Planets._jNow+365.25*Planets.planetOrbitalYears[t]/Planets._orbitalSampleRate*(i-Planets._orbitalSampleRate/2),s=new Vector3d;if(t===SolarSystemObjects.moon?r=-1:t>9&&t<14&&(r=4),r>-1){var a=AstroCalc.getPlanet(n,r,0,0,-6378149);s=Coordinates.raDecTo3dAu(a.RA,a.dec,a.distance)}if(t!==SolarSystemObjects.earth){var o=AstroCalc.getPlanet(n,t,0,0,-6378149);Planets._orbits[t][i]=Coordinates.raDecTo3dAu(o.RA,o.dec,o.distance),Planets._orbits[t][i].subtract(s)}else Planets._orbits[t][i]=Vector3d.create(-s.x,-s.y,-s.z);Planets._orbits[t][i].rotateX(Planets._obliquity)}Planets._orbits[t][Planets._orbitalSampleRate-1]=Planets._orbits[t][0]}Planets.dumpOrbitsFile()}}finally{}},Planets.readOrbits=function(){return!1},Planets.dumpOrbitsFile=function(){},Planets.drawPlanets=function(e,t){null==Planets._planetTextures&&Planets._loadPlanetTextures();var i=Planets._geocentricElongation(Planets._planetLocations[9].RA,Planets._planetLocations[9].dec,Planets._planetLocations[0].RA,Planets._planetLocations[0].dec);Planets._planetLocations[9].RA,Planets._planetLocations[0].RA;Planets._planetLocations[9].RA,Planets._planetLocations[0].RA,Planets._phaseAngle(i,Planets._planetLocations[9].distance,Planets._planetLocations[0].distance),Planets._positionAngle(Planets._planetLocations[9].RA,Planets._planetLocations[9].dec,Planets._planetLocations[0].RA,Planets._planetLocations[0].dec);var r=15*Math.abs(Planets._planetLocations[9].RA-Planets._planetLocations[0].RA)*Math.cos(Coordinates.degreesToRadians(Planets._planetLocations[0].dec)),n=Math.abs(Planets._planetLocations[9].dec-Planets._planetLocations[0].dec),s=Math.sqrt(r*r+n*n),a=0,o=Planets._planetScales[9]/2-s;Math.min(32,ss.ss.truncate(32*s)),o>Planets._planetScales[0]/4&&(a=Math.min(1,(o-Planets._planetScales[0]/2)/.001),Planets._drawPlanet(e,18,a));for(var l=ss.ss.enumerate(ss.ss.keys(Planets._planetDrawOrder));l.moveNext();){var h=l.current,c=Planets._planetDrawOrder[h];Planets._drawPlanet(e,c,1)}return!0},Planets._loadPlanetTextures=function(){var e=URLHelpers.singleton.engineAssetUrl("");Planets._planetTextures=new Array(20),Planets._planetTextures[0]=Texture.fromUrl(e+"sun.png"),Planets._planetTextures[1]=Texture.fromUrl(e+"mercury.png"),Planets._planetTextures[2]=Texture.fromUrl(e+"venus.png"),Planets._planetTextures[3]=Texture.fromUrl(e+"mars.png"),Planets._planetTextures[4]=Texture.fromUrl(e+"jupiter.png"),Planets._planetTextures[5]=Texture.fromUrl(e+"saturn.png"),Planets._planetTextures[6]=Texture.fromUrl(e+"uranus.png"),Planets._planetTextures[7]=Texture.fromUrl(e+"neptune.png"),Planets._planetTextures[8]=Texture.fromUrl(e+"pluto.png"),Planets._planetTextures[9]=Texture.fromUrl(e+"moon.png"),Planets._planetTextures[10]=Texture.fromUrl(e+"io.png"),Planets._planetTextures[11]=Texture.fromUrl(e+"europa.png"),Planets._planetTextures[12]=Texture.fromUrl(e+"ganymede.png"),Planets._planetTextures[13]=Texture.fromUrl(e+"callisto.png"),Planets._planetTextures[14]=Texture.fromUrl(e+"moonshadow.png"),Planets._planetTextures[15]=Texture.fromUrl(e+"moonshadow.png"),Planets._planetTextures[16]=Texture.fromUrl(e+"moonshadow.png"),Planets._planetTextures[17]=Texture.fromUrl(e+"moonshadow.png"),Planets._planetTextures[18]=Texture.fromUrl(e+"sunCorona.png"),Planets._planetTextures[SolarSystemObjects.earth]=Texture.fromUrl(e+"earth.png")},Planets.getPlanetOrientationAtEpoch=function(e){var t=Matrix3d.get_identity(),i=23.4392794;return e===SolarSystemObjects.earth?t._multiply(Matrix3d._rotationX(i*Planets.RC)):(t._multiply(Matrix3d._rotationX(-90*Planets.RC)),t._multiply(Matrix3d._rotationZ((180+Planets._planetAngles[e].primeMeridian)*Planets.RC)),t._multiply(Matrix3d._rotationX((90-Planets._planetAngles[e].poleDec)*Planets.RC)),t._multiply(Matrix3d._rotationZ((Planets._planetAngles[e].poleRa-90)*Planets.RC)),t._multiply(Matrix3d._rotationX(i*Planets.RC)),t._multiply(Matrix3d._rotationX(90*Planets.RC))),t},Planets.setupPlanetMatrix=function(e,t,i,r){var n=e.get_world().clone();if(Planets._setupMatrixForPlanetGeometry(e,t,i,r),t===SolarSystemObjects.sun){var s=Planets.getAdjustedPlanetRadius(t);n.scale(Vector3d.create(s,s,s));var a=Vector3d.subtractVectors(Planets._planet3dLocations[t],i);n._multiply(Matrix3d.translation(a)),e.set_worldBaseNonRotating(n)}},Planets._setupMatrixForPlanetGeometry=function(e,t,i,r){var n=Planets.getAdjustedPlanetRadius(t),s=0;s=t===SolarSystemObjects.earth?Math.PI+Coordinates.mstFromUTC2(SpaceTimeController.get_now(),0)/180*Math.PI:Math.PI+(Planets._jNow-2451545)/Planets.planetRotationPeriod[t]*Math.PI*2%(2*Math.PI),9===t&&(s-=Math.PI/2);var a=e.get_world().clone(),o=e.get_world().clone(),l=Vector3d.subtractVectors(Planets._planet3dLocations[t],i),h=Planets.getPlanetOrientationAtEpoch(t);return a.scale(Vector3d.create(n,n,n)),a._multiply(Matrix3d._rotationY(-s)),a._multiply(h),t===e.viewCamera.target&&(Planets.earthMatrix=Matrix3d.get_identity(),Planets.earthMatrix._multiply(Matrix3d._rotationY(-s)),Planets.earthMatrix._multiply(h),Planets.earthMatrixInv=Planets.earthMatrix.clone(),Planets.earthMatrixInv.invert()),a._multiply(Matrix3d.translation(l)),e.set_world(a),e.set_worldBase(e.get_world().clone()),e.set_nominalRadius(Planets.getPlanetRadiusInMeters(t)),r&&e.makeFrustum(),o.scale(Vector3d.create(n,n,n)),o._multiply(h),o._multiply(Matrix3d.translation(l)),e.set_worldBaseNonRotating(o),s},Planets.getPlanetPositionDirect=function(e,t){var i=0,r=0,n=0;switch(e){case 1:i=CAAMercury.eclipticLongitude(t),r=CAAMercury.eclipticLatitude(t),n=CAAMercury.radiusVector(t);break;case 2:i=CAAVenus.eclipticLongitude(t),r=CAAVenus.eclipticLatitude(t),n=CAAVenus.radiusVector(t);break;case SolarSystemObjects.earth:i=CAAEarth.eclipticLongitude(t),r=CAAEarth.eclipticLatitude(t),n=CAAEarth.radiusVector(t);break;case 3:i=CAAMars.eclipticLongitude(t),r=CAAMars.eclipticLatitude(t),n=CAAMars.radiusVector(t);break;case 4:i=CAAJupiter.eclipticLongitude(t),r=CAAJupiter.eclipticLatitude(t),n=CAAJupiter.radiusVector(t);break;case 5:i=CAASaturn.eclipticLongitude(t),r=CAASaturn.eclipticLatitude(t),n=CAASaturn.radiusVector(t);break;case 6:i=CAAUranus.eclipticLongitude(t),r=CAAUranus.eclipticLatitude(t),n=CAAUranus.radiusVector(t);break;case 7:i=CAANeptune.eclipticLongitude(t),r=CAANeptune.eclipticLatitude(t),n=CAANeptune.radiusVector(t);break;case 8:i=CAAPluto.eclipticLongitude(t),r=CAAPluto.eclipticLatitude(t),n=CAAPluto.radiusVector(t);break;case 9:i=CAAMoon.eclipticLongitude(t),r=CAAMoon.eclipticLatitude(t),n=CAAMoon.radiusVector(t)/149598e3;break;case 10:var s=GM.calculate(t).satellite1.eclipticRectangularCoordinates;return Vector3d.create(s.x,s.z,s.y);case 11:return s=GM.calculate(t).satellite2.eclipticRectangularCoordinates,Vector3d.create(s.x,s.z,s.y);case 12:return s=GM.calculate(t).satellite3.eclipticRectangularCoordinates,Vector3d.create(s.x,s.z,s.y);case 13:return s=GM.calculate(t).satellite4.eclipticRectangularCoordinates,Vector3d.create(s.x,s.z,s.y)}i=Coordinates.degreesToRadians(i),r=Coordinates.degreesToRadians(r);var a=Vector3d.create(Math.cos(i)*Math.cos(r)*n,Math.sin(i)*Math.cos(r)*n,Math.sin(r)*n),o=(Coordinates.meanObliquityOfEcliptic(t)-Coordinates.meanObliquityOfEcliptic(2451545))*Planets.RC;return a.rotateX(o),Vector3d.create(a.x,a.z,a.y)},Planets._stateVectorToKeplerian=function(e,t,i){var r=Vector3d.scale(e,149598e3),n=Vector3d.scale(Vector3d.scale(t,1/86400),149598e3),s=r.length(),a=n.length(),o=1/(2/s-a*a/i),l=Vector3d.cross(r,n),h=Vector3d.subtractVectors(Vector3d.scale(Vector3d.cross(n,l),1/i),Vector3d.scale(r,1/s)),c=h.length();l.normalize(),h.normalize();var u=Vector3d.cross(l,h);r.normalize();var d=Vector3d.dot(h,r),_=Vector3d.dot(u,r),g=Math.atan2(Math.sqrt(1-c*c)*_,c+d),f=new KeplerianElements;return f.orientation=Matrix3d.create(h.x,h.y,h.z,0,u.x,u.y,u.z,0,l.x,l.y,l.z,0,0,0,0,1),f.a=o,f.e=c,f.ea=g,f},Planets.getAdjustedPlanetRadius=function(e){return e>Planets._planetDiameters.length-1&&(e=SolarSystemObjects.earth),Planets._planetDiameters[e]/2*(e?1+3*(Settings.get_active().get_solarSystemScale()-1):1+.3*(Settings.get_active().get_solarSystemScale()-1))},Planets.getPlanetRadiusInMeters=function(e){return e>Planets._planetDiameters.length-1&&(e=SolarSystemObjects.earth),Planets._planetDiameters[e]/2*149598e3*1e3},Planets._drawPlanet=function(e,t,i){var r=Planets._planetLocations[t];if(t<14&&Planets._planetScales[t]<e.viewCamera.zoom/6/400){if(t<10||t<14&&Planets._planetScales[t]>e.viewCamera.zoom/6/6400){var n=Coordinates.raDecTo3d(r.RA,r.dec);BasePlanets.drawPointPlanet(e,n,3,Planets.planetColors[t],!1)}}else{var s=null;if(t<10||18===t)s=Planets._planetTextures[t];else if(t<14)s=Planets._planetLocations[t].eclipsed?Planets._planetTextures[15]:Settings.get_active().get_showMoonsAsPointSource()?Planets._planetTextures[14]:Planets._planetTextures[t];else{if(!Planets._planetLocations[t].shadow)return;s=Planets._planetTextures[15]}if(null!=e.gl){if(null==Planets._planetPoints){Planets._planetPoints=new Array(4);for(var a=0;a<4;a++)Planets._planetPoints[a]=new PositionColoredTextured}var o=Planets._planetScales[t]/2,l=o/Math.cos(r.dec/180*Math.PI);Planets._planetPoints[0].position=Coordinates.raDecTo3dAu(r.RA-l/15,r.dec+o,1),Planets._planetPoints[0].tu=0,Planets._planetPoints[0].tv=1,Planets._planetPoints[0].color=Colors.get_white(),Planets._planetPoints[1].position=Coordinates.raDecTo3dAu(r.RA-l/15,r.dec-o,1),Planets._planetPoints[1].tu=0,Planets._planetPoints[1].tv=0,Planets._planetPoints[1].color=Colors.get_white(),Planets._planetPoints[2].position=Coordinates.raDecTo3dAu(r.RA+l/15,r.dec+o,1),Planets._planetPoints[2].tu=1,Planets._planetPoints[2].tv=1,Planets._planetPoints[2].color=Colors.get_white(),Planets._planetPoints[3].position=Coordinates.raDecTo3dAu(r.RA+l/15,r.dec-o,1),Planets._planetPoints[3].tu=1,Planets._planetPoints[3].tv=0,Planets._planetPoints[3].color=Colors.get_white(),Planets._planetSprite.draw(e,Planets._planetPoints,4,s,!0,1)}else{var h=Coordinates.raDecTo3d(r.RA,r.dec),c=Planets._planetScales[t]/(e.get_fovScale()/3600)/2,u=e.WVP.transform(h);if(u.z<0)return;if(Vector3d.dot(e.get_viewPoint(),h)<.55)return;var d=e.device;d.save(),d.globalAlpha=i,d.beginPath(),d.arc(u.x,u.y,c,0,2*Math.PI,!0),d.lineWidth=0,d.closePath(),d.clip(),d.drawImage(s.imageElement,u.x-c,u.y-c,2*c,2*c),d.globalAlpha=1,d.restore()}}},Planets._drawPlanetPhase=function(e,t,i,r,n){},Planets._geocentricElongation=function(e,t,i,r){return e=Coordinates.degreesToRadians(15*e),i=Coordinates.degreesToRadians(15*i),t=Coordinates.degreesToRadians(t),r=Coordinates.degreesToRadians(r),Coordinates.radiansToDegrees(Math.acos(Math.sin(r)*Math.sin(t)+Math.cos(r)*Math.cos(t)*Math.cos(i-e)))},Planets._phaseAngle=function(e,t,i){return e=Coordinates.degreesToRadians(e),Coordinates.mapTo0To360Range(Coordinates.radiansToDegrees(Math.atan2(i*Math.sin(e),t-i*Math.cos(e))))},Planets._positionAngle=function(e,t,i,r){return e=Coordinates.hoursToRadians(e),i=Coordinates.hoursToRadians(i),t=Coordinates.degreesToRadians(t),r=Coordinates.degreesToRadians(r),Coordinates.mapTo0To360Range(Coordinates.radiansToDegrees(Math.atan2(Math.cos(t)*Math.sin(e-i),Math.sin(t)*Math.cos(r)-Math.cos(t)*Math.sin(r)*Math.cos(e-i))))};var Planets$={};registerType("Planets",[Planets,Planets$,null]);var Classification={star:1,supernova:2,blackHole:4,neutronStar:8,doubleStar:16,multipleStars:32,asterism:64,constellation:128,openCluster:256,globularCluster:512,nebulousCluster:1024,nebula:2048,emissionNebula:4096,planetaryNebula:8192,reflectionNebula:16384,darkNebula:32768,giantMolecularCloud:65536,supernovaRemnant:131072,interstellarDust:262144,quasar:524288,galaxy:1048576,spiralGalaxy:2097152,irregularGalaxy:4194304,ellipticalGalaxy:8388608,knot:16777216,plateDefect:33554432,clusterOfGalaxies:67108864,otherNGC:134217728,unidentified:268435456,solarSystem:536870912,unfiltered:1073741823,stellar:63,stellarGroupings:2032,nebulae:523264,galactic:133693440,other:436207616};function Place(){this._camParams=CameraParameters.create(0,0,-1,0,0,100),this._location3d=Vector3d.create(0,0,0),this.htmlDescription="",this._constellation="",this._classification=1048576,this._type=2,this._magnitude=0,this._distnace=0,this.angularSize=60,this.annotation="",this._thumbNail=null,this._studyImageset=null,this._backgroundImageSet=null,this._searchDistance=0,this._elevation=50}registerType("Classification",Classification),registerEnum("Classification",Classification),Place.create=function(e,t,i,r,n,s,a){var o=new Place;return o.set_zoomLevel(a),o._constellation=n,o._name=e,2===s||4===s?o._camParams.set_RA(i):o.set_lng(i),o.set_lat(t),o.set_classification(r),o.set_type(s),o},Place.createCameraParams=function(e,t,i,r,n,s){var a=new Place;return a._constellation=r,a._name=e,a.set_classification(i),a._camParams=t,a.set_type(n),a.set_target(s),a},Place._fromXml=function(e){var t=new Place;if(t._name=e.attributes.getNamedItem("Name").nodeValue,null!=e.attributes.getNamedItem("MSRComponentId")&&null!=e.attributes.getNamedItem("Permission")&&null!=e.attributes.getNamedItem("Url"))return t.set_url(e.attributes.getNamedItem("Url").nodeValue),t.set_thumbnailUrl(e.attributes.getNamedItem("Thumbnail").nodeValue),t;null!=e.attributes.getNamedItem("DataSetType")&&(t._type=Enums.parse("ImageSetType",e.attributes.getNamedItem("DataSetType").nodeValue)),2===t.get_type()?(t._camParams.set_RA(parseFloat(e.attributes.getNamedItem("RA").nodeValue)),t._camParams.set_dec(parseFloat(e.attributes.getNamedItem("Dec").nodeValue))):(t.set_lat(parseFloat(e.attributes.getNamedItem("Lat").nodeValue)),t.set_lng(parseFloat(e.attributes.getNamedItem("Lng").nodeValue))),null!=e.attributes.getNamedItem("Constellation")&&(t._constellation=e.attributes.getNamedItem("Constellation").nodeValue),null!=e.attributes.getNamedItem("Classification")&&(t._classification=Enums.parse("Classification",e.attributes.getNamedItem("Classification").nodeValue)),null!=e.attributes.getNamedItem("Magnitude")&&(t._magnitude=parseFloat(e.attributes.getNamedItem("Magnitude").nodeValue)),null!=e.attributes.getNamedItem("AngularSize")&&(t.angularSize=parseFloat(e.attributes.getNamedItem("AngularSize").nodeValue)),null!=e.attributes.getNamedItem("ZoomLevel")&&t.set_zoomLevel(parseFloat(e.attributes.getNamedItem("ZoomLevel").nodeValue)),null!=e.attributes.getNamedItem("Rotation")&&(t._camParams.rotation=parseFloat(e.attributes.getNamedItem("Rotation").nodeValue)),null!=e.attributes.getNamedItem("Annotation")&&(t.annotation=e.attributes.getNamedItem("Annotation").nodeValue),null!=e.attributes.getNamedItem("Angle")&&(t._camParams.angle=parseFloat(e.attributes.getNamedItem("Angle").nodeValue)),null!=e.attributes.getNamedItem("Opacity")?t._camParams.opacity=parseFloat(e.attributes.getNamedItem("Opacity").nodeValue):t._camParams.opacity=100,t.set_target(65536),null!=e.attributes.getNamedItem("Target")&&t.set_target(Enums.parse("SolarSystemObjects",e.attributes.getNamedItem("Target").nodeValue)),null!=e.attributes.getNamedItem("ViewTarget")&&(t._camParams.viewTarget=Vector3d.parse(e.attributes.getNamedItem("ViewTarget").nodeValue)),null!=e.attributes.getNamedItem("TargetReferenceFrame")&&(t._camParams.targetReferenceFrame=e.attributes.getNamedItem("TargetReferenceFrame").nodeValue);var i=Util.selectSingleNode(e,"Description");null!=i&&(t.htmlDescription=Util.getInnerText(i));var r=Util.selectSingleNode(e,"BackgroundImageSet");if(null!=r){var n=Util.selectSingleNode(r,"ImageSet");t._backgroundImageSet=Imageset.fromXMLNode(n)}var s=Util.selectSingleNode(e,"ForegroundImageSet");return null!=s&&(n=Util.selectSingleNode(s,"ImageSet"),t._studyImageset=Imageset.fromXMLNode(n)),null!=(s=Util.selectSingleNode(e,"ImageSet"))&&(t._studyImageset=Imageset.fromXMLNode(s)),t},Place._properCaps=function(e){for(var t=e.split(" "),i="",r=ss.ss.enumerate(t);r.moveNext();){var n=r.current;i=i+n.substr(0,1).toUpperCase()+(n.length>1?n.substr(1).toLowerCase():"")+" "}return ss.ss.trim(i)};var Place$={get_tag:function(){return this._tag},set_tag:function(e){return this._tag=e,e},get_url:function(){return this._url},set_url:function(e){return this._url=e,e},get_thumbnail:function(){return this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,e},get_name:function(){return this.get_names()[0]},get_names:function(){return ss.ss.emptyString(this._name)?"".split(";"):this._name.split(";")},set_names:function(e){return this._name=UiTools.getNamesStringFromArray(e),e},get_camParams:function(){if(536870912===this.get_classification()&&20!==this._camParams.target){var e=Planets.getPlanetLocation(this.get_name());this._camParams.set_RA(e.RA),this._camParams.set_dec(e.dec),this._distnace=e.distance}return this._camParams},set_camParams:function(e){return this._camParams=e,e},updatePlanetLocation:function(e){this._camParams.viewTarget=Planets.getPlanet3dLocationJD(this.get_target(),e),65536!==this.get_target()&&20!==this.get_target()&&(this._camParams.viewTarget=Planets.getPlanetTargetPoint(this.get_target(),this.get_lat(),this.get_lng(),e))},get_location3d:function(){return 536870912!==this.get_classification()&&(this._location3d.x||this._location3d.y||this._location3d.z)||(this._location3d=Coordinates.raDecTo3d(this.get_RA(),this.get_dec())),this._location3d},get_lat:function(){return this.get_camParams().lat},set_lat:function(e){return this._camParams.lat=e,e},get_lng:function(){return this.get_camParams().lng},set_lng:function(e){return this._camParams.lng=e,e},get_opacity:function(){return this.get_camParams().opacity},set_opacity:function(e){return this._camParams.opacity=e,e},get_constellation:function(){return this._constellation},set_constellation:function(e){return this._constellation=e,e},get_classification:function(){return this._classification},set_classification:function(e){return this._classification=e,e},get_type:function(){return this._type},set_type:function(e){return this._type=e,e},get_magnitude:function(){return this._magnitude},set_magnitude:function(e){return this._magnitude=e,e},get_distance:function(){return this._distnace},set_distance:function(e){return this._distnace=e,e},get_zoomLevel:function(){return this.get_camParams().zoom},set_zoomLevel:function(e){return this._camParams.zoom=e,e},get_annotation:function(){return this.annotation},set_annotation:function(e){return this.annotation=e,e},get_studyImageset:function(){return this._studyImageset},set_studyImageset:function(e){return this._studyImageset=e,e},get_backgroundImageset:function(){return this._backgroundImageSet},set_backgroundImageset:function(e){return null!=e&&this.set_type(e.get_dataSetType()),this._backgroundImageSet=e,e},get_searchDistance:function(){return this._searchDistance},set_searchDistance:function(e){return this._searchDistance=e,e},get_elevation:function(){return this._elevation},set_elevation:function(e){return this._elevation=e,e},get_thumbnailUrl:function(){if(ss.ss.emptyString(this._thumbnailField)){if(null!=this._studyImageset&&!ss.ss.emptyString(this._studyImageset.get_thumbnailUrl()))return this._studyImageset.get_thumbnailUrl();if(null!=this._backgroundImageSet&&!ss.ss.emptyString(this._backgroundImageSet.get_thumbnailUrl()))return this._backgroundImageSet.get_thumbnailUrl();var e=this.get_name();return e.indexOf(";")>-1&&(e=e.substr(0,e.indexOf(";"))),1===this.get_classification()||freestandingMode?URLHelpers.singleton.engineAssetUrl("thumb_star.jpg"):URLHelpers.singleton.coreStaticUrl("wwtweb/thumbnail.aspx?name="+e.toLowerCase())}return this._thumbnailField},set_thumbnailUrl:function(e){return this._thumbnailField=e,e},get_RA:function(){return this.get_camParams().get_RA()},set_RA:function(e){return this._camParams.set_RA(e),e},get_dec:function(){return this.get_camParams().get_dec()},set_dec:function(e){return this._camParams.set_dec(e),e},toString:function(){return this._name},_saveToXml:function(e,t){e._writeStartElement(t),e._writeAttributeString("Name",this._name),e._writeAttributeString("DataSetType",Enums.toXml("ImageSetType",this._type)),2===this.get_type()?(e._writeAttributeString("RA",this._camParams.get_RA().toString()),e._writeAttributeString("Dec",this._camParams.get_dec().toString())):(e._writeAttributeString("Lat",this.get_lat().toString()),e._writeAttributeString("Lng",this.get_lng().toString())),e._writeAttributeString("Constellation",this._constellation),e._writeAttributeString("Classification",Enums.toXml("Classification",this._classification)),e._writeAttributeString("Magnitude",this._magnitude.toString()),e._writeAttributeString("Distance",this._distnace.toString()),e._writeAttributeString("AngularSize",this.angularSize.toString()),e._writeAttributeString("ZoomLevel",this.get_zoomLevel().toString()),e._writeAttributeString("Rotation",this._camParams.rotation.toString()),e._writeAttributeString("Angle",this._camParams.angle.toString()),e._writeAttributeString("Opacity",this._camParams.opacity.toString()),e._writeAttributeString("Target",Enums.toXml("SolarSystemObjects",this.get_target())),e._writeAttributeString("ViewTarget",this._camParams.viewTarget.toString()),e._writeAttributeString("TargetReferenceFrame",this._camParams.targetReferenceFrame),e._writeStartElement("Description"),e._writeCData(this.htmlDescription),e._writeEndElement(),null!=this._backgroundImageSet&&(e._writeStartElement("BackgroundImageSet"),Imageset.saveToXml(e,this._backgroundImageSet,""),e._writeEndElement()),null!=this._studyImageset&&Imageset.saveToXml(e,this._studyImageset,""),e._writeEndElement()},asXml:function(e){var t=new XmlTextWriter;return this._saveToXml(t,e||"Place"),t.body},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_isImage:function(){return null!=this._studyImageset||null!=this._backgroundImageSet},get_isTour:function(){return!1},get_isFolder:function(){return!1},get_children:function(){return[]},get_readOnly:function(){return!0},get_target:function(){return this._camParams.target},set_target:function(e){return this._camParams.target=e,e},get_isCloudCommunityItem:function(){return!1}};function FolderUp(){this.parent=null,this._bounds=new Rectangle}registerType("Place",[Place,Place$,null,IThumbnail,IPlace]),set_createPlace(Place.create);var FolderUp$={get_name:function(){return"Up Level"},get_thumbnail:function(){return this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,e},get_thumbnailUrl:function(){return URLHelpers.singleton.engineAssetUrl("thumb_folderup.jpg")},set_thumbnailUrl:function(e){return e},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_isImage:function(){return!1},get_isTour:function(){return!1},get_isFolder:function(){return!1},get_isCloudCommunityItem:function(){return!1},get_readOnly:function(){return!1},get_children:function(){return null==this.parent?[]:this.parent.get_children()}};function Grids(){}registerType("FolderUp",[FolderUp,FolderUp$,null,IThumbnail]),Grids._galaxyImageIndexBuffer=null,Grids._galaxyImageTriangleCount=0,Grids._milkyWayImage=null,Grids._starSprites=null,Grids._starCount=0,Grids._starsDownloading=!1,Grids._stars=null,Grids._hipparcosIndex={},Grids._limitingMagnitude=16,Grids._galaxyTextures=null,Grids._galaxyVertexCounts=null,Grids._largeSet=!0,Grids._cosmosReady=!1,Grids._cosmos=null,Grids._downloadingGalaxy=!1,Grids._eclipticCount=0,Grids._eclipticYear=0,Grids._monthDays=[31,28.2421,31,30,31,30,31,31,30,31,30,31],Grids._monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Grids._eclipticTextYear=0,Grids._createGalaxyImage=function(e){null==Grids._milkyWayImage&&(Grids._milkyWayImage=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("milkywaybar.jpg")));var t,i,r=50,n=0;Grids._galaxyImageVertexBuffer=new PositionTextureVertexBuffer(2601);var s,a,o,l=Grids._galaxyImageVertexBuffer.lock(),h=608e5,c=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())/180*Math.PI;for(a=0;a<=r;a++)for(t=a!==r?-64- -2.56*a:64,s=0;s<=r;s++)i=s!==r?2.56*s-64:64,n=51*a+s,(o=Vector3d.create(i*h,0,(t-28)*h)).rotateY(213/180*Math.PI),o.rotateZ(-.3492875*Math.PI),o.rotateY(-192.8595083/180*Math.PI),o.rotateX(c),l[n]=PositionTexture.createPosRaw(o,1-.02*s,.02*a);Grids._galaxyImageVertexBuffer.unlock(),Grids._galaxyImageTriangleCount=5e3;var u=new Uint16Array(15e3),d=u;for(a=0;a<r;a++)for(s=0;s<r;s++)d[n=a*r*6+6*s]=51*a+s,d[n+2]=51*(a+1)+s,d[n+1]=51*a+(s+1),d[n+3]=51*a+(s+1),d[n+5]=51*(a+1)+s,d[n+4]=51*(a+1)+(s+1);Grids._galaxyImageIndexBuffer=tilePrepDevice.createBuffer(),tilePrepDevice.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,Grids._galaxyImageIndexBuffer),tilePrepDevice.bufferData(WEBGL.ELEMENT_ARRAY_BUFFER,u,WEBGL.STATIC_DRAW)},Grids.drawGalaxyImage=function(e,t){null==Grids._galaxyImageIndexBuffer&&Grids._createGalaxyImage(e);var i=e.viewCamera.zoom,r=128*(Math.log(Math.max(1,i))/Math.log(4)-14);Math.min(255,Math.max(0,r)),ImageShader.use(e,Grids._galaxyImageVertexBuffer.vertexBuffer,Grids._galaxyImageIndexBuffer,Grids._milkyWayImage.texture2d,t,!0),e.gl.drawElements(WEBGL.TRIANGLES,3*Grids._galaxyImageTriangleCount,WEBGL.UNSIGNED_SHORT,0)},Grids.drawStars3D=function(e,t){var i=e.viewCamera.zoom,r=Math.max(Math.min(255,40.8*(Math.log(i)-15.5)),0),n=Math.min(255,Math.max(0,ss.ss.truncate(r)));n>254||(n=(255-n)*t,null==Grids._starSprites&&Grids.initStarVertexBuffer(e),null!=Grids._starSprites&&Grids._starSprites.draw(e,n/255,!1))},Grids.initStarVertexBuffer=function(e){if(Grids._starsDownloading||freestandingMode||(Grids.getStarFile(URLHelpers.singleton.coreStaticUrl("wwtweb/catalog.aspx?Q=hipparcos")),Grids._starsDownloading=!0),null==Grids._starSprites&&Grids._starCount>0){var t=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())/180*Math.PI,i=Grids._stars.length;Grids._starCount=i,Grids._starSprites=new PointList(e),Grids._starSprites.depthBuffered=!1,Grids._starSprites.showFarSide=!0;for(var r=ss.ss.enumerate(Grids._stars);r.moveNext();){var n=r.current,s=Coordinates.raDecTo3dAu(n.RA,n.dec,n.distance);s.rotateX(t),n.position=s;var a=12e5/Math.pow(1.6,n.absoluteMagnitude);Grids._starSprites.addPoint(s,n.col,new Dates(0,1),100*a)}}},Grids.initializeStarDB=function(e){if(null==Grids._stars&&null==Grids._stars){Grids._stars=[];for(var t,i=e.split("\r\n"),r=ss.ss.enumerate(i);r.moveNext();)(t=new Star(r.current)).magnitude<Grids._limitingMagnitude&&t.par>.001&&(Grids._stars.push(t),Grids._hipparcosIndex[t.id]=t);Grids._starCount=Grids._stars.length}},Grids.getStarFile=function(e){Grids._webFileStar=new WebFile(e),Grids._webFileStar.onStateChange=Grids.starFileStateChange,Grids._webFileStar.send()},Grids.starFileStateChange=function(){2===Grids._webFileStar.get_state()?alert(Grids._webFileStar.get_message()):1===Grids._webFileStar.get_state()&&Grids.initializeStarDB(Grids._webFileStar.getText())},Grids.getGalaxyFile=function(e){Grids._webFileGalaxy=new WebFile(e),Grids._webFileGalaxy.responseType="blob",Grids._webFileGalaxy.onStateChange=Grids.galaxyFileStateChange,Grids._webFileGalaxy.send()},Grids.galaxyFileStateChange=function(){if(2===Grids._webFileGalaxy.get_state())alert(Grids._webFileGalaxy.get_message());else if(1===Grids._webFileGalaxy.get_state()){var e=Grids._webFileGalaxy.getBlob(),t=new FileReader;t.onloadend=function(e){var i=new BinaryReader(new Uint8Array(t.result));Grids.initializeCosmos(i)},t.readAsArrayBuffer(e)}},Grids.drawCosmos3D=function(e,t){e.gl;var i=e.viewCamera.zoom,r=90*(Math.log(Math.max(1,i))/Math.log(4)-15.5),n=Math.min(255,Math.max(0,ss.ss.truncate(r)));if(!(n<3)){if(Grids.initCosmosVertexBuffer(),null==Grids._galaxyTextures&&Grids._largeSet){Grids._galaxyTextures=new Array(256);for(var s=0;s<256;s++){for(var a=s.toString();a.length<4;)a="0"+a;var o=ss.ss.format(URLHelpers.singleton.engineAssetUrl("galimg/gal_{0}.jpg"),a);Grids._galaxyTextures[s]=Texture.fromUrl(o)}}if(Grids._cosmosReady)for(s=0;s<256;s++)Grids._cosmosSprites[s].drawTextured(e,Grids._galaxyTextures[s].texture2d,n*t/255)}},Grids.initCosmosVertexBuffer=function(){null==Grids._cosmosSprites&&Grids._downloadCosmosFile()},Grids._createCosmosVertexBuffer=function(e){var t=256;if(null!=Grids._cosmosSprites)for(var i=0;i<t;i++)null!=Grids._cosmosSprites[i]&&(Grids._cosmosSprites[i]=null);Grids._cosmosSprites=null;var r=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())/180*Math.PI;Grids._cosmosSprites=new Array(t);for(var n=new Array(t),s=0;s<t;s++)Grids._galaxyVertexCounts[s],Grids._cosmosSprites[s]=new PointList(e),Grids._cosmosSprites[s].depthBuffered=!1,Grids._cosmosSprites[s].showFarSide=!0,n[s]=0;for(var a=ss.ss.enumerate(Grids._cosmos);a.moveNext();){var o=a.current,l=o.eTypeBucket,h=(n[l],Coordinates.raDecTo3dAu(o.RA,o.dec,206264.806*o.distance*1e6/.73));h.rotateX(r),o.position=h,Grids._cosmosSprites[l].addPoint(h,Colors.get_white(),new Dates(0,1),1e9*o.size*100),n[l]++}Grids._cosmosReady=!0},Grids.initializeCosmos=function(e){if(Math.pow(100,2.849485002),null==Grids._cosmos){if(Grids._galaxyVertexCounts=new Array(Grids._largeSet?256:20),null==Grids._cosmos){var t;Grids._cosmos=[];try{for(;e.get_position()<e.get_length();)t=new Galaxy(e),Grids._cosmos.push(t),Grids._galaxyVertexCounts[t.eTypeBucket]++}catch(e){}e.close()}Grids._createCosmosVertexBuffer(globalRenderContext)}},Grids._downloadCosmosFile=function(){return Grids._downloadingGalaxy||freestandingMode||(Grids.getGalaxyFile(URLHelpers.singleton.coreStaticUrl("wwtweb/catalog.aspx?Q=cosmosnewbin")),Grids._downloadingGalaxy=!0),!1},Grids.drawEquitorialGrid=function(e,t,i){if(null==Grids._equLineList){Grids._equLineList=new SimpleLineList,Grids._equLineList.set_depthBuffered(!1);for(var r=0;r<24;r++)for(var n=-80;n<80;n+=2)Grids._equLineList.addLine(Coordinates.raDecTo3dAu(r,n,1),Coordinates.raDecTo3dAu(r,n+2,1));for(n=-80;n<=80;n+=10)for(r=0;r<23.8;r+=.2)Grids._equLineList.addLine(Coordinates.raDecTo3dAu(r,n,1),Coordinates.raDecTo3dAu(r+.2,n,1));for(var s=0,a=0;a<24;a+=.25){switch(n=.5,s%4){case 0:s++;continue;case 3:case 1:n=.25}s++,Grids._equLineList.addLine(Coordinates.raDecTo3dAu(a,n,1),Coordinates.raDecTo3dAu(a,-n,1))}for(s=0,a=0;a<24;a+=3)for(s=0,n=-80;n<=80;n+=1){var o=.5/30;switch(s%10){case 0:s++;continue;case 5:o=.5/15}s++,Grids._equLineList.addLine(Coordinates.raDecTo3dAu(a+o,n,1),Coordinates.raDecTo3dAu(a-o,n,1))}}return Grids._equLineList.drawLines(e,t,i),!0},Grids.drawEquitorialGridText=function(e,t,i){return Grids._makeEquitorialGridText(),Grids._equTextBatch.draw(e,t,i),!0},Grids._makeEquitorialGridText=function(){if(null==Grids._equTextBatch){Grids._equTextBatch=new Text3dBatch(30);for(var e=0;e<24;e++){var t=e.toString()+" hr";e<10&&(t="  "+e.toString()+" hr"),Grids._equTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(e+.005,.4,1),Coordinates.raDecTo3dAu(e+.005,.5,1),t,45,18e-5))}for(e=0;e<24;e+=3)for(var i=-80;i<=80;i+=10)i&&(t=i.toString(),i>0?(t="  +"+i.toString(),Grids._equTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(e,i-.4,1),Coordinates.raDecTo3dAu(e,i-.3,1),t,45,18e-5))):(t="  - "+t.substr(1),Grids._equTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(e,i+.4,1),Coordinates.raDecTo3dAu(e,i+.5,1),t,45,18e-5))))}},Grids.drawEcliptic=function(e,t,i,r){var n=SpaceTimeController.get_now().getUTCFullYear();if(null==Grids._eclipticOverviewLineList||n!==Grids._eclipticYear){null!=Grids._eclipticOverviewLineList&&(Grids._eclipticOverviewLineList.clear(),Grids._eclipticOverviewLineList=null),Grids._eclipticYear=n;var s=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow()),a=Matrix3d._rotationX(-s/360*(2*Math.PI)),o=365.25;DT.isLeap(n,!0)?(Grids._monthDays[1]=29,o=366):(Grids._monthDays[1]=28,o=365),Grids._eclipticCount=ss.ss.truncate(o);var l=SpaceTimeController.utcToJulian(new Date(n,0,1,12,0,0)),h=0,c=0,u=0;Grids._eclipticOverviewLineList=new SimpleLineList,Grids._eclipticOverviewLineList.set_depthBuffered(!1);for(var d=0;d<12;d++){for(var _=ss.ss.truncate(Grids._monthDays[d]),g=0;g<_;g++){var f=Planets.getPlanetLocationJD("Sun",l);h=CT.eq2Ec(f.RA,f.dec,s).x,0==g&&0==d&&(u=h);var m=.005;g||(m=.01);var p=h;Grids._eclipticOverviewLineList.addLine(Vector3d._transformCoordinate(Vector3d.create(Math.cos(p*Math.PI*2/360),m,Math.sin(p*Math.PI*2/360)),a),Vector3d._transformCoordinate(Vector3d.create(Math.cos(p*Math.PI*2/360),-m,Math.sin(p*Math.PI*2/360)),a)),!r||0==g&&0==d||Grids._eclipticOverviewLineList.addLine(Vector3d._transformCoordinate(Vector3d.create(Math.cos(p*Math.PI*2/360),0,Math.sin(p*Math.PI*2/360)),a),Vector3d._transformCoordinate(Vector3d.create(Math.cos(c*Math.PI*2/360),0,Math.sin(c*Math.PI*2/360)),a)),l+=1,c=h}h+=Grids._monthDays[d]}r&&Grids._eclipticOverviewLineList.addLine(Vector3d._transformCoordinate(Vector3d.create(Math.cos(u*Math.PI*2/360),0,Math.sin(u*Math.PI*2/360)),a),Vector3d._transformCoordinate(Vector3d.create(Math.cos(p*Math.PI*2/360),0,Math.sin(p*Math.PI*2/360)),a))}return Grids._eclipticOverviewLineList.drawLines(e,t,i),!0},Grids.drawEclipticText=function(e,t,i){return Grids._makeEclipticText(),Grids._eclipOvTextBatch.draw(e,t,i),!0},Grids._makeEclipticText=function(){var e=SpaceTimeController.get_now().getUTCFullYear();if(null==Grids._eclipOvTextBatch){Grids._eclipOvTextBatch=new Text3dBatch(80),Grids._eclipticTextYear=e;var t=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow()),i=Matrix3d._rotationX(-t/360*(2*Math.PI)),r=365.25;DT.isLeap(e,!0)?(Grids._monthDays[1]=29,r=366):(Grids._monthDays[1]=28,r=365),ss.ss.truncate(r),Grids._eclipticCount=ss.ss.truncate(r);for(var n=SpaceTimeController.utcToJulian(new Date(e,0,1,12,0,0)),s=0;s<12;s++){for(var a=ss.ss.truncate(Grids._monthDays[s]),o=0;o<a;o++){var l=Planets.getPlanetLocationJD("Sun",n),h=CT.eq2Ec(l.RA,l.dec,t).x;if(o===Math.floor(a/2)){var c=Vector3d._transformCoordinate(Vector3d.create(Math.cos(h*Math.PI*2/360),.025,Math.sin(h*Math.PI*2/360)),i),u=Vector3d._transformCoordinate(Vector3d.create(Math.cos(h*Math.PI*2/360),.045,Math.sin(h*Math.PI*2/360)),i);u.subtract(c),u.normalize(),Grids._eclipOvTextBatch.add(new Text3d(c,u,Grids._monthNames[s],80,159375e-9))}n+=1}Grids._monthDays[s]}}},Grids.drawPrecessionChart=function(e,t,i){return Grids._makePrecessionChart(),Grids._precTextBatch.draw(e,t,i),Grids._precLineList.drawLines(e,t,i),!0},Grids._makePrecessionChart=function(){var e=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow()),t=Matrix3d._rotationX(e/360*(2*Math.PI));if(Colors.get_white(),null==Grids._precLineList){Grids._precLineList=new SimpleLineList,Grids._precLineList.set_depthBuffered(!1);for(var i=0;i<360;i++){var r=90-e;Grids._precLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,r,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu((i+1)/15,r,1),t))}for(i=-12e3;i<13e3;i+=2e3){r=90-e;var n=-(i-2e3)/25772*24-6;Grids._precLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(n,r-.5,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(n,r+.5,1),t))}}if(null==Grids._precTextBatch)for(Grids._precTextBatch=new Text3dBatch(50),i=-12e3;i<13e3;i+=2e3){r=90-e+3,n=-(i-2e3)/25772*24-6;var s=i.toString();i?s=i<0?"  "+Math.abs(i).toString()+" BCE":Math.abs(i).toString()+" CE":(r=90-e+2,s="1 CE"),9===s.length&&(s="   "+s),Grids._precTextBatch.add(new Text3d(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(n,r,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(n+.01,r,1),t),s,75,15e-5))}},Grids.drawAltAzGrid=function(e,t,i){var r=new Coordinates(0,0),n=Coordinates.horizonToEquitorial(r,SpaceTimeController.get_location(),SpaceTimeController.get_now()),s=-(n.get_RA()+6)/24*(2*Math.PI),a=-n.get_dec()/360*(2*Math.PI),o=(Coordinates.formatDMS(n.get_RA()),Matrix3d._rotationY(-s));if(o._multiply(Matrix3d._rotationX(a)),o.invert(),null==Grids._altAzLineList){Grids._altAzLineList=new SimpleLineList,Grids._altAzLineList.set_depthBuffered(!1);for(var l=0;l<360;l+=10)for(var h=-80;h<80;h+=2)Grids._altAzLineList.addLine(Coordinates.raDecTo3dAu(l/15,h,1),Coordinates.raDecTo3dAu(l/15,h+2,1));for(h=-80;h<=80;h+=10)for(l=0;l<360;l+=5)Grids._altAzLineList.addLine(Coordinates.raDecTo3dAu(l/15,h,1),Coordinates.raDecTo3dAu((l+5)/15,h,1));var c=0;for(l=0;l<360;l+=1){switch(h=.25,c%10){case 0:c++;continue;case 5:h=.5}c++,Grids._altAzLineList.addLine(Coordinates.raDecTo3dAu(l/15,h,1),Coordinates.raDecTo3dAu(l/15,-h,1))}for(c=0,l=0;l<360;l+=90)for(c=0,h=-80;h<=80;h+=1){var u=.25;switch(c%10){case 0:c++;continue;case 5:u=.5}c++,Grids._altAzLineList.addLine(Coordinates.raDecTo3dAu((l+u)/15,h,1),Coordinates.raDecTo3dAu((l-u)/15,h,1))}}var d=e.get_world().clone(),_=e.get_worldBase().clone();return e.set_worldBase(Matrix3d.multiplyMatrix(o,e.get_world())),e.set_world(e.get_worldBase().clone()),e.makeFrustum(),Grids._altAzLineList.viewTransform=Matrix3d.invertMatrix(o),Grids._altAzLineList.drawLines(e,t,i),e.set_worldBase(_),e.set_world(d),e.makeFrustum(),!0},Grids.drawAltAzGridText=function(e,t,i){var r=new Coordinates(0,0),n=Coordinates.horizonToEquitorial(r,SpaceTimeController.get_location(),SpaceTimeController.get_now()),s=-(n.get_RA()-6)/24*(2*Math.PI),a=-n.get_dec()/360*(2*Math.PI),o=(Coordinates.formatDMS(n.get_RA()),Matrix3d._rotationY(-s-Math.PI));o._multiply(Matrix3d._rotationX(a)),o.invert(),Grids._makeAltAzGridText();var l=e.get_world().clone(),h=e.get_worldBase().clone();return e.set_worldBase(Matrix3d.multiplyMatrix(o,e.get_world())),e.set_world(e.get_worldBase().clone()),e.makeFrustum(),Grids._altAzTextBatch.viewTransform=Matrix3d.invertMatrix(o),Grids._altAzTextBatch.draw(e,t,i),e.set_worldBase(h),e.set_world(l),e.makeFrustum(),!0},Grids._makeAltAzGridText=function(){if(Colors.get_white(),null==Grids._altAzTextBatch){Grids._altAzTextBatch=new Text3dBatch(30);for(var e=0;e<360;e+=10){var t="       "+e.toString();e<10?t="   "+e.toString():e<100&&(t="     "+e.toString());var i=360-e;Grids._altAzTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(i/15-6,.4,1),Coordinates.raDecTo3dAu(i/15-6,.5,1),t,75,18e-5))}for(e=0;e<360;e+=90)for(var r=-80;r<=80;r+=10)r&&(t=r.toString(),r>0?(t="  +"+r.toString(),Grids._altAzTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(e/15,r-.4,1),Coordinates.raDecTo3dAu(e/15,r-.3,1),t,75,18e-5))):(t="  - "+t.substr(1),Grids._altAzTextBatch.add(new Text3d(Coordinates.raDecTo3dAu(e/15,r+.4,1),Coordinates.raDecTo3dAu(e/15,r+.5,1),t,75,18e-5))))}},Grids.drawEclipticGrid=function(e,t,i){if(null==Grids._eclipticLineList){Grids._eclipticLineList=new SimpleLineList,Grids._eclipticLineList.set_depthBuffered(!1);for(var r=Coordinates.meanObliquityOfEcliptic(2451545),n=Matrix3d._rotationX(-r/360*(2*Math.PI)),s=0;s<360;s+=10)for(var a=-80;a<80;a+=2)Grids._eclipticLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(s/15,a,1),n),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(s/15,a+2,1),n));for(a=-80;a<=80;a+=10)for(s=0;s<360;s+=5)Grids._eclipticLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(s/15,a,1),n),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu((s+5)/15,a,1),n));var o=0;for(s=0;s<360;s+=1){switch(a=.25,o%10){case 0:o++;continue;case 5:a=.5}o++,Grids._eclipticLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(s/15,a,1),n),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(s/15,-a,1),n))}for(o=0,s=0;s<360;s+=90)for(o=0,a=-80;a<=80;a+=1){var l=.25;switch(o%10){case 0:o++;continue;case 5:l=.5}o++,Grids._eclipticLineList.addLine(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu((s+l)/15,a,1),n),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu((s-l)/15,a,1),n))}}return Grids._eclipticLineList.drawLines(e,t,i),!0},Grids.drawEclipticGridText=function(e,t,i){return Grids._makeEclipticGridText(),Grids._eclipticTextBatch.draw(e,t,i),!0},Grids._makeEclipticGridText=function(){Colors.get_white();var e=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow()),t=Matrix3d._rotationX(-e/360*(2*Math.PI));if(null==Grids._eclipticTextBatch){Grids._eclipticTextBatch=new Text3dBatch(30);for(var i=0;i<360;i+=10){var r="       "+i.toString();i<10?r="   "+i.toString():i<100&&(r="     "+i.toString()),Grids._eclipticTextBatch.add(new Text3d(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,.4,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,.5,1),t),r,75,18e-5))}for(i=0;i<360;i+=90)for(var n=-80;n<=80;n+=10)n&&(r=n.toString(),n>0?(r="  +"+n.toString(),Grids._eclipticTextBatch.add(new Text3d(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,n-.4,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,n-.3,1),t),r,75,18e-5))):(r="  - "+r.substr(1),Grids._eclipticTextBatch.add(new Text3d(Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,n+.4,1),t),Vector3d._transformCoordinate(Coordinates.raDecTo3dAu(i/15,n+.5,1),t),r,75,18e-5))))}},Grids.drawGalacticGrid=function(e,t,i){if(null==Grids._galLineList){Grids._galLineList=new SimpleLineList,Grids._galLineList.set_depthBuffered(!1);for(var r=0;r<360;r+=10)for(var n=-80;n<80;n+=2)Grids._galLineList.addLine(Coordinates.galacticTo3dDouble(r,n),Coordinates.galacticTo3dDouble(r,n+2));for(n=-80;n<=80;n+=10)for(r=0;r<360;r+=5)Grids._galLineList.addLine(Coordinates.galacticTo3dDouble(r,n),Coordinates.galacticTo3dDouble(r+5,n));var s=0;for(r=0;r<360;r+=1){switch(n=.25,s%10){case 0:s++;continue;case 5:n=.5}s++,Grids._galLineList.addLine(Coordinates.galacticTo3dDouble(r,n),Coordinates.galacticTo3dDouble(r,-n))}for(s=0,r=0;r<360;r+=90)for(s=0,n=-80;n<=80;n+=1){var a=.25;switch(s%10){case 0:s++;continue;case 5:a=.5}s++,Grids._galLineList.addLine(Coordinates.galacticTo3dDouble(r+a,n),Coordinates.galacticTo3dDouble(r-a,n))}}return Grids._galLineList.drawLines(e,t,i),!0},Grids.drawGalacticGridText=function(e,t,i){return Grids._makeGalacticGridText(),Grids._galTextBatch.draw(e,t,i),!0},Grids._makeGalacticGridText=function(){if(null==Grids._galTextBatch){Grids._galTextBatch=new Text3dBatch(30);for(var e=0;e<360;e+=10){var t="       "+e.toString();e<10?t="   "+e.toString():e<100&&(t="     "+e.toString()),Grids._galTextBatch.add(new Text3d(Coordinates.galacticTo3dDouble(e,.4),Coordinates.galacticTo3dDouble(e,.5),t,75,18e-5))}for(e=0;e<360;e+=90)for(var i=-80;i<=80;i+=10)i&&(t=i.toString(),i>0?(t="  +"+i.toString(),Grids._galTextBatch.add(new Text3d(Coordinates.galacticTo3dDouble(e,i-.4),Coordinates.galacticTo3dDouble(e,i-.3),t,75,18e-5))):(t="  - "+t.substr(1),Grids._galTextBatch.add(new Text3d(Coordinates.galacticTo3dDouble(e,i+.4),Coordinates.galacticTo3dDouble(e,i+.5),t,75,18e-5))))}},Grids.drawPlanetGrid=function(e,t,i){if(null==Grids._planetLineList){Grids._planetLineList=new SimpleLineList,Grids._planetLineList.set_depthBuffered(!0);for(var r=0;r<360;r+=10)for(var n=-80;n<80;n+=2)Grids._planetLineList.addLine(Coordinates.geoTo3dDouble(n,r),Coordinates.geoTo3dDouble(n+2,r));for(n=-80;n<=80;n+=10)for(var s=0;s<360;s+=5)Grids._planetLineList.addLine(Coordinates.geoTo3dDouble(n,s),Coordinates.geoTo3dDouble(n,s+5));var a=0;for(r=0;r<360;r+=1){switch(n=.25,a%10){case 0:a++;continue;case 5:n=.5}a++,Grids._planetLineList.addLine(Coordinates.geoTo3dDouble(n,r),Coordinates.geoTo3dDouble(-n,r))}for(a=0,r=0;r<360;r+=90){a=0;for(var o=-80;o<=80;o+=1){var l=.25;switch(a%10){case 0:a++;continue;case 5:l=.5}a++,Grids._planetLineList.addLine(Coordinates.geoTo3dDouble(o,r+l),Coordinates.geoTo3dDouble(o,r-l))}}}return Grids._planetLineList.aaFix=!1,Grids._planetLineList.set_depthBuffered(!0),Grids._planetLineList.sky=!1,Grids._planetLineList.drawLines(e,t,i),!0},Grids.drawPlanetGridText=function(e,t,i){return Grids._makePlanetGridText(),Grids._planetTextBatch.draw(e,t,i),!0},Grids._makePlanetGridText=function(){if(null==Grids._planetTextBatch){Grids._planetTextBatch=new Text3dBatch(80);for(var e=-180;e<180;e+=10){var t="       "+e.toString();e<10?t="   "+e.toString():e<100&&(t="     "+e.toString()),Grids._planetTextBatch.add(new Text3d(Coordinates.geoTo3dDouble(.4,e),Coordinates.geoTo3dDouble(.5,e),t,-80,6e-5))}for(e=0;e<360;e+=90)for(var i=-80;i<=80;i+=10)i&&(t=i.toString(),i>0?(t="  +"+i.toString(),Grids._planetTextBatch.add(new Text3d(Coordinates.geoTo3dDouble(i-.4,e),Coordinates.geoTo3dDouble(i-.3,e),t,-80,6e-5))):(t="  - "+t.substring(1),Grids._planetTextBatch.add(new Text3d(Coordinates.geoTo3dDouble(i+.4,e),Coordinates.geoTo3dDouble(i+.5,e),t,-80,6e-5))))}};var Grids$={};function KeplerVertex(){this.ABC=new Vector3d,this.abc1=new Vector3d,this.pointSize=0,this.w=0,this.e=0,this.n=0,this.t=0,this.a=0,this.z=0,this.orbitPos=0,this.orbits=0}registerType("Grids",[Grids,Grids$,null]),KeplerVertex._sine=0,KeplerVertex._cose=1,KeplerVertex._degrad=Math.PI/180;var KeplerVertex$={fill:function(e){var t=Math.cos(e.omega*KeplerVertex._degrad),i=Math.sin(e.omega*KeplerVertex._degrad),r=Math.cos(e.i*KeplerVertex._degrad),n=Math.sin(e.i*KeplerVertex._degrad),s=i*KeplerVertex._cose,a=i*KeplerVertex._sine,o=-i*r,l=t*r*KeplerVertex._cose-n*KeplerVertex._sine,h=t*r*KeplerVertex._sine+n*KeplerVertex._cose;this.ABC.x=Math.atan2(t,o),this.ABC.y=Math.atan2(s,l),this.ABC.z=Math.atan2(a,h),this.abc1.x=Math.sqrt(t*t+o*o),this.abc1.y=Math.sqrt(s*s+l*l),this.abc1.z=Math.sqrt(a*a+h*h),this.pointSize=.1,e.a<2.5?this.color=Colors.get_white():e.a<2.83?this.color=Colors.get_red():e.a<2.96?this.color=Colors.get_green():e.a<3.3?this.color=Colors.get_magenta():e.a<5?this.color=Colors.get_cyan():e.a<10?(this.color=Colors.get_yellow(),this.pointSize=.9):(this.color=Colors.get_white(),this.pointSize=8),this.w=e.w,this.e=e.e,e.n?this.n=e.n:this.n=.9856076686/(e.a*Math.sqrt(e.a)),this.t=e.t-KeplerVertex.baseDate,this.a=e.a,this.z=0,this.orbitPos=0,this.orbits=0}};function Pointing(){this.theta=0,this.phi=0}registerType("KeplerVertex",[KeplerVertex,KeplerVertex$,null]),Pointing.create=function(e,t){var i=new Pointing;return i.theta=e,i.phi=t,i};var Pointing$={normalizeTheta:function(){this.theta=HealpixUtils.fmodulo(this.theta,2*Math.PI),this.theta>Math.PI&&(this.phi+=Math.PI,this.theta=2*Math.PI-this.theta)},normalize:function(){this.normalizeTheta(),this.phi=HealpixUtils.fmodulo(this.phi,2*Math.PI)},toString:function(){var e=new ss.ss.StringBuilder;return e.append("ptg("),e.append(this.theta),e.append(","),e.append(this.phi),e.append(")"),e.toString()}};function Tour(){this.userLevel=0,this.classification=0,this.averageRating=0,this.lengthInSecs=0,this._thumbnailUrlField=""}registerType("Pointing",[Pointing,Pointing$,null]),Tour._fromXml=function(e){var t=new Tour;return null!=e.attributes.getNamedItem("ID")&&(t.id=e.attributes.getNamedItem("ID").nodeValue),null!=e.attributes.getNamedItem("TourUrl")&&(t._tourUrl=e.attributes.getNamedItem("TourUrl").nodeValue),null!=e.attributes.getNamedItem("Title")&&(t.title=e.attributes.getNamedItem("Title").nodeValue),null!=e.attributes.getNamedItem("Description")&&(t.description=e.attributes.getNamedItem("Description").nodeValue),null!=e.attributes.getNamedItem("Classification")&&(t.classification=Enums.parse("Classification",e.attributes.getNamedItem("Classification").nodeValue)),null!=e.attributes.getNamedItem("AuthorEmail")&&(t.authorEmail=e.attributes.getNamedItem("AuthorEmail").nodeValue),null!=e.attributes.getNamedItem("Author")&&(t.author=e.attributes.getNamedItem("Author").nodeValue),null!=e.attributes.getNamedItem("AuthorURL")&&(t.authorURL=e.attributes.getNamedItem("AuthorURL").nodeValue),null!=e.attributes.getNamedItem("AuthorImageUrl")&&(t.authorImageUrl=e.attributes.getNamedItem("AuthorImageUrl").nodeValue),null!=e.attributes.getNamedItem("AverageRating")&&(t.averageRating=parseFloat(e.attributes.getNamedItem("AverageRating").nodeValue)),null!=e.attributes.getNamedItem("LengthInSecs")&&(t.lengthInSecs=parseFloat(e.attributes.getNamedItem("LengthInSecs").nodeValue)),null!=e.attributes.getNamedItem("OrganizationUrl")&&(t.organizationUrl=e.attributes.getNamedItem("OrganizationUrl").nodeValue),null!=e.attributes.getNamedItem("OrganizationName")&&(t.organizationName=e.attributes.getNamedItem("OrganizationName").nodeValue),null!=e.attributes.getNamedItem("RelatedTours")&&(t.relatedTours=e.attributes.getNamedItem("RelatedTours").nodeValue),null!=e.attributes.getNamedItem("Keywords")&&(t.keywords=e.attributes.getNamedItem("Keywords").nodeValue),null!=e.attributes.getNamedItem("ThumbnailUrl")&&t.set_thumbnailUrl(e.attributes.getNamedItem("ThumbnailUrl").nodeValue),t};var Tour$={get_name:function(){return this.title},get_thumbnail:function(){return this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,e},get_thumbnailUrl:function(){return ss.ss.emptyString(this._thumbnailUrlField)?freestandingMode?URLHelpers.singleton.engineAssetUrl("thumb_star.jpg"):ss.ss.format(URLHelpers.singleton.coreStaticUrl("wwtweb/GetTourThumbnail.aspx?GUID={0}"),this.id):this._thumbnailUrlField},set_thumbnailUrl:function(e){return this._thumbnailUrlField=e,e},get_tourUrl:function(){return ss.ss.emptyString(this._tourUrl)&&!freestandingMode?ss.ss.format(URLHelpers.singleton.coreStaticUrl("wwtweb/GetTour.aspx?GUID={0}"),this.id):this._tourUrl},set_tourUrl:function(e){return this._tourUrl=e,e},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_isImage:function(){return!1},get_isTour:function(){return!0},get_isFolder:function(){return!1},get_isCloudCommunityItem:function(){return!1},get_readOnly:function(){return!1},get_children:function(){return[]}};function VideoOutputType(e,t,i,r,n){this.fps=0,this.width=0,this.height=0,this.totalFrames=0,this.waitDownload=!1,this.format="image/jpeg",this.width=e,this.height=t,this.fps=i,this.format=r,this.waitDownload=n}registerType("Tour",[Tour,Tour$,null,IThumbnail]);var VideoOutputType$={};function ViewMoverKenBurnsStyle(e,t,i,r,n,s){this.interpolationType=0,this.fastDirectionMove=!1,this._toTargetTime=0,this._dateTimeSpan=0,this._complete=!1,this._midpointFired=!1,this.interpolationType=s,Math.abs(e.lng-t.lng)>180&&(e.lng>t.lng?e.lng-=360:e.lng+=360),this._fromDateTime=r,this._toDateTime=n,this._dateTimeSpan=n-r,this._from=e.copy(),this._to=t.copy(),this._fromTime=SpaceTimeController.get_metaNow(),this._toTargetTime=i}registerType("VideoOutputType",[VideoOutputType,VideoOutputType$,null]);var ViewMoverKenBurnsStyle$={get_complete:function(){return this._complete},get_currentPosition:function(){var e=(SpaceTimeController.get_metaNow()-this._fromTime)/1e3/this._toTargetTime;return!this._midpointFired&&e>=.5&&(this._midpointFired=!0,null!=this._midpoint&&this._midpoint()),e>=1?(e=1,this._complete=!0,this._to.copy()):Settings.get_active().get_galacticMode()&&globalRenderContext.space?CameraParameters.interpolateGreatCircle(this._from,this._to,e,this.interpolationType,this.fastDirectionMove):CameraParameters.interpolate(this._from,this._to,e,this.interpolationType,this.fastDirectionMove)},get_currentDateTime:function(){var e=(SpaceTimeController.get_metaNow()-this._fromTime)/1e3/this._toTargetTime,t=this._dateTimeSpan*e;return new Date(this._fromDateTime.getTime()+ss.ss.truncate(t))},get_midpoint:function(){return this._midpoint},set_midpoint:function(e){return this._midpoint=e,e},get_moveTime:function(){return this._toTargetTime}};function ViewMoverSlew(){this._upTargetTime=0,this._downTargetTime=0,this._toTargetTime=0,this._upTimeFactor=.6,this._downTimeFactor=.6,this._travelTimeFactor=7,this._midpointFired=!1,this._complete=!1}registerType("ViewMoverKenBurnsStyle",[ViewMoverKenBurnsStyle,ViewMoverKenBurnsStyle$,null,IViewMover]),ViewMoverSlew.create=function(e,t,i){var r=new ViewMoverSlew;if(r.init(e,t),i){const e=r._toTargetTime,t=r._upTargetTime/e,n=r._downTargetTime/e;r._upTargetTime=i*t,r._downTargetTime=i*n,r._toTargetTime=i}return r},ViewMoverSlew.createUpDown=function(e,t,i){var r=new ViewMoverSlew;return r._upTimeFactor=r._downTimeFactor=i,r.init(e.copy(),t.copy()),r};var ViewMoverSlew$={init:function(e,t){Math.abs(e.lng-t.lng)>180&&(e.lng>t.lng?e.lng-=360:e.lng+=360),t.zoom<=0&&(t.zoom=360),e.zoom<=0&&(e.zoom=360),this._from=e,this._to=t,this._fromTime=SpaceTimeController.get_metaNow();var i,r=360,n=Math.abs(e.lng-t.lng),s=Math.abs(e.lat-t.lat),a=Math.sqrt(s*s+n*n);(r=a/3*20)>360&&(r=360),r<e.zoom&&(r=e.zoom),i=a/180*(360/r)*this._travelTimeFactor;var o=Math.max(Math.abs(e.angle-t.angle),Math.abs(e.rotation-t.rotation)),l=Math.max(Math.abs(Util.logN(r,2)-Util.logN(e.zoom,2)),o);this._upTargetTime=this._upTimeFactor*l,this._downTargetTime=this._upTargetTime+i;var h=Math.abs(Util.logN(r,2)-Util.logN(t.zoom,2));this._toTargetTime=this._downTargetTime+Math.max(this._downTimeFactor*h,o),this._fromTop=e.copy(),this._fromTop.zoom=r,this._fromTop.angle=(e.angle+t.angle)/2,this._fromTop.rotation=(e.rotation+t.rotation)/2,this._toTop=t.copy(),this._toTop.zoom=this._fromTop.zoom,this._toTop.angle=this._fromTop.angle,this._toTop.rotation=this._fromTop.rotation},get_complete:function(){return this._complete},get_currentPosition:function(){var e=(SpaceTimeController.get_metaNow()-this._fromTime)/1e3;if(e<this._upTargetTime)return CameraParameters.interpolate(this._from,this._fromTop,e/this._upTargetTime,3,!1);if(e<this._downTargetTime)return e-=this._upTargetTime,Settings.get_active().get_galacticMode()&&globalRenderContext.space?CameraParameters.interpolateGreatCircle(this._fromTop,this._toTop,e/(this._downTargetTime-this._upTargetTime),3,!1):CameraParameters.interpolate(this._fromTop,this._toTop,e/(this._downTargetTime-this._upTargetTime),3,!1);this._midpointFired||(this._midpointFired=!0,null!=this._midpoint&&this._midpoint());var t=(e-=this._downTargetTime)/(this._toTargetTime-this._downTargetTime);return t>1?(t=1,this._complete=!0,this._to.copy()):CameraParameters.interpolate(this._toTop,this._to,t,3,!1)},get_currentDateTime:function(){return SpaceTimeController.updateClock(),SpaceTimeController.get_now()},get_midpoint:function(){return this._midpoint},set_midpoint:function(e){return this._midpoint=e,e},get_moveTime:function(){return this._toTargetTime}};function VizLayer(){this.table=[],this.items=[],this._imageReady=!1,this._dateColumn=0,this._latColumn=1,this._lngColumn=2,this._depthColumn=3,this._magColumn=4}registerType("ViewMoverSlew",[ViewMoverSlew,ViewMoverSlew$,null,IViewMover]),VizLayer.earthRadius=6371e3;var VizLayer$={load:function(e){var t=this,i=e.split("\r\n");this._starProfile=document.createElement("img"),this._starProfile.addEventListener("load",(function(e){t._imageReady=!0}),!1),this._starProfile.src=URLHelpers.singleton.engineAssetUrl("StarProfileAlpha.png");for(var r=!1,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;r?this.table.push(s.split("\t")):(this.header=s.split("\t"),r=!0)}},prepare:function(){this._worldList=new Array(this.table.length),this._transformedList=new Array(this.table.length);for(var e=0,t=ss.ss.enumerate(this.table);t.moveNext();){var i=t.current,r=new DataItem;r.eventTime=ss.ss.date(i[this._dateColumn]);var n=(6371e3-1e3*parseFloat(i[this._depthColumn]))/6371e3;r.location=Coordinates.geoTo3dRad(parseFloat(i[this._latColumn]),parseFloat(i[this._lngColumn])+180,n),r.tranformed=new Vector3d,r.size=Math.pow(2,parseFloat(i[this._magColumn]))/50,this._worldList[e]=r.location,this._transformedList[e]=r.tranformed,this.items.push(r),e++}},draw:function(e){if(this._imageReady){e.device.save(),e.WVP.projectArrayToScreen(this._worldList,this._transformedList);var t=e.device;t.globalAlpha=.4;for(var i=e.width,r=e.height,n=(Vector3d.makeCopy(e.get_viewPoint()),e.get_fovScale()/100),s=ss.ss.enumerate(this.items);s.moveNext();){var a=s.current;if(a.tranformed.z<1){var o=a.tranformed.x,l=a.tranformed.y,h=4*a.size/n,c=h/2;o>-c&&o<i+c&&l>-c&&l<r+c&&t.drawImage(this._starProfile,o-h/2,l-h/2,h,h)}}e.device.restore()}}};function ColorPicker(){this.callBack=null,this.color=Colors.get_white()}registerType("VizLayer",[VizLayer,VizLayer$,null]);var ColorPicker$={nonMenuClick:function(e){},show:function(e){globalScriptInterface.showColorPicker(this,e)},getColorFromClick:function(e){var t=document.getElementById("colorhex"),i=document.createElement("canvas");i.width=t.width,i.height=t.height;var r=i.getContext("2d");r.drawImage(t,0,0);var n=r.getImageData(e.offsetX,e.offsetY,1,1).data;return this.color=Color.fromArgb(n[3],n[0],n[1],n[2]),this.color},pickColor:function(e){this.callBack(this.color)}};function Dialog(){}registerType("ColorPicker",[ColorPicker,ColorPicker$,null]);var Dialog$={add_showDialogHook:function(e){this.__showDialogHook=ss.ss.bindAdd(this.__showDialogHook,e)},remove_showDialogHook:function(e){this.__showDialogHook=ss.ss.bindSub(this.__showDialogHook,e)},show:function(e,t){null!=this.__showDialogHook&&this.__showDialogHook(e,t)}};function Histogram(){this.image=null,this.layer=null,this.tile=null,this._dropDown=null,this._downPosition=0,this._lowPosition=0,this._highPosition=255,this._center=127,this._ignoreNextClick=!1,this._dragType=4,this._updated=!1,this.selectedCurveStyle=0}registerType("Dialog",[Dialog,Dialog$,null]),Histogram.updateImage=function(e,t){if(!useGlVersion2){var i=ss.ss.safeCast(e.get_imageSet().get_wcsImage(),FitsImageJs);tileCacheGetTile(0,0,0,e.get_imageSet(),null).texture2d=i.getBitmap().getTexture()}},Histogram.updateScale=function(e,t,i,r){if(e.get_imageSet().get_fitsProperties().scaleType=t,e.get_imageSet().get_fitsProperties().lowerCut=i,e.get_imageSet().get_fitsProperties().upperCut=r,!useGlVersion2){var n=ss.ss.safeCast(e.get_imageSet().get_wcsImage(),FitsImageJs);tileCacheGetTile(0,0,0,e.get_imageSet(),null).texture2d=n.getBitmap().getTexture()}},Histogram.updateColorMapper=function(e,t){if(e.get_imageSet().get_fitsProperties().colorMapName=t,!useGlVersion2){var i=ss.ss.safeCast(e.get_imageSet().get_wcsImage(),FitsImageJs);tileCacheGetTile(0,0,0,e.get_imageSet(),null).texture2d=i.getBitmap().getTexture()}};var Histogram$={close:function(e){var t=document.getElementById("histogram");document.getElementById("histogramClose"),t.style.display="none",window.removeEventListener("click",ss.ss.bind("close",this),!0);var i=document.getElementById("graph");i.removeEventListener("mousedown",ss.ss.bind("onPointerDown",this),!1),i.removeEventListener("mousemove",ss.ss.bind("onPointerMove",this),!1),i.removeEventListener("mouseup",ss.ss.bind("onPointerUp",this),!1),this._dropDown.removeEventListener("change",ss.ss.bind("curveStyleSelected",this),!1),this._dropDown.removeEventListener("click",ss.ss.bind("ignoreMe",this),!0)},show:function(e){this.tile=tileCacheGetTile(0,0,0,this.layer.get_imageSet(),null);var t=document.getElementById("histogram"),i=document.getElementById("histogramClose");t.style.display="block",t.style.left=e.x.toString()+"px",t.style.top=e.y.toString()+"px",this.selectedCurveStyle=this.layer.get_imageSet().get_fitsProperties().scaleType,this._dropDown=document.getElementById("ScaleTypePicker"),this._dropDown.addEventListener("change",ss.ss.bind("curveStyleSelected",this),!1),this._dropDown.addEventListener("click",ss.ss.bind("ignoreMe",this),!0);var r=document.getElementById("graph");r.addEventListener("pointerdown",ss.ss.bind("onPointerDown",this),!1),r.addEventListener("pointermove",ss.ss.bind("onPointerMove",this),!1),r.addEventListener("pointerup",ss.ss.bind("onPointerUp",this),!1),i.addEventListener("click",ss.ss.bind("close",this),!0),this.draw()},ignoreMe:function(e){this._ignoreNextClick=!0},curveStyleSelected:function(e){this.selectedCurveStyle=this._dropDown.selectedIndex,this.setUpdateTimer(),this.layer.get_imageSet().get_fitsProperties().scaleType=this.selectedCurveStyle,this.draw(),this._ignoreNextClick=!0},onPointerDown:function(e){var t=document.getElementById("graph"),i=Mouse.offsetX(t,e),r=Mouse.offsetY(t,e);t.setPointerCapture(e.pointerId),Math.abs(i-this._center)<10&&Math.abs(r-75)<10?this._dragType=3:Math.abs(i-this._lowPosition)<10?this._dragType=0:Math.abs(i-this._highPosition)<10?this._dragType=1:(this._dragType=2,this._downPosition=Math.min(255,Math.max(0,i)),this.draw()),e.cancelBubble=!0},onPointerMove:function(e){var t=document.getElementById("graph"),i=Mouse.offsetX(t,e);switch(Mouse.offsetY(t,e),this._dragType){case 0:this._lowPosition=Math.min(255,Math.max(0,i));break;case 1:this._highPosition=Math.min(255,Math.max(0,i));break;case 2:this._lowPosition=this._downPosition,this._highPosition=Math.min(255,Math.max(0,i));break;case 3:var r=Math.abs(this._highPosition-this._lowPosition)/2,n=Math.min(255-r,Math.max(r,i)),s=this._center-n;this._lowPosition-=s,this._highPosition-=s;break;case 4:return}this._center=(this._lowPosition+this._highPosition)/2,this.draw();var a=(this.layer.get_imageSet().get_fitsProperties().maxVal-this.layer.get_imageSet().get_fitsProperties().minVal)/256,o=this.layer.get_imageSet().get_fitsProperties().minVal+this._lowPosition*a,l=this.layer.get_imageSet().get_fitsProperties().minVal+this._highPosition*a;this.setUpdateTimer(),this.layer.get_imageSet().get_fitsProperties().upperCut=l,this.layer.get_imageSet().get_fitsProperties().lowerCut=o,this.layer.get_imageSet().get_fitsProperties().scaleType=this.selectedCurveStyle,e.cancelBubble=!0},onPointerUp:function(e){e.srcElement.releasePointerCapture(e.pointerId),4!==this._dragType&&(this._dragType=4,this.setUpdateTimer(),this._ignoreNextClick=!0),e.cancelBubble=!0},setUpdateTimer:function(){var e=this;useGlVersion2||(setTimeout((function(){e.update()}),500),this._updated=!1)},update:function(){if(!this._updated){if(ss.ss.canCast(this.image,FitsImageJs)){var e=(this.layer.get_imageSet().get_fitsProperties().maxVal-this.layer.get_imageSet().get_fitsProperties().minVal)/256,t=this.layer.get_imageSet().get_fitsProperties().minVal+this._lowPosition*e,i=this.layer.get_imageSet().get_fitsProperties().minVal+this._highPosition*e;this.tile.texture2d=this.image.getScaledBitmap(t,i,this.selectedCurveStyle,0,null).getTexture()}this._updated=!0}},draw:function(){var e=document.getElementById("graph").getContext("2d");null!=this.image&&this.image.drawHistogram(e);var t="rgba(0,0,255,255)";e.strokeStyle="rgba(255,0,0,255)",e.beginPath(),e.moveTo(this._lowPosition,0),e.lineTo(this._lowPosition,150),e.stroke(),e.strokeStyle="rgba(0,255,0,255)",e.beginPath(),e.moveTo(this._highPosition,0),e.lineTo(this._highPosition,150),e.stroke(),e.strokeStyle=t,e.beginPath(),e.arc(this._center,75,10,0,2*Math.PI,!1),e.closePath(),e.stroke();var i=[];switch(this.selectedCurveStyle){case 0:i.length=0,i.push(Vector2d.create(this._lowPosition,150)),i.push(Vector2d.create(this._highPosition,0));break;case 1:i.length=0;for(var r=150/Math.log(255),n=(l=this._highPosition-this._lowPosition)<0?-1:1,s=Math.abs(256/(l||1e-6)),a=1e-6,o=this._lowPosition;o!==this._highPosition;o+=n)i.push(Vector2d.create(o,150-Math.log(a)*r)),a+=s;break;case 2:for(i.length=0,r=150/Math.pow(255,2),n=(l=this._highPosition-this._lowPosition)<0?-1:1,s=Math.abs(256/(l||1e-6)),a=1e-6,o=this._lowPosition;o!==this._highPosition;o+=n)i.push(Vector2d.create(o,150-Math.pow(a,2)*r)),a+=s;break;case 3:var l;for(i.length=0,r=150/Math.sqrt(255),n=(l=this._highPosition-this._lowPosition)<0?-1:1,s=Math.abs(256/(l||1e-6)),a=1e-6,o=this._lowPosition;o!==this._highPosition;o+=n)i.push(Vector2d.create(o,150-Math.sqrt(a)*r)),a+=s}if(i.length>1){for(e.beginPath(),e.strokeStyle=t,e.moveTo(i[0].x,i[0].y),o=1;o<i.length;o++)e.lineTo(i[o].x,i[o].y);e.stroke()}}};registerType("Histogram",[Histogram,Histogram$,null]);var pako=__webpack_require__(48),pako_default=__webpack_require__.n(pako),AltUnits={meters:1,feet:2,inches:3,miles:4,kilometers:5,astronomicalUnits:6,lightYears:7,parsecs:8,megaParsecs:9,custom:10};registerType("AltUnits",AltUnits),registerEnum("AltUnits",AltUnits);var FadeType={fadeIn:1,fadeOut:2,both:3,none:4};function DomainValue(e,t){this.markerIndex=4,this.customMarker=null,this.text=e,this.markerIndex=t}registerType("FadeType",FadeType),registerEnum("FadeType",FadeType);var DomainValue$={};function Layer(){this.id=Guid.newGuid(),this.loadedFromTour=!1,this.tourDocument=null,this.opacity=1,this.opened=!1,this._startTime=ss.ss.date("01/01/1900"),this._endTime=ss.ss.date("01/01/2100"),this._fadeSpan=0,this._fadeType=4,this.version=0,this.color=Colors.get_white(),this.enabled=!0,this.astronomical=!1}registerType("DomainValue",[DomainValue,DomainValue$,null]);var Layer$={getPrimaryUI:function(){return null},getFileStreamUrl:function(e){return null!=this.tourDocument?this.tourDocument.getFileStream(e):null},get_opacity:function(){return this.opacity},set_opacity:function(e){return this.opacity!==e&&(this.version++,this.opacity=e),e},get_opened:function(){return this.opened},set_opened:function(e){return this.opened!==e&&(this.version++,this.opened=e),e},get_startTime:function(){return this._startTime},set_startTime:function(e){return ss.ss.compareDates(this._startTime,e)||(this.version++,this._startTime=e),e},get_endTime:function(){return this._endTime},set_endTime:function(e){return ss.ss.compareDates(this._endTime,e)||(this.version++,this._endTime=e),e},get_fadeSpan:function(){return this._fadeSpan},set_fadeSpan:function(e){return this.version++,this._fadeSpan=e,e},get_fadeType:function(){return this._fadeType},set_fadeType:function(e){return this._fadeType!==e&&(this.set_version(this.get_version()+1),this._fadeType=e),e},get_version:function(){return this.version},set_version:function(e){return this.version=e,e},findClosest:function(e,t,i,r){return i},hoverCheckScreenSpace:function(e){return!1},clickCheckScreenSpace:function(e){return!1},draw:function(e,t,i){return!0},preDraw:function(e,t){return!0},updateData:function(e,t,i,r){return!0},upadteData:function(e,t,i,r){return this.updateData(e,t,i,r)},canCopyToClipboard:function(){return!1},copyToClipboard:function(){},getParams:function(){var e=new Array(5);return e[0]=this.color.r/255,e[1]=this.color.g/255,e[2]=this.color.b/255,e[3]=this.color.a/255,e[4]=this.opacity,e},setParams:function(e){5===e.length&&(this.opacity=e[4],this.color=Color.fromArgb(255*e[3],255*e[0],255*e[1],255*e[2]))},getParamNames:function(){return["Color.Red","Color.Green","Color.Blue","Color.Alpha","Opacity"]},getEditUI:function(){return ss.ss.safeCast(this,IUiController)},cleanUp:function(){},get_name:function(){return this._name},set_name:function(e){return this._name!==e&&(this.version++,this._name=e),e},toString:function(){return this._name},get_referenceFrame:function(){return this.referenceFrame},set_referenceFrame:function(e){return this.referenceFrame=e,e},getProps:function(){return""},get_color:function(){return this.color},set_color:function(e){return this.color!==e&&(this.color=e,this.version++),e},colorChanged:function(){},get_colorValue:function(){return this.get_color().toString()},set_colorValue:function(e){return this.set_color(Color.fromName(e)),e},get_enabled:function(){return this.enabled},set_enabled:function(e){return this.enabled=e,e},get_astronomical:function(){return this.astronomical},set_astronomical:function(e){return this.astronomical!==e&&(this.version++,this.astronomical=e),e},getTypeName:function(){return"TerraViewer.Layer"},saveToXml:function(e){e._writeStartElement("Layer"),e._writeAttributeString("Id",this.id.toString()),e._writeAttributeString("Type",this.getTypeName()),e._writeAttributeString("Name",this.get_name()),e._writeAttributeString("ReferenceFrame",this.referenceFrame),e._writeAttributeString("Color",this.color.save()),e._writeAttributeString("Opacity",this.opacity.toString()),e._writeAttributeString("StartTime",Util.xmlDate(this.get_startTime())),e._writeAttributeString("EndTime",Util.xmlDate(this.get_endTime())),e._writeAttributeString("FadeSpan",this.get_fadeSpan().toString()),e._writeAttributeString("FadeType",this.get_fadeType().toString()),this.writeLayerProperties(e),e._writeEndElement()},writeLayerProperties:function(e){},initializeFromXml:function(e){},initFromXml:function(e){if(this.id=Guid.fromString(e.attributes.getNamedItem("Id").nodeValue),this.set_name(e.attributes.getNamedItem("Name").nodeValue),this.referenceFrame=e.attributes.getNamedItem("ReferenceFrame").nodeValue,this.color=Color.load(e.attributes.getNamedItem("Color").nodeValue),this.opacity=parseFloat(e.attributes.getNamedItem("Opacity").nodeValue),null!=e.attributes.getNamedItem("StartTime")&&this.set_startTime(new Date(e.attributes.getNamedItem("StartTime").nodeValue)),null!=e.attributes.getNamedItem("EndTime")&&this.set_endTime(new Date(e.attributes.getNamedItem("EndTime").nodeValue)),null!=e.attributes.getNamedItem("FadeSpan")&&this.set_fadeSpan(Util.parseTimeSpan(e.attributes.getNamedItem("FadeSpan").nodeValue)),null!=e.attributes.getNamedItem("FadeType"))switch(e.attributes.getNamedItem("FadeType").nodeValue){case"In":this.set_fadeType(1);break;case"Out":this.set_fadeType(2);break;case"Both":this.set_fadeType(3);break;case"None":this.set_fadeType(4)}this.initializeFromXml(e)},loadData:function(e,t){},addFilesToCabinet:function(e){},getStringFromGzipBlob:function(e,t){var i=new FileReader;i.onloadend=function(e){var i="";try{i=pako_default().inflate(e.target.result,{to:"string"})}catch(t){var r=t.toString();if("incorrect header check"!==r&&"unknown compression method"!==r)throw t;i=String.fromCharCode.apply(null,new Uint8Array(e.target.result))}t(i)},i.readAsArrayBuffer(e)}};function LayerCollection(){Layer.call(this)}registerType("Layer",[Layer,Layer$,null]);var LayerCollection$={draw:function(e,t,i){return Layer.prototype.draw.call(this,e,t,!1)}};function LayerUI(){}registerType("LayerCollection",[LayerCollection,LayerCollection$,Layer]),LayerUI._type=null;var LayerUI$={get_hasTreeViewNodes:function(){return!1},getTreeNodes:function(){return null},getNodeContextMenu:function(e){return null},setUICallbacks:function(e){}};function LayerUIMenuItem(){this._tag=null,this._isChecked=!1,this._isEnabled=!0,this._subMenus=null}registerType("LayerUI",[LayerUI,LayerUI$,null]);var LayerUIMenuItem$={get_name:function(){return this._name},set_name:function(e){return this._name=e,e},get_tag:function(){return this._tag},set_tag:function(e){return this._tag=e,e},get_checked:function(){return this._isChecked},set_checked:function(e){return this._isChecked=e,e},get_enabled:function(){return this._isEnabled},set_enabled:function(e){return this._isEnabled=e,e},add_menuItemSelected:function(e){this.__menuItemSelected=ss.ss.bindAdd(this.__menuItemSelected,e)},remove_menuItemSelected:function(e){this.__menuItemSelected=ss.ss.bindSub(this.__menuItemSelected,e)},fireMenuItemSelected:function(){null!=this.__menuItemSelected&&this.__menuItemSelected(this)},get_subMenus:function(){return null==this._subMenus&&(this._subMenus=[]),this._subMenus}};function LayerUITreeNode(){this._parent=null,this._level=0,this._open=!1,this._isChecked=!1,this._bold=!1,this._color=Colors.get_white(),this._nodes=null}registerType("LayerUIMenuItem",[LayerUIMenuItem,LayerUIMenuItem$,null]);var LayerUITreeNode$={add_nodeChecked:function(e){this.__nodeChecked=ss.ss.bindAdd(this.__nodeChecked,e)},remove_nodeChecked:function(e){this.__nodeChecked=ss.ss.bindSub(this.__nodeChecked,e)},fireNodeChecked:function(e){null!=this.__nodeChecked&&this.__nodeChecked(this,e)},add_nodeUpdated:function(e){this.__nodeUpdated=ss.ss.bindAdd(this.__nodeUpdated,e)},remove_nodeUpdated:function(e){this.__nodeUpdated=ss.ss.bindSub(this.__nodeUpdated,e)},fireNodeUpdated:function(){null!=this.__nodeUpdated&&this.__nodeUpdated(this)},add_nodeSelected:function(e){this.__nodeSelected=ss.ss.bindAdd(this.__nodeSelected,e)},remove_nodeSelected:function(e){this.__nodeSelected=ss.ss.bindSub(this.__nodeSelected,e)},fireNodeSelected:function(){null!=this.__nodeSelected&&this.__nodeSelected(this)},add_nodeActivated:function(e){this.__nodeActivated=ss.ss.bindAdd(this.__nodeActivated,e)},remove_nodeActivated:function(e){this.__nodeActivated=ss.ss.bindSub(this.__nodeActivated,e)},fireNodeActivated:function(){null!=this.__nodeActivated&&this.__nodeActivated(this)},get_name:function(){return this._name},set_name:function(e){return this._name!==e&&(this._name=e,this.fireNodeUpdated()),e},get_parent:function(){return this._parent},set_parent:function(e){return this._parent=e,e},get_level:function(){return this._level},set_level:function(e){return this._level=e,e},get_tag:function(){return this._tag},set_tag:function(e){return this._tag=e,e},get_referenceTag:function(){return this._referenceTag},set_referenceTag:function(e){return this._referenceTag=e,e},get_opened:function(){return this._open},set_opened:function(e){return this._open!==e&&(this._open=e,this.fireNodeUpdated()),e},get_checked:function(){return this._isChecked},set_checked:function(e){return this._isChecked!==e&&(this._isChecked=e,this.fireNodeUpdated()),e},get_bold:function(){return this._bold},set_bold:function(e){return this._bold!==e&&(this._bold=e,this.fireNodeUpdated()),e},get_color:function(){return this._color},set_color:function(e){return this._color!==e&&(this._color=e,this.fireNodeUpdated()),e},add:function(e){var t=new LayerUITreeNode;return t.set_name(e),t.set_parent(this),t.set_level(this.get_level()+1),this.get_nodes().push(t),t},get_nodes:function(){return null==this._nodes&&(this._nodes=[]),this._nodes}};function GreatCirlceRouteLayer(){this._triangleList$1=null,this._latStart$1=0,this._lngStart$1=0,this._latEnd$1=0,this._lngEnd$1=0,this._width$1=4,this._percentComplete$1=100,Layer.call(this)}registerType("LayerUITreeNode",[LayerUITreeNode,LayerUITreeNode$,null]);var GreatCirlceRouteLayer$={getTypeName:function(){return"TerraViewer.GreatCirlceRouteLayer"},cleanUp:function(){null!=this._triangleList$1&&this._triangleList$1.clear(),this._triangleList$1=null,Layer.prototype.cleanUp.call(this)},draw:function(e,t,i){return null==this._triangleList$1&&this._initializeRoute$1(e),this._triangleList$1.jNow=this._percentComplete$1/100,this._triangleList$1.draw(e,t*this.get_opacity(),2),!0},_initializeRoute$1:function(e){this._triangleList$1=new TriangleList,this._triangleList$1.decay=1e3,this._triangleList$1.sky=this.get_astronomical(),this._triangleList$1.timeSeries=!0,this._triangleList$1.depthBuffered=!1,this._triangleList$1.autoTime=!1;var t=Coordinates.geoTo3dDouble(this._latStart$1,this._lngStart$1),i=Coordinates.geoTo3dDouble(this._latEnd$1,this._lngEnd$1),r=Vector3d.subtractVectors(i,t);r.normalize();var n=t;n.normalize();var s=Vector3d.cross(n,r),a=Vector3d.cross(r,n);s.normalize(),a.normalize(),s.multiply(.001*this._width$1),a.multiply(.001*this._width$1);for(var o=new Vector3d,l=new Vector3d,h=!0,c=0;c<=500;c++){var u=Vector3d.lerp(t,i,c/500);u.normalize();var d=u,_=u;d.add(s),_.add(a),h?h=!1:this._triangleList$1.addQuad(l,o,_,d,this.get_color(),new Dates(c/500,2)),o=d,l=_}},getParams:function(){return[this._percentComplete$1]},getParamNames:function(){return["Percentage"]},setParams:function(e){e.length>0&&(this._percentComplete$1=e[0])},get_latStart:function(){return this._latStart$1},set_latStart:function(e){return this._latStart$1!==e&&(this._latStart$1=e,this.version++),e},get_lngStart:function(){return this._lngStart$1},set_lngStart:function(e){return this._lngStart$1!==e&&(this._lngStart$1=e,this.version++),e},get_latEnd:function(){return this._latEnd$1},set_latEnd:function(e){return this._latEnd$1!==e&&(this._latEnd$1=e,this.version++),e},get_lngEnd:function(){return this._lngEnd$1},set_lngEnd:function(e){return this._lngEnd$1!==e&&(this._lngEnd$1=e,this.version++),e},get_width:function(){return this._width$1},set_width:function(e){return this._width$1!==e&&(this._width$1=e,this.version++),e},get_percentComplete:function(){return this._percentComplete$1},set_percentComplete:function(e){return this._percentComplete$1!==e&&(this._percentComplete$1=e,this.version++),e},writeLayerProperties:function(e){e._writeAttributeString("LatStart",this.get_latStart().toString()),e._writeAttributeString("LngStart",this.get_lngStart().toString()),e._writeAttributeString("LatEnd",this.get_latEnd().toString()),e._writeAttributeString("LngEnd",this.get_lngEnd().toString()),e._writeAttributeString("Width",this.get_width().toString()),e._writeAttributeString("PercentComplete",this.get_percentComplete().toString())},initializeFromXml:function(e){this._latStart$1=parseFloat(e.attributes.getNamedItem("LatStart").nodeValue),this._lngStart$1=parseFloat(e.attributes.getNamedItem("LngStart").nodeValue),this._latEnd$1=parseFloat(e.attributes.getNamedItem("LatEnd").nodeValue),this._lngEnd$1=parseFloat(e.attributes.getNamedItem("LngEnd").nodeValue),this._width$1=parseFloat(e.attributes.getNamedItem("Width").nodeValue),this._percentComplete$1=parseFloat(e.attributes.getNamedItem("PercentComplete").nodeValue)}};function GridLayer(){Layer.call(this)}registerType("GreatCirlceRouteLayer",[GreatCirlceRouteLayer,GreatCirlceRouteLayer$,Layer]);var GridLayer$={draw:function(e,t,i){return Grids.drawPlanetGrid(e,t*this.get_opacity(),this.get_color()),Grids.drawPlanetGridText(e,t*this.get_opacity(),this.get_color()),!0}};function ImageSetLayer(){this._imageSet$1=null,this._extension$1=".txt",this._overrideDefaultLayer$1=!1,this._loaded$1=!1,Layer.call(this)}registerType("GridLayer",[GridLayer,GridLayer$,Layer]),ImageSetLayer.create=function(e){var t=new ImageSetLayer;return t._imageSet$1=e,t};var ImageSetLayer$={get_imageSet:function(){return this._imageSet$1},set_imageSet:function(e){return this._imageSet$1=e,e},get_overrideDefaultLayer:function(){return this._overrideDefaultLayer$1},set_overrideDefaultLayer:function(e){return this._overrideDefaultLayer$1=e,e},getFitsImage:function(){return ss.ss.safeCast(this._imageSet$1.get_wcsImage(),FitsImage)},_isFitsImageset$1:function(){var e=".fits"===this._imageSet$1.get_extension();return ss.ss.canCast(this._imageSet$1.get_wcsImage(),FitsImage)||null==this._imageSet$1.get_wcsImage()&&e},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"ImageSet");this._imageSet$1=Imageset.fromXMLNode(t),null!=e.attributes.getNamedItem("Extension")&&(this._extension$1=e.attributes.getNamedItem("Extension").nodeValue),null!=e.attributes.getNamedItem("ScaleType")&&(this.get_imageSet().get_fitsProperties().scaleType=Enums.parse("ScaleTypes",e.attributes.getNamedItem("ScaleType").nodeValue)),null!=e.attributes.getNamedItem("MinValue")&&(this.get_imageSet().get_fitsProperties().minVal=parseFloat(e.attributes.getNamedItem("MinValue").nodeValue),this.get_imageSet().get_fitsProperties().lowerCut=null!=e.attributes.getNamedItem("LowerCut")?parseFloat(e.attributes.getNamedItem("LowerCut").nodeValue):this.get_imageSet().get_fitsProperties().minVal),null!=e.attributes.getNamedItem("MaxValue")&&(this.get_imageSet().get_fitsProperties().maxVal=parseFloat(e.attributes.getNamedItem("MaxValue").nodeValue),this.get_imageSet().get_fitsProperties().upperCut=null!=e.attributes.getNamedItem("UpperCut")?parseFloat(e.attributes.getNamedItem("UpperCut").nodeValue):this.get_imageSet().get_fitsProperties().maxVal),null!=e.attributes.getNamedItem("ColorMapperName")&&(this.get_imageSet().get_fitsProperties().colorMapName=e.attributes.getNamedItem("ColorMapperName").nodeValue),null!=e.attributes.getNamedItem("OverrideDefault")&&(this._overrideDefaultLayer$1=ss.ss.boolean(e.attributes.getNamedItem("OverrideDefault").nodeValue))},draw:function(e,t,i){return!!this._loaded$1&&(e.set_worldBase(e.get_world()),e.set_viewBase(e.get_view()),e.makeFrustum(),e.drawImageSet(this._imageSet$1,this.get_opacity()*t*100),!0)},writeLayerProperties:function(e){null!=this._imageSet$1.get_wcsImage()&&(this._isFitsImageset$1()?this._extension$1=".fit":this._extension$1=".png",e._writeAttributeString("Extension",this._extension$1)),this._isFitsImageset$1()&&(e._writeAttributeString("ScaleType",Enums.toXml("ScaleTypes",this._imageSet$1.get_fitsProperties().scaleType)),e._writeAttributeString("MinValue",this._imageSet$1.get_fitsProperties().minVal.toString()),e._writeAttributeString("MaxValue",this._imageSet$1.get_fitsProperties().maxVal.toString()),e._writeAttributeString("LowerCut",this._imageSet$1.get_fitsProperties().lowerCut.toString()),e._writeAttributeString("UpperCut",this._imageSet$1.get_fitsProperties().upperCut.toString()),null!=this._imageSet$1.get_fitsProperties().colorMapName&&e._writeAttributeString("ColorMapperName",this._imageSet$1.get_fitsProperties().colorMapName)),e._writeAttributeString("OverrideDefault",this._overrideDefaultLayer$1.toString()),Imageset.saveToXml(e,this._imageSet$1,""),Layer.prototype.writeLayerProperties.call(this,e)},getTypeName:function(){return"TerraViewer.ImageSetLayer"},cleanUp:function(){Layer.prototype.cleanUp.call(this)},addFilesToCabinet:function(e){if(ss.ss.canCast(this._imageSet$1.get_wcsImage(),FitsImage)){this._imageSet$1.get_wcsImage().get_filename();var t=e.tempDirectory+ss.ss.format("{0}\\{1}{2}",e.get_packageID(),this.id.toString(),this._extension$1);e.addFile(t,this._imageSet$1.get_wcsImage().sourceBlob)}},getParamNames:function(){return Layer.prototype.getParamNames.call(this)},getParams:function(){return Layer.prototype.getParams.call(this)},setParams:function(e){Layer.prototype.setParams.call(this,e)},setImageScale:function(e,t,i){console.warn("SetImageScale is considered deprecated. Use setImageScaleRaw or setImageScalePhysical instead."),this.setImageScaleRaw(e,t,i)},setImageScaleRaw:function(e,t,i){this.get_imageSet().get_fitsProperties().lowerCut=t,this.get_imageSet().get_fitsProperties().upperCut=i,this.get_imageSet().get_fitsProperties().scaleType=e,ss.ss.canCast(this._imageSet$1.get_wcsImage(),FitsImageJs)&&Histogram.updateScale(this,e,t,i)},setImageScalePhysical:function(e,t,i){var r=t,n=i;this._isFitsImageset$1()&&(r=(r-this._imageSet$1.get_fitsProperties().bZero)/this._imageSet$1.get_fitsProperties().bScale,n=(n-this._imageSet$1.get_fitsProperties().bZero)/this._imageSet$1.get_fitsProperties().bScale),this.setImageScaleRaw(e,r,n)},setImageZ:function(e){this._isFitsImageset$1()&&Histogram.updateImage(this,e)},get_colorMapperName:function(){return this.get_imageSet().get_fitsProperties().colorMapName},set_colorMapperName:function(e){if(null==ColorMapContainer.fromNamedColormap(e))throw new Error("Invalid colormap name");return this.version++,this._isFitsImageset$1()&&(useGlVersion2?this._imageSet$1.get_fitsProperties().colorMapName=e:Histogram.updateColorMapper(this,e)),e},get_colorMapper:function(){return null==this.get_imageSet().get_fitsProperties().colorMapName?null:ColorMapContainer.fromNamedColormap(this.get_imageSet().get_fitsProperties().colorMapName)},loadData:function(e,t){if(ss.ss.startsWith(this._extension$1.toLowerCase(),".fit")){var i,r=e.getFileBlob(ss.ss.replaceString(t,".txt",this._extension$1));i=useGlVersion2?new FitsImage(this._imageSet$1,"image.fit",r,ss.ss.bind("doneLoading",this)):new FitsImageJs(this._imageSet$1,"image.fit",r,ss.ss.bind("doneLoading",this)),this._imageSet$1.set_wcsImage(i)}else this._loaded$1=!0},doneLoading:function(e){this._loaded$1=!0}};function Material(){this.specularSharpness=0,this.opacity=0,this.isDefault=!1}registerType("ImageSetLayer",[ImageSetLayer,ImageSetLayer$,Layer]);var Material$={};function Object3dLayer(){this._primaryUI$1=null,this._heading$1=0,this._flipV$1=!0,this._flipHandedness$1=!1,this._smooth$1=!0,this._twoSidedGeometry$1=!1,this._pitch$1=0,this._roll$1=0,this._scale$1=Vector3d.create(1,1,1),this._translate$1=Vector3d.create(0,0,0),this._lightID$1=0,this._dirty$1=!1,this.objType=!1,this._xHandle$1=new Vector2d,this._yHandle$1=new Vector2d,this._zHandle$1=new Vector2d,this._hprHandles$1=new Array(6),this._uiScale$1=1,this._showEditUi$1=!1,this._dragMode$1=0,this._pntDown$1=new Vector2d,this._valueOnDown$1=0,this._valueOnDown2$1=0,this._hitDist$1=20,this._lockPreferedAxis$1=!1,this._preferY$1=!1,Layer.call(this)}registerType("Material",[Material,Material$,null]),Object3dLayer._translateUI$1=null,Object3dLayer._translateUILines$1=null,Object3dLayer._scaleUI$1=null,Object3dLayer._rotateUi$1=null,Object3dLayer._initTranslateUI$1=function(){Object3dLayer._translateUILines$1=new LineList,Object3dLayer._translateUILines$1.timeSeries=!1,Object3dLayer._translateUILines$1.set_depthBuffered(!1),Object3dLayer._translateUILines$1.showFarSide=!0,Object3dLayer._translateUI$1=new TriangleList,Object3dLayer._translateUI$1.depthBuffered=!1,Object3dLayer._translateUI$1.timeSeries=!1,Object3dLayer._translateUI$1.writeZbuffer=!1;for(var e=2*Math.PI,t=e/45,i=.05,r=0;r<e;r+=t){var n=Vector3d.create(.8,0,0),s=Vector3d.create(.8,Math.cos(r)*i,Math.sin(r)*i),a=Vector3d.create(.8,Math.cos(r+t)*i,Math.sin(r+t)*i);Object3dLayer._translateUI$1.addTriangle(n,s,a,Colors.get_red(),Dates.empty())}for(r=0;r<e;r+=t)n=Vector3d.create(1,0,0),a=Vector3d.create(.8,Math.cos(r)*i,Math.sin(r)*i),s=Vector3d.create(.8,Math.cos(r+t)*i,Math.sin(r+t)*i),Object3dLayer._translateUI$1.addTriangle(n,s,a,Color.fromArgb(255,255,Math.max(0,128*Math.sin(r)),Math.max(0,128*Math.sin(r))),Dates.empty());for(Object3dLayer._translateUILines$1.addLine(Vector3d.create(0,0,0),Vector3d.create(1,0,0),Colors.get_red(),Dates.empty()),r=0;r<e;r+=t)n=Vector3d.create(0,.8,0),a=Vector3d.create(Math.cos(r)*i,.8,Math.sin(r)*i),s=Vector3d.create(Math.cos(r+t)*i,.8,Math.sin(r+t)*i),Object3dLayer._translateUI$1.addTriangle(n,s,a,Colors.get_green(),Dates.empty());for(r=0;r<e;r+=t)n=Vector3d.create(0,1,0),s=Vector3d.create(Math.cos(r)*i,.8,Math.sin(r)*i),a=Vector3d.create(Math.cos(r+t)*i,.8,Math.sin(r+t)*i),Object3dLayer._translateUI$1.addTriangle(n,s,a,Color.fromArgb(255,Math.max(0,128*Math.sin(r)),255,Math.max(0,128*Math.sin(r))),Dates.empty());for(Object3dLayer._translateUILines$1.addLine(Vector3d.create(0,0,0),Vector3d.create(0,1,0),Colors.get_green(),Dates.empty()),r=0;r<e;r+=t)n=Vector3d.create(0,0,.8),s=Vector3d.create(Math.cos(r)*i,Math.sin(r)*i,.8),a=Vector3d.create(Math.cos(r+t)*i,Math.sin(r+t)*i,.8),Object3dLayer._translateUI$1.addTriangle(n,s,a,Colors.get_blue(),Dates.empty());for(r=0;r<e;r+=t)n=Vector3d.create(0,0,1),a=Vector3d.create(Math.cos(r)*i,Math.sin(r)*i,.8),s=Vector3d.create(Math.cos(r+t)*i,Math.sin(r+t)*i,.8),Object3dLayer._translateUI$1.addTriangle(n,s,a,Color.fromArgb(255,Math.max(0,128*Math.sin(r)),Math.max(0,128*Math.sin(r)),255),Dates.empty());Object3dLayer._translateUILines$1.addLine(Vector3d.create(0,0,0),Vector3d.create(0,0,1),Colors.get_blue(),Dates.empty()),Object3dLayer._initRotateUI$1(),Object3dLayer._initScaleUI$1()},Object3dLayer._initScaleUI$1=function(){Object3dLayer._scaleUI$1=new TriangleList,Object3dLayer._scaleUI$1.depthBuffered=!1,Object3dLayer._scaleUI$1.timeSeries=!1,Object3dLayer._scaleUI$1.writeZbuffer=!1,Math.PI,Object3dLayer._makeCube$1(Object3dLayer._scaleUI$1,Vector3d.create(.9,0,0),.1,Colors.get_red()),Object3dLayer._makeCube$1(Object3dLayer._scaleUI$1,Vector3d.create(0,.9,0),.1,Colors.get_green()),Object3dLayer._makeCube$1(Object3dLayer._scaleUI$1,Vector3d.create(0,0,.9),.1,Colors.get_blue())},Object3dLayer._makeCube$1=function(e,t,i,r){var n=Color.fromArgb(255,ss.ss.truncate(.6*r.r),r.g,ss.ss.truncate(.6*r.b)),s=Color.fromArgb(255,ss.ss.truncate(.8*r.r),ss.ss.truncate(.8*r.g),ss.ss.truncate(.8*r.b));e.addQuad(Vector3d.create(t.x+i,t.y+i,t.z+i),Vector3d.create(t.x+i,t.y+i,t.z-i),Vector3d.create(t.x-i,t.y+i,t.z+i),Vector3d.create(t.x-i,t.y+i,t.z-i),r,Dates.empty()),e.addQuad(Vector3d.create(t.x+i,t.y-i,t.z+i),Vector3d.create(t.x-i,t.y-i,t.z+i),Vector3d.create(t.x+i,t.y-i,t.z-i),Vector3d.create(t.x-i,t.y-i,t.z-i),r,Dates.empty()),e.addQuad(Vector3d.create(t.x-i,t.y+i,t.z+i),Vector3d.create(t.x-i,t.y+i,t.z-i),Vector3d.create(t.x-i,t.y-i,t.z+i),Vector3d.create(t.x-i,t.y-i,t.z-i),n,Dates.empty()),e.addQuad(Vector3d.create(t.x+i,t.y+i,t.z+i),Vector3d.create(t.x+i,t.y-i,t.z+i),Vector3d.create(t.x+i,t.y+i,t.z-i),Vector3d.create(t.x+i,t.y-i,t.z-i),n,Dates.empty()),e.addQuad(Vector3d.create(t.x+i,t.y+i,t.z+i),Vector3d.create(t.x-i,t.y+i,t.z+i),Vector3d.create(t.x+i,t.y-i,t.z+i),Vector3d.create(t.x-i,t.y-i,t.z+i),s,Dates.empty()),e.addQuad(Vector3d.create(t.x+i,t.y+i,t.z-i),Vector3d.create(t.x+i,t.y-i,t.z-i),Vector3d.create(t.x-i,t.y+i,t.z-i),Vector3d.create(t.x-i,t.y-i,t.z-i),s,Dates.empty())},Object3dLayer._initRotateUI$1=function(){Object3dLayer._rotateUi$1=new TriangleList,Object3dLayer._rotateUi$1.depthBuffered=!1,Object3dLayer._rotateUi$1.timeSeries=!1,Object3dLayer._rotateUi$1.writeZbuffer=!1;for(var e=2*Math.PI,t=e/40,i=.05,r=0,n=0;n<e;n+=t){var s=!(r%10),a=!((r+1)%10),o=Vector3d.create(i*(s?0:a?1.5:1),Math.cos(n),Math.sin(n)),l=Vector3d.create(-i*(s?0:a?1.5:1),Math.cos(n),Math.sin(n)),h=Vector3d.create(i*(s?1.5:a?0:1),Math.cos(n+t),Math.sin(n+t)),c=Vector3d.create(-i*(s?1.5:a?0:1),Math.cos(n+t),Math.sin(n+t));Object3dLayer._rotateUi$1.addQuad(o,h,l,c,Color._fromArgbColor(192,Colors.get_red()),Dates.empty()),r++}for(r=0,n=0;n<e;n+=t)s=!(r%10),a=!((r+1)%10),o=Vector3d.create(Math.cos(n),Math.sin(n),i*(s?0:a?1.5:1)),l=Vector3d.create(Math.cos(n),Math.sin(n),-i*(s?0:a?1.5:1)),h=Vector3d.create(Math.cos(n+t),Math.sin(n+t),i*(s?1.5:a?0:1)),c=Vector3d.create(Math.cos(n+t),Math.sin(n+t),-i*(s?1.5:a?0:1)),Object3dLayer._rotateUi$1.addQuad(o,h,l,c,Color._fromArgbColor(192,Colors.get_blue()),Dates.empty()),r++;for(r=0,n=0;n<e;n+=t)s=!(r%10),a=!((r+1)%10),o=Vector3d.create(Math.cos(n),i*(s?0:a?1.5:1),Math.sin(n)),l=Vector3d.create(Math.cos(n),-i*(s?0:a?1.5:1),Math.sin(n)),h=Vector3d.create(Math.cos(n+t),i*(s?1.5:a?0:1),Math.sin(n+t)),c=Vector3d.create(Math.cos(n+t),-i*(s?1.5:a?0:1),Math.sin(n+t)),Object3dLayer._rotateUi$1.addQuad(o,l,h,c,Color._fromArgbColor(192,Colors.get_green()),Dates.empty()),r++;for(r=0,n=0;n<e;n+=t)s=!(r%10),a=!((r+1)%10),o=Vector3d.create(-i*(s?0:a?1.5:1),Math.cos(n),Math.sin(n)),l=Vector3d.create(i*(s?0:a?1.5:1),Math.cos(n),Math.sin(n)),h=Vector3d.create(-i*(s?1.5:a?0:1),Math.cos(n+t),Math.sin(n+t)),c=Vector3d.create(i*(s?1.5:a?0:1),Math.cos(n+t),Math.sin(n+t)),Object3dLayer._rotateUi$1.addQuad(o,h,l,c,Colors.get_red(),Dates.empty()),r++;for(r=0,n=0;n<e;n+=t)s=!(r%10),a=!((r+1)%10),o=Vector3d.create(Math.cos(n),Math.sin(n),-i*(s?0:a?1.5:1)),l=Vector3d.create(Math.cos(n),Math.sin(n),i*(s?0:a?1.5:1)),h=Vector3d.create(Math.cos(n+t),Math.sin(n+t),-i*(s?1.5:a?0:1)),c=Vector3d.create(Math.cos(n+t),Math.sin(n+t),i*(s?1.5:a?0:1)),Object3dLayer._rotateUi$1.addQuad(o,h,l,c,Colors.get_blue(),Dates.empty()),r++;for(r=0,n=0;n<e;n+=t)s=!(r%10),a=!((r+1)%10),o=Vector3d.create(Math.cos(n),-i*(s?0:a?1.5:1),Math.sin(n)),l=Vector3d.create(Math.cos(n),i*(s?0:a?1.5:1),Math.sin(n)),h=Vector3d.create(Math.cos(n+t),-i*(s?1.5:a?0:1),Math.sin(n+t)),c=Vector3d.create(Math.cos(n+t),i*(s?1.5:a?0:1),Math.sin(n+t)),Object3dLayer._rotateUi$1.addQuad(o,l,h,c,Colors.get_green(),Dates.empty()),r++};var Object3dLayer$={getPrimaryUI:function(){return null==this._primaryUI$1&&(this._primaryUI$1=new Object3dLayerUI(this)),this._primaryUI$1},get_flipV:function(){return this._flipV$1},set_flipV:function(e){return this._flipV$1!==e&&(this._flipV$1=e,null!=this.object3d&&(this.object3d.flipV=this._flipV$1,this.object3d._reload()),this.version++),e},get_flipHandedness:function(){return this._flipHandedness$1},set_flipHandedness:function(e){return this._flipHandedness$1!==e&&(this._flipHandedness$1=e,null!=this.object3d&&(this.object3d.flipHandedness=this._flipHandedness$1,this.object3d._reload()),this.version++),e},get_smooth:function(){return this._smooth$1},set_smooth:function(e){return this._smooth$1!==e&&(this._smooth$1=e,null!=this.object3d&&(this.object3d.smooth=this._smooth$1,this.object3d._reload()),this.version++),e},get_twoSidedGeometry:function(){return this._twoSidedGeometry$1},set_twoSidedGeometry:function(e){return this._twoSidedGeometry$1!==e&&(this._twoSidedGeometry$1=e,this.version++),e},get_heading:function(){return this._heading$1},set_heading:function(e){return this._heading$1!==e&&(this.version++,this._heading$1=e),e},get_pitch:function(){return this._pitch$1},set_pitch:function(e){return this._pitch$1!==e&&(this.version++,this._pitch$1=e),e},get_roll:function(){return this._roll$1},set_roll:function(e){return this._roll$1!==e&&(this.version++,this._roll$1=e),e},get_scale:function(){return this._scale$1},set_scale:function(e){return this._scale$1!==e&&(this.version++,this._scale$1=e),e},get_translate:function(){return this._translate$1},set_translate:function(e){return this._translate$1!==e&&(this.version++,this._translate$1=e),e},get_lightID:function(){return this._lightID$1},set_lightID:function(e){return this._lightID$1=e,e},cleanUp:function(){this._dirty$1=!0},colorChanged:function(){null!=this.object3d&&(this.object3d.color=this.get_color())},writeLayerProperties:function(e){e._writeAttributeString("FlipV",this.get_flipV().toString()),e._writeAttributeString("FlipHandedness",this.get_flipHandedness().toString()),e._writeAttributeString("Smooth",this.get_smooth().toString()),e._writeAttributeString("TwoSidedGeometry",this.get_twoSidedGeometry().toString()),e._writeAttributeString("Heading",this.get_heading().toString()),e._writeAttributeString("Pitch",this.get_pitch().toString()),e._writeAttributeString("Roll",this.get_roll().toString()),e._writeAttributeString("Scale",this.get_scale().toString()),e._writeAttributeString("Translate",this.get_translate().toString()),e._writeAttributeString("LightID",this.get_lightID().toString()),e._writeAttributeString("Obj",this.objType.toString())},getParams:function(){var e=new Array(14);return e[0]=this._heading$1,e[1]=this._pitch$1,e[2]=this._roll$1,e[3]=this._scale$1.x,e[4]=this._scale$1.y,e[5]=this._scale$1.z,e[6]=this._translate$1.x,e[7]=this._translate$1.y,e[8]=this._translate$1.z,e[9]=this.get_color().r/255,e[10]=this.get_color().g/255,e[11]=this.get_color().b/255,e[12]=this.get_color().a/255,e[13]=this.get_opacity(),e},getParamNames:function(){return["Heading","Pitch","Roll","Scale.X","Scale.Y","Scale.Z","Translate.X","Translate.Y","Translate.Z","Colors.Red","Colors.Green","Colors.Blue","Colors.Alpha","Opacity"]},setParams:function(e){if(14===e.length){this._heading$1=e[0],this._pitch$1=e[1],this._roll$1=e[2],this._scale$1.x=e[3],this._scale$1.y=e[4],this._scale$1.z=e[5],this._translate$1.x=e[6],this._translate$1.y=e[7],this._translate$1.z=e[8],this.set_opacity(e[13]);var t=Color.fromArgb(ss.ss.truncate(255*e[12]),ss.ss.truncate(255*e[9]),ss.ss.truncate(255*e[10]),ss.ss.truncate(255*e[11]));this.set_color(t)}},add_propertiesChanged:function(e){this.__propertiesChanged$1=ss.ss.bindAdd(this.__propertiesChanged$1,e)},remove_propertiesChanged:function(e){this.__propertiesChanged$1=ss.ss.bindSub(this.__propertiesChanged$1,e)},fireChanged:function(){null!=this.__propertiesChanged$1&&this.__propertiesChanged$1(this,new ss.ss.EventArgs)},getEditUI:function(){return ss.ss.safeCast(this,IUiController)},initializeFromXml:function(e){this.set_flipV(ss.ss.boolean(e.attributes.getNamedItem("FlipV").nodeValue)),null!=e.attributes.getNamedItem("FlipHandedness")?this.set_flipHandedness(ss.ss.boolean(e.attributes.getNamedItem("FlipHandedness").nodeValue)):this.set_flipHandedness(!1),null!=e.attributes.getNamedItem("Smooth")?this.set_smooth(ss.ss.boolean(e.attributes.getNamedItem("Smooth").nodeValue)):this.set_smooth(!0),null!=e.attributes.getNamedItem("TwoSidedGeometry")?this.set_twoSidedGeometry(ss.ss.boolean(e.attributes.getNamedItem("TwoSidedGeometry").nodeValue)):this.set_twoSidedGeometry(!1),null!=e.attributes.getNamedItem("Obj")?this.objType=ss.ss.boolean(e.attributes.getNamedItem("Obj").nodeValue):this.objType=!1,this.set_heading(parseFloat(e.attributes.getNamedItem("Heading").nodeValue)),this.set_pitch(parseFloat(e.attributes.getNamedItem("Pitch").nodeValue)),this.set_roll(parseFloat(e.attributes.getNamedItem("Roll").nodeValue)),this.set_scale(Vector3d.parse(e.attributes.getNamedItem("Scale").nodeValue)),this.set_translate(Vector3d.parse(e.attributes.getNamedItem("Translate").nodeValue)),null!=e.attributes.getNamedItem("LightID")&&this.set_lightID(parseInt(e.attributes.getNamedItem("LightID").nodeValue))},draw:function(e,t,i){var r=e.get_world(),n=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(Matrix3d._rotationZ(-this._roll$1/180*Math.PI),Matrix3d._rotationX(-this._pitch$1/180*Math.PI)),Matrix3d._rotationY(this._heading$1/180*Math.PI));return e.set_world(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(n,Matrix3d._scaling(this._scale$1.x,this._scale$1.y,this._scale$1.z)),Matrix3d.translation(this._translate$1)),r)),e.set_twoSidedLighting(this.get_twoSidedGeometry()),BasePlanets.drawPointPlanet(e,new Vector3d,1,Colors.get_red(),!1),this._lightID$1>0||null!=this.object3d&&(this.object3d.color=this.get_color(),this.object3d.render(e,t*this.get_opacity())),e.set_twoSidedLighting(!1),e.set_world(r),!0},addFilesToCabinet:function(e){},loadData:function(e,t){ss.ss.endsWith(t.toLowerCase(),".obj")&&(this.objType=!0),this._lightID$1||(this.objType?this.object3d=new Object3d(e,ss.ss.replaceString(t,".txt",".obj"),this.get_flipV(),this._flipHandedness$1,!0,this.get_color()):this.object3d=new Object3d(e,ss.ss.replaceString(t,".txt",".3ds"),this.get_flipV(),this._flipHandedness$1,!0,this.get_color()))},pointToView:function(e){var t=globalRenderContext.height,i=globalRenderContext.width,r=globalRenderContext.width/globalRenderContext.height*1116,n=e.x/i*r-(r-1920)/2,s=e.y/t*1116;return Vector2d.create(n,s)},render:function(e){this._showEditUi$1=!0},preRender:function(e){this._showEditUi$1=!0},mouseDown:function(e,t){var i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY));this._pntDown$1=i;var r=i;if(t.shiftKey){if(Vector2d.subtract(r,this._xHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=10,this._valueOnDown$1=this._scale$1.x,!0;if(Vector2d.subtract(r,this._yHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=10,this._valueOnDown$1=this._scale$1.y,!0;if(Vector2d.subtract(r,this._zHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=10,this._valueOnDown$1=this._scale$1.z,!0}else{if(Vector2d.subtract(r,this._xHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=1,this._valueOnDown$1=this._translate$1.x,!0;if(Vector2d.subtract(r,this._yHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=2,this._valueOnDown$1=this._translate$1.y,!0;if(Vector2d.subtract(r,this._zHandle$1).get_length()<this._hitDist$1)return this._dragMode$1=3,this._valueOnDown$1=this._translate$1.z,!0}for(var n=0;n<this._hprHandles$1.length;n++)if(Vector2d.subtract(r,this._hprHandles$1[n]).get_length()<this._hitDist$1)switch(n){case 0:return this._dragMode$1=4,this._valueOnDown$1=this._heading$1,this._valueOnDown2$1=this._pitch$1,!0;case 1:return this._dragMode$1=7,this._valueOnDown$1=this._heading$1,this._valueOnDown2$1=this._pitch$1,!0;case 2:return this._dragMode$1=5,this._valueOnDown$1=this._pitch$1,this._valueOnDown2$1=this._roll$1,!0;case 3:return this._dragMode$1=8,this._valueOnDown$1=this._pitch$1,this._valueOnDown2$1=this._roll$1,!0;case 4:return this._dragMode$1=6,this._valueOnDown$1=this._roll$1,this._valueOnDown2$1=this._heading$1,!0;case 5:return this._dragMode$1=9,this._valueOnDown$1=this._roll$1,this._valueOnDown2$1=this._heading$1,!0}return!1},mouseUp:function(e,t){return!!this._dragMode$1&&(this._dragMode$1=0,this._lockPreferedAxis$1=!1,!0)},mouseMove:function(e,t){var i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY));if(this._dragMode$1){var r=0,n=i.x-this._pntDown$1.x,s=-(i.y-this._pntDown$1.y);switch(this._lockPreferedAxis$1?this._preferY$1?(r=s,this._preferY$1=!0,Cursor.set_current(Cursors.get_sizeNS())):(r=n,this._preferY$1=!1,Cursor.set_current(Cursors.get_sizeWE())):(Math.abs(n)>Math.abs(s)?(r=n,this._preferY$1=!1):(r=s,this._preferY$1=!0),r>5&&(this._lockPreferedAxis$1=!0)),this._dragMode$1){case 0:default:break;case 1:this._translate$1.x=this._valueOnDown$1+12*this._uiScale$1*(r/globalRenderContext.width);break;case 2:this._translate$1.y=this._valueOnDown$1+12*this._uiScale$1*(r/globalRenderContext.width);break;case 3:this._translate$1.z=this._valueOnDown$1+12*this._uiScale$1*(r/globalRenderContext.width);break;case 4:this._heading$1=this._valueOnDown$1-n/4,this._pitch$1=this._valueOnDown2$1+s/4;break;case 5:this._pitch$1=this._valueOnDown$1+s/4,this._roll$1=this._valueOnDown2$1-n/4;break;case 6:this._roll$1=this._valueOnDown$1+s/4,this._heading$1=this._valueOnDown2$1-n/4;break;case 7:this._heading$1=this._valueOnDown$1-n/4,this._pitch$1=this._valueOnDown2$1-s/4;break;case 8:this._pitch$1=this._valueOnDown$1+s/4,this._roll$1=this._valueOnDown2$1+n/4;break;case 9:this._roll$1=this._valueOnDown$1-s/4,this._heading$1=this._valueOnDown2$1-n/4;break;case 10:this._scale$1.x=this._scale$1.y=this._scale$1.z=this._valueOnDown$1*Math.pow(2,r/100)}return this.fireChanged(),!0}var a=i;if(Vector2d.subtract(a,this._xHandle$1).get_length()<this._hitDist$1)return Cursor.set_current(Cursors.get_sizeAll()),!0;if(Vector2d.subtract(a,this._yHandle$1).get_length()<this._hitDist$1)return Cursor.set_current(Cursors.get_sizeAll()),!0;if(Vector2d.subtract(a,this._zHandle$1).get_length()<this._hitDist$1)return Cursor.set_current(Cursors.get_sizeAll()),!0;for(var o=0;o<this._hprHandles$1.length;o++)if(Vector2d.subtract(a,this._hprHandles$1[o]).get_length()<this._hitDist$1)return Cursor.set_current(Cursors.get_sizeAll()),!0;return!1},mouseClick:function(e,t){return!1},click:function(e,t){return!1},mouseDoubleClick:function(e,t){return!1},keyDown:function(e,t){return!1},keyUp:function(e,t){return!1},hover:function(e){return!1}};function Group(){this.startIndex=0,this.indexCount=0,this.materialIndex=0}registerType("Object3dLayer",[Object3dLayer,Object3dLayer$,Layer,IUiController]);var Group$={};function Mesh(){this.boundingSphere=new SphereHull}registerType("Group",[Group,Group$,null]),Mesh.create=function(e,t){var i=new Mesh;i.vertices=e,i.indices=t;for(var r=new Array(e.length),n=0;n<e.length;++n)r[n]=e[n].get_position();return i.boundingSphere=ConvexHull.findEnclosingSphereFast(r),i},Mesh.createTangent=function(e,t){var i=new Mesh;i.tangentVertices=e,i.indices=t;for(var r=new Array(i.tangentVertices.length),n=0;n<i.tangentVertices.length;++n)r[n]=i.tangentVertices[n].get_position();return i.boundingSphere=ConvexHull.findEnclosingSphereFast(r),i};var Mesh$={dispose:function(){null!=this.vertexBuffer&&(this.vertexBuffer.dispose(),this.vertexBuffer=null),null!=this.tangentVertexBuffer&&(this.tangentVertexBuffer.dispose(),this.tangentVertexBuffer=null),null!=this.indexBuffer&&(this.indexBuffer.dispose(),this.indexBuffer=null)},setObjects:function(e){this._objects=e},commitToDevice:function(){null!=this.vertices?this.vertexBuffer=PositionNormalTexturedVertexBuffer.create(this.vertices):null!=this.tangentVertices&&(this.tangentVertexBuffer=PositionNormalTexturedTangentVertexBuffer.create(this.tangentVertices)),this.indexBuffer=new IndexBuffer(new Uint32Array(this.indices))},beginDrawing:function(e){null!=this.vertexBuffer?e._setVertexBuffer(this.vertexBuffer):null!=this.tangentVertexBuffer&&e._setVertexBuffer(this.tangentVertexBuffer),null!=this.indexBuffer&&e._setIndexBuffer(this.indexBuffer)},drawSubset:function(e,t){null!=this.indexBuffer&&null!=this._objects&&this.drawHierarchy(this._objects,t,e,0)},drawHierarchy:function(e,t,i,r){if(!(r>1212))for(var n=ss.ss.enumerate(e);n.moveNext();){var s=n.current;if(null!=s.drawGroup&&s.enabled)for(var a=ss.ss.enumerate(s.drawGroup);a.moveNext();){var o=a.current;o.materialIndex===t&&i.gl.drawElements(WEBGL.TRIANGLES,o.indexCount,WEBGL.UNSIGNED_INT,4*o.startIndex)}this.drawHierarchy(s.children,t,i,r+1)}},get_objects:function(){return this._objects},set_objects:function(e){return this._objects=e,e}};function VertexPosition(){this.index=0}registerType("Mesh",[Mesh,Mesh$,null,ss.ss.IDisposable]);var VertexPosition$={};function Object3d(e,t,i,r,n,s){this.flipHandedness=!1,this.flipV=!0,this.smooth=!0,this._mesh=null,this._meshMaterials=[],this._meshTextures=[],this._meshSpecularTextures=[],this._meshNormalMaps=[],this.meshFilenames=[],this.color=Colors.get_white(),this._textureCache={},this._matFiles=new Array(0),this._matFileIndex=0,this.objects=[],this._matLib={},this._textureLib={},this._tourDocument=null,this.issLayer=!1,this._readyToRender=!1,this.useCurrentAmbient=!1,this._dirty=!0,this.color=s,this.smooth=n,this.flipV=i,this.flipHandedness=r,this.filename=t,ss.ss.endsWith(this.filename.toLowerCase(),".obj")?this._loadMeshFromObj(e,this.filename):this._loadMeshFrom3ds(e,this.filename,1)}registerType("VertexPosition",[VertexPosition,VertexPosition$,null]),Object3d._compareVector3=function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:e.z<t.z?-1:e.z>t.z?1:0},Object3d._compareVector=function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0},Object3d._getMaterialID=function(e,t){for(var i=0,r=ss.ss.enumerate(t);r.moveNext();){if(r.current===e)return i;i++}return-1},Object3d._disposeTextureList=function(e){if(null!=e){for(var t=0;t<e.length;++t)null!=e[t]&&(e[t].dispose(),e[t]=null);e.length=0}};var Object3d$={_reload:function(){this.issLayer||(this.dispose(),ss.ss.endsWith(this.filename.toLowerCase(),".obj")?this._loadMeshFromObj(this._tourDocument,this.filename):this._loadMeshFrom3ds(this._tourDocument,this.filename,1))},_calculateVertexNormalsMerged:function(e,t,i){if(!e.length)return null;e.length;for(var r=Math.floor(t.length/3),n=[],s=0;s<e.length;++s){var a=new VertexPosition;a.position=e[s].get_position(),a.index=s,n.push(a)}n.sort((function(e,t){return Object3d._compareVector3(e.position,t.position)}));var o=new Array(n.length),l=0;for(s=0;s<n.length;s++)s&&!Object3d._compareVector3(n[s].position,n[s-1].position)||++l,o[n[s].index]=l-1;for(var h=new Array(l),c=0;c<l;c++)h[c]=0;for(var u=ss.ss.enumerate(t);u.moveNext();)h[M=o[s=u.current]]++;var d=new Array(l);for(c=0;c<l;++c){var _=h[c];if(_>0){d[c]=new Array(_);for(var g=0;g<_;g++)d[c][g]=0}}for(c=0;c<t.length;++c){var f=Math.floor(c/3);d[M=o[t[c]]][--h[M]]=f}var m=new Array(r);for(c=0;c<r;++c){var p=t[3*c+0],C=t[3*c+1],S=t[3*c+2],w=Vector3d.subtractVectors(e[C].get_position(),e[p].get_position()),T=Vector3d.subtractVectors(e[S].get_position(),e[C].get_position());m[c]=Vector3d.cross(w,T),m[c].normalize()}var y=3*r,b=new Array(y),v=Math.min(.9999,Math.cos(i));for(c=0;c<y;++c){for(var M=o[s=t[c]],x=m[Math.floor(c/3)],L=new Vector3d,A=ss.ss.enumerate(d[M]);A.moveNext();){var V=m[f=A.current];Vector3d.dot(x,V)>v&&L.add(V)}b[c]=L,b[c].normalize()}return b},_calculateVertexTangents:function(e,t,i){if(!e.length)return null;e.length;for(var r=Math.floor(t.length/3),n=[],s=0;s<e.length;++s){var a=new VertexPosition;a.position=e[s].get_position(),a.index=s,n.push(a)}n.sort((function(e,t){return Object3d._compareVector3(e.position,t.position)}));var o=new Array(n.length),l=0;for(s=0;s<n.length;s++)s&&!Object3d._compareVector3(n[s].position,n[s-1].position)||++l,o[n[s].index]=l-1;for(var h=new Array(l),c=0;c<l;c++)h[c]=0;for(var u=ss.ss.enumerate(t);u.moveNext();)h[R=o[s=u.current]]++;var d=new Array(l);for(c=0;c<l;++c){var _=h[c];if(_>0){d[c]=new Array(_);for(var g=0;g<_;g++)d[c][g]=0}}for(c=0;c<t.length;++c){var f=Math.floor(c/3);d[R=o[t[c]]][--h[R]]=f}var m=new Array(r);for(c=0;c<r;++c){var p=e[t[3*c+0]],C=e[t[3*c+1]],S=e[t[3*c+2]],w=Vector3d.subtractVectors(C.get_position(),p.get_position()),T=Vector3d.subtractVectors(S.get_position(),p.get_position()),y=C.tu-p.tu,b=C.tv-p.tv,v=S.tu-p.tu,M=S.tv-p.tv,x=y*M-b*v;if(Math.abs(x)<1e-6)w.lengthSq()>0?(m[c]=w,m[c].normalize()):m[c]=Vector3d.create(1,0,0);else{var L=1/x,A=M*L,V=-b*L;m[c]=Vector3d.addVectors(Vector3d.multiplyScalar(w,A),Vector3d.multiplyScalar(T,V)),m[c].normalize()}}var P=3*r,E=new Array(P),I=Math.min(.9999,Math.cos(i));for(c=0;c<P;++c){for(var R=o[s=t[c]],D=m[Math.floor(c/3)],k=new Vector3d,F=ss.ss.enumerate(d[R]);F.moveNext();){var B=m[f=F.current];Vector3d.dot(D,B)>I&&k.add(B)}var N=e[s].get_normal();E[c]=Vector3d.subtractVectors(k,Vector3d.multiplyScalar(N,Vector3d.dot(N,k))),E[c].normalize()}return E},_calculateVertexNormals:function(e,t,i){for(var r=e.length,n=Math.floor(t.length/3),s=new Array(r),a=ss.ss.enumerate(t);a.moveNext();)s[w=a.current]++;for(var o=new Array(r),l=0;l<r;++l){var h=s[l];h>0&&(o[l]=new Array(h))}for(l=0;l<t.length;++l){var c=Math.floor(l/3);o[w=t[l]][--s[w]]=c}var u=new Array(n);for(l=0;l<n;++l){var d=t[3*l+0],_=t[3*l+1],g=t[3*l+2],f=Vector3d.subtractVectors(e[_].get_position(),e[d].get_position()),m=Vector3d.subtractVectors(e[g].get_position(),e[_].get_position());u[l]=Vector3d.cross(f,m),u[l].normalize()}var p=3*n,C=new Array(p),S=Math.min(.9999,Math.cos(i));for(l=0;l<p;++l){for(var w=t[l],T=u[Math.floor(l/3)],y=new Vector3d,b=ss.ss.enumerate(o[w]);b.moveNext();){var v=u[c=b.current];Vector3d.dot(T,v)>S&&y.add(v)}C[l]=y,C[l].normalize()}return C},_addMaterial:function(e){for(this._meshMaterials.push(e);this._meshTextures.length<this._meshMaterials.length;)this._meshTextures.push(null);for(;this._meshSpecularTextures.length<this._meshMaterials.length;)this._meshSpecularTextures.push(null);for(;this._meshNormalMaps.length<this._meshMaterials.length;)this._meshNormalMaps.push(null)},_loadColorChunk:function(e){var t=e.readUInt16(),i=e.readUInt32(),r=Colors.get_black();if(16!==t&&19!==t||18!==i)17!==t&&18!==t||9!==i?e.readBytes(i-6):r=Color.fromArgb(255,e.readByte(),e.readByte(),e.readByte());else{var n=Math.max(0,Math.min(1,e.readSingle())),s=Math.max(0,Math.min(1,e.readSingle())),a=Math.max(0,Math.min(1,e.readSingle()));r=Color.fromArgb(255,ss.ss.truncate(255*n),ss.ss.truncate(255*s),ss.ss.truncate(255*a))}return r},_loadPercentageChunk:function(e){var t=e.readUInt16(),i=e.readUInt32(),r=0;return 48===t&&8===i?r=e.readUInt16():49===t&&10===i?r=e.readSingle():e.readBytes(i-6),r},_loadMeshFromObj:function(e,t){var i=this;this.filename=t,this._tourDocument=e;var r=e.getFileBlob(t),n=new FileReader;n.onloadend=function(e){i._matFiles=i._readObjMaterialsFromBin(ss.ss.safeCast(n.result,String)),i._matFileIndex=0,i._loadMatLib(ss.ss.safeCast(n.result,String))},n.readAsText(r)},_readObjMaterialsFromBin:function(e){for(var t=[],i=e.split("\n"),r=ss.ss.enumerate(i);r.moveNext();){var n=r.current,s=ss.ss.replaceString(n,"  "," "),a=ss.ss.trim(s).split(" ");if(a.length>0&&"mtllib"===a[0]){var o=this.filename.substring(0,this.filename.lastIndexOf("\\")+1)+a[1];t.push(o)}}return t},_readObjFromBin:function(e){var t=!1,i=[],r=new ObjectNode;r.name="Default";var n=[],s=[],a=[],o=[];s.push(new Vector3d),a.push(new Vector3d),o.push(new Vector2d);var l=[],h=-1,c=new Material,u=new Group,d=0;(c=new Material).diffuse=this.color,c.ambient=this.color,c.specular=Colors.get_white(),c.specularSharpness=30,c.opacity=1,c.isDefault=!0,u.startIndex=0,u.indexCount=0,u.materialIndex=0;for(var _=e.split("\n"),g=ss.ss.enumerate(_);g.moveNext();){var f=g.current,m=ss.ss.replaceString(f,"  "," "),p=ss.ss.trim(m).split(" ");if(p.length>0)switch(p[0]){case"mtllib":break;case"usemtl":var C=p[1];if(ss.ss.keyExists(this._matLib,C)&&(-1===h&&d>0&&(this._addMaterial(c),h++),h>-1&&(u.indexCount=d-u.startIndex,r.drawGroup.push(u)),h++,ss.ss.keyExists(this._matLib,C))){if(c=this._matLib[C],ss.ss.keyExists(this._textureLib,C))try{if(!ss.ss.keyExists(this._textureCache,this._textureLib[C])){var S=this.filename.substring(0,this.filename.lastIndexOf("\\")+1),w=this._tourDocument.getCachedTexture2d(S+this._textureLib[C]);null!=w&&(this.meshFilenames.push(this._textureLib[C]),this._textureCache[this._textureLib[C]]=w)}this._meshTextures.push(this._textureCache[this._textureLib[C]])}catch(e){}this._addMaterial(c),(u=new Group).startIndex=d,u.indexCount=0,u.materialIndex=h}break;case"v":this.flipHandedness?s.push(Vector3d.create(-parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]))):s.push(Vector3d.create(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])));break;case"vn":this.flipHandedness?a.push(Vector3d.create(-parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]))):a.push(Vector3d.create(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])));break;case"vt":o.push(Vector2d.create(parseFloat(p[1]),this.flipV?1-parseFloat(p[2]):parseFloat(p[2])));break;case"g":case"o":t&&(h>-1&&(u.indexCount=d-u.startIndex,r.drawGroup.push(u),(u=new Group).startIndex=d,u.indexCount=0,u.materialIndex=h),r=new ObjectNode),t=!0,p.length>1?r.name=p[1]:r.name="Unnamed",i.push(r);break;case"f":var T=this._getIndexies(p[1]),y=this._getIndexies(p[2]),b=this._getIndexies(p[3]);if(n.push(PositionNormalTextured.createUV(s[T[0]],a[T[2]],o[T[1]])),n.push(PositionNormalTextured.createUV(s[y[0]],a[y[2]],o[y[1]])),n.push(PositionNormalTextured.createUV(s[b[0]],a[b[2]],o[b[1]])),this.flipHandedness?(l.push(d),l.push(d+2),l.push(d+1)):(l.push(d),l.push(d+1),l.push(d+2)),d+=3,p.length>4)for(var v=4;v<p.length;)this.flipHandedness?(T=this._getIndexies(p[1]),b=this._getIndexies(p[v]),y=this._getIndexies(p[v-1])):(T=this._getIndexies(p[1]),y=this._getIndexies(p[v-1]),b=this._getIndexies(p[v])),n.push(PositionNormalTextured.createUV(s[T[0]],a[T[2]],o[T[1]])),n.push(PositionNormalTextured.createUV(s[y[0]],a[y[2]],o[y[1]])),n.push(PositionNormalTextured.createUV(s[b[0]],a[b[2]],o[b[1]])),l.push(d),l.push(d+1),l.push(d+2),d+=3,v++}}if(t||i.push(r),-1===h&&d>0&&(this._addMaterial(c),h++),h>-1&&(u.indexCount=d-u.startIndex,r.drawGroup.push(u)),a.length<2){for(var M=Math.PI/180,x=this.smooth?170*M:45*M,L=this._calculateVertexNormalsMerged(n,l,x),A=[],V=l.length,P=0;P<V;++P){var E=n[l[P]];E.set_normal(L[P]),A.push(E)}n=A}this._mesh=Mesh.create(n,l);var I=new ObjectNode;I.name="Root",I.parent=null,I.level=-1,I.drawGroup=null,I.children=i,this.objects=[],this.objects.push(I),this._mesh.setObjects(this.objects),this._mesh.commitToDevice(),this._dirty=!1,this._readyToRender=!0},_loadMatLib:function(e){var t=this;if(this._matFileIndex<this._matFiles.length){var i=this._matFiles[this._matFileIndex++],r=this._tourDocument.getFileBlob(i),n=new FileReader;n.onloadend=function(i){t._readMatLibFromBin(ss.ss.safeCast(n.result,String)),t._loadMatLib(e)},n.readAsText(r)}else this._readObjFromBin(e)},_readMatLibFromBin:function(e){try{var t=new Material,i="";this._matLib={},this._textureLib={};for(var r=e.split("\n"),n=ss.ss.enumerate(r);n.moveNext();){var s=n.current,a=ss.ss.trim(s).split(" ");if(a.length>0)switch(a[0]){case"newmtl":ss.ss.emptyString(i)||(this._matLib[i]=t),(t=new Material).diffuse=Colors.get_white(),t.ambient=Colors.get_white(),t.specular=Colors.get_black(),t.specularSharpness=30,t.opacity=1,i=a[1];break;case"Ka":t.ambient=Color.fromArgb(255,Math.min(255*parseFloat(a[1]),255),Math.min(255*parseFloat(a[2]),255),Math.min(255*parseFloat(a[3]),255));break;case"map_Kd":t.diffuse=Colors.get_white();for(var o=a[1],l=2;l<a.length;l++)o+=" "+a[l];this.filename.substring(0,this.filename.lastIndexOf("\\")+1),-1!==(o=ss.ss.replaceString(o,"/","\\")).indexOf("\\")&&(o=o.substring(o.lastIndexOf("\\")+1)),this._textureLib[i]=o;break;case"Kd":t.diffuse=Color.fromArgb(255,Math.min(255*parseFloat(a[1]),255),Math.min(255*parseFloat(a[2]),255),Math.min(255*parseFloat(a[3]),255));break;case"Ks":t.specular=Color.fromArgb(255,Math.min(255*parseFloat(a[1]),255),Math.min(255*parseFloat(a[2]),255),Math.min(255*parseFloat(a[3]),255));break;case"d":t.opacity=parseFloat(a[1]);break;case"Tr":t.opacity=1-parseFloat(a[1]);break;case"illum":parseInt(a[1]);break;case"sharpness":t.specularSharpness=parseFloat(a[1]);break;case"Ns":t.specularSharpness=1+2*parseFloat(a[1]),t.specularSharpness=Math.max(10,t.specularSharpness)}}ss.ss.emptyString(i)||(this._matLib[i]=t)}catch(e){}},_getIndexies:function(e){var t=ss.ss.trim(e).split("/"),i=new Array(3);return ss.ss.emptyString(e)||(t.length>0&&(i[0]=parseInt(t[0])),t.length>1&&(ss.ss.emptyString(t[1])?i[1]=0:i[1]=parseInt(t[1])),t.length>2&&(i[2]=parseInt(t[2]))),i},_loadMeshFrom3ds:function(e,t,i){var r=this;this._tourDocument=e;var n=e.getFileBlob(t),s=new FileReader;s.onloadend=function(e){r._read3dsFromBin(new BinaryReader(new Uint8Array(s.result)),i)},s.readAsArrayBuffer(n)},_read3dsFromBin:function(e,t){for(var i,r,n,s="",a="",o=0,l=0,h=[],c=[],u=[],d=-1,_=new Material,g=0,f=0,m=!1,p=[],C=null,S=[],w=[],T={},y=e.get_length()-1,b=0,v=0;e.get_position()<y;)switch(r=e.readUInt16(),n=e.readUInt32(),r){case 19789:case 15677:case 45055:case 41472:case 45056:case 45058:break;case 16384:var M;s="";do{(M=e.readByte())>0&&(s+=String.fromCharCode(M))}while(M);(C=new ObjectNode).name=s,p.push(C),ss.ss.keyExists(T,C.name)||(T[C.name]=C);break;case 16640:b=h.length,v=Math.floor(c.length/3);break;case 16656:for(l=e.readUInt16(),i=0;i<l;i++){var x=e.readSingle()-0,L=e.readSingle()-0,A=e.readSingle()-0,V=PositionNormalTextured._create(x*t,A*t,L*t,0,0,0,0,0);h.push(V)}break;case 16672:for(o+=R=e.readUInt16(),i=0;i<R;i++){var P=e.readUInt16()+b,E=e.readUInt16()+b,I=e.readUInt16()+b;c.push(I),c.push(E),c.push(P),e.readUInt16()}break;case 16688:a="",i=0;do{(W=e.readByte())>0&&(a+=String.fromCharCode(W)),i++}while(W);var R=e.readUInt16(),D=new Array(R);for(g=Object3d._getMaterialID(a,u),i=0;i<R;i++)D[i]=e.readUInt16()+v;C.applyLists.push(D),C.applyListsIndex.push(g);break;case 16704:for(f=e.readUInt16(),i=0;i<f;i++){V=h[b+i];var k=Vector2d.create(e.readSingle(),this.flipV?1-e.readSingle():e.readSingle());h[b+i]=PositionNormalTextured.createUV(V.get_position(),new Vector3d,k)}break;case 16736:var F=new Array(12);for(i=0;i<12;i++)F[i]=e.readSingle();ss.ss.keyExists(T,s)&&(T[s].localMat=Matrix3d.create(F[0],F[1],F[2],0,F[3],F[4],F[5],0,F[6],F[7],F[8],0,F[9],F[10],F[11],1),T[s].localMat.invert());break;case 40960:var B="";i=0;do{(U=e.readByte())>0&&(B+=String.fromCharCode(U)),i++}while(U);u.push(B),d>-1&&this._addMaterial(_),d++,(_=new Material).diffuse=Colors.get_white(),_.ambient=Colors.get_white(),_.specular=Colors.get_black(),_.specularSharpness=30,_.opacity=1;break;case 40976:_.ambient=this._loadColorChunk(e);break;case 40992:_.diffuse=this._loadColorChunk(e);break;case 41008:_.specular=this._loadColorChunk(e);break;case 41024:_.specularSharpness=1+2*this._loadPercentageChunk(e),_.specularSharpness=Math.max(10,_.specularSharpness);break;case 41728:var N="";i=0;do{(U=e.readByte())>0&&(N+=String.fromCharCode(U)),i++}while(U);var $=this.filename.substring(0,this.filename.lastIndexOf("\\")+1);try{null!=(z=this._tourDocument.getCachedTexture2d($+N))?(this._meshTextures.push(z),this.meshFilenames.push(N),_.diffuse=Colors.get_white()):this._meshTextures.push(null)}catch(e){this._meshTextures.push(null)}break;case 41520:this._loadPercentageChunk(e),e.readUInt16(),e.readUInt32(),N="",i=0;do{(U=e.readByte())>0&&(N+=String.fromCharCode(U)),i++}while(U);$=this.filename.substring(0,this.filename.lastIndexOf("\\")+1);try{null!=(z=this._tourDocument.getCachedTexture2d($+N))?(this._meshNormalMaps.push(z),this.meshFilenames.push(N),m=!0):this._meshNormalMaps.push(null)}catch(e){this._meshNormalMaps.push(null)}break;case 41476:var U,O=this._loadPercentageChunk(e);e.readUInt16(),e.readUInt32(),N="",i=0;do{(U=e.readByte())>0&&(N+=String.fromCharCode(U)),i++}while(U);$=this.filename.substring(0,this.filename.lastIndexOf("\\")+1);try{var z;if(null!=(z=this._tourDocument.getCachedTexture2d($+N))){this._meshSpecularTextures.push(z),this.meshFilenames.push(N);var G=ss.ss.truncate(255.99*O/100);_.specular=Color.fromArgb(255,G,G,G)}else this._meshSpecularTextures.push(null)}catch(e){this._meshSpecularTextures.push(null)}break;case 45072:s="",i=0;do{(W=e.readByte())>0&&(s+=String.fromCharCode(W)),i++}while(W);e.readUInt16(),e.readUInt16(),65535===(de=e.readUInt16())&&(de=-1),ss.ss.startsWith(s,"$")||w.push(s),S.push(de),ss.ss.keyExists(T,s)&&(T[s].level=de);break;case 45073:var W;s="",i=0;do{(W=e.readByte())>0&&(s+=String.fromCharCode(W)),i++}while(W);w.push("$$$"+s);break;case 45075:var H=new Array(3);for(i=0;i<3;i++)H[i]=e.readSingle();ss.ss.keyExists(T,s)&&(T[s].pivotPoint=Vector3d.create(-H[0],-H[1],-H[2]));break;case 45088:var X=new Array(8);for(i=0;i<8;i++)X[i]=e.readSingle();break;default:e.seekRelative(n-6)}e.close(),d>-1&&this._addMaterial(_);for(var j=Math.PI/180,Y=this.smooth?70*j:45*j,q=this._calculateVertexNormalsMerged(h,c,Y),K=[],J=3*o,Z=0;Z<J;++Z)(we=h[c[Z]]).set_normal(q[Z]),K.push(we);for(var Q=[],ee=ss.ss.enumerate(p);ee.moveNext();){var te=ee.current,ie=[];for(i=0;i<te.applyLists.length;i++){for(var re=te.applyListsIndex[i],ne=Q.length,se=ss.ss.enumerate(te.applyLists[i]);se.moveNext();){var ae=se.current;Q.push(3*ae),Q.push(3*ae+1),Q.push(3*ae+2)}var oe=new Group;oe.startIndex=ne,oe.indexCount=3*te.applyLists[i].length,oe.materialIndex=re,ie.push(oe)}te.drawGroup=ie}var le=new ss.ss.Stack,he=[],ce=new ObjectNode;ce.name="Root",ce.parent=null,ce.level=-1,ce.drawGroup=null;var ue=-1;for(le.push(ce),he.push(ce),i=0;i<S.length;i++){var de;if((de=S[i])<=ue){for(;de<=le.peek().level&&le.count>1;)le.pop();ue=de}if(ss.ss.startsWith(w[i],"$$$")){var _e=new ObjectNode;_e.name=ss.ss.replaceString(w[i],"$$$",""),_e.parent=le.peek(),_e.parent.children.push(_e),_e.level=ue=de,_e.drawGroup=null,le.push(_e)}else T[w[i]].level=ue=de,T[w[i]].parent=le.peek(),T[w[i]].parent.children.push(T[w[i]]),le.push(T[w[i]])}if(!S.length)for(var ge=ss.ss.enumerate(p);ge.moveNext();)te=ge.current,ce.children.push(te),te.parent=ce;if(m){for(var fe=[],me=0;me<J;++me)fe.push(me);for(var pe=this._calculateVertexTangents(K,fe,Y),Ce=new Array(K.length),Se=(Z=0,ss.ss.enumerate(K));Se.moveNext();){var we,Te=new PositionNormalTexturedTangent((we=Se.current).get_position(),we.get_normal(),Vector2d.create(we.tu,we.tv),pe[Z]);Ce[Z]=Te,++Z}this._mesh=Mesh.createTangent(Ce,Q)}else this._mesh=Mesh.create(K,Q);this.objects=he,this._mesh.setObjects(he),this._mesh.commitToDevice(),this._dirty=!1,this._readyToRender=!0},_offsetObjects:function(e,t,i,r){for(var n=ss.ss.enumerate(t);n.moveNext();){var s=n.current,a=s.localMat;this._offsetObjects(e,s.children,a,Vector3d.addVectors(s.pivotPoint,r));for(var o=ss.ss.enumerate(s.drawGroup);o.moveNext();)for(var l=o.current,h=l.startIndex+l.indexCount,c=l.startIndex;c<h;c++){var u=e[c];u.set_position(Vector3d.addVectors(u.get_position(),Vector3d.addVectors(s.pivotPoint,r))),e[c]=u}}},setupLighting:function(e){var t=Vector3d.create(e.get_world().get_offsetX(),e.get_world().get_offsetY(),e.get_world().get_offsetZ()),i=Vector3d.subtractVectors(t,e.get_reflectedLightPosition()),r=Vector3d.subtractVectors(e.get_sunPosition(),e.get_reflectedLightPosition()),n=r.length()<=0?1:Vector3d.dot(i,r)/(i.length()*r.length()),s=Math.max(0,n);s=Math.sqrt(s);var a=0,o=1;if(e.get_occludingPlanetRadius()>0){var l=Vector3d.subtractVectors(t,e.get_occludingPlanetPosition()).length()-e.get_occludingPlanetRadius();s*=1-(a=Math.max(0,Math.min(1,1-l/e.get_occludingPlanetRadius()*300)));var h=Vector3d.subtractVectors(e.get_occludingPlanetPosition(),e.get_sunPosition()),c=Vector3d.subtractVectors(e.get_occludingPlanetPosition(),t),u=Vector3d.create(-c.x,-c.y,-c.z);u.normalize(),e.set_hemisphereLightUp(u);var d=Vector3d.subtractVectors(e.get_sunPosition(),t),_=h.length(),g=-Vector3d.dot(d,h)/(_*_);if(g>1){var f=Vector3d.addVectors(e.get_sunPosition(),Vector3d.multiplyScalar(h,g)),m=Vector3d.subtractVectors(f,t).length(),p=(Vector3d.subtractVectors(f,e.get_sunPosition()).length(),.004645784),C=e.get_occludingPlanetRadius()+(g-1)*(e.get_occludingPlanetRadius()+p),S=e.get_occludingPlanetRadius()+(g-1)*(e.get_occludingPlanetRadius()-p);if(m<C){var w=0;if(S<0){var T=Math.pow(1/(1-S),2);S=0,w=1-T}var y=Math.max(0,S);o=Math.max(w,(m-y)/(C-y));var b=ss.ss.truncate(255.99*o);e.set_sunlightColor(Color.fromArgb(255,b,b,b)),a*=o}}}e.set_reflectedLightColor(Color.fromArgb(255,ss.ss.truncate(e.get_reflectedLightColor().r*s),ss.ss.truncate(e.get_reflectedLightColor().g*s),ss.ss.truncate(e.get_reflectedLightColor().b*s))),e.set_hemisphereLightColor(Color.fromArgb(255,ss.ss.truncate(e.get_hemisphereLightColor().r*a),ss.ss.truncate(e.get_hemisphereLightColor().g*a),ss.ss.truncate(e.get_hemisphereLightColor().b*a)))},render:function(e,t){if(this._readyToRender){this._dirty&&!this.issLayer&&this._reload();var i=e.get_world(),r=this._mesh.boundingSphere.center,n=1;this._mesh.boundingSphere.radius>0&&(n=1/this._mesh.boundingSphere.radius),e.set_world(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(Matrix3d.translation(Vector3d.create(-r.x,-r.y,-r.z)),Matrix3d._scaling(n,n,n)),i));var s=Matrix3d.multiplyMatrix(e.get_world(),e.get_view()),a=s.transform(Vector3d.get_empty()),o=Math.sqrt(s.get_m11()*s.get_m11()+s.get_m22()*s.get_m22()+s.get_m33()*s.get_m33())/n,l=a.length(),h=o,c=ss.ss.truncate(e.height),u=e.get_projection().get_m11(),d=e.get_projection().get_m34(),_=e.get_projection().get_m44();if(!(h*(u/(Math.abs(d)*l+_)*c)<.5)){var g=e.get_sunlightColor(),f=e.get_reflectedLightColor(),m=e.get_hemisphereLightColor();if(Settings.get_current().get_solarSystemLighting()?(this.setupLighting(e),this.useCurrentAmbient||e.set_ambientLightColor(Color.fromArgb(255,11,11,11))):(e.set_sunlightColor(Colors.get_black()),e.set_reflectedLightColor(Colors.get_black()),e.set_hemisphereLightColor(Colors.get_black()),e.set_ambientLightColor(Colors.get_white())),null!=this._mesh){ModelShader.minLightingBrightness=.1;var p=this._meshMaterials.length;if(this._mesh.beginDrawing(e),p>0)for(var C=0;C<this._meshMaterials.length;C++){if(this._meshMaterials[C].isDefault){var S=this._meshMaterials[C];S.diffuse=this.color,S.ambient=this.color,this._meshMaterials[C]=S}e.setMaterial(this._meshMaterials[C],this._meshTextures[C],this._meshSpecularTextures[C],this._meshNormalMaps[C],t),null!=this._mesh.vertexBuffer?ModelShader.use(e,this._mesh.vertexBuffer.vertexBuffer,this._mesh.indexBuffer.buffer,null!=this._meshTextures[C]?this._meshTextures[C].texture2d:null,t,!1,32):ModelShader.use(e,this._mesh.tangentVertexBuffer.vertexBuffer,this._mesh.indexBuffer.buffer,null!=this._meshTextures[C]?this._meshTextures[C].texture2d:null,t,!1,44),e.preDraw(),this._mesh.drawSubset(e,C)}else for(e.preDraw(),C=0;C<this._meshTextures.length;C++)null!=this._meshTextures[C]&&(e.set_mainTexture(this._meshTextures[C]),null!=this._mesh.vertexBuffer?ModelShader.use(e,this._mesh.vertexBuffer.vertexBuffer,this._mesh.indexBuffer.buffer,null!=this._meshTextures[C]?this._meshTextures[C].texture2d:null,t,!1,32):ModelShader.use(e,this._mesh.tangentVertexBuffer.vertexBuffer,this._mesh.indexBuffer.buffer,null!=this._meshTextures[C]?this._meshTextures[C].texture2d:null,t,!1,44)),e.preDraw(),this._mesh.drawSubset(e,C);e.set_world(i),e.set_sunlightColor(g),e.set_reflectedLightColor(f),e.set_hemisphereLightColor(m),e.set_ambientLightColor(Colors.get_black())}}}},dispose:function(){null!=this._mesh&&(this._mesh.dispose(),this._mesh=null);for(var e=ss.ss.enumerate(ss.ss.keys(this._textureCache));e.moveNext();){var t=e.current,i=this._textureCache[t];null!=i&&i.dispose()}ss.ss.clearKeys(this._textureCache),Object3d._disposeTextureList(this._meshTextures),Object3d._disposeTextureList(this._meshSpecularTextures),Object3d._disposeTextureList(this._meshNormalMaps),this._meshMaterials.length=0,this._dirty=!0}};function ObjectNode(){this.level=-1,this.children=[],this.enabled=!0,this.drawGroup=[],this.applyLists=[],this.applyListsIndex=[]}registerType("Object3d",[Object3d,Object3d$,null]);var ObjectNode$={};function Object3dLayerUI(e){this._layer$1=null,this._opened$1=!0,this._callbacks$1=null,LayerUI.call(this),this._layer$1=e}registerType("ObjectNode",[ObjectNode,ObjectNode$,null]);var Object3dLayerUI$={setUICallbacks:function(e){this._callbacks$1=e},get_hasTreeViewNodes:function(){return!0},getTreeNodes:function(){var e=[];return this._layer$1.object3d.objects.length>0&&null!=this._layer$1.object3d.objects[0].children&&this._loadTree$1(e,this._layer$1.object3d.objects[0].children),e},_loadTree$1:function(e,t){for(var i=ss.ss.enumerate(t);i.moveNext();){var r=i.current,n=new LayerUITreeNode;n.set_name(r.name),n.set_tag(r),n.set_checked(r.enabled),n.add_nodeSelected(ss.ss.bind("_node_NodeSelected$1",this)),n.add_nodeChecked(ss.ss.bind("_node_NodeChecked$1",this)),e.push(n),this._loadTree$1(n.get_nodes(),r.children)}},_node_NodeChecked$1:function(e,t){var i=e.get_tag();null!=i&&(i.enabled=t)},_node_NodeSelected$1:function(e){if(null!=this._callbacks$1){var t=e.get_tag(),i={};i.Name=t.name,i["Pivot.X"]=t.pivotPoint.x.toString(),i["Pivot.Y"]=t.pivotPoint.y.toString(),i["Pivot.Z"]=t.pivotPoint.z.toString(),this._callbacks$1.showRowData(i)}},getNodeContextMenu:function(e){return LayerUI.prototype.getNodeContextMenu.call(this,e)}};function Orbit(e,t,i,r,n){this._elements=null,this._orbitColor=Colors.get_white(),this._scale=0,this._segmentCount=0,this._elements=e,this._segmentCount=t,this._orbitColor=i,this._scale=n}registerType("Object3dLayerUI",[Object3dLayerUI,Object3dLayerUI$,LayerUI]),Orbit._orbitalToWwt=Matrix3d.create(1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1),Orbit._initBegun=!1;var Orbit$={cleanUp:function(){},get_boundingRadius:function(){return null!=this._elements?this._elements.a*(1+this._elements.e)/this._scale:0},draw3D:function(e,t,i){var r=Matrix3d.multiplyMatrix(Matrix3d._rotationZ(Coordinates.degreesToRadians(this._elements.w)),Matrix3d.multiplyMatrix(Matrix3d._rotationX(Coordinates.degreesToRadians(this._elements.i)),Matrix3d._rotationZ(Coordinates.degreesToRadians(this._elements.omega))));r=Matrix3d.multiplyMatrix(r,Orbit._orbitalToWwt);var n=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(r,Matrix3d.translation(i)),e.get_world()),s=this._elements.n*(SpaceTimeController.get_jNow()-this._elements.t),a=1;s<0&&(a=-1),s=360*((s=Math.abs(s)/360)-ss.ss.truncate(s))*a;for(var o=Color._fromArgbColor(ss.ss.truncate(255*t),this._orbitColor),l=s=Coordinates.degreesToRadians(s),h=0;h<5;h++)l+=(s-l+this._elements.e*Math.sin(l))/(1-this._elements.e*Math.cos(l));EllipseRenderer.drawEllipse(e,this._elements.a/this._scale,this._elements.e,l,o,n)}};function EllipseRenderer(){}registerType("Orbit",[Orbit,Orbit$,null]),EllipseRenderer.drawEllipseWithPosition=function(e,t,i,r,n,s,a){null==EllipseRenderer._ellipseShader&&(EllipseRenderer._ellipseShader=new EllipseShader),null==EllipseRenderer._ellipseVertexBuffer&&(EllipseRenderer._ellipseVertexBuffer=EllipseRenderer.createEllipseVertexBuffer(500));var o=e.get_world();e.set_world(s),e.gl.bindBuffer(WEBGL.ARRAY_BUFFER,EllipseRenderer._ellipseVertexBuffer.vertexBuffer),e.gl.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),EllipseShader.use(e,t,i,r,n,1,o,a),e.gl.drawArrays(WEBGL.LINE_STRIP,0,EllipseRenderer._ellipseVertexBuffer.count),e.set_world(o)},EllipseRenderer.drawEllipse=function(e,t,i,r,n,s){null==EllipseRenderer._ellipseShader&&(EllipseRenderer._ellipseShader=new EllipseShader),null==EllipseRenderer._ellipseWithoutStartPointVertexBuffer&&(EllipseRenderer._ellipseWithoutStartPointVertexBuffer=EllipseRenderer.createEllipseVertexBufferWithoutStartPoint(360));var a=e.get_world();e.set_world(s),e.gl.bindBuffer(WEBGL.ARRAY_BUFFER,EllipseRenderer._ellipseWithoutStartPointVertexBuffer.vertexBuffer),e.gl.bindBuffer(WEBGL.ELEMENT_ARRAY_BUFFER,null),EllipseShader.use(e,t,i,r,n,1,a,Vector3d.create(0,0,0)),e.gl.drawArrays(WEBGL.LINE_STRIP,0,EllipseRenderer._ellipseWithoutStartPointVertexBuffer.count-1),e.set_world(a)},EllipseRenderer.createEllipseVertexBuffer=function(e){for(var t=new PositionVertexBuffer(e),i=t.lock(),r=0,n=0;n<e/2;++n)i[r++]=Vector3d.create(2*n/e*.05,0,0);for(n=0;n<e/2;++n)i[r++]=Vector3d.create(2*n/e*.95+.05,0,0);return t.unlock(),t},EllipseRenderer.createEllipseVertexBufferWithoutStartPoint=function(e){var t=new PositionVertexBuffer(e),i=t.lock();i[0]=Vector3d.create(1e-6,0,0);for(var r=1;r<e;++r)i[r]=Vector3d.create(2*r/e,0,0);return t.unlock(),t};var EllipseRenderer$={};registerType("EllipseRenderer",[EllipseRenderer,EllipseRenderer$,null]);var ReferenceFrameTypes={fixedSherical:0,orbital:1,trajectory:2,synodic:3};function ReferenceFrame(){this._systemGenerated=!1,this.meanAnomoly=0,this.orbitalYears=0,this.observingLocation=!1,this.reference=18,this.parentsRoationalBase=!1,this.referenceFrameType=0,this.meanRadius=6371e3,this.oblateness=.0033528,this.heading=0,this.pitch=0,this.roll=0,this.scale=1,this.tilt=0,this.translation=new Vector3d,this.lat=0,this.lng=0,this.altitude=0,this.rotationalPeriod=0,this.zeroRotationDate=0,this.representativeColor=Colors.get_white(),this.showAsPoint=!1,this.showOrbitPath=!1,this.stationKeeping=!0,this.semiMajorAxis=0,this.semiMajorAxisUnits=1,this.eccentricity=0,this.inclination=0,this.argumentOfPeriapsis=0,this.longitudeOfAscendingNode=0,this.meanAnomolyAtEpoch=0,this.meanDailyMotion=0,this.epoch=0,this._orbit=null,this._elements=new EOE,this.worldMatrix=new Matrix3d,this.worldMatrix=Matrix3d.get_identity()}registerType("ReferenceFrameTypes",ReferenceFrameTypes),registerEnum("ReferenceFrameTypes",ReferenceFrameTypes),ReferenceFrame.isTLECheckSumGood=function(e){if(69!==e.length)return!1;for(var t=0,i=0;i<68;i++)switch(e.substr(i,1)){case"1":case"-":t+=1;break;case"2":t+=2;break;case"3":t+=3;break;case"4":t+=4;break;case"5":t+=5;break;case"6":t+=6;break;case"7":t+=7;break;case"8":t+=8;break;case"9":t+=9}return(t%10).toString()===e.charAt(68).toString()},ReferenceFrame.toTLEExponential=function(e,t){var i=e.toExponential(t);return i.length<t+6&&(i=i.substring(0,t+4)+"0"+i.substr(t+4,1)),i},ReferenceFrame.tleNumberString=function(e,t,i){var r=e.toFixed(i),n=r.indexOf(".");-1===n&&(n=r.length,r+=".0");var s=r.length-n-1,a="00000000";return a.substr(0,t-n)+r+a.substr(0,i-s)},ReferenceFrame.computeTLECheckSum=function(e){if(68!==e.length)return"0";for(var t=0,i=0;i<68;i++)switch(e[i]){case"1":case"-":t+=1;break;case"2":t+=2;break;case"3":t+=3;break;case"4":t+=4;break;case"5":t+=5;break;case"6":t+=6;break;case"7":t+=7;break;case"8":t+=8;break;case"9":t+=9}return t%10};var ReferenceFrame$={get_representativeColor:function(){return this.representativeColor},set_representativeColor:function(e){return e!==this.representativeColor&&(this.representativeColor=e,this._orbit=null),e},get_orbit:function(){return this._orbit},set_orbit:function(e){return this._orbit=e,e},getIndentifier:function(){return this.name},importTrajectory:function(e){},saveToXml:function(e){e._writeStartElement("ReferenceFrame"),e._writeAttributeString("Name",this.name),e._writeAttributeString("Parent",this.parent),e._writeAttributeString("ReferenceFrameType",Enums.toXml("ReferenceFrameTypes",this.referenceFrameType)),e._writeAttributeString("Reference",Enums.toXml("ReferenceFrames",this.reference)),e._writeAttributeString("ParentsRoationalBase",this.parentsRoationalBase.toString()),e._writeAttributeString("MeanRadius",this.meanRadius.toString()),e._writeAttributeString("Oblateness",this.oblateness.toString()),e._writeAttributeString("Heading",this.heading.toString()),e._writeAttributeString("Pitch",this.pitch.toString()),e._writeAttributeString("Roll",this.roll.toString()),e._writeAttributeString("Scale",this.scale.toString()),e._writeAttributeString("Tilt",this.tilt.toString()),e._writeAttributeString("Translation",this.translation.toString()),this.referenceFrameType||(e._writeAttributeString("Lat",this.lat.toString()),e._writeAttributeString("Lng",this.lng.toString()),e._writeAttributeString("Altitude",this.altitude.toString())),e._writeAttributeString("RotationalPeriod",this.rotationalPeriod.toString()),e._writeAttributeString("ZeroRotationDate",this.zeroRotationDate.toString()),e._writeAttributeString("RepresentativeColor",this.get_representativeColor().save()),e._writeAttributeString("ShowAsPoint",this.showAsPoint.toString()),e._writeAttributeString("ShowOrbitPath",this.showOrbitPath.toString()),e._writeAttributeString("StationKeeping",this.stationKeeping.toString()),1===this.referenceFrameType&&(e._writeAttributeString("SemiMajorAxis",this.semiMajorAxis.toString()),e._writeAttributeString("SemiMajorAxisScale",Enums.toXml("AltUnits",this.semiMajorAxisUnits)),e._writeAttributeString("Eccentricity",this.eccentricity.toString()),e._writeAttributeString("Inclination",this.inclination.toString()),e._writeAttributeString("ArgumentOfPeriapsis",this.argumentOfPeriapsis.toString()),e._writeAttributeString("LongitudeOfAscendingNode",this.longitudeOfAscendingNode.toString()),e._writeAttributeString("MeanAnomolyAtEpoch",this.meanAnomolyAtEpoch.toString()),e._writeAttributeString("MeanDailyMotion",this.meanDailyMotion.toString()),e._writeAttributeString("Epoch",this.epoch.toString())),e._writeEndElement()},initializeFromXml:function(e){this.name=e.attributes.getNamedItem("Name").nodeValue,this.parent=e.attributes.getNamedItem("Parent").nodeValue,this.referenceFrameType=Enums.parse("ReferenceFrameTypes",e.attributes.getNamedItem("ReferenceFrameType").nodeValue),this.reference=Enums.parse("ReferenceFrames",e.attributes.getNamedItem("Reference").nodeValue),this.parentsRoationalBase=ss.ss.boolean(e.attributes.getNamedItem("ParentsRoationalBase").nodeValue),this.meanRadius=parseFloat(e.attributes.getNamedItem("MeanRadius").nodeValue),this.oblateness=parseFloat(e.attributes.getNamedItem("Oblateness").nodeValue),this.heading=parseFloat(e.attributes.getNamedItem("Heading").nodeValue),this.pitch=parseFloat(e.attributes.getNamedItem("Pitch").nodeValue),this.roll=parseFloat(e.attributes.getNamedItem("Roll").nodeValue),this.scale=parseFloat(e.attributes.getNamedItem("Scale").nodeValue),this.tilt=parseFloat(e.attributes.getNamedItem("Tilt").nodeValue),this.translation=Vector3d.parse(e.attributes.getNamedItem("Translation").nodeValue),this.referenceFrameType||(this.lat=parseFloat(e.attributes.getNamedItem("Lat").nodeValue),this.lng=parseFloat(e.attributes.getNamedItem("Lng").nodeValue),this.altitude=parseFloat(e.attributes.getNamedItem("Altitude").nodeValue)),this.rotationalPeriod=parseFloat(e.attributes.getNamedItem("RotationalPeriod").nodeValue),this.zeroRotationDate=parseFloat(e.attributes.getNamedItem("ZeroRotationDate").nodeValue),this.set_representativeColor(Color.load(e.attributes.getNamedItem("RepresentativeColor").nodeValue)),this.showAsPoint=ss.ss.boolean(e.attributes.getNamedItem("ShowAsPoint").nodeValue),null!=e.attributes.getNamedItem("StationKeeping")&&(this.stationKeeping=ss.ss.boolean(e.attributes.getNamedItem("StationKeeping").nodeValue)),1===this.referenceFrameType&&(this.showOrbitPath=ss.ss.boolean(e.attributes.getNamedItem("ShowOrbitPath").nodeValue),this.semiMajorAxis=parseFloat(e.attributes.getNamedItem("SemiMajorAxis").nodeValue),this.semiMajorAxisUnits=Enums.parse("AltUnits",e.attributes.getNamedItem("SemiMajorAxisScale").nodeValue),this.eccentricity=parseFloat(e.attributes.getNamedItem("Eccentricity").nodeValue),this.inclination=parseFloat(e.attributes.getNamedItem("Inclination").nodeValue),this.argumentOfPeriapsis=parseFloat(e.attributes.getNamedItem("ArgumentOfPeriapsis").nodeValue),this.longitudeOfAscendingNode=parseFloat(e.attributes.getNamedItem("LongitudeOfAscendingNode").nodeValue),this.meanAnomolyAtEpoch=parseFloat(e.attributes.getNamedItem("MeanAnomolyAtEpoch").nodeValue),this.meanDailyMotion=parseFloat(e.attributes.getNamedItem("MeanDailyMotion").nodeValue),this.epoch=parseFloat(e.attributes.getNamedItem("Epoch").nodeValue))},fromTLE:function(e,t,i){this.epoch=SpaceTimeController._twoLineDateToJulian(e.substr(18,14)),this.eccentricity=parseFloat("0."+t.substr(26,7)),this.inclination=parseFloat(t.substr(8,8)),this.longitudeOfAscendingNode=parseFloat(t.substr(17,8)),this.argumentOfPeriapsis=parseFloat(t.substr(34,8));var r=parseFloat(t.substr(52,11));this.meanAnomolyAtEpoch=parseFloat(t.substr(43,8)),this.meanDailyMotion=360*r;var n=86400/r/(2*Math.PI);this.semiMajorAxis=Math.pow(n*n*i,1/3),this.semiMajorAxisUnits=1},toTLE:function(){var e=new ss.ss.StringBuilder;e.append("1 99999U 00111AAA "),e.append(SpaceTimeController.julianToTwoLineDate(this.epoch)),e.append(" "),e.append(this.semiMajorAxis.toExponential(4)),e.append(" 00000-0 "),e.append(ReferenceFrame.toTLEExponential(this.meanDailyMotion,5)),e.append("  001"),e.append(ReferenceFrame.computeTLECheckSum(e.toString())),e.appendLine("");var t=new ss.ss.StringBuilder;return t.append("2 99999 "),t.append(ReferenceFrame.tleNumberString(this.inclination,3,4)+" "),t.append(ReferenceFrame.tleNumberString(this.longitudeOfAscendingNode,3,4)+" "),t.append((ReferenceFrame.tleNumberString(this.eccentricity,1,7)+" ").substring(2)),t.append(ReferenceFrame.tleNumberString(this.argumentOfPeriapsis,3,4)+" "),t.append(ReferenceFrame.tleNumberString(this.meanAnomolyAtEpoch,3,4)+" "),t.append(ReferenceFrame.toTLEExponential(this.meanDailyMotion/207732,5)),t.append("00001"),t.append(ReferenceFrame.computeTLECheckSum(t.toString())),t.appendLine(""),e.toString()+t.toString()},get_elements:function(){return this._elements.a=this.semiMajorAxis,this._elements.e=this.eccentricity,this._elements.i=this.inclination,this._elements.w=this.argumentOfPeriapsis,this._elements.omega=this.longitudeOfAscendingNode,this._elements.jdEquinox=this.epoch,this.meanDailyMotion?this._elements.n=this.meanDailyMotion:this._elements.n=ELL.meanMotionFromSemiMajorAxis(this._elements.a),this._elements.t=this.epoch-this.meanAnomolyAtEpoch/this._elements.n,this._elements},set_elements:function(e){return this._elements=e,e},computeFrame:function(e){switch(this.referenceFrameType){case 1:this._computeOrbital(e);break;case 0:this._computeFixedSherical(e);break;case 2:this._computeFrameTrajectory(e)}},useRotatingParentFrame:function(){switch(this.referenceFrameType){case 1:case 2:case 3:return!1;default:return!0}},_computeFixedRectangular:function(e){},_computeFixedSherical:function(e){this.observingLocation&&(this.lat=SpaceTimeController.get_location().get_lat(),this.lng=SpaceTimeController.get_location().get_lng(),this.altitude=SpaceTimeController.get_altitude()),this.worldMatrix=Matrix3d.get_identity(),this.worldMatrix.translate(this.translation);var t=1/e.get_nominalRadius()*this.scale*this.meanRadius;if(this.worldMatrix.scale(Vector3d.create(t,t,t)),this.worldMatrix._multiply(Matrix3d.rotationYawPitchRoll(this.heading/180*Math.PI,this.pitch/180*Math.PI,this.roll/180*Math.PI)),this.worldMatrix._multiply(Matrix3d._rotationZ(-.5*Math.PI)),this.rotationalPeriod){var i=(SpaceTimeController.get_jNow()-this.zeroRotationDate)/this.rotationalPeriod*Math.PI*2%(2*Math.PI);this.worldMatrix._multiply(Matrix3d._rotationX(-i))}this.worldMatrix.translate(Vector3d.create(1+this.altitude/e.get_nominalRadius(),0,0)),this.worldMatrix._multiply(Matrix3d._rotationZ(this.lat/180*Math.PI)),this.worldMatrix._multiply(Matrix3d._rotationY(-(this.lng+180)/180*Math.PI))},_computeFrameTrajectory:function(e){},_computeOrbital:function(e){var t=this.get_elements(),i=ELL.calculateRectangularJD(SpaceTimeController.get_jNow(),t);this.meanAnomoly=t.meanAnnomolyOut;var r=ELL.calculateRectangular(t,this.meanAnomoly+.001),n=Vector3d.subtractVectors(i,r),s=i.copy();s.normalize(),n.normalize(),i.length();var a=1;switch(this.semiMajorAxisUnits){case 1:case 10:a=1;break;case 2:a=1/3.2808399;break;case 3:a=1/3.2808399/12;break;case 4:a=1609.344;break;case 5:a=1e3;break;case 6:a=149598e6;break;case 7:a=9460528406976600;break;case 8:a=0x6da0192cd11520;break;case 9:a=30856802447988e9}a*=1/e.get_nominalRadius();var o=Matrix3d.lookAtLH(Vector3d.create(0,0,0),n,s);o.invert(),this.worldMatrix=Matrix3d.get_identity(),this.worldMatrix.translate(this.translation);var l=1/e.get_nominalRadius()*this.scale*this.meanRadius;if(this.worldMatrix.scale(Vector3d.create(l,l,l)),this.worldMatrix._multiply(Matrix3d.rotationYawPitchRoll(this.heading/180*Math.PI,this.pitch/180*Math.PI,this.roll/180*Math.PI)),this.rotationalPeriod){var h=(SpaceTimeController.get_jNow()-this.zeroRotationDate)/this.rotationalPeriod*Math.PI*2%(2*Math.PI);this.worldMatrix._multiply(Matrix3d._rotationX(-h))}i=Vector3d.scale(i,a),this.worldMatrix.translate(i),this.stationKeeping&&(this.worldMatrix=Matrix3d.multiplyMatrix(o,this.worldMatrix))}};function OrbitLayer(){this._frames$1=[],this._primaryUI$1=null,this._pointOpacity$1=1,this._pointColor$1=Colors.get_yellow(),this._filename$1="",this._dataFile$1="",Layer.call(this)}registerType("ReferenceFrame",[ReferenceFrame,ReferenceFrame$,null]);var OrbitLayer$={get_frames:function(){return this._frames$1},set_frames:function(e){return this._frames$1=e,e},getPrimaryUI:function(){return null==this._primaryUI$1&&(this._primaryUI$1=new OrbitLayerUI(this)),this._primaryUI$1},cleanUp:function(){for(var e=ss.ss.enumerate(this._frames$1);e.moveNext();){var t=e.current;null!=t.get_orbit()&&(t.get_orbit().cleanUp(),t.set_orbit(null))}},writeLayerProperties:function(e){e._writeAttributeString("PointOpacity",this.get_pointOpacity().toString()),e._writeAttributeString("PointColor",this._pointColor$1.save())},get_pointOpacity:function(){return this._pointOpacity$1},set_pointOpacity:function(e){return this._pointOpacity$1!==e&&(this.version++,this._pointOpacity$1=e),e},get_pointColor:function(){return this._pointColor$1},set_pointColor:function(e){return this._pointColor$1!==e&&(this.version++,this._pointColor$1=e),e},getParams:function(){var e=new Array(6);return e[0]=this._pointOpacity$1,e[1]=this.get_color().r/255,e[2]=this.get_color().g/255,e[3]=this.get_color().b/255,e[4]=this.get_color().a/255,e[5]=this.get_opacity(),e},getParamNames:function(){return["PointOpacity","Color.Red","Color.Green","Color.Blue","Color.Alpha","Opacity"]},setParams:function(e){if(6===e.length){this._pointOpacity$1=e[0],this.set_opacity(e[5]);var t=Color.fromArgb(ss.ss.truncate(255*e[4]),ss.ss.truncate(255*e[1]),ss.ss.truncate(255*e[2]),ss.ss.truncate(255*e[3]));this.set_color(t)}},initializeFromXml:function(e){this.set_pointOpacity(parseFloat(e.attributes.getNamedItem("PointOpacity").nodeValue)),this.set_pointColor(Color.load(e.attributes.getNamedItem("PointColor").nodeValue))},draw:function(e,t,i){var r=e.get_world();e.set_world(e.get_worldBaseNonRotating());for(var n=ss.ss.enumerate(this._frames$1);n.moveNext();){var s=n.current;s.showOrbitPath&&(null==s.get_orbit()&&s.set_orbit(new Orbit(s.get_elements(),360,this.get_color(),1,e.get_nominalRadius())),s.get_orbit().draw3D(e,t*this.get_opacity(),new Vector3d))}return e.set_world(r),!0},addFilesToCabinet:function(e){this._filename$1=e.tempDirectory+ss.ss.format("{0}\\{1}.txt",e.get_packageID(),this.id.toString()),this._filename$1.substring(0,this._filename$1.lastIndexOf("\\"));var t=new Blob([this._dataFile$1]);e.addFile(this._filename$1,t),Layer.prototype.addFilesToCabinet.call(this,e)},loadData:function(e,t){var i=this,r=e.getFileBlob(t),n=new FileReader;n.onloadend=function(e){i._dataFile$1=ss.ss.safeCast(n.result,String),i.loadString(i._dataFile$1)},n.readAsText(r)},loadString:function(e){var t=e.split("\n");this._frames$1.length=0;for(var i=0;i<t.length;i+=2){var r=i,n=i+1;if(t[i].length>0){var s=new ReferenceFrame;if("1"!==t[i].substring(0,1))r++,n++,s.name=ss.ss.trim(t[i]),i++;else{if("1"!==t[i].substring(0,1)){i-=2;continue}s.name=t[i].substring(2,5)}s.reference=18,s.oblateness=0,s.showOrbitPath=!0,s.showAsPoint=!0,s.referenceFrameType=1,s.scale=1,s.semiMajorAxisUnits=1,s.meanRadius=10,s.oblateness=0,s.fromTLE(t[r],t[n],3986004418e5),this._frames$1.push(s)}else i-=1}}};function OrbitLayerUI(e){this._layer$1=null,this._opened$1=!0,this._callbacks$1=null,LayerUI.call(this),this._layer$1=e}registerType("OrbitLayer",[OrbitLayer,OrbitLayer$,Layer]);var OrbitLayerUI$={setUICallbacks:function(e){this._callbacks$1=e},get_hasTreeViewNodes:function(){return!0},getTreeNodes:function(){for(var e=[],t=ss.ss.enumerate(this._layer$1.get_frames());t.moveNext();){var i=t.current,r=new LayerUITreeNode;r.set_name(i.name),r.set_tag(i),r.set_checked(i.showOrbitPath),r.add_nodeSelected(ss.ss.bind("_node_NodeSelected$1",this)),r.add_nodeChecked(ss.ss.bind("_node_NodeChecked$1",this)),e.push(r)}return e},_node_NodeChecked$1:function(e,t){var i=e.get_tag();null!=i&&(i.showOrbitPath=t)},_node_NodeSelected$1:function(e){if(null!=this._callbacks$1){var t=e.get_tag(),i={};i.Name=t.name,i["SemiMajor Axis"]=t.semiMajorAxis.toString(),i["SMA Units"]=t.semiMajorAxisUnits.toString(),i.Inclination=t.inclination.toString(),i.Eccentricity=t.eccentricity.toString(),i["Long of Asc. Node"]=t.longitudeOfAscendingNode.toString(),i["Argument Of Periapsis"]=t.argumentOfPeriapsis.toString(),i.Epoch=t.epoch.toString(),i["Mean Daily Motion"]=t.meanDailyMotion.toString(),i["Mean Anomoly at Epoch"]=t.meanAnomolyAtEpoch.toString(),this._callbacks$1.showRowData(i)}},getNodeContextMenu:function(e){return LayerUI.prototype.getNodeContextMenu.call(this,e)}};function Table(){this.guid=new Guid,this.header=[],this.rows=[],this.delimiter="\t",this.locked=!1}registerType("OrbitLayerUI",[OrbitLayerUI,OrbitLayerUI$,LayerUI]);var Table$={lock:function(){this.locked=!0},unlock:function(){this.locked=!1},save:function(){for(var e="",t=!0,i=ss.ss.enumerate(this.header);i.moveNext();)t?t=!1:e+="\t",e+=i.current;e+="\r\n";for(var r=ss.ss.enumerate(this.rows);r.moveNext();){var n=r.current;t=!0;for(var s=ss.ss.enumerate(n);s.moveNext();)t?t=!1:e+="\t",e+=s.current;e+="\r\n"}return e},loadFromString:function(e,t,i,r){var n=0,s=e.split("\r\n");if(!t||r)if(s.length>0){var a=s[0];n++,-1===a.indexOf("\t")&&a.indexOf(",")>-1&&(this.delimiter=","),t||(this.rows.length=0),this.header=UiTools.splitString(a,this.delimiter)}else this.header=[];var o=[];for(i||(o=this.rows);n<s.length;){var l=s[n],h=UiTools.splitString(l,this.delimiter);if(h.length<1)break;o.push(h),n++}i&&(this.rows=o)},clone:function(){for(var e=new Table,t=0;t<this.header.length;t++)e.header.push(this.header[t]);for(var i=0;i<this.rows.length;i++)for(e.rows.push([]),t=0;t<this.rows[i].length;t++)e.rows[i].push(this.rows[i][t]);return e},addColumn:function(e,t){this.header.push(e);for(var i=0;i<t.length;i++)this.rows[i].push(t[i])},removeColumn:function(e){var t=this.header.indexOf(e);if(t>-1){this.header.splice(t,1);for(var i=0;i<this.rows.length;i++)this.rows[i].splice(t,1)}}};registerType("Table",[Table,Table$,null]);var Primitives={voBoolean:1,voBit:2,voUnsignedByte:3,voShort:4,voInt:5,voLong:6,voChar:7,voUnicodeChar:8,voFloat:9,voDouble:10,voFloatComplex:11,voDoubleComplex:12,voUndefined:13};function VoTable(){this.columns={},this.column=[],this.rows=[],this.loadFilename="",this.sampId="",this.selectedRow=null,this.error=!1,this.errorText=""}registerType("Primitives",Primitives),registerEnum("Primitives",Primitives),VoTable.loadFromUrl=function(e,t){var i=new VoTable;return i._onComplete=t,i._webFile=new WebFile(URLHelpers.singleton.rewrite(e,1)),i._webFile.onStateChange=ss.ss.bind("_loadData",i),i._webFile.send(),i},VoTable.loadFromString=function(e){var t=(new DOMParser).parseFromString(e,"text/xml"),i=new VoTable;return i.loadFromXML(t),i};var VoTable$={_loadData:function(){2===this._webFile.get_state()?alert(this._webFile.get_message()):1===this._webFile.get_state()&&(this.loadFromXML(this._webFile.getXml()),null!=this._onComplete&&this._onComplete())},loadFromXML:function(e){var t=Util.selectSingleNode(e,"VOTABLE");if(null!=t){var i=0;try{var r=Util.selectSingleNode(Util.selectSingleNode(t,"RESOURCE"),"TABLE");if(null!=r)for(var n=ss.ss.enumerate(r.childNodes);n.moveNext();)if("FIELD"===(l=n.current).nodeName){var s=new VoColumn(l,i++);this.columns[s.name]=s,this.column.push(s)}}catch(e){this.error=!0,this.errorText=Util.selectSingleNode(t,"DESCRIPTION").text}try{var a=Util.selectSingleNode(Util.selectSingleNode(Util.selectSingleNode(Util.selectSingleNode(t,"RESOURCE"),"TABLE"),"DATA"),"TABLEDATA");if(null!=a)for(var o=ss.ss.enumerate(a.childNodes);o.moveNext();){var l;if("TR"===(l=o.current).nodeName){var h=new VoRow(this);h.columnData=new Array(ss.ss.keyCount(this.columns)),i=0;for(var c=ss.ss.enumerate(l.childNodes);c.moveNext();){var u=c.current;"TD"===u.nodeName&&(h.columnData[i++]=ss.ss.trim(Util.getInnerText(u)))}this.rows.push(h)}}}catch(e){}}},save:function(e){return!0},getColumnByUcd:function(e){for(var t=ss.ss.enumerate(ss.ss.keys(this.columns));t.moveNext();){var i=t.current,r=this.columns[i];if(ss.ss.replaceString(r.ucd,"_",".").toLocaleLowerCase().indexOf(e.toLocaleLowerCase())>-1)return r}return null},getRAColumn:function(){for(var e=ss.ss.enumerate(ss.ss.keys(this.columns));e.moveNext();){var t=e.current;if((r=this.columns[t]).ucd.toLocaleLowerCase().indexOf("pos.eq.ra")>-1||r.ucd.toLocaleLowerCase().indexOf("pos_eq_ra")>-1)return r}for(var i=ss.ss.enumerate(ss.ss.keys(this.columns));i.moveNext();){var r;if(t=i.current,(r=this.columns[t]).name.toLocaleLowerCase().indexOf("ra")>-1)return r}return null},getDecColumn:function(){for(var e=ss.ss.enumerate(ss.ss.keys(this.columns));e.moveNext();){var t=e.current;if((r=this.columns[t]).ucd.toLowerCase().indexOf("pos.eq.dec")>-1||r.ucd.toLowerCase().indexOf("pos_eq_dec")>-1)return r}for(var i=ss.ss.enumerate(ss.ss.keys(this.columns));i.moveNext();){var r;if(t=i.current,(r=this.columns[t]).name.toLowerCase().indexOf("dec")>-1)return r}return null},getMagColumn:function(){for(var e=ss.ss.enumerate(ss.ss.keys(this.columns));e.moveNext();){var t=e.current,i=this.columns[t];if(i.ucd.toLowerCase().indexOf("phot.mag")>-1||i.ucd.toLowerCase().indexOf("phot_mag")>-1)return i}return null},getDistanceColumn:function(){for(var e=ss.ss.enumerate(ss.ss.keys(this.columns));e.moveNext();){var t=e.current,i=this.columns[t];if(i.ucd.toLowerCase().indexOf("pos.distance")>-1||i.ucd.toLowerCase().indexOf("pos_distance")>-1)return i}return null},toString:function(){for(var e=new ss.ss.StringBuilder,t=!0,i=ss.ss.enumerate(ss.ss.keys(this.columns));i.moveNext();){var r=i.current,n=this.columns[r];t?t=!1:e.append("\t"),e.append(n.name)}e.appendLine("");for(var s=ss.ss.enumerate(this.rows);s.moveNext();){var a=s.current;t=!0;for(var o=ss.ss.enumerate(a.columnData);o.moveNext();)n=o.current,t?t=!1:e.append("\t"),e.append(n.toString());e.appendLine("")}return e.toString()}};function VoRow(e){this.selected=!1,this.owner=e}registerType("VoTable",[VoTable,VoTable$,null]);var VoRow$={getColumnData:function(e){return null!=this.owner.columns[e]?this.columnData[this.owner.columns[e].index]:null},get_item:function(e){return e<0||e>=this.columnData.length?null:this.columnData[e]}};function VoColumn(e,t){if(this.id="",this.type=0,this.precision=0,this.dimentions=0,this.sizes=null,this.ucd="",this.unit="",this.name="",this.index=0,this.index=t,null!=e.attributes.getNamedItem("datatype")&&(this.type=VoColumn.getType(e.attributes.getNamedItem("datatype").nodeValue)),null!=e.attributes.getNamedItem("ucd")&&(this.ucd=e.attributes.getNamedItem("ucd").nodeValue),null!=e.attributes.getNamedItem("precision"))try{this.precision=parseInt(e.attributes.getNamedItem("precision").nodeValue)}catch(e){}if(null!=e.attributes.getNamedItem("ID")&&(this.id=e.attributes.getNamedItem("ID").nodeValue),null!=e.attributes.getNamedItem("name")?this.name=e.attributes.getNamedItem("name").nodeValue:this.name=this.id,null!=e.attributes.getNamedItem("unit")&&(this.unit=e.attributes.getNamedItem("unit").nodeValue),null!=e.attributes.getNamedItem("arraysize")){var i=e.attributes.getNamedItem("arraysize").nodeValue.split("x");this.dimentions=i.length,this.sizes=new Array(i.length);for(var r=0,n=ss.ss.enumerate(i);n.moveNext();){var s=n.current;if(s.indexOf("*")>-1){var a=9999,o=ss.ss.replaceString(s,"*","");o.length>0&&(a=parseInt(o)),this.sizes[r++]=a}else this.sizes[r++]=parseInt(s)}}}registerType("VoRow",[VoRow,VoRow$,null]),VoColumn.getType=function(e){var t=13;switch(e){case"boolean":t=1;break;case"bit":t=2;break;case"unsignedByte":t=3;break;case"short":t=4;break;case"int":t=5;break;case"long":t=6;break;case"char":t=7;break;case"unicodeChar":t=8;break;case"float":t=9;break;case"double":t=10;break;case"floatComplex":t=11;break;case"doubleComplex":t=12;break;default:t=13}return t};var VoColumn$={toString:function(){return this.name}};function FileEntry(e,t){this.size=0,this.offset=0,this.filename=e,this.size=t}registerType("VoColumn",[VoColumn,VoColumn$,null]);var FileEntry$={toString:function(){return this.filename}};function FileCabinet(){this.tempDirectory="",this._currentOffset=0,this._packageID="",this.url="",this.clearFileList()}registerType("FileEntry",[FileEntry,FileEntry$,null]),FileCabinet.fromUrl=function(e,t){var i=new FileCabinet;return i.url=e,i._callMe=t,i._webFile=new WebFile(e),i._webFile.responseType="blob",i._webFile.onStateChange=ss.ss.bind("_loadCabinet",i),i._webFile.send(),i};var FileCabinet$={get_packageID:function(){return this._packageID},set_packageID:function(e){return this._packageID=e,e},addFile:function(e,t){if(null!=t&&!ss.ss.keyExists(this._fileDirectory,e)){var i=new FileEntry(e,t.size);i.offset=this._currentOffset,i.blob=t,this.fileList.push(i),this._fileDirectory[e]=i,this._currentOffset+=i.size}},clearFileList:function(){null==this.fileList&&(this.fileList=[]),null==this._fileDirectory&&(this._fileDirectory={}),this.fileList.length=0,ss.ss.clearKeys(this._fileDirectory),this._currentOffset=0},packageFiles:function(){var e=new XmlTextWriter;e.formatting=1,e._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),e._writeStartElement("FileCabinet"),e._writeAttributeString("HeaderSize","0x0BADFOOD"),e._writeStartElement("Files");for(var t=ss.ss.enumerate(this.fileList);t.moveNext();){var i=t.current;e._writeStartElement("File"),e._writeAttributeString("Name",i.filename),e._writeAttributeString("Size",i.size.toString()),e._writeAttributeString("Offset",i.offset.toString()),e._writeEndElement()}e._writeEndElement(),e._writeFullEndElement(),e._close();var r=e.body,n=new Blob([r]),s=ss.ss.format("0x{0:x8}",n.size);r=ss.ss.replaceString(r,"0x0BADFOOD",s),n=new Blob([r]);var a=[];a.push(n);for(var o=ss.ss.enumerate(this.fileList);o.moveNext();)i=o.current,a.push(i.blob);return new Blob(a,{type:"application/x-wtt"})},_loadCabinet:function(){var e=this;if(2===this._webFile.get_state())alert(this._webFile.get_message());else if(1===this._webFile.get_state()){this._mainBlob=this._webFile.getBlob();var t=new FileReader;t.onloadend=function(i){var r=e._getSize(t.result),n=new FileReader;n.onloadend=function(t){var i=ss.ss.safeCast(n.result,String),s=new DOMParser;e.extract(s.parseFromString(i,"text/xml"),r),e._callMe()},n.readAsText(e._mainBlob.slice(0,r))},t.readAsText(this._mainBlob.slice(0,255))}},_getSize:function(e){var t=e.indexOf("0x");return-1===t?0:parseInt(e.substring(t,t+10),16)},extract:function(e,t){try{var i=Util.selectSingleNode(e,"FileCabinet"),r=Util.selectSingleNode(i,"Files");this.fileList.length=0;for(var n=ss.ss.enumerate(r.childNodes);n.moveNext();){var s=n.current;if("File"===s.nodeName){var a=new FileEntry(s.attributes.getNamedItem("Name").nodeValue,parseInt(s.attributes.getNamedItem("Size").nodeValue));a.offset=t,t+=a.size,this.fileList.push(a)}}}catch(e){}},getFileBlob:function(e){var t=this.getFileEntry(e);if(null!=t){var i=null;switch(e.substr(e.lastIndexOf(".")).toLowerCase()){case".png":i="image/png";break;case".jpg":case".jpeg":i="image/jpeg";break;case".mp3":i="audio/mpeg3";break;case".txt":i="text/plain";break;case".fit":case".fits":i="application/octet-stream"}return this._mainBlob.slice(t.offset,t.offset+t.size,i)}return null},getFileEntry:function(e){for(var t=ss.ss.enumerate(this.fileList);t.moveNext();){var i=t.current;if(i.filename===e)return i}return null},get_masterFile:function(){return this.fileList.length>0?this.fileList[0].filename:null},clearTempFiles:function(){for(var e=ss.ss.enumerate(this.fileList);e.moveNext();)e.current}};registerType("FileCabinet",[FileCabinet,FileCabinet$,null]);var OverlayAnchor={sky:0,screen:1};registerType("OverlayAnchor",OverlayAnchor),registerEnum("OverlayAnchor",OverlayAnchor);var AudioType={music:0,voice:1};registerType("AudioType",AudioType),registerEnum("AudioType",AudioType);var ShapeType={circle:0,rectagle:1,star:2,donut:3,arrow:4,line:5,openRectagle:6};registerType("ShapeType",ShapeType),registerEnum("ShapeType",ShapeType);var LoopTypes={loop:0,upDown:1,down:2,upDownOnce:3,once:4,begin:5,end:6};function Overlay(){this.isDynamic=!1,this.isDesignTimeOnly=!1,this._name="",this.id=(Overlay.nextId++).toString(),this._owner=null,this._url="",this._linkID="",this._domeMatrix=Matrix3d.get_identity(),this._domeMatX=0,this._domeMatY=0,this._domeAngle=0,this.points=null,this._animate=!1,this._tweenFactor=0,this._endX=0,this._endY=0,this._endOpacity=0,this._endColor=new Color,this._endWidth=0,this._endHeight=0,this._endRotationAngle=0,this._anchor=1,this._x=0,this._y=0,this._width=0,this._height=0,this._color=Colors.get_white(),this._opacity=.5,this._rotationAngle=0,this.currentRotation=0,this.texture=null,this.texture2d=null,this._interpolationType=5}registerType("LoopTypes",LoopTypes),registerEnum("LoopTypes",LoopTypes),Overlay.defaultAnchor=1,Overlay.clipboardFormat="WorldWideTelescope.Overlay",Overlay.nextId=11231,Overlay.RC=3.1415927/180,Overlay._fromXml=function(e,t){if(null==t.attributes)return null;if(null==t.attributes.getNamedItem("Type"))return null;var i=t.attributes.getNamedItem("Type").nodeValue,r=null;switch(ss.ss.replaceString(i,"TerraViewer.","")){case"AudioOverlay":r=new AudioOverlay;break;case"BitmapOverlay":r=new BitmapOverlay;break;case"FlipBookOverlay":r=new FlipbookOverlay;break;case"ShapeOverlay":r=new ShapeOverlay;break;case"TextOverlay":r=new TextOverlay;break;default:return null}return r._owner=e,r._initOverlayFromXml(t),r};var Overlay$={get_name:function(){return this._name},set_name:function(e){return this._name=e,e},get_owner:function(){return this._owner},set_owner:function(e){return this._owner=e,e},get_zOrder:function(){for(var e=0,t=ss.ss.enumerate(this._owner.get_overlays());t.moveNext()&&t.current!==this;)e++;return e},get_url:function(){return this._url},set_url:function(e){return this._url=e,e},get_linkID:function(){return this._linkID},set_linkID:function(e){return this._linkID=e,e},play:function(){},pause:function(){},stop:function(){},seek:function(e){},makePosition:function(e,t,i,r,n){e-=960,t-=558;var s=Vector3d.create(e+i,t+r,1347);return(this._domeMatX||this._domeMatY||this._domeAngle!==n)&&(this._domeMatX=e,this._domeMatY=t,this._domeMatrix=Matrix3d.translation(Vector3d.create(-e,-t,0)),this._domeMatrix._multiply(Matrix3d._rotationZ(n/180*Math.PI)),this._domeMatrix._multiply(Matrix3d.translation(Vector3d.create(e,t,0)))),Vector3d._transformCoordinate(s,this._domeMatrix)},draw3D:function(e,t){useGl&&((null==this.texture||this.isDynamic)&&this.initializeTexture(),this.isDesignTimeOnly&&!t||(this.initializeGeometry(),this.updateRotation()))},cleanUp:function(){null!=this.texture&&(this.texture=null),this.texture2d=null},initializeTexture:function(){},prepMultimedia:function(){},cleanUpGeometry:function(){this.currentRotation=0,this.points=null},initializeGeometry:function(){null==this.points&&(this.currentRotation=0,this.points=new Array(4),this.points[0]=new PositionColoredTextured,this.points[0].position=this.makePosition(this.get_x(),this.get_y(),-this.get_width()/2,-this.get_height()/2,this.get_rotationAngle()),this.points[0].tu=0,this.points[0].tv=0,this.points[0].color=this.get_color(),this.points[1]=new PositionColoredTextured,this.points[1].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/2,-this.get_height()/2,this.get_rotationAngle()),this.points[1].tu=1,this.points[1].tv=0,this.points[1].color=this.get_color(),this.points[2]=new PositionColoredTextured,this.points[2].position=this.makePosition(this.get_x(),this.get_y(),-this.get_width()/2,this.get_height()/2,this.get_rotationAngle()),this.points[2].tu=0,this.points[2].tv=1,this.points[2].color=this.get_color(),this.points[3]=new PositionColoredTextured,this.points[3].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/2,this.get_height()/2,this.get_rotationAngle()),this.points[3].tu=1,this.points[3].tv=1,this.points[3].color=this.get_color())},updateRotation:function(){},get_animate:function(){return this._animate},set_animate:function(e){return this._animate!==e&&(this._animate=e,this._animate?(this._endX=this._x,this._endY=this._y,this._endRotationAngle=this._rotationAngle,this._endColor=this._color,this._endWidth=this._width,this._endHeight=this._height,this.cleanUpGeometry()):(this._endX=this._x=this.get_x(),this._endY=this._y=this.get_y(),this._endRotationAngle=this._rotationAngle=this.get_rotationAngle(),this._endColor=this._color=this.get_color(),this._endWidth=this._width=this.get_width(),this._endHeight=this._height=this.get_height(),this.cleanUpGeometry(),this._tweenFactor=0)),e},get_tweenFactor:function(){return this._tweenFactor},set_tweenFactor:function(e){return this._animate?this._tweenFactor!==e&&(this._tweenFactor=e,this.cleanUpGeometry()):this._tweenFactor=0,e},get_anchor:function(){return this._anchor},set_anchor:function(e){return this._anchor=e,e},get_position:function(){return Vector2d.create(this.get_x(),this.get_y())},set_position:function(e){return this.set_x(e.x),this.set_y(e.y),e},get_x:function(){return this._x*(1-this._tweenFactor)+this._endX*this._tweenFactor},set_x:function(e){return this._tweenFactor<.5?this._x!==e&&(this._x=e,this.cleanUpGeometry()):this._endX!==e&&(this._endX=e,this.cleanUpGeometry()),e},get_y:function(){return this._y*(1-this._tweenFactor)+this._endY*this._tweenFactor},set_y:function(e){return this._tweenFactor<.5?this._y!==e&&(this._y=e,this.cleanUpGeometry()):this._endY!==e&&(this._endY=e,this.cleanUpGeometry()),e},get_width:function(){return this._width*(1-this._tweenFactor)+this._endWidth*this._tweenFactor},set_width:function(e){return e<5&&e&&(e=5),this._tweenFactor<.5?this._width!==e&&(this._width=e,this.cleanUpGeometry()):this._endWidth!==e&&(this._endWidth=e,this.cleanUpGeometry()),e},get_height:function(){return this._height*(1-this._tweenFactor)+this._endHeight*this._tweenFactor},set_height:function(e){return e<5&&e&&(e=5),this._tweenFactor<.5?this._height!==e&&(this._height=e,this.cleanUpGeometry()):this._endHeight!==e&&(this._endHeight=e,this.cleanUpGeometry()),e},get_color:function(){var e=ss.ss.truncate(this._color.r*(1-this._tweenFactor)+this._endColor.r*this._tweenFactor),t=ss.ss.truncate(this._color.g*(1-this._tweenFactor)+this._endColor.g*this._tweenFactor),i=ss.ss.truncate(this._color.b*(1-this._tweenFactor)+this._endColor.b*this._tweenFactor),r=ss.ss.truncate(this._color.a*(1-this._tweenFactor)+this._endColor.a*this._tweenFactor);return Color.fromArgb(Math.max(0,Math.min(255,r)),Math.max(0,Math.min(255,e)),Math.max(0,Math.min(255,t)),Math.max(0,Math.min(255,i)))},set_color:function(e){return this._tweenFactor<.5?this._color!==e&&(this._color=e,this.cleanUpGeometry()):this._endColor!==e&&(this._endColor=e,this.cleanUpGeometry()),e},get_opacity:function(){return this.get_color().a/255},set_opacity:function(e){var t=this.get_color();return this.set_color(Color.fromArgb(Math.min(255,ss.ss.truncate(255*e)),t.r,t.g,t.b)),this._opacity=e,e},get_rotationAngle:function(){return this._rotationAngle*(1-this._tweenFactor)+this._endRotationAngle*this._tweenFactor},set_rotationAngle:function(e){return this._tweenFactor<.5?this._rotationAngle!==e&&(this._rotationAngle=e,this.cleanUpGeometry()):this._endRotationAngle!==e&&(this._endRotationAngle=e,this.cleanUpGeometry()),e},hitTest:function(e){var t=new Array(1);return t[0]=Vector2d.create(e.x,e.y),Matrix2d.rotateAt(-this.get_rotationAngle()/180*Math.PI,Vector2d.create(this.get_x(),this.get_y()))._transformPoints(t),Rectangle.create(this.get_x()-this.get_width()/2,this.get_y()-this.get_height()/2,this.get_width(),this.get_height()).contains(t[0])},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_interpolationType:function(){return this._interpolationType},set_interpolationType:function(e){return this._interpolationType=e,e},saveToXml:function(e,t){e._writeStartElement("Overlay"),e._writeAttributeString("Id",this.id),e._writeAttributeString("Type",this.getTypeName()),e._writeAttributeString("Name",this.get_name()),e._writeAttributeString("X",this._x.toString()),e._writeAttributeString("Y",this._y.toString()),e._writeAttributeString("Width",this._width.toString()),e._writeAttributeString("Height",this._height.toString()),e._writeAttributeString("Rotation",this._rotationAngle.toString()),e._writeAttributeString("Color",this._color.save()),e._writeAttributeString("Url",this._url),e._writeAttributeString("LinkID",this._linkID),e._writeAttributeString("Animate",this._animate.toString()),this._animate&&(e._writeAttributeString("EndX",this._endX.toString()),e._writeAttributeString("EndY",this._endY.toString()),e._writeAttributeString("EndWidth",this._endWidth.toString()),e._writeAttributeString("EndHeight",this._endHeight.toString()),e._writeAttributeString("EndRotation",this._endRotationAngle.toString()),e._writeAttributeString("EndColor",this._endColor.save()),e._writeAttributeString("InterpolationType",Enums.toXml("InterpolationType",this._interpolationType))),e._writeAttributeString("Anchor",Enums.toXml("OverlayAnchor",this._anchor)),this.writeOverlayProperties(e),e._writeEndElement()},getTypeName:function(){return"TerraViewer.Overlay"},addFilesToCabinet:function(e){},writeOverlayProperties:function(e){},_initOverlayFromXml:function(e){this.id=e.attributes.getNamedItem("Id").nodeValue,this.set_name(e.attributes.getNamedItem("Name").nodeValue),this._x=parseFloat(e.attributes.getNamedItem("X").nodeValue),this._y=parseFloat(e.attributes.getNamedItem("Y").nodeValue),this._width=parseFloat(e.attributes.getNamedItem("Width").nodeValue),this._height=parseFloat(e.attributes.getNamedItem("Height").nodeValue),this._rotationAngle=parseFloat(e.attributes.getNamedItem("Rotation").nodeValue),this._color=Color.load(e.attributes.getNamedItem("Color").nodeValue),null!=e.attributes.getNamedItem("Url")&&this.set_url(e.attributes.getNamedItem("Url").nodeValue),null!=e.attributes.getNamedItem("LinkID")&&this.set_linkID(e.attributes.getNamedItem("LinkID").nodeValue),null!=e.attributes.getNamedItem("Animate")&&(this._animate=ss.ss.boolean(e.attributes.getNamedItem("Animate").nodeValue),this._animate&&(this._endX=parseFloat(e.attributes.getNamedItem("EndX").nodeValue),this._endY=parseFloat(e.attributes.getNamedItem("EndY").nodeValue),this._endColor=Color.load(e.attributes.getNamedItem("EndColor").nodeValue),this._endWidth=parseFloat(e.attributes.getNamedItem("EndWidth").nodeValue),this._endHeight=parseFloat(e.attributes.getNamedItem("EndHeight").nodeValue),this._endRotationAngle=parseFloat(e.attributes.getNamedItem("EndRotation").nodeValue),null!=e.attributes.getNamedItem("InterpolationType")&&this.set_interpolationType(Enums.parse("InterpolationType",e.attributes.getNamedItem("InterpolationType").nodeValue)))),this.initializeFromXml(e)},initializeFromXml:function(e){},toString:function(){return this.get_name()}};function BitmapOverlay(){this._textureReady$1=!1,this._sprite$1=new Sprite2d,Overlay.call(this)}registerType("Overlay",[Overlay,Overlay$,null]),BitmapOverlay.create=function(e,t){var i=new BitmapOverlay;return i.set_owner(e),i._filename$1=t.name,i.set_name(e.getNextDefaultName("Image")),i.set_x(0),i.set_y(0),e.get_owner().addCachedFile(t.name,t),i};var BitmapOverlay$={getTypeName:function(){return"TerraViewer.BitmapOverlay"},copy:function(e){var t=new BitmapOverlay;return t.set_owner(e),t._filename$1=this._filename$1,t.set_x(this.get_x()),t.set_y(this.get_y()),t.set_width(this.get_width()),t.set_height(this.get_height()),t.set_color(this.get_color()),t.set_opacity(this.get_opacity()),t.set_rotationAngle(this.get_rotationAngle()),t.set_name(this.get_name()+" - Copy"),t},cleanUp:function(){this.texture=null,null!=this.texture2d&&(this.texture2d.cleanUp(),this.texture2d=null)},initializeTexture:function(){var e=this;try{useGl?(this.texture2d=this.get_owner().get_owner().getCachedTexture2d(this._filename$1),this._textureReady$1=!0):this.texture=this.get_owner().get_owner().getCachedTexture(this._filename$1,(function(){e._textureReady$1=!0}))}catch(e){}},draw3D:function(e,t){if(useGl)null==this.texture2d&&this.initializeTexture(),this.get_width()||this.get_height()||(this.set_width(this.texture2d.imageElement.width),this.set_height(this.texture2d.imageElement.height)),this.initializeGeometry(),this.updateRotation(),this._sprite$1.draw(e,this.points,this.points.length,this.texture2d,!0,1);else{if(null==this.texture&&this.initializeTexture(),!this._textureReady$1)return;this.get_width()||this.get_height()||(this.set_width(this.texture.width),this.set_height(this.texture.height));var i=e.device;i.save(),i.translate(this.get_x(),this.get_y()),i.rotate(this.get_rotationAngle()*Overlay.RC),i.globalAlpha=this.get_opacity(),i.drawImage(this.texture,-this.get_width()/2,-this.get_height()/2,this.get_width(),this.get_height()),i.restore()}},addFilesToCabinet:function(e){e.addFile(this.get_owner().get_owner().get_workingDirectory()+this._filename$1,this.get_owner().get_owner().getFileBlob(this._filename$1))},writeOverlayProperties:function(e){e._writeStartElement("Bitmap"),e._writeAttributeString("Filename",this._filename$1),e._writeEndElement()},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"Bitmap");this._filename$1=t.attributes.getNamedItem("Filename").nodeValue}};function TextOverlay(){this._sprite$1=new Sprite2d,this._ctx$1=null,this._ce$1=null,Overlay.call(this)}registerType("BitmapOverlay",[BitmapOverlay,BitmapOverlay$,Overlay]),TextOverlay.create=function(e){var t=new TextOverlay;return t.textObject=e,t._calculateTextSize$1(),t};var TextOverlay$={getTypeName:function(){return"TerraViewer.TextOverlay"},get_color:function(){return Overlay.prototype.get_color.call(this)},set_color:function(e){return this.textObject.foregroundColor!==e&&(this.textObject.foregroundColor=e,Overlay.prototype.set_color.call(this,e),this.cleanUp()),e},draw3D:function(e,t){if(useGl)this.initializeTexture(),this.initializeGeometry(),this.updateRotation(),this._sprite$1.draw(e,this.points,this.points.length,this.texture2d,!0,1);else{var i=e.device;i.save(),i.translate(this.get_x(),this.get_y()),i.rotate(this.get_rotationAngle()*Overlay.RC),i.globalAlpha=this.get_opacity(),this._drawCanvasText$1(i),i.restore()}},_drawCanvasText$1:function(e){e.fillStyle=this.textObject.foregroundColor.toString(),e.font=(this.textObject.italic?"italic":"normal")+" "+(this.textObject.bold?"bold":"normal")+" "+Math.round(1.2*this.textObject.fontSize).toString()+"px "+this.textObject.fontName,e.textBaseline="top";var t=this.textObject.text;if(t.indexOf("{$")>-1){if(t.indexOf("{$DATE}")>-1){var i=ss.ss.format("{0:yyyy/MM/dd}",SpaceTimeController.get_now());t=ss.ss.replaceString(t,"{$DATE}",i)}if(t.indexOf("{$TIME}")>-1){var r=ss.ss.format("{0:HH:mm:ss}",SpaceTimeController.get_now());t=ss.ss.replaceString(t,"{$TIME}",r)}t=ss.ss.replaceString(t,"{$DIST}",UiTools.formatDistance(globalRenderContext.get_solarSystemCameraDistance())),t=ss.ss.replaceString(t,"{$LAT}",Coordinates.formatDMS(globalRenderContext.viewCamera.lat)),t=ss.ss.replaceString(t,"{$LNG}",Coordinates.formatDMS(globalRenderContext.viewCamera.lat)),t=ss.ss.replaceString(t,"{$RA}",Coordinates.formatDMS(globalRenderContext.viewCamera.get_RA())),t=ss.ss.replaceString(t,"{$DEC}",Coordinates.formatDMS(globalRenderContext.viewCamera.get_dec())),t=ss.ss.replaceString(t,"{$FOV}",Coordinates.formatDMS(globalRenderContext.get_fovAngle()))}for(var n=t.split("\n"),s=-this.get_height()/2,a=1.7*this.textObject.fontSize,o=ss.ss.enumerate(n);o.moveNext();)for(var l=o.current,h=Util.getWrappedText(e,l,this.get_width()),c=ss.ss.enumerate(h);c.moveNext();){var u=c.current;e.fillText(u,-this.get_width()/2,s),s+=a}},_calculateTextSize$1:function(){null!=this._ctx$1&&null!=this._ce$1||(this._ce$1=document.createElement("canvas"),this._ce$1.height=100,this._ce$1.width=100,this._ctx$1=this._ce$1.getContext("2d")),this._ctx$1.fillStyle=this.textObject.foregroundColor.toString(),this._ctx$1.font=(this.textObject.italic?"italic":"normal")+" "+(this.textObject.bold?"bold":"normal")+" "+Math.round(1.2*this.textObject.fontSize).toString()+"px "+this.textObject.fontName,this._ctx$1.textBaseline="top";var e=this.textObject.text;if(e.indexOf("{$")>-1){if(e.indexOf("{$DATE}")>-1){var t=ss.ss.format("{0:yyyy/MM/dd}",SpaceTimeController.get_now());e=ss.ss.replaceString(e,"{$DATE}",t)}if(e.indexOf("{$TIME}")>-1){var i=ss.ss.format("{0:HH:mm:ss}",SpaceTimeController.get_now());e=ss.ss.replaceString(e,"{$TIME}",i)}e=ss.ss.replaceString(e,"{$DIST}",UiTools.formatDistance(globalRenderContext.get_solarSystemCameraDistance())),e=ss.ss.replaceString(e,"{$LAT}",Coordinates.formatDMS(globalRenderContext.viewCamera.lat)),e=ss.ss.replaceString(e,"{$LNG}",Coordinates.formatDMS(globalRenderContext.viewCamera.lat)),e=ss.ss.replaceString(e,"{$RA}",Coordinates.formatDMS(globalRenderContext.viewCamera.get_RA())),e=ss.ss.replaceString(e,"{$DEC}",Coordinates.formatDMS(globalRenderContext.viewCamera.get_dec())),e=ss.ss.replaceString(e,"{$FOV}",Coordinates.formatDMS(globalRenderContext.get_fovAngle()))}for(var r=e.split("\n"),n=0,s=1.7*this.textObject.fontSize,a=0,o=ss.ss.enumerate(r);o.moveNext();){var l=o.current,h=this._ctx$1.measureText(l).width;a=Math.max(h,a),n+=s}this.set_width(1.01*a),this.set_height(n),this._ce$1=null,this._ctx$1=null},initializeTexture:function(){(null==this.texture2d||this.textObject.text.indexOf("{$")>-1)&&(this.get_height()&&this.get_width()||this._calculateTextSize$1(),null!=this._ctx$1&&null!=this._ce$1||(this._ce$1=document.createElement("canvas"),this._ce$1.height=ss.ss.truncate(this.get_height()),this._ce$1.width=ss.ss.truncate(this.get_width()),this._ctx$1=this._ce$1.getContext("2d")),this._ctx$1.translate(this.get_width()/2,this.get_height()/2),this._ctx$1.clearRect(0,0,this.get_width(),this.get_height()),this._drawCanvasText$1(this._ctx$1),this.texture2d=new Texture,this.texture2d.imageElement=this._ce$1,this.texture2d.makeTexture(),this._ce$1=null,this._ctx$1=null)},writeOverlayProperties:function(e){e._writeStartElement("Text"),this.textObject._saveToXml(e),e._writeEndElement()},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"Text");this.textObject=TextObject._fromXml(Util.selectSingleNode(t,"TextObject"))},initializeGeometry:function(){useGl&&Overlay.prototype.initializeGeometry.call(this)}};function ShapeOverlay(){this._shapeType$1=1,this._sprite$1=new Sprite2d,this._triangleStrip$1=!0,Overlay.call(this)}registerType("TextOverlay",[TextOverlay,TextOverlay$,Overlay]),ShapeOverlay._create=function(e,t){var i=new ShapeOverlay;return i._shapeType$1=t,i.set_owner(e),i};var ShapeOverlay$={getTypeName:function(){return"TerraViewer.ShapeOverlay"},get_shapeType:function(){return this._shapeType$1},set_shapeType:function(e){return this._shapeType$1=e,this.cleanUpGeometry(),e},draw3D:function(e,t){if(useGl)this.initializeGeometry(),this._sprite$1.draw(e,this.points,this.points.length,null,this._triangleStrip$1,this.get_opacity());else switch(this._shapeType$1){case 0:this._drawCircleGeometry$1(e);break;case 1:this._drawRectGeometry$1(e);break;case 6:this._drawOpenRectGeometry$1(e);break;case 2:this._drawStarGeometry$1(e);break;case 3:this._drawDonutGeometry$1(e);break;case 4:this._drawArrowGeometry$1(e);break;case 5:this._drawLineGeometry$1(e)}},initializeGeometry:function(){if(null==this.points)switch(this._shapeType$1){case 0:this._createCircleGeometry$1();break;case 1:Overlay.prototype.initializeGeometry.call(this);break;case 6:this._createOpenRectGeometry$1();break;case 2:this._createStarGeometry$1();break;case 3:this._createDonutGeometry$1();break;case 4:this._createArrowGeometry$1();break;case 5:this._createLineGeometry$1()}},_createLineGeometry$1:function(){this.get_x(),this.get_y(),this.get_width();var e=this.get_width(),t=ss.ss.truncate(e/12)+1;Math.PI,null==this.points&&(this.points=new Array(2*t+2));for(var i=0;i<=t;i++){var r=2*i;this.points[r]=new PositionColoredTextured,this.points[r].position=this.makePosition(this.get_x(),this.get_y(),i/t*this.get_width()-this.get_width()/2,6,this.get_rotationAngle()),this.points[r].tu=i%2,this.points[r].tv=0,this.points[r].color=this.get_color(),this.points[r+1]=new PositionColoredTextured,this.points[r+1].position=this.makePosition(this.get_x(),this.get_y(),i/t*this.get_width()-this.get_width()/2,-6,this.get_rotationAngle()),this.points[r+1].tu=i%2,this.points[r+1].tv=1,this.points[r+1].color=this.get_color()}},_createOpenRectGeometry$1:function(){var e=this.get_x(),t=this.get_y(),i=(this.get_width(),this.get_width()),r=ss.ss.truncate(i/12)+1,n=ss.ss.truncate(this.get_height()/12)+1,s=2*(2*(r+1)+2*(n+1));null==this.points&&(this.points=new Array(s));for(var a=0;a<=r;a++){var o=2*a;this.points[o]=new PositionColoredTextured,this.points[o].position=this.makePosition(e,t,a/r*this.get_width()-this.get_width()/2,this.get_height()/2,this.get_rotationAngle()),this.points[o].tu=a%2,this.points[o].tv=0,this.points[o].color=this.get_color(),this.points[o+1]=new PositionColoredTextured,this.points[o+1].position=this.makePosition(e,t,a/r*this.get_width()-this.get_width()/2,this.get_height()/2-12,this.get_rotationAngle()),this.points[o+1].tu=a%2,this.points[o+1].tv=1,this.points[o+1].color=this.get_color();var l=4*(r+1)+2*(n+1)-2-o;this.points[l]=new PositionColoredTextured,this.points[l].position=this.makePosition(e,t,a/r*this.get_width()-this.get_width()/2,-this.get_height()/2+12,this.get_rotationAngle()),this.points[l].tu=a%2,this.points[l].tv=0,this.points[l].color=this.get_color(),this.points[l+1]=new PositionColoredTextured,this.points[l+1].position=this.makePosition(e,t,a/r*this.get_width()-this.get_width()/2,-this.get_height()/2,this.get_rotationAngle()),this.points[l+1].tu=a%2,this.points[l+1].tv=1,this.points[l+1].color=this.get_color()}var h=2*(r+1);for(a=0;a<=n;a++){var c=2*(n+1)+h-2;o=2*a,this.points[c-o]=new PositionColoredTextured,this.points[c-o].position=this.makePosition(e,t,this.get_width()/2,a/n*this.get_height()-this.get_height()/2,this.get_rotationAngle()),this.points[c-o].tu=a%2,this.points[c-o].tv=0,this.points[c-o].color=this.get_color(),this.points[c-o+1]=new PositionColoredTextured,this.points[c-o+1].position=this.makePosition(e,t,this.get_width()/2-12,a/n*this.get_height()-this.get_height()/2,this.get_rotationAngle()),this.points[c-o+1].tu=a%2,this.points[c-o+1].tv=1,this.points[c-o+1].color=this.get_color(),l=o+4*(r+1)+2*(n+1),this.points[l]=new PositionColoredTextured,this.points[l].position=this.makePosition(e,t,-this.get_width()/2+12,a/n*this.get_height()-this.get_height()/2,this.get_rotationAngle()),this.points[l].tu=a%2,this.points[l].tv=0,this.points[l].color=this.get_color(),this.points[l+1]=new PositionColoredTextured,this.points[l+1].position=this.makePosition(e,t,-this.get_width()/2,a/n*this.get_height()-this.get_height()/2,this.get_rotationAngle()),this.points[l+1].tu=a%2,this.points[l+1].tv=1,this.points[l+1].color=this.get_color()}},_createStarGeometry$1:function(){var e=this.get_x(),t=this.get_y(),i=(this.get_width(),2*Math.PI/5);null==this.points&&(this.points=new Array(12)),null==this._pnts$1&&(this._pnts$1=new Array(10));for(var r=0;r<5;r++){var n=r*i-Math.PI/2;this._pnts$1[r]=new PositionColoredTextured,this._pnts$1[r].position=this.makePosition(e,t,Math.cos(n)*(this.get_width()/2),Math.sin(n)*(this.get_height()/2),this.get_rotationAngle()),this._pnts$1[r].tu=0,this._pnts$1[r].tv=0,this._pnts$1[r].color=this.get_color()}for(r=5;r<10;r++)n=r*i+i/2-Math.PI/2,this._pnts$1[r]=new PositionColoredTextured,this._pnts$1[r].position=this.makePosition(e,t,Math.cos(n)*(this.get_width()/5.3),Math.sin(n)*(this.get_height()/5.3),this.get_rotationAngle()),this._pnts$1[r].tu=0,this._pnts$1[r].tv=0,this._pnts$1[r].color=this.get_color();this.points[0]=this._pnts$1[0],this.points[1]=this._pnts$1[5],this.points[2]=this._pnts$1[9],this.points[3]=this._pnts$1[1],this.points[4]=this._pnts$1[7],this.points[5]=this._pnts$1[4],this.points[6]=this._pnts$1[6],this.points[7]=this._pnts$1[2],this.points[8]=this._pnts$1[7],this.points[9]=this._pnts$1[7],this.points[10]=this._pnts$1[3],this.points[11]=this._pnts$1[8],this._triangleStrip$1=!1},_createArrowGeometry$1:function(){null==this.points&&(this.points=new Array(9)),this.points[0]=new PositionColoredTextured,this.points[0].position=this.makePosition(this.get_x(),this.get_y(),-this.get_width()/2,-this.get_height()/4,this.get_rotationAngle()),this.points[0].tu=0,this.points[0].tv=0,this.points[0].color=this.get_color(),this.points[1]=new PositionColoredTextured,this.points[1].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/4,-this.get_height()/4,this.get_rotationAngle()),this.points[1].tu=1,this.points[1].tv=0,this.points[1].color=this.get_color(),this.points[2]=new PositionColoredTextured,this.points[2].position=this.makePosition(this.get_x(),this.get_y(),-this.get_width()/2,this.get_height()/4,this.get_rotationAngle()),this.points[2].tu=0,this.points[2].tv=1,this.points[2].color=this.get_color(),this.points[3]=new PositionColoredTextured,this.points[3].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/4,-this.get_height()/4,this.get_rotationAngle()),this.points[3].tu=1,this.points[3].tv=0,this.points[3].color=this.get_color(),this.points[4]=new PositionColoredTextured,this.points[4].position=this.makePosition(this.get_x(),this.get_y(),-this.get_width()/2,this.get_height()/4,this.get_rotationAngle()),this.points[4].tu=0,this.points[4].tv=1,this.points[4].color=this.get_color(),this.points[5]=new PositionColoredTextured,this.points[5].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/4,this.get_height()/4,this.get_rotationAngle()),this.points[5].tu=1,this.points[5].tv=1,this.points[5].color=this.get_color(),this.points[6]=new PositionColoredTextured,this.points[6].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/4,-this.get_height()/2,this.get_rotationAngle()),this.points[6].tu=1,this.points[6].tv=1,this.points[6].color=this.get_color(),this.points[7]=new PositionColoredTextured,this.points[7].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/2,0,this.get_rotationAngle()),this.points[7].tu=1,this.points[7].tv=.5,this.points[7].color=this.get_color(),this.points[8]=new PositionColoredTextured,this.points[8].position=this.makePosition(this.get_x(),this.get_y(),this.get_width()/4,this.get_height()/2,this.get_rotationAngle()),this.points[8].tu=1,this.points[8].tv=1,this.points[8].color=this.get_color(),this._triangleStrip$1=!1},_createDonutGeometry$1:function(){var e=this.get_x(),t=this.get_y(),i=this.get_width()/2,r=2*Math.PI*i,n=ss.ss.truncate(r/12)+1,s=2*Math.PI/n;null==this.points&&(this.points=new Array(2*n+2));for(var a=0;a<=n;a++){var o=2*a;this.points[o]=new PositionColoredTextured,this.points[o].position=this.makePosition(e,t,Math.cos(a*s)*(this.get_width()/2),Math.sin(a*s)*(this.get_height()/2),this.get_rotationAngle()),this.points[o].tu=a%2,this.points[o].tv=0,this.points[o].color=this.get_color(),this.points[o+1]=new PositionColoredTextured,this.points[o+1].position=this.makePosition(e,t,Math.cos(a*s)*(this.get_width()/2-10),Math.sin(a*s)*(this.get_height()/2-10),this.get_rotationAngle()),this.points[o+1].tu=a%2,this.points[o+1].tv=1,this.points[o+1].color=this.get_color()}},_createCircleGeometry$1:function(){var e=this.get_x(),t=this.get_y(),i=this.get_width()/2,r=2*Math.PI*i,n=ss.ss.truncate(r/12)+1,s=2*Math.PI/n;null==this.points&&(this.points=new Array(2*n+2));for(var a=0;a<=n;a++){var o=2*a;this.points[o]=new PositionColoredTextured,this.points[o].position=this.makePosition(e,t,Math.cos(a*s)*(this.get_width()/2),Math.sin(a*s)*(this.get_height()/2),this.get_rotationAngle()),this.points[o].tu=a%2,this.points[o].tv=0,this.points[o].color=this.get_color(),this.points[o+1]=new PositionColoredTextured,this.points[o+1].position=this.makePosition(e,t,0,0,this.get_rotationAngle()),this.points[o+1].tu=a%2,this.points[o+1].tv=1,this.points[o+1].color=this.get_color()}},initializeTexture:function(){switch(this.get_shapeType()){case 5:case 3:case 6:break;default:this.texture=null}},_drawLineGeometry$1:function(e){var t=e.device;t.save();var i=this.get_width()/2;t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.moveTo(-i,0),t.lineTo(i,0),t.lineWidth=9,t.strokeStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.stroke(),t.restore()},_drawOpenRectGeometry$1:function(e){var t=e.device;t.save(),t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),t.moveTo(-this.get_width()/2,-this.get_height()/2),t.lineTo(this.get_width()/2,-this.get_height()/2),t.lineTo(this.get_width()/2,this.get_height()/2),t.lineTo(-this.get_width()/2,this.get_height()/2),t.closePath(),t.lineWidth=9,t.strokeStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.stroke(),t.restore()},_drawRectGeometry$1:function(e){var t=e.device;t.save(),t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),t.moveTo(-this.get_width()/2,-this.get_height()/2),t.lineTo(this.get_width()/2,-this.get_height()/2),t.lineTo(this.get_width()/2,this.get_height()/2),t.lineTo(-this.get_width()/2,this.get_height()/2),t.closePath(),t.lineWidth=0,t.fillStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.fill(),t.restore()},_drawStarGeometry$1:function(e){var t=e.device;t.save(),t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),this.get_width();for(var i=2*Math.PI/5,r=!0,n=0;n<5;n++){var s=n*i-Math.PI/2;r?(r=!1,t.moveTo(0+Math.cos(s)*(this.get_width()/2),0+Math.sin(s)*(this.get_height()/2))):t.lineTo(0+Math.cos(s)*(this.get_width()/2),0+Math.sin(s)*(this.get_height()/2));var a=n*i+i/2-Math.PI/2;t.lineTo(0+Math.cos(a)*(this.get_width()/5.3),0+Math.sin(a)*(this.get_height()/5.3))}t.closePath(),t.lineWidth=0,t.fillStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.fill(),t.restore()},_drawArrowGeometry$1:function(e){var t=e.device;t.save(),t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),t.moveTo(-this.get_width()/2,-this.get_height()/4),t.lineTo(this.get_width()/4,-this.get_height()/4),t.lineTo(this.get_width()/4,-this.get_height()/2),t.lineTo(this.get_width()/2,0),t.lineTo(this.get_width()/4,this.get_height()/2),t.lineTo(this.get_width()/4,this.get_height()/4),t.lineTo(-this.get_width()/2,this.get_height()/4),t.closePath(),t.lineWidth=0,t.fillStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.fill(),t.restore()},_drawDonutGeometry$1:function(e){var t=e.device;t.save(),t.translate(this.get_x(),this.get_y()),t.scale(1,this.get_height()/this.get_width()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),t.arc(0,0,this.get_width()/2,0,2*Math.PI,!1),t.closePath(),t.lineWidth=9,t.strokeStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.stroke(),t.restore()},_drawCircleGeometry$1:function(e){var t=e.device;t.save(),t.scale(1,this.get_width()/this.get_height()),t.translate(this.get_x(),this.get_y()),t.rotate(this.get_rotationAngle()*Overlay.RC),t.beginPath(),t.arc(0,0,this.get_width(),0,2*Math.PI,!1),t.closePath(),t.lineWidth=0,t.fillStyle=this.get_color().toString(),t.globalAlpha=this.get_opacity(),t.fill(),t.restore()},cleanUpGeometry:function(){Overlay.prototype.cleanUpGeometry.call(this),this.cleanUp()},writeOverlayProperties:function(e){e._writeStartElement("Shape"),e._writeAttributeString("ShapeType",Enums.toXml("ShapeType",this._shapeType$1)),e._writeEndElement()},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"Shape");this._shapeType$1=Enums.parse("ShapeType",t.attributes.getNamedItem("ShapeType").nodeValue)}};function AudioOverlay(){this._audio$1=null,this._audioReady$1=!1,this._wantPlaying$1=!1,this._volume$1=100,this._mute$1=!1,this._position$1=0,this._trackType$1=0,Overlay.call(this),this.isDesignTimeOnly=!0}registerType("ShapeOverlay",[ShapeOverlay,ShapeOverlay$,Overlay]),AudioOverlay.create=function(e,t){var i=new AudioOverlay;return i.set_owner(e),i._filename$1=t.name,i.get_owner().get_owner().addCachedFile(t.name,t),i};var AudioOverlay$={getTypeName:function(){return"TerraViewer.AudioOverlay"},get_mute:function(){return this._mute$1},set_mute:function(e){return this._mute$1=e,this.set_volume(this.get_volume()),e},get_volume:function(){return this._volume$1},set_volume:function(e){return this._volume$1=e,null!=this._audio$1&&(this._audio$1.volume=this._mute$1?0:this._volume$1/100),e},addFilesToCabinet:function(e){e.addFile(this.get_owner().get_owner().get_workingDirectory()+this._filename$1,this.get_owner().get_owner().getFileBlob(this._filename$1))},play:function(){null==this._audio$1&&this.prepMultimedia(),this._wantPlaying$1=!0,null!=this._audio$1&&this._audioReady$1&&(this._audio$1.play(),this.set_volume(this.get_volume()),this._audio$1.currentTime=this._position$1)},pause:function(){null==this._audio$1&&this.prepMultimedia(),this._wantPlaying$1=!1,null!=this._audio$1&&this._audioReady$1&&this._audio$1.pause()},stop:function(){this.pause()},seek:function(e){this._position$1=e,null==this._audio$1&&this.prepMultimedia(),this._audioReady$1&&(this._audio$1.duration<e?this._audio$1.pause():this._audio$1.currentTime=this._position$1)},prepMultimedia:function(){var e=this;if(null==this._audio$1){this._audio$1=document.createElement("audio"),this._audio$1.addEventListener("canplaythrough",(function(){e._audioReady$1||(e._audioReady$1=!0,e._wantPlaying$1&&e.play())}),!1);var t=document.createElement("source");this._audio$1.appendChild(t),t.src=this.get_owner().get_owner().getFileStream(this._filename$1),t.type="audio/mp3",this._audio$1.load()}},initializeTexture:function(){this.prepMultimedia()},cleanUp:function(){Overlay.prototype.cleanUp.call(this),this._wantPlaying$1=!1,null!=this._audio$1&&(this._audio$1.pause(),this._audio$1.src=null,this._audio$1=null)},get_trackType:function(){return this._trackType$1},set_trackType:function(e){return this._trackType$1=e,e},writeOverlayProperties:function(e){e._writeStartElement("Audio"),e._writeAttributeString("Filename",this._filename$1),e._writeAttributeString("Volume",this._volume$1.toString()),e._writeAttributeString("Mute",this._mute$1.toString()),e._writeAttributeString("TrackType",Enums.toXml("AudioType",this._trackType$1)),e._writeEndElement()},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"Audio");this._filename$1=t.attributes.getNamedItem("Filename").nodeValue,null!=t.attributes.getNamedItem("Volume")&&(this._volume$1=parseInt(t.attributes.getNamedItem("Volume").nodeValue)),null!=t.attributes.getNamedItem("Mute")&&(this._mute$1=ss.ss.boolean(t.attributes.getNamedItem("Mute").nodeValue)),null!=t.attributes.getNamedItem("TrackType")&&(this._trackType$1=Enums.parse("AudioType",t.attributes.getNamedItem("TrackType").nodeValue))}};function FlipbookOverlay(){this._loopType$1=1,this._startFrame$1=0,this._framesList$1=[],this._frames$1=1,this._framesX$1=8,this._framesY$1=8,this._textureReady$1=!1,this._currentFrame$1=0,this._cellHeight$1=256,this._cellWidth$1=256,this._timeStart$1=ss.ss.now(),this._playing$1=!0,Overlay.call(this)}registerType("AudioOverlay",[AudioOverlay,AudioOverlay$,Overlay]);var FlipbookOverlay$={getTypeName:function(){return"TerraViewer.FlipbookOverlay"},get_loopType:function(){return this._loopType$1},set_loopType:function(e){return this._loopType$1=e,e},get_startFrame:function(){return this._startFrame$1},set_startFrame:function(e){return this._startFrame$1=e,e},get_frameSequence:function(){return this._frameSequence$1},set_frameSequence:function(e){if(this._frameSequence$1!==e&&(this._frameSequence$1=e,this._framesList$1=[],!ss.ss.emptyString(this._frameSequence$1)))try{for(var t=this._frameSequence$1.split(","),i=ss.ss.enumerate(t);i.moveNext();){var r=i.current,n=parseInt(ss.ss.trim(r));this._framesList$1.push(n)}}catch(e){}return e},get_frames:function(){return this._frames$1},set_frames:function(e){return this._frames$1=e,e},get_framesX:function(){return this._framesX$1},set_framesX:function(e){return this._framesX$1=e,e},get_framesY:function(){return this._framesY$1},set_framesY:function(e){return this._framesY$1=e,e},copy:function(e){var t=new FlipbookOverlay;return t.set_owner(e),t._filename$1=this._filename$1,t.set_x(this.get_x()),t.set_y(this.get_y()),t.set_width(this.get_width()),t.set_height(this.get_height()),t.set_color(this.get_color()),t.set_opacity(this.get_opacity()),t.set_rotationAngle(this.get_rotationAngle()),t.set_name(this.get_name()+" - Copy"),t.set_startFrame(this.get_startFrame()),t.set_frames(this.get_frames()),t.set_loopType(this.get_loopType()),t.set_frameSequence(this.get_frameSequence()),t.set_framesX(this.get_framesX()),t.set_framesY(this.get_framesY()),t},cleanUp:function(){this.texture=null},initializeTexture:function(){var e=this;try{ss.ss.endsWith(this._filename$1.toLowerCase(),".jpg"),this.texture=this.get_owner().get_owner().getCachedTexture(this._filename$1,(function(){e._textureReady$1=!0}))}catch(e){}},addFilesToCabinet:function(e){e.addFile(this.get_owner().get_owner().get_workingDirectory()+this._filename$1,this.get_owner().get_owner().getFileBlob(this._filename$1))},writeOverlayProperties:function(e){e._writeStartElement("Flipbook"),e._writeAttributeString("Filename",this._filename$1),e._writeAttributeString("Frames",this._frames$1.toString()),e._writeAttributeString("Loop",Enums.toXml("LoopTypes",this._loopType$1)),e._writeAttributeString("FramesX",this._framesX$1.toString()),e._writeAttributeString("FramesY",this._framesY$1.toString()),e._writeAttributeString("StartFrame",this._startFrame$1.toString()),ss.ss.emptyString(this._frameSequence$1)||e._writeAttributeString("FrameSequence",this._frameSequence$1),e._writeEndElement()},initializeFromXml:function(e){var t=Util.selectSingleNode(e,"Flipbook");this._filename$1=t.attributes.getNamedItem("Filename").nodeValue,this._frames$1=parseInt(t.attributes.getNamedItem("Frames").nodeValue),this._loopType$1=Enums.parse("LoopTypes",t.attributes.getNamedItem("Loop").nodeValue),null!=t.attributes.getNamedItem("FramesX")&&this.set_framesX(parseInt(t.attributes.getNamedItem("FramesX").nodeValue)),null!=t.attributes.getNamedItem("FramesY")&&this.set_framesY(parseInt(t.attributes.getNamedItem("FramesY").nodeValue)),null!=t.attributes.getNamedItem("StartFrame")&&this.set_startFrame(parseInt(t.attributes.getNamedItem("StartFrame").nodeValue)),null!=t.attributes.getNamedItem("FrameSequence")&&this.set_frameSequence(t.attributes.getNamedItem("FrameSequence").nodeValue)},play:function(){this._playing$1=!0,this._timeStart$1=ss.ss.now()},pause:function(){this._playing$1=!1},stop:function(){this._playing$1=!1,this._currentFrame$1=0},initializeGeometry:function(){var e=this._frames$1;if(ss.ss.emptyString(this._frameSequence$1)||(e=this._framesList$1.length),this._playing$1){var t=ss.ss.now()-this._timeStart$1;switch(this._loopType$1){case 0:this._currentFrame$1=ss.ss.truncate(t/1e3*24%e)+this._startFrame$1;break;case 1:this._currentFrame$1=Math.abs(ss.ss.truncate((t/1e3*24+e)%(2*e-1))-(e-1))+this._startFrame$1,this._currentFrame$1<0||this._currentFrame$1;break;case 2:this._currentFrame$1=Math.max(0,e-ss.ss.truncate(t/1e3*24%e))+this._startFrame$1;break;case 3:var i=Math.min(t/1e3*24,2*e+1)+e;this._currentFrame$1=Math.abs(i%(2*e-1)-(e-1))+this._startFrame$1;break;case 4:this._currentFrame$1=Math.min(e-1,ss.ss.truncate(t/1e3*24));break;case 5:default:this._currentFrame$1=this._startFrame$1;break;case 6:this._currentFrame$1=e-1+this._startFrame$1}}ss.ss.emptyString(this._frameSequence$1)||(this._currentFrame$1<this._framesList$1.length&&this._currentFrame$1>-1?this._currentFrame$1=this._framesList$1[this._currentFrame$1]:this._currentFrame$1=0),this.currentRotation=0}};registerType("FlipbookOverlay",[FlipbookOverlay,FlipbookOverlay$,Overlay]);var SelectionAnchor={topLeft:0,top:1,topRight:2,right:3,bottomRight:4,bottom:5,bottomLeft:6,left:7,rotate:8,move:9,center:10,none:11};function Selection(){this._singleSelectHandles=null,this._multiSelectHandles=null,this._focusHandles=null,this.selectionSet=[],this._focus=null,this._ratio=1,this._sprite=new Sprite2d,this._centerX=0,this._centerY=0}registerType("SelectionAnchor",SelectionAnchor),registerEnum("SelectionAnchor",SelectionAnchor),Selection._points=new Array(54);var Selection$={clearSelection:function(){this.selectionSet.length=0},addSelection:function(e){null!=e&&(this.selectionSet.indexOf(e)>=0||this.selectionSet.push(e))},addSelectionRange:function(e){for(var t=ss.ss.enumerate(e);t.moveNext();){var i=t.current;this.selectionSet.push(i)}},isOverlaySelected:function(e){return this.selectionSet.indexOf(e)>=0},setSelection:function(e){this.selectionSet.length=0,null!=e&&this.selectionSet.push(e)},get_multiSelect:function(){return this.selectionSet.length>1},setSelectionRange:function(e){this.selectionSet.length=0;for(var t=ss.ss.enumerate(e);t.moveNext();){var i=t.current;this.selectionSet.push(i)}},get_focus:function(){return this._focus},set_focus:function(e){return this._focus=e,e},draw3D:function(e,t){if(this._ratio=1116/e.height,null==this._singleSelectHandles&&(this._singleSelectHandles=Texture.fromUrl("images/Selhand.bmp")),null==this._multiSelectHandles&&(this._multiSelectHandles=Texture.fromUrl("images/multiSelhand.bmp")),null==this._focusHandles&&(this._focusHandles=Texture.fromUrl("images/FocusHandles.png")),this.selectionSet.length>1)for(var i=ss.ss.enumerate(this.selectionSet);i.moveNext();)(n=i.current)===this._focus?this._drawSelectionHandles(e,n,this._focusHandles):this._drawSelectionHandles(e,n,this._multiSelectHandles);else for(var r=ss.ss.enumerate(this.selectionSet);r.moveNext();){var n=r.current;this._drawSelectionHandles(e,n,this._singleSelectHandles)}},_drawSelectionHandles:function(e,t,i){for(var r=this.makeHandles(t),n=t.get_rotationAngle(),s=0,a=0,o=ss.ss.enumerate(r);o.moveNext();){var l=o.current;Selection._points[s+0]=new PositionColoredTextured,Selection._points[s+0].position=t.makePosition(this._centerX,this._centerY,l.get_left()-this._centerX,l.get_top()-this._centerY,n),Selection._points[s+0].tu=a*(1/9),Selection._points[s+0].tv=0,Selection._points[s+0].color=Colors.get_white(),Selection._points[s+1]=new PositionColoredTextured,Selection._points[s+1].position=t.makePosition(this._centerX,this._centerY,l.get_right()-this._centerX,l.get_top()-this._centerY,n),Selection._points[s+1].tu=(a+1)*(1/9),Selection._points[s+1].tv=0,Selection._points[s+1].color=Colors.get_white(),Selection._points[s+2]=new PositionColoredTextured,Selection._points[s+2].position=t.makePosition(this._centerX,this._centerY,l.get_left()-this._centerX,l.get_bottom()-this._centerY,n),Selection._points[s+2].tu=a*(1/9),Selection._points[s+2].tv=1,Selection._points[s+2].color=Colors.get_white(),Selection._points[s+3]=new PositionColoredTextured,Selection._points[s+3].position=t.makePosition(this._centerX,this._centerY,l.get_right()-this._centerX,l.get_top()-this._centerY,n),Selection._points[s+3].tu=(a+1)*(1/9),Selection._points[s+3].tv=0,Selection._points[s+3].color=Colors.get_white(),Selection._points[s+4]=new PositionColoredTextured,Selection._points[s+4].position=t.makePosition(this._centerX,this._centerY,l.get_right()-this._centerX,l.get_bottom()-this._centerY,n),Selection._points[s+4].tu=(a+1)*(1/9),Selection._points[s+4].tv=1,Selection._points[s+4].color=Colors.get_white(),Selection._points[s+5]=new PositionColoredTextured,Selection._points[s+5].position=t.makePosition(this._centerX,this._centerY,l.get_left()-this._centerX,l.get_bottom()-this._centerY,n),Selection._points[s+5].tu=a*(1/9),Selection._points[s+5].tv=1,Selection._points[s+5].color=Colors.get_white(),s+=6,a++}this.get_multiSelect()?this._sprite.draw(e,Selection._points,Selection._points.length-6,i,!1,1):this._sprite.draw(e,Selection._points,Selection._points.length,i,!1,1)},pointToSelectionSpace:function(e){var t=new Array(1);return t[0]=Vector2d.create(e.x,e.y),Matrix2d.rotateAt(-this.selectionSet[0].get_rotationAngle()/180*Math.PI,Vector2d.create(this.selectionSet[0].get_x(),this.selectionSet[0].get_y()))._transformPoints(t),t[0]},pointToScreenSpace:function(e){var t=new Array(1);return t[0]=Vector2d.create(e.x,e.y),Matrix2d.rotateAt(this.selectionSet[0].get_rotationAngle()/180*Math.PI,Vector2d.create(this.selectionSet[0].get_x(),this.selectionSet[0].get_y()))._transformPoints(t),t[0]},hitTest:function(e){if(1===this.selectionSet.length)for(var t=ss.ss.enumerate(this.selectionSet);t.moveNext();)for(var i=t.current,r=this.makeHandles(i),n=0,s=this.pointToSelectionSpace(e),a=ss.ss.enumerate(r);a.moveNext();){if(a.current.contains(s))return n;n++}return 11},makeHandles:function(e){var t=ss.ss.truncate(e.get_x()-e.get_width()/2)+.5,i=ss.ss.truncate(e.get_y())-e.get_height()/2+.5;this._centerX=e.get_x(),this._centerY=e.get_y();var r=e.get_width(),n=e.get_height(),s=12*this._ratio,a=new Array(9);return a[0]=Rectangle.create(t-s,i-s,s,s),a[1]=Rectangle.create(t+r/2-s/2,i-s,s,s),a[2]=Rectangle.create(t+r,i-s,s,s),a[3]=Rectangle.create(t+r,i+n/2-s/2,s,s),a[4]=Rectangle.create(t+r,i+n,s,s),a[5]=Rectangle.create(t+r/2-s/2,i+n,s,s),a[6]=Rectangle.create(t-s,i+n,s,s),a[7]=Rectangle.create(t-s,i+n/2-s/2,s,s),a[8]=Rectangle.create(t+r/2-s/2,i-30*this._ratio,s,s),a}};registerType("Selection",[Selection,Selection$,null]);var TransitionType={slew:0,crossFade:1,crossCut:2,fadeOutIn:3,fadeIn:4,fadeOut:5};function TourStop(){this._tourStopType=0,this._keyFramed=!1,this._tweenPosition=0,this.faderOpacity=0,this._owner=null,this._transition=0,this._transitionTime=2,this._transitionHoldTime=4,this._transitionOutTime=2,this._nextSlide="Next",this._fadeInOverlays=!1,this._masterSlide=!1,this._id="",this._description="",this._name="",this._duration=1e4,this._interpolationType=0,this._hasLocation=!0,this._hasTime=!0,this._startTime=SpaceTimeController.get_now(),this._endTime=SpaceTimeController.get_now(),this._actualPlanetScale=Settings.get_current().get_actualPlanetScale(),this._locationAltitude=Settings.get_current().get_locationAltitude(),this._locationLat=Settings.get_current().get_locationLat(),this._locationLng=Settings.get_current().get_locationLng(),this._showClouds=Settings.get_current().get_showClouds(),this._showConstellationBoundries=Settings.get_current().get_showConstellationBoundries(),this._showConstellationFigures=Settings.get_current().get_showConstellationFigures(),this._showConstellationSelection=Settings.get_current().get_showConstellationSelection(),this._showEcliptic=Settings.get_current().get_showEcliptic(),this._showElevationModel=Settings.get_current().get_showElevationModel(),this._showFieldOfView=Settings.get_current().get_showFieldOfView(),this._showGrid=Settings.get_current().get_showGrid(),this._showHorizon=Settings.get_current().get_showHorizon(),this._showHorizonPanorama=Settings.get_current().get_showHorizonPanorama(),this._showMoonsAsPointSource=Settings.get_current().get_showMoonsAsPointSource(),this._showSolarSystem=Settings.get_current().get_showSolarSystem(),this._fovTelescope=Settings.get_current().get_fovTelescope(),this._fovEyepiece=Settings.get_current().get_fovEyepiece(),this._fovCamera=Settings.get_current().get_fovCamera(),this._localHorizonMode=Settings.get_current().get_localHorizonMode(),this._galacticMode=Settings.get_current().get_galacticMode(),this._solarSystemStars=Settings.get_current().get_solarSystemStars(),this._solarSystemMilkyWay=Settings.get_current().get_solarSystemMilkyWay(),this._solarSystemCosmos=Settings.get_current().get_solarSystemCosmos(),this._solarSystemOrbits=Settings.get_current().get_solarSystemOrbits(),this._solarSystemOverlays=Settings.get_current().get_solarSystemOverlays(),this._solarSystemLighting=Settings.get_current().get_solarSystemLighting(),this._solarSystemScale=Settings.get_current().get_solarSystemScale(),this._solarSystemMultiRes=Settings.get_current().get_solarSystemMultiRes(),this._showEquatorialGridText=Settings.get_current().get_showEquatorialGridText(),this._showGalacticGrid=Settings.get_current().get_showGalacticGrid(),this._showGalacticGridText=Settings.get_current().get_showGalacticGridText(),this._showEclipticGrid=Settings.get_current().get_showEclipticGrid(),this._showEclipticGridText=Settings.get_current().get_showEclipticGridText(),this._showEclipticOverviewText=Settings.get_current().get_showEclipticOverviewText(),this._showAltAzGrid=Settings.get_current().get_showAltAzGrid(),this._showAltAzGridText=Settings.get_current().get_showAltAzGridText(),this._showPrecessionChart=Settings.get_current().get_showPrecessionChart(),this._showConstellationPictures=Settings.get_current().get_showConstellationPictures(),this._showConstellationLabels=Settings.get_current().get_showConstellationLabels(),this._solarSystemCMB=Settings.get_current().get_solarSystemCMB(),this._solarSystemMinorPlanets=Settings.get_current().get_solarSystemMinorPlanets(),this._solarSystemPlanets=Settings.get_current().get_solarSystemPlanets(),this._showEarthSky=Settings.get_current().get_showEarthSky(),this._solarSystemMinorOrbits=Settings.get_current().get_solarSystemMinorOrbits(),this._constellationsEnabled="",this._constellationFiguresFilter=Settings.get_current().get_constellationFiguresFilter().clone(),this._constellationBoundariesFilter=Settings.get_current().get_constellationBoundariesFilter().clone(),this._constellationNamesFilter=Settings.get_current().get_constellationNamesFilter().clone(),this._constellationArtFilter=Settings.get_current().get_constellationArtFilter().clone(),this._showSkyOverlays=Settings.get_current().get_showSkyOverlays(),this._showConstellations=Settings.get_current().get_showConstellations(),this._showSkyNode=Settings.get_current().get_showSkyNode(),this._showSkyGrids=Settings.get_current().get_showSkyGrids(),this._showSkyOverlaysIn3d=Settings.get_current().get_showSkyOverlaysIn3d(),this._earthCutawayView=Settings.get_current().get_earthCutawayView(),this._showISSModel=Settings.get_current().get_showISSModel(),this._milkyWayModel=Settings.get_current().get_milkyWayModel(),this._minorPlanetsFilter=Settings.get_current().get_minorPlanetsFilter(),this._planetOrbitsFilter=Settings.get_current().get_planetOrbitsFilter(),this._thumbnailString="",this._thumbnail=null,this.layers={},this._overlays=[],this._musicTrack=null,this._voiceTrack=null,this._eclipticGridColor=Colors.get_green(),this._galacticGridColor=Colors.get_cyan(),this._altAzGridColor=Colors.get_magenta(),this._precessionChartColor=Colors.get_orange(),this._eclipticColor=Colors.get_blue(),this._equatorialGridColor=Colors.get_white(),this._constellationLabelsHeight=80,this._id=Guid.newGuid().toString()}registerType("TransitionType",TransitionType),registerEnum("TransitionType",TransitionType),TourStop.clipboardFormat="WorldWideTelescope.Slide",TourStop.create=function(e){var t=new TourStop;return t._target=e,t},TourStop.getXmlText=function(e){var t=new XmlTextWriter;return t._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),e._saveToXml(t,!0),t._close(),t.body},TourStop._fromXml=function(e,t){try{var i=new TourStop;i._owner=e,i.set_id(t.attributes.getNamedItem("Id").nodeValue),i.set_name(t.attributes.getNamedItem("Name").nodeValue),i.set_description(t.attributes.getNamedItem("Description").nodeValue),i._thumbnailString=t.attributes.getNamedItem("Thumbnail").nodeValue,i._duration=Util.parseTimeSpan(t.attributes.getNamedItem("Duration").nodeValue),null!=t.attributes.getNamedItem("Master")&&(i._masterSlide=ss.ss.boolean(t.attributes.getNamedItem("Master").nodeValue)),null!=t.attributes.getNamedItem("NextSlide")&&(i._nextSlide=t.attributes.getNamedItem("NextSlide").nodeValue),null!=t.attributes.getNamedItem("InterpolationType")&&i.set_interpolationType(Enums.parse("InterpolationType",t.attributes.getNamedItem("InterpolationType").nodeValue)),i._fadeInOverlays=!0,null!=t.attributes.getNamedItem("FadeInOverlays")&&(i._fadeInOverlays=ss.ss.boolean(t.attributes.getNamedItem("FadeInOverlays").nodeValue)),null!=t.attributes.getNamedItem("Transition")&&(i._transition=Enums.parse("TransitionType",t.attributes.getNamedItem("Transition").nodeValue)),null!=t.attributes.getNamedItem("HasLocation")&&(i._hasLocation=ss.ss.boolean(t.attributes.getNamedItem("HasLocation").nodeValue)),i._hasLocation&&(null!=t.attributes.getNamedItem("LocationAltitude")&&(i._locationAltitude=parseFloat(t.attributes.getNamedItem("LocationAltitude").nodeValue)),null!=t.attributes.getNamedItem("LocationLat")&&(i._locationLat=parseFloat(t.attributes.getNamedItem("LocationLat").nodeValue)),null!=t.attributes.getNamedItem("LocationLng")&&(i._locationLng=parseFloat(t.attributes.getNamedItem("LocationLng").nodeValue))),null!=t.attributes.getNamedItem("HasTime")&&(i._hasTime=ss.ss.boolean(t.attributes.getNamedItem("HasTime").nodeValue),i._hasTime&&(null!=t.attributes.getNamedItem("StartTime")&&(i._startTime=ss.ss.date(t.attributes.getNamedItem("StartTime").nodeValue+" UTC")),null!=t.attributes.getNamedItem("EndTime")&&(i._endTime=ss.ss.date(t.attributes.getNamedItem("EndTime").nodeValue+" UTC")))),null!=t.attributes.getNamedItem("ActualPlanetScale")&&(i._actualPlanetScale=ss.ss.boolean(t.attributes.getNamedItem("ActualPlanetScale").nodeValue)),null!=t.attributes.getNamedItem("ShowClouds")&&(i._showClouds=ss.ss.boolean(t.attributes.getNamedItem("ShowClouds").nodeValue)),null!=t.attributes.getNamedItem("ShowConstellationBoundries")&&(i._showConstellationBoundries=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellationBoundries").nodeValue)),null!=t.attributes.getNamedItem("ShowConstellationFigures")&&(i._showConstellationFigures=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellationFigures").nodeValue)),null!=t.attributes.getNamedItem("ShowConstellationSelection")&&(i._showConstellationSelection=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellationSelection").nodeValue)),null!=t.attributes.getNamedItem("ShowEcliptic")&&(i._showEcliptic=ss.ss.boolean(t.attributes.getNamedItem("ShowEcliptic").nodeValue)),null!=t.attributes.getNamedItem("EclipticColor")&&(i._eclipticColor=Color.load(t.attributes.getNamedItem("EclipticColor").nodeValue)),null!=t.attributes.getNamedItem("ShowElevationModel")&&(i._showElevationModel=ss.ss.boolean(t.attributes.getNamedItem("ShowElevationModel").nodeValue)),null!=t.attributes.getNamedItem("ShowFieldOfView")&&(i._showFieldOfView=ss.ss.boolean(t.attributes.getNamedItem("ShowFieldOfView").nodeValue)),null!=t.attributes.getNamedItem("ShowGrid")&&(i._showGrid=ss.ss.boolean(t.attributes.getNamedItem("ShowGrid").nodeValue)),null!=t.attributes.getNamedItem("ShowHorizon")&&(i._showHorizon=ss.ss.boolean(t.attributes.getNamedItem("ShowHorizon").nodeValue)),null!=t.attributes.getNamedItem("ShowHorizonPanorama")&&(i._showHorizonPanorama=ss.ss.boolean(t.attributes.getNamedItem("ShowHorizonPanorama").nodeValue)),null!=t.attributes.getNamedItem("ShowMoonsAsPointSource")&&(i._showMoonsAsPointSource=ss.ss.boolean(t.attributes.getNamedItem("ShowMoonsAsPointSource").nodeValue)),null!=t.attributes.getNamedItem("ShowSolarSystem")&&(i._showSolarSystem=ss.ss.boolean(t.attributes.getNamedItem("ShowSolarSystem").nodeValue)),null!=t.attributes.getNamedItem("FovTelescope")&&(i._fovTelescope=parseInt(t.attributes.getNamedItem("FovTelescope").nodeValue)),null!=t.attributes.getNamedItem("FovEyepiece")&&(i._fovEyepiece=parseInt(t.attributes.getNamedItem("FovEyepiece").nodeValue)),null!=t.attributes.getNamedItem("FovCamera")&&(i._fovCamera=parseInt(t.attributes.getNamedItem("FovCamera").nodeValue)),null!=t.attributes.getNamedItem("LocalHorizonMode")&&(i._localHorizonMode=ss.ss.boolean(t.attributes.getNamedItem("LocalHorizonMode").nodeValue)),null!=t.attributes.getNamedItem("GalacticMode")&&(i._galacticMode=ss.ss.boolean(t.attributes.getNamedItem("GalacticMode").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemStars")&&(i._solarSystemStars=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemStars").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemMilkyWay")&&(i._solarSystemMilkyWay=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemMilkyWay").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemCosmos")&&(i._solarSystemCosmos=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemCosmos").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemOrbits")&&(i._solarSystemOrbits=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemOrbits").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemOverlays")&&(i._solarSystemOverlays=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemOverlays").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemLighting")&&(i._solarSystemLighting=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemLighting").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemScale")&&(i._solarSystemScale=parseInt(t.attributes.getNamedItem("SolarSystemScale").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemMultiRes")&&(i._solarSystemMultiRes=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemMultiRes").nodeValue)),null!=t.attributes.getNamedItem("ShowEquatorialGridText")&&(i._showEquatorialGridText=ss.ss.boolean(t.attributes.getNamedItem("ShowEquatorialGridText").nodeValue)),null!=t.attributes.getNamedItem("EquatorialGridColor")&&(i._equatorialGridColor=Color.load(t.attributes.getNamedItem("EquatorialGridColor").nodeValue)),null!=t.attributes.getNamedItem("ShowGalacticGrid")&&(i._showGalacticGrid=ss.ss.boolean(t.attributes.getNamedItem("ShowGalacticGrid").nodeValue)),null!=t.attributes.getNamedItem("ShowGalacticGridText")&&(i._showGalacticGridText=ss.ss.boolean(t.attributes.getNamedItem("ShowGalacticGridText").nodeValue)),null!=t.attributes.getNamedItem("GalacticGridColor")&&(i._galacticGridColor=Color.load(t.attributes.getNamedItem("GalacticGridColor").nodeValue)),null!=t.attributes.getNamedItem("ShowEclipticGrid")&&(i._showEclipticGrid=ss.ss.boolean(t.attributes.getNamedItem("ShowEclipticGrid").nodeValue)),null!=t.attributes.getNamedItem("ShowEclipticGridText")&&(i._showEclipticGridText=ss.ss.boolean(t.attributes.getNamedItem("ShowEclipticGridText").nodeValue)),null!=t.attributes.getNamedItem("EclipticGridColor")&&(i._eclipticGridColor=Color.load(t.attributes.getNamedItem("EclipticGridColor").nodeValue)),null!=t.attributes.getNamedItem("ShowEclipticOverviewText")&&(i._showEclipticOverviewText=ss.ss.boolean(t.attributes.getNamedItem("ShowEclipticOverviewText").nodeValue)),null!=t.attributes.getNamedItem("ShowAltAzGrid")&&(i._showAltAzGrid=ss.ss.boolean(t.attributes.getNamedItem("ShowAltAzGrid").nodeValue)),null!=t.attributes.getNamedItem("ShowAltAzGridText")&&(i._showAltAzGridText=ss.ss.boolean(t.attributes.getNamedItem("ShowAltAzGridText").nodeValue)),null!=t.attributes.getNamedItem("AltAzGridColor")&&(i._altAzGridColor=Color.load(t.attributes.getNamedItem("AltAzGridColor").nodeValue)),null!=t.attributes.getNamedItem("ShowPrecessionChart")&&(i._showPrecessionChart=ss.ss.boolean(t.attributes.getNamedItem("ShowPrecessionChart").nodeValue)),null!=t.attributes.getNamedItem("PrecessionChartColor")&&(i._precessionChartColor=Color.load(t.attributes.getNamedItem("PrecessionChartColor").nodeValue)),null!=t.attributes.getNamedItem("ShowConstellationPictures")&&(i._showConstellationPictures=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellationPictures").nodeValue)),null!=t.attributes.getNamedItem("ShowConstellationLabels")&&(i._showConstellationLabels=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellationLabels").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemCMB")&&(i._solarSystemCMB=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemCMB").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemMinorPlanets")&&(i._solarSystemMinorPlanets=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemMinorPlanets").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemPlanets")&&(i._solarSystemPlanets=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemPlanets").nodeValue)),null!=t.attributes.getNamedItem("ShowEarthSky")&&(i._showEarthSky=ss.ss.boolean(t.attributes.getNamedItem("ShowEarthSky").nodeValue)),null!=t.attributes.getNamedItem("SolarSystemMinorOrbits")&&(i._solarSystemMinorOrbits=ss.ss.boolean(t.attributes.getNamedItem("SolarSystemMinorOrbits").nodeValue)),null!=t.attributes.getNamedItem("ShowSkyOverlays")?i._showSkyOverlays=ss.ss.boolean(t.attributes.getNamedItem("ShowSkyOverlays").nodeValue):i._showSkyOverlays=!0,null!=t.attributes.getNamedItem("ShowConstellations")?i._showConstellations=ss.ss.boolean(t.attributes.getNamedItem("ShowConstellations").nodeValue):i._showConstellations=!0,null!=t.attributes.getNamedItem("ShowSkyNode")?i._showSkyNode=ss.ss.boolean(t.attributes.getNamedItem("ShowSkyNode").nodeValue):i._showSkyNode=!0,null!=t.attributes.getNamedItem("ShowSkyGrids")?i._showSkyGrids=ss.ss.boolean(t.attributes.getNamedItem("ShowSkyGrids").nodeValue):i._showSkyGrids=!0,null!=t.attributes.getNamedItem("ShowSkyOverlaysIn3d")&&(i._showSkyOverlaysIn3d=ss.ss.boolean(t.attributes.getNamedItem("ShowSkyOverlaysIn3d").nodeValue)),null!=t.attributes.getNamedItem("EarthCutawayView")&&(i._earthCutawayView=ss.ss.boolean(t.attributes.getNamedItem("EarthCutawayView").nodeValue)),null!=t.attributes.getNamedItem("ShowISSModel")&&(i._showISSModel=ss.ss.boolean(t.attributes.getNamedItem("ShowISSModel").nodeValue)),null!=t.attributes.getNamedItem("MilkyWayModel")&&(i._milkyWayModel=ss.ss.boolean(t.attributes.getNamedItem("MilkyWayModel").nodeValue)),null!=t.attributes.getNamedItem("ConstellationBoundariesFilter")?i._constellationBoundariesFilter=ConstellationFilter.parse(t.attributes.getNamedItem("ConstellationBoundariesFilter").nodeValue):i._constellationBoundariesFilter=ConstellationFilter.get_allConstellation(),null!=t.attributes.getNamedItem("ConstellationBoundariesFilter")?i._constellationFiguresFilter=ConstellationFilter.parse(t.attributes.getNamedItem("ConstellationBoundariesFilter").nodeValue):i._constellationFiguresFilter=new ConstellationFilter,null!=t.attributes.getNamedItem("ConstellationNamesFilter")?i._constellationNamesFilter=ConstellationFilter.parse(t.attributes.getNamedItem("ConstellationNamesFilter").nodeValue):i._constellationNamesFilter=new ConstellationFilter,null!=t.attributes.getNamedItem("ConstellationArtFilter")?i._constellationArtFilter=ConstellationFilter.parse(t.attributes.getNamedItem("ConstellationArtFilter").nodeValue):i._constellationArtFilter=new ConstellationFilter,null!=t.attributes.getNamedItem("MinorPlanetsFilter")&&(i._minorPlanetsFilter=parseInt(t.attributes.getNamedItem("MinorPlanetsFilter").nodeValue)),null!=t.attributes.getNamedItem("PlanetOrbitsFilter")&&(i._planetOrbitsFilter=parseInt(t.attributes.getNamedItem("PlanetOrbitsFilter").nodeValue));var r=Util.selectSingleNode(t,"Place");i._target=Place._fromXml(r);var n=Util.selectSingleNode(t,"EndTarget");null!=n&&(i._endTarget=Place._fromXml(n));for(var s=Util.selectSingleNode(t,"Overlays"),a=ss.ss.enumerate(s.childNodes);a.moveNext();){var o=a.current;"Overlay"===o.nodeName&&i.addOverlay(Overlay._fromXml(i,o))}var l=Util.selectSingleNode(t,"MusicTrack");null!=l&&(i._musicTrack=Overlay._fromXml(i,Util.selectSingleNode(l,"Overlay")));var h=Util.selectSingleNode(t,"VoiceTrack");null!=h&&(i._voiceTrack=Overlay._fromXml(i,Util.selectSingleNode(h,"Overlay")));var c=Util.selectSingleNode(t,"VisibleLayers");return null!=c&&i._loadLayerList(c),i._thumbnail=e.getCachedTexture(ss.ss.format("{0}.thumb.png",i._id),(function(){})),i}catch(e){return globalScriptInterface._fireTourError(e),null}};var TourStop$={get_keyFramed:function(){return this._keyFramed},get_tourStopType:function(){return null!=this._target.get_backgroundImageset()?this._target.get_backgroundImageset().get_dataSetType():this._tourStopType},set_tourStopType:function(e){return null!=this._target.get_backgroundImageset()&&this._target.get_backgroundImageset().get_dataSetType()!==e&&this._target.set_backgroundImageset(null),this._tourStopType=e,e},get_tweenPosition:function(){return this._tweenPosition},set_tweenPosition:function(e){return this._tweenPosition!==e&&(this._tweenPosition=Math.max(0,Math.min(1,e)),this.updateTweenPosition()),e},updateTweenPosition:function(){this.get_keyFramed()},copy:function(){var e=new XmlTextWriter;e._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),this._saveToXml(e,!0);try{var t=(new DOMParser).parseFromString(e.body,"text/xml"),i=Util.selectSingleNode(t,"TourStop"),r=TourStop._fromXml(this.get_owner(),i);return r.set_id(Guid.newGuid().toString()),r}catch(e){}return null},get_owner:function(){return this._owner},set_owner:function(e){return this._owner=e,e},get__transition:function(){return this._transition},set__transition:function(e){return this._transition!==e&&(this._transition=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get__transitionTime:function(){return this._transitionTime},set__transitionTime:function(e){return this._transitionTime!==e&&(this._transitionTime=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get__transitionHoldTime:function(){return this._transitionHoldTime},set__transitionHoldTime:function(e){return this._transitionHoldTime!==e&&(this._transitionHoldTime=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get__transitionOutTime:function(){return this._transitionOutTime},set__transitionOutTime:function(e){return this._transitionOutTime!==e&&(this._transitionOutTime=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_nextSlide:function(){return this._nextSlide},set_nextSlide:function(e){return this._nextSlide=e,e},get_isLinked:function(){return!(null==this._nextSlide||"Next"===this._nextSlide||!this._nextSlide)},get_fadeInOverlays:function(){return this._fadeInOverlays},set_fadeInOverlays:function(e){return this._fadeInOverlays=e,e},get_masterSlide:function(){return this._masterSlide},set_masterSlide:function(e){return this._masterSlide!==e&&(this._masterSlide=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_id:function(){return this._id},set_id:function(e){return this._id=e,null!=this._owner&&this._owner.set_tourDirty(!0),e},toString:function(){return null!=this._target?this.get_target().get_name():this._description},get_description:function(){return this._description},set_description:function(e){return this._description!==e&&(this._description=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_name:function(){return null!=this._target?this._target.get_name():this._name},set_name:function(e){return this._name!==e&&(this._name=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_duration:function(){return this._duration},set_duration:function(e){return this._duration!==e&&(this._duration=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_target:function(){return this._target},set_target:function(e){return this._target!==e&&(this._target=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_endTarget:function(){return this._endTarget},set_endTarget:function(e){return this._endTarget!==e&&(this._endTarget=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_interpolationType:function(){return this._interpolationType},set_interpolationType:function(e){return this._interpolationType=e,e},get_hasLocation:function(){return this._hasTime},set_hasLocation:function(e){return this._hasLocation!==e&&(this._hasLocation=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_hasTime:function(){return this._hasTime},set_hasTime:function(e){return this._hasTime!==e&&(this._hasTime=this._hasLocation=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_startTime:function(){return this._startTime},set_startTime:function(e){return this._startTime=e,ss.ss.compareDates(this._startTime,e)||(this._startTime=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_endTime:function(){return this._endTime},set_endTime:function(e){return ss.ss.compareDates(this._endTime,e)||(this._endTime=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},captureSettings:function(){this._startTime=SpaceTimeController.get_now(),this._actualPlanetScale=Settings.get_current().get_actualPlanetScale(),this._locationAltitude=Settings.get_current().get_locationAltitude(),this._locationLat=Settings.get_current().get_locationLat(),this._locationLng=Settings.get_current().get_locationLng(),this._showClouds=Settings.get_current().get_showClouds(),this._showConstellationBoundries=Settings.get_current().get_showConstellationBoundries(),this._showConstellationFigures=Settings.get_current().get_showConstellationFigures(),this._showConstellationSelection=Settings.get_current().get_showConstellationSelection(),this._showEcliptic=Settings.get_current().get_showEcliptic(),this._showElevationModel=Settings.get_current().get_showElevationModel(),this._showFieldOfView=Settings.get_current().get_showFieldOfView(),this._showGrid=Settings.get_current().get_showGrid(),this._showHorizon=Settings.get_current().get_showHorizon(),this._showHorizonPanorama=Settings.get_current().get_showHorizonPanorama(),this._showMoonsAsPointSource=Settings.get_current().get_showMoonsAsPointSource(),this._showSolarSystem=Settings.get_current().get_showSolarSystem(),this._fovTelescope=Settings.get_current().get_fovTelescope(),this._fovEyepiece=Settings.get_current().get_fovEyepiece(),this._fovCamera=Settings.get_current().get_fovCamera(),this._localHorizonMode=Settings.get_current().get_localHorizonMode(),this._galacticMode=Settings.get_current().get_galacticMode(),this._solarSystemStars=Settings.get_current().get_solarSystemStars(),this._solarSystemMilkyWay=Settings.get_current().get_solarSystemMilkyWay(),this._solarSystemCosmos=Settings.get_current().get_solarSystemCosmos(),this._solarSystemOrbits=Settings.get_current().get_solarSystemOrbits(),this._solarSystemOverlays=Settings.get_current().get_solarSystemOverlays(),this._solarSystemLighting=Settings.get_current().get_solarSystemLighting(),this._solarSystemScale=Settings.get_current().get_solarSystemScale(),this._solarSystemMultiRes=Settings.get_current().get_solarSystemMultiRes(),this._showEquatorialGridText=Settings.get_current().get_showEquatorialGridText(),this._showGalacticGrid=Settings.get_current().get_showGalacticGrid(),this._showGalacticGridText=Settings.get_current().get_showGalacticGridText(),this._showEclipticGrid=Settings.get_current().get_showEclipticGrid(),this._showEclipticGridText=Settings.get_current().get_showEclipticGridText(),this._showEclipticOverviewText=Settings.get_current().get_showEclipticOverviewText(),this._showAltAzGrid=Settings.get_current().get_showAltAzGrid(),this._showAltAzGridText=Settings.get_current().get_showAltAzGridText(),this._showPrecessionChart=Settings.get_current().get_showPrecessionChart(),this._showConstellationPictures=Settings.get_current().get_showConstellationPictures(),this._showConstellationLabels=Settings.get_current().get_showConstellationLabels(),this._solarSystemCMB=Settings.get_current().get_solarSystemCMB(),this._solarSystemMinorPlanets=Settings.get_current().get_solarSystemMinorPlanets(),this._solarSystemPlanets=Settings.get_current().get_solarSystemPlanets(),this._showEarthSky=Settings.get_current().get_showEarthSky(),this._solarSystemMinorOrbits=Settings.get_current().get_solarSystemMinorOrbits(),this._constellationFiguresFilter=Settings.get_current().get_constellationFiguresFilter().clone(),this._constellationBoundariesFilter=Settings.get_current().get_constellationBoundariesFilter().clone(),this._constellationNamesFilter=Settings.get_current().get_constellationNamesFilter().clone(),this._constellationArtFilter=Settings.get_current().get_constellationArtFilter().clone(),this._showSkyOverlays=Settings.get_current().get_showSkyOverlays(),this._showConstellations=Settings.get_current().get_showConstellations(),this._showSkyNode=Settings.get_current().get_showSkyNode(),this._showSkyGrids=Settings.get_current().get_showSkyGrids(),this._showSkyOverlaysIn3d=Settings.get_current().get_showSkyOverlaysIn3d(),this._earthCutawayView=Settings.get_current().get_earthCutawayView(),this._showISSModel=Settings.get_current().get_showISSModel(),this._milkyWayModel=Settings.get_current().get_milkyWayModel(),this._minorPlanetsFilter=Settings.get_current().get_minorPlanetsFilter(),this._planetOrbitsFilter=Settings.get_current().get_planetOrbitsFilter()},syncSettings:function(){Settings.get_globalSettings().set_actualPlanetScale(this._actualPlanetScale),Settings.get_globalSettings().set_locationAltitude(this._locationAltitude),Settings.get_globalSettings().set_locationLat(this._locationLat),Settings.get_globalSettings().set_locationLng(this._locationLng),Settings.get_globalSettings().set_earthCutawayView(this._earthCutawayView),Settings.get_globalSettings().set_showConstellationBoundries(this._showConstellationBoundries),Settings.get_globalSettings().set_showConstellationFigures(this._showConstellationFigures),Settings.get_globalSettings().set_showConstellationSelection(this._showConstellationSelection),Settings.get_globalSettings().set_showEcliptic(this._showEcliptic),Settings.get_globalSettings().set_showElevationModel(this._showElevationModel),Settings.get_globalSettings().set_showGrid(this._showGrid),Settings.get_globalSettings().set_showHorizon(this._showHorizon),Settings.get_globalSettings().set_showSolarSystem(this._showSolarSystem),Settings.get_globalSettings().set_localHorizonMode(this._localHorizonMode),Settings.get_globalSettings().set_galacticMode(this._galacticMode),Settings.get_globalSettings().set_solarSystemStars(this._solarSystemStars),Settings.get_globalSettings().set_solarSystemMilkyWay(this._solarSystemMilkyWay),Settings.get_globalSettings().set_solarSystemCosmos(this._solarSystemCosmos),Settings.get_globalSettings().set_solarSystemCMB(this._solarSystemCMB),Settings.get_globalSettings().set_solarSystemOrbits(this._solarSystemOrbits),Settings.get_globalSettings().set_solarSystemMinorOrbits(this._solarSystemMinorOrbits),Settings.get_globalSettings().set_solarSystemMinorPlanets(this._solarSystemMinorPlanets),Settings.get_globalSettings().set_solarSystemOverlays(this._solarSystemOverlays),Settings.get_globalSettings().set_solarSystemLighting(this._solarSystemLighting),Settings.get_globalSettings().set_showISSModel(this._showISSModel),Settings.get_globalSettings().set_solarSystemScale(this._solarSystemScale),Settings.get_globalSettings().set_solarSystemMultiRes(this._solarSystemMultiRes),Settings.get_globalSettings().set_showEarthSky(this._showEarthSky),Settings.get_globalSettings().set_minorPlanetsFilter(this._minorPlanetsFilter),Settings.get_globalSettings().set_planetOrbitsFilter(this._planetOrbitsFilter),Settings.get_globalSettings().set_showEquatorialGridText(this._showEquatorialGridText),Settings.get_globalSettings().set_showGalacticGrid(this._showGalacticGrid),Settings.get_globalSettings().set_showGalacticGridText(this._showGalacticGridText),Settings.get_globalSettings().set_showEclipticGrid(this._showEclipticGrid),Settings.get_globalSettings().set_showEclipticGridText(this._showEclipticGridText),Settings.get_globalSettings().set_showEclipticOverviewText(this._showEclipticOverviewText),Settings.get_globalSettings().set_showAltAzGrid(this._showAltAzGrid),Settings.get_globalSettings().set_showAltAzGridText(this._showAltAzGridText),Settings.get_globalSettings().set_showPrecessionChart(this._showPrecessionChart),Settings.get_globalSettings().set_showConstellationPictures(this._showConstellationPictures),Settings.get_globalSettings().set_constellationsEnabled(this._constellationsEnabled),Settings.get_globalSettings().set_showSkyOverlays(this._showSkyOverlays),Settings.get_globalSettings().set_constellations(this._showConstellations),Settings.get_globalSettings().set_showSkyNode(this._showSkyNode),Settings.get_globalSettings().set_showSkyGrids(this._showSkyGrids),Settings.get_globalSettings().set_constellationFiguresFilter(this._constellationFiguresFilter.clone()),Settings.get_globalSettings().set_constellationBoundariesFilter(this._constellationBoundariesFilter.clone()),Settings.get_globalSettings().set_constellationNamesFilter(this._constellationNamesFilter.clone()),Settings.get_globalSettings().set_constellationArtFilter(this._constellationArtFilter.clone())},get_solarSystemStars:function(){return this._solarSystemStars},get_solarSystemMultiRes:function(){return this._solarSystemMultiRes},get_solarSystemMilkyWay:function(){return this._solarSystemMilkyWay},get_solarSystemCosmos:function(){return this._solarSystemCosmos},get_solarSystemOrbits:function(){return this._solarSystemOrbits},get_solarSystemOverlays:function(){return this._solarSystemOverlays},get_solarSystemLighting:function(){return this._solarSystemLighting},get_solarSystemScale:function(){return this._solarSystemScale},get_actualPlanetScale:function(){return this._actualPlanetScale},get_fovCamera:function(){return this._fovCamera},get_fovEyepiece:function(){return this._fovEyepiece},get_fovTelescope:function(){return this._fovTelescope},get_locationAltitude:function(){return this._hasLocation?this._locationAltitude:Settings.get_current().get_locationAltitude()},get_locationLat:function(){return this._hasLocation?this._locationLat:Settings.get_current().get_locationLat()},get_locationLng:function(){return this._hasLocation?this._locationLng:Settings.get_current().get_locationLng()},get_showClouds:function(){return this._showClouds},get_showConstellationBoundries:function(){return this._showConstellationBoundries},get_showConstellationFigures:function(){return this._showConstellationFigures},get_showConstellationSelection:function(){return this._showConstellationSelection},get_showEcliptic:function(){return this._showEcliptic},get_showElevationModel:function(){return this._showElevationModel},get_showFieldOfView:function(){return this._showFieldOfView},get_showGrid:function(){return this._showGrid},get_showHorizon:function(){return this._showHorizon},get_showHorizonPanorama:function(){return this._showHorizonPanorama},get_showMoonsAsPointSource:function(){return this._showMoonsAsPointSource},get_showSolarSystem:function(){return this._showSolarSystem},get_localHorizonMode:function(){return this._localHorizonMode},get_galacticMode:function(){return this._galacticMode},get_thumbnail:function(){return null!=this._target&&null==this._thumbnail?null:this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,null!=this._owner&&this._owner.set_tourDirty(!0),e},get_overlays:function(){return this._overlays},get_musicTrack:function(){return this._musicTrack},set_musicTrack:function(e){return this._musicTrack!==e&&(this._musicTrack=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},get_voiceTrack:function(){return this._voiceTrack},set_voiceTrack:function(e){return this._voiceTrack!==e&&(this._voiceTrack=e,null!=this._owner&&this._owner.set_tourDirty(!0)),e},addOverlay:function(e){null!=e&&(e.set_owner(this),this._overlays.push(e),null!=this._owner&&this._owner.set_tourDirty(!0))},removeOverlay:function(e){ss.ss.remove(this._overlays,e),null!=this._owner&&this._owner.set_tourDirty(!0)},cleanUp:function(){for(var e=ss.ss.enumerate(this.get_overlays());e.moveNext();)e.current.cleanUp();null!=this._voiceTrack&&this._voiceTrack.cleanUp(),null!=this._musicTrack&&this._musicTrack.cleanUp()},sendToBack:function(e){ss.ss.remove(this._overlays,e),this._overlays.splice(0,0,e),null!=this._owner&&this._owner.set_tourDirty(!0)},bringToFront:function(e){ss.ss.remove(this._overlays,e),this._overlays.push(e),null!=this._owner&&this._owner.set_tourDirty(!0)},bringForward:function(e){var t=this._overlays.indexOf(e);t<this._overlays.length-1&&(ss.ss.remove(this._overlays,e),this._overlays.splice(t+1,0,e)),null!=this._owner&&this._owner.set_tourDirty(!0)},sendBackward:function(e){var t=this._overlays.indexOf(e);t>0&&(ss.ss.remove(this._overlays,e),this._overlays.splice(t-1,0,e)),null!=this._owner&&this._owner.set_tourDirty(!0)},getNextOverlay:function(e){if(null==e)return this._overlays.length>0?this._overlays[0]:null;var t=this._overlays.indexOf(e);return t<this._overlays.length-1?this._overlays[t+1]:this._overlays[0]},getPerviousOverlay:function(e){if(null==e)return this._overlays.length>0?this._overlays[0]:null;var t=this._overlays.indexOf(e);return t>0?this._overlays[t-1]:this._overlays[this._overlays.length-1]},getOverlayById:function(e){for(var t=ss.ss.enumerate(this._overlays);t.moveNext();){var i=t.current;if(i.id===e)return i}return null},get_tourStopThumbnailFilename:function(){return ss.ss.format("{0}.thumb.png",this._id)},_saveToXml:function(e,t){t&&this._thumbnail,e._writeStartElement("TourStop"),e._writeAttributeString("Id",this._id),e._writeAttributeString("Name",this._name),e._writeAttributeString("Description",this._description),e._writeAttributeString("Thumbnail",this._thumbnailString),e._writeAttributeString("Duration",Util.xmlDuration(this._duration)),e._writeAttributeString("Master",this._masterSlide.toString()),e._writeAttributeString("TransitionType",Enums.toXml("TransitionType",this._transition)),e._writeAttributeString("TransitionTime",this._transitionTime.toString()),e._writeAttributeString("TransitionOutTime",this._transitionOutTime.toString()),e._writeAttributeString("TransitionHoldTime",this._transitionHoldTime.toString()),e._writeAttributeString("NextSlide",this._nextSlide),e._writeAttributeString("InterpolationType",Enums.toXml("InterpolationType",this._interpolationType)),e._writeAttributeString("HasLocation",this._hasLocation.toString()),this._hasLocation&&(e._writeAttributeString("LocationAltitude",this._locationAltitude.toString()),e._writeAttributeString("LocationLat",this._locationLat.toString()),e._writeAttributeString("LocationLng",this._locationLng.toString())),e._writeAttributeString("HasTime",this._hasTime.toString()),this._hasTime&&(e._writeAttributeString("StartTime",Util.xmlDate(this._startTime)),e._writeAttributeString("EndTime",Util.xmlDate(this._endTime))),e._writeAttributeString("ActualPlanetScale",this._actualPlanetScale.toString()),e._writeAttributeString("ShowClouds",this._showClouds.toString()),e._writeAttributeString("EarthCutawayView",this._earthCutawayView.toString()),e._writeAttributeString("ShowConstellationBoundries",this._showConstellationBoundries.toString()),e._writeAttributeString("ShowConstellationFigures",this._showConstellationFigures.toString()),e._writeAttributeString("ShowConstellationSelection",this._showConstellationSelection.toString()),e._writeAttributeString("ShowEcliptic",this._showEcliptic.toString()),e._writeAttributeString("EclipticColor",this._eclipticColor.save()),e._writeAttributeString("ShowElevationModel",this._showElevationModel.toString()),this._showFieldOfView=!1,e._writeAttributeString("ShowFieldOfView",this._showFieldOfView.toString()),e._writeAttributeString("ShowGrid",this._showGrid.toString()),e._writeAttributeString("ShowHorizon",this._showHorizon.toString()),e._writeAttributeString("ShowHorizonPanorama",this._showHorizonPanorama.toString()),e._writeAttributeString("ShowMoonsAsPointSource",this._showMoonsAsPointSource.toString()),e._writeAttributeString("ShowSolarSystem",this._showSolarSystem.toString()),e._writeAttributeString("FovTelescope",this._fovTelescope.toString()),e._writeAttributeString("FovEyepiece",this._fovEyepiece.toString()),e._writeAttributeString("FovCamera",this._fovCamera.toString()),e._writeAttributeString("LocalHorizonMode",this._localHorizonMode.toString()),e._writeAttributeString("GalacticMode",this._galacticMode.toString()),e._writeAttributeString("FadeInOverlays",this._fadeInOverlays.toString()),e._writeAttributeString("SolarSystemStars",this._solarSystemStars.toString()),e._writeAttributeString("SolarSystemMilkyWay",this._solarSystemMilkyWay.toString()),e._writeAttributeString("SolarSystemCosmos",this._solarSystemCosmos.toString()),e._writeAttributeString("SolarSystemCMB",this._solarSystemCMB.toString()),e._writeAttributeString("SolarSystemOrbits",this._solarSystemOrbits.toString()),e._writeAttributeString("SolarSystemMinorOrbits",this._solarSystemMinorOrbits.toString()),e._writeAttributeString("SolarSystemOverlays",this._solarSystemOverlays.toString()),e._writeAttributeString("SolarSystemLighting",this._solarSystemLighting.toString()),e._writeAttributeString("ShowISSModel",this._showISSModel.toString()),e._writeAttributeString("SolarSystemScale",this._solarSystemScale.toString()),e._writeAttributeString("MinorPlanetsFilter",this._minorPlanetsFilter.toString()),e._writeAttributeString("PlanetOrbitsFilter",this._planetOrbitsFilter.toString()),e._writeAttributeString("SolarSystemMultiRes",this._solarSystemMultiRes.toString()),e._writeAttributeString("SolarSystemMinorPlanets",this._solarSystemMinorPlanets.toString()),e._writeAttributeString("SolarSystemPlanets",this._solarSystemPlanets.toString()),e._writeAttributeString("ShowEarthSky",this._showEarthSky.toString()),e._writeAttributeString("ShowEquatorialGridText",this.get_showEquatorialGridText().toString()),e._writeAttributeString("EquatorialGridColor",this.get_equatorialGridColor().save()),e._writeAttributeString("ShowGalacticGrid",this.get_showGalacticGrid().toString()),e._writeAttributeString("ShowGalacticGridText",this.get_showGalacticGridText().toString()),e._writeAttributeString("GalacticGridColor",this.get_galacticGridColor().save()),e._writeAttributeString("ShowEclipticGrid",this.get_showEclipticGrid().toString()),e._writeAttributeString("ShowEclipticGridText",this.get_showEclipticGridText().toString()),e._writeAttributeString("EclipticGridColor",this.get_eclipticGridColor().save()),e._writeAttributeString("ShowEclipticOverviewText",this.get_showEclipticOverviewText().toString()),e._writeAttributeString("ShowAltAzGrid",this.get_showAltAzGrid().toString()),e._writeAttributeString("ShowAltAzGridText",this.get_showAltAzGridText().toString()),e._writeAttributeString("AltAzGridColor",this.get_altAzGridColor().save()),e._writeAttributeString("ShowPrecessionChart",this.get_showPrecessionChart().toString()),e._writeAttributeString("PrecessionChartColor",this.get_precessionChartColor().save()),e._writeAttributeString("ConstellationPictures",this.get_showConstellationPictures().toString()),e._writeAttributeString("ConstellationsEnabled",this.get_constellationsEnabled()),e._writeAttributeString("ShowConstellationLabels",this.get_showConstellationLabels().toString()),e._writeAttributeString("ShowSkyOverlays",this.get_showSkyOverlays().toString()),e._writeAttributeString("ShowConstellations",this.get_showConstellations().toString()),e._writeAttributeString("ShowSkyNode",this.get_showSkyNode().toString()),e._writeAttributeString("ShowSkyGrids",this.get_showSkyGrids().toString()),e._writeAttributeString("SkyOverlaysIn3d",this.get_showSkyOverlaysIn3d().toString()),e._writeAttributeString("ConstellationFiguresFilter",this._constellationFiguresFilter.toString()),e._writeAttributeString("ConstellationBoundariesFilter",this._constellationBoundariesFilter.toString()),e._writeAttributeString("ConstellationNamesFilter",this._constellationNamesFilter.toString()),e._writeAttributeString("ConstellationArtFilter",this._constellationArtFilter.toString()),this._target._saveToXml(e,"Place"),null!=this._endTarget&&this._endTarget._saveToXml(e,"EndTarget"),e._writeStartElement("Overlays");for(var i=ss.ss.enumerate(this._overlays);i.moveNext();)i.current.saveToXml(e,!1);e._writeEndElement(),null!=this._musicTrack&&(e._writeStartElement("MusicTrack"),this._musicTrack.saveToXml(e,!1),e._writeEndElement()),null!=this._voiceTrack&&(e._writeStartElement("VoiceTrack"),this._voiceTrack.saveToXml(e,!1),e._writeEndElement()),this._writeLayerList(e),e._writeEndElement()},_writeLayerList:function(e){if(ss.ss.keyCount(this.layers)>0){e._writeStartElement("VisibleLayers");for(var t=ss.ss.enumerate(ss.ss.keys(this.layers));t.moveNext();){var i=t.current,r=this.layers[i];e._writeStartElement("Layer"),e._writeAttributeString("StartOpacity",r.startOpacity.toString()),e._writeAttributeString("EndOpacity",r.endOpacity.toString());var n=r.startParams.length;e._writeAttributeString("ParamCount",n.toString());for(var s=0;s<n;s++)e._writeAttributeString(ss.ss.format("StartParam{0}",s),r.startParams[s].toString()),e._writeAttributeString(ss.ss.format("EndParam{0}",s),r.endParams[s].toString());e._writeValue(r.id.toString()),e._writeEndElement()}e._writeEndElement()}},_addFilesToCabinet:function(e,t){if(null!=this._thumbnail){var i=ss.ss.format("{0}.thumb.png",this._id),r=this._owner.getFileBlob(i);e.addFile(this._owner.get_workingDirectory()+i,r)}t||(null!=this._musicTrack&&this._musicTrack.addFilesToCabinet(e),null!=this._voiceTrack&&this._voiceTrack.addFilesToCabinet(e));for(var n=ss.ss.enumerate(this._overlays);n.moveNext();)n.current.addFilesToCabinet(e)},getNextDefaultName:function(e){for(var t=1,i=ss.ss.enumerate(this._overlays);i.moveNext();){var r=i.current;if(ss.ss.startsWith(r.get_name(),e)){var n=0;try{n=parseInt(r.get_name().substr(e.length))}catch(e){}n>=t&&(t=n+1)}}return ss.ss.format("{0} {1}",e,t)},_loadLayerList:function(e){for(var t=ss.ss.enumerate(e.childNodes);t.moveNext();){var i=t.current;if("Layer"===i.nodeName){var r=new LayerInfo,n=i.innerHTML;r.id=Guid.fromString(n),r.startOpacity=parseFloat(i.attributes.getNamedItem("StartOpacity").nodeValue),r.endOpacity=parseFloat(i.attributes.getNamedItem("EndOpacity").nodeValue);var s=0;null!=i.attributes.getNamedItem("ParamCount")&&(s=parseInt(i.attributes.getNamedItem("ParamCount").nodeValue)),r.startParams=new Array(s),r.endParams=new Array(s),r.frameParams=new Array(s);for(var a=0;a<s;a++)r.startParams[a]=parseFloat(i.attributes.getNamedItem(ss.ss.format("StartParam{0}",a)).nodeValue),r.endParams[a]=parseFloat(i.attributes.getNamedItem(ss.ss.format("EndParam{0}",a)).nodeValue),r.frameParams[a]=r.startParams[a];this.layers[r.id]=r}}},_updateLayerOpacity:function(){this.get_keyFramed()&&this.updateTweenPosition()},get_showEquatorialGridText:function(){return this._showEquatorialGridText},set_showEquatorialGridText:function(e){return this._showEquatorialGridText=e,e},get_showGalacticGrid:function(){return this._showGalacticGrid},set_showGalacticGrid:function(e){return this._showGalacticGrid=e,e},get_showGalacticGridText:function(){return this._showGalacticGridText},set_showGalacticGridText:function(e){return this._showGalacticGridText=e,e},get_showEclipticGrid:function(){return this._showEclipticGrid},set_showEclipticGrid:function(e){return this._showEclipticGrid=e,e},get_showEclipticGridText:function(){return this._showEclipticGridText},set_showEclipticGridText:function(e){return this._showEclipticGridText=e,e},get_showEclipticOverviewText:function(){return this._showEclipticOverviewText},set_showEclipticOverviewText:function(e){return this._showEclipticOverviewText=e,e},get_showAltAzGrid:function(){return this._showAltAzGrid},set_showAltAzGrid:function(e){return this._showAltAzGrid=e,e},get_showAltAzGridText:function(){return this._showAltAzGridText},set_showAltAzGridText:function(e){return this._showAltAzGridText=e,e},get_showPrecessionChart:function(){return this._showPrecessionChart},set_showPrecessionChart:function(e){return this._showPrecessionChart=e,e},get_showConstellationPictures:function(){return this._showConstellationPictures},set_showConstellationPictures:function(e){return this._showConstellationPictures=e,e},get_showConstellationLabels:function(){return this._showConstellationLabels},set_showConstellationLabels:function(e){return this._showConstellationLabels=e,e},get_solarSystemCMB:function(){return this._solarSystemCMB},set_solarSystemCMB:function(e){return this._solarSystemCMB=e,e},get_solarSystemMinorPlanets:function(){return this._solarSystemMinorPlanets},set_solarSystemMinorPlanets:function(e){return this._solarSystemMinorPlanets=e,e},get_solarSystemPlanets:function(){return this._solarSystemPlanets},set_solarSystemPlanets:function(e){return this._solarSystemPlanets=e,e},get_showEarthSky:function(){return this._showEarthSky},set_showEarthSky:function(e){return this._showEarthSky=e,e},get_solarSystemMinorOrbits:function(){return this._solarSystemMinorOrbits},set_solarSystemMinorOrbits:function(e){return this._solarSystemMinorOrbits=e,e},get_constellationsEnabled:function(){return this._constellationsEnabled},set_constellationsEnabled:function(e){return this._constellationsEnabled=e,e},get_constellationFiguresFilter:function(){return this._constellationFiguresFilter},set_constellationFiguresFilter:function(e){return this._constellationFiguresFilter=e,e},get_constellationBoundariesFilter:function(){return this._constellationBoundariesFilter},set_constellationBoundariesFilter:function(e){return this._constellationBoundariesFilter=e,e},get_constellationNamesFilter:function(){return this._constellationNamesFilter},set_constellationNamesFilter:function(e){return this._constellationNamesFilter=e,e},get_constellationArtFilter:function(){return this._constellationArtFilter},set_constellationArtFilter:function(e){return this._constellationArtFilter=e,e},get_showSkyOverlays:function(){return this._showSkyOverlays},set_showSkyOverlays:function(e){return this._showSkyOverlays=e,e},get_showConstellations:function(){return this._showConstellations},set_showConstellations:function(e){return this._showConstellations=e,e},get_showSkyNode:function(){return this._showSkyNode},set_showSkyNode:function(e){return this._showSkyNode=e,e},get_showSkyGrids:function(){return this._showSkyGrids},set_showSkyGrids:function(e){return this._showSkyGrids=e,e},get_showSkyOverlaysIn3d:function(){return this._showSkyOverlaysIn3d},set_showSkyOverlaysIn3d:function(e){return this._showSkyOverlaysIn3d=e,e},get_earthCutawayView:function(){return this._earthCutawayView},set_earthCutawayView:function(e){return this._earthCutawayView=e,e},get_showISSModel:function(){return this._showISSModel},set_showISSModel:function(e){return this._showISSModel=e,e},get_milkyWayModel:function(){return this._milkyWayModel},set_milkyWayModel:function(e){return this._milkyWayModel=e,e},get_minorPlanetsFilter:function(){return this._minorPlanetsFilter},set_minorPlanetsFilter:function(e){return this._minorPlanetsFilter=e,e},get_planetOrbitsFilter:function(){return this._planetOrbitsFilter},set_planetOrbitsFilter:function(e){return this._planetOrbitsFilter=e,e},getSetting:function(e){return 17===e?new SettingParameter(!0,this.faderOpacity,!!this.faderOpacity,null):new SettingParameter(!1,1,!1,null)},get_eclipticGridColor:function(){return this._eclipticGridColor},set_eclipticGridColor:function(e){return this._eclipticGridColor=e,e},get_galacticGridColor:function(){return this._galacticGridColor},set_galacticGridColor:function(e){return this._galacticGridColor=e,e},get_altAzGridColor:function(){return this._altAzGridColor},set_altAzGridColor:function(e){return this._altAzGridColor=e,e},get_precessionChartColor:function(){return this._precessionChartColor},set_precessionChartColor:function(e){return this._precessionChartColor=e,e},get_eclipticColor:function(){return this._eclipticColor},set_eclipticColor:function(e){return this._eclipticColor=e,e},get_equatorialGridColor:function(){return this._equatorialGridColor},set_equatorialGridColor:function(e){return this._equatorialGridColor=e,e},get_constellationLabelsHeight:function(){return this._constellationLabelsHeight},set_constellationLabelsHeight:function(e){return this._constellationLabelsHeight=e,e}};function LayerInfo(){this.id=Guid.newGuid(),this.startOpacity=1,this.endOpacity=1,this.frameOpacity=1,this.startParams=new Array(0),this.endParams=new Array(0),this.frameParams=new Array(0)}registerType("TourStop",[TourStop,TourStop$,null,ISettings]);var LayerInfo$={};function UndoTourStopChange(e,t){this._undoXml="",this._redoXml="",this._currentIndex=0,this._actionText="",this._targetTour=null,this._currentIndex=t.get_currentTourstopIndex(),this._actionText=e,this._targetTour=t,this._undoXml=TourStop.getXmlText(t.get_currentTourStop()),this._targetTour.set_tourDirty(!0)}registerType("LayerInfo",[LayerInfo,LayerInfo$,null]);var UndoTourStopChange$={get_actionText:function(){return this._actionText},set_actionText:function(e){return this._actionText=e,e},undo:function(){var e=this._targetTour.get_tourStops()[this._currentIndex],t=(new DOMParser).parseFromString(this._undoXml,"text/xml"),i=Util.selectSingleNode(t,"TourStop");this._targetTour.get_tourStops()[this._currentIndex]=TourStop._fromXml(this._targetTour,i),this._targetTour.set_currentTourstopIndex(this._currentIndex),ss.ss.emptyString(this._redoXml)&&(this._redoXml=TourStop.getXmlText(e)),this._targetTour.set_tourDirty(!0)},redo:function(){var e=(new DOMParser).parseFromString(this._redoXml,"text/xml"),t=Util.selectSingleNode(e,"TourStop");this._targetTour.get_tourStops()[this._currentIndex]=TourStop._fromXml(this._targetTour,t),this._targetTour.set_currentTourstopIndex(this._currentIndex),this._targetTour.set_tourDirty(!0)},toString:function(){return this._actionText}};function Undo(){}registerType("UndoTourStopChange",[UndoTourStopChange,UndoTourStopChange$,null,IUndoStep]),Undo._undoStack=new ss.ss.Stack,Undo._redoStack=new ss.ss.Stack,Undo.clear=function(){Undo._undoStack=new ss.ss.Stack,Undo._redoStack=new ss.ss.Stack},Undo.push=function(e){Undo._undoStack.push(e),Undo._redoStack=new ss.ss.Stack},Undo.peekActionString=function(){return Undo._undoStack.count>0?Undo._undoStack.peek().toString():Language.getLocalizedText(551,"Nothing to Undo")},Undo.peekRedoActionString=function(){return Undo._redoStack.count>0?Undo._redoStack.peek().toString():""},Undo.peekAction=function(){return Undo._undoStack.count>0},Undo.peekRedoAction=function(){return Undo._redoStack.count>0},Undo.stepBack=function(){var e=Undo._undoStack.pop();e.undo(),Undo._redoStack.push(e)},Undo.stepForward=function(){var e=Undo._redoStack.pop();e.redo(),Undo._undoStack.push(e)};var Undo$={};function UndoStep(){}registerType("Undo",[Undo,Undo$,null]);var UndoStep$={undo:function(){},redo:function(){},toString:function(){return Language.getLocalizedText(551,"Nothing to Undo")}};function UndoTourSlidelistChange(e,t){this._currentIndex=0,this._actionText="",this._targetTour=null,this._undoList=[];for(var i=0;i<t.get_tourStops().length;i++)this._undoList.push(t.get_tourStops()[i]);this._currentIndex=t.get_currentTourstopIndex(),this._actionText=e,this._targetTour=t,this._targetTour.set_tourDirty(!0)}registerType("UndoStep",[UndoStep,UndoStep$,null,IUndoStep]);var UndoTourSlidelistChange$={get_actionText:function(){return this._actionText},set_actionText:function(e){return this._actionText=e,e},undo:function(){this._redoList=this._targetTour.get_tourStops(),this._targetTour.set_tourStops(this._undoList),this._targetTour.set_currentTourstopIndex(this._currentIndex),this._targetTour.set_tourDirty(!0)},redo:function(){this._undoList=this._targetTour.get_tourStops(),this._targetTour.set_tourStops(this._redoList),this._targetTour.set_currentTourstopIndex(this._currentIndex),this._targetTour.set_tourDirty(!0)},toString:function(){return this._actionText}};function UndoTourPropertiesChange(e,t){this._actionText="",this._targetTour=null,this._undoDomeMode=!1,this._undoLevel=0,this._redoDomeMode=!1,this._redoLevel=0,this._undoTitle=t.get_title(),this._undoAuthor=t.get_author(),this._undoAuthorEmail=t.get_authorEmail(),this._undoDescription=t.get_description(),this._undoAuthorImage=t.get_authorImage(),this._undoOrganizationUrl=t.get_organizationUrl(),this._undoOrgName=t.get_orgName(),this._undoKeywords=t.get_keywords(),this._undoTaxonomy=t.get_taxonomy(),this._undoLevel=t.get_level(),this._actionText=e,this._targetTour=t,this._targetTour.set_tourDirty(!0)}registerType("UndoTourSlidelistChange",[UndoTourSlidelistChange,UndoTourSlidelistChange$,null,IUndoStep]);var UndoTourPropertiesChange$={get_actionText:function(){return this._actionText},set_actionText:function(e){return this._actionText=e,e},undo:function(){this._redoTitle=this._targetTour.get_title(),this._redoAuthor=this._targetTour.get_author(),this._redoAuthorEmail=this._targetTour.get_authorEmail(),this._redoDescription=this._targetTour.get_description(),this._redoAuthorImage=this._targetTour.get_authorImage(),this._redoOrganizationUrl=this._targetTour.get_organizationUrl(),this._redoOrgName=this._targetTour.get_orgName(),this._redoKeywords=this._targetTour.get_keywords(),this._redoTaxonomy=this._targetTour.get_taxonomy(),this._redoLevel=this._targetTour.get_level(),this._targetTour.set_title(this._undoTitle),this._targetTour.set_author(this._undoAuthor),this._targetTour.set_authorEmail(this._undoAuthorEmail),this._targetTour.set_description(this._undoDescription),this._targetTour.set_authorImage(this._undoAuthorImage),this._targetTour.set_organizationUrl(this._undoOrganizationUrl),this._targetTour.set_orgName(this._undoOrgName),this._targetTour.set_keywords(this._undoKeywords),this._targetTour.set_taxonomy(this._undoTaxonomy),this._targetTour.set_level(this._undoLevel),this._targetTour.set_tourDirty(!0)},redo:function(){this._targetTour.set_title(this._redoTitle),this._targetTour.set_author(this._redoAuthor),this._targetTour.set_authorEmail(this._redoAuthorEmail),this._targetTour.set_description(this._redoDescription),this._targetTour.set_authorImage(this._redoAuthorImage),this._targetTour.set_organizationUrl(this._redoOrganizationUrl),this._targetTour.set_orgName(this._redoOrgName),this._targetTour.set_keywords(this._redoKeywords),this._targetTour.set_taxonomy(this._redoTaxonomy),this._targetTour.set_level(this._redoLevel),this._targetTour.set_tourDirty(!0)},toString:function(){return this._actionText}};function TourEditor(){this.selection=new Selection,this._contextMenu=new ContextMenuStrip,this._tour=null,this._mouseDown=!1,this._selectionAction=11,this._needUndoFrame=!1,this._contextPoint=new Vector2d,this._dragCopying=!1,this._brokeThreshold=!1,this.nextSlideCallback=null,this.clipboardData="",this.clipboardType="",this.editTextCallback=null,this._defaultColor=Colors.get_white()}registerType("UndoTourPropertiesChange",[UndoTourPropertiesChange,UndoTourPropertiesChange$,null,IUndoStep]),TourEditor.capturing=!1,TourEditor.currentEditor=null;var TourEditor$={render:function(e){if(e.setupMatricesOverlays(),null!=this._tour&&null!=this._tour.get_currentTourStop()){for(var t=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());t.moveNext();){var i=t.current;i.get_animate()&&this.get_tour().get_currentTourStop().get_keyFramed()?i.set_tweenFactor(this._tour.get_currentTourStop().get_tweenPosition()):this.get_tour().get_currentTourStop().get_keyFramed()||i.set_tweenFactor(this._tour.get_currentTourStop().get_tweenPosition()<.5?0:1),i.draw3D(e,!0)}this.selection.draw3D(e,1),null!=TourEditor.currentEditor&&TourEditor.currentEditor.render(e),Settings.tourSettings=null}},get_tour:function(){return this._tour},set_tour:function(e){return this._tour=e,e},close:function(){null!=this._tour&&(this._tour=null,this.set_focus(null))},clearSelection:function(){this.selection.clearSelection(),OverlayList._updateOverlayListSelection(this.selection),this.set_focus(null)},get_focus:function(){return this.selection.get_focus()},set_focus:function(e){return this.selection.set_focus(e),e},pointToView:function(e){var t=globalRenderContext.height,i=globalRenderContext.width,r=globalRenderContext.width/globalRenderContext.height*1116,n=e.x/i*r-(r-1920)/2,s=e.y/t*1116;return Vector2d.create(n,s)},mouseDown:function(e,t){this._brokeThreshold=!1,this._needUndoFrame=!0;var i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY));if(null==this._tour||null==this._tour.get_currentTourStop())return this._needUndoFrame=!1,!1;if(null!=TourEditor.currentEditor&&TourEditor.currentEditor.mouseDown(e,t))return!0;if(null!=this.get_focus()){if(this.selection.get_multiSelect())for(var r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;if(n.hitTest(i))return this._selectionAction=9,this._mouseDown=!0,this._pointDown=i,this.set_focus(n),t.ctrlKey&&(this._dragCopying=!0),!0}else if(this.get_focus().hitTest(i))return this._selectionAction=9,this._mouseDown=!0,this._pointDown=i,t.ctrlKey&&(this._dragCopying=!0),!0;var s=this.selection.hitTest(i);if(11!==s)return this._selectionAction=s,this._mouseDown=!0,this._pointDown=8===s?i:this.selection.pointToSelectionSpace(i),!0}for(var a=this._tour.get_currentTourStop().get_overlays().length-1;a>=0;a--)if(this._tour.get_currentTourStop().get_overlays()[a].hitTest(i))return this._selectionAction=9,this.set_focus(this._tour.get_currentTourStop().get_overlays()[a]),t.ctrlKey||t.shiftKey?this.selection.addSelection(this.get_focus()):this.selection.setSelection(this.get_focus()),OverlayList._updateOverlayListSelection(this.selection),this._mouseDown=!0,this._pointDown=i,!0;return this.set_focus(null),this.clearSelection(),this._needUndoFrame=!1,!1},mouseUp:function(e,t){return this._brokeThreshold=!1,!(null==TourEditor.currentEditor||!TourEditor.currentEditor.mouseUp(e,t))||(this._contextPoint=Vector2d.create(t.offsetX,t.offsetY),this._mouseDown?(this._mouseDown=!1,2===t.button&&null!=this.get_focus()&&this.showSelectionContextMenu(Vector2d.create(t.offsetX,t.offsetY)),!0):2===t.button&&(null==this.get_focus()&&this._showNoSelectionContextMenu(Vector2d.create(t.offsetX,t.offsetY)),!0))},mouseMove:function(e,t){if(null!=TourEditor.currentEditor&&TourEditor.currentEditor.mouseMove(e,t))return!0;var i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY));if(this._mouseDown&&null!=this.get_focus()){var r,n,s=null,a=Language.getLocalizedText(502,"Edit");if(this._needUndoFrame&&(s=new UndoTourStopChange(Language.getLocalizedText(502,"Edit"),this._tour)),9!==this._selectionAction&&8!==this._selectionAction){var o=this.selection.pointToSelectionSpace(i);r=o.x-this._pointDown.x,n=o.y-this._pointDown.y,this._pointDown=o}else{if(r=i.x-this._pointDown.x,n=i.y-this._pointDown.y,9===this._selectionAction&&!this._brokeThreshold){if(!(Math.abs(r)>3||Math.abs(n)>3))return!0;this._brokeThreshold=!0}this._pointDown=i}if(this._dragCopying)if(this.selection.get_multiSelect()){var l=this.selection.selectionSet;this.clearSelection();for(var h=ss.ss.enumerate(l);h.moveNext();){var c=h.current;(u=this.addOverlay(c)).set_x(c.get_x()),u.set_y(c.get_y()),this.set_focus(u),this.selection.addSelection(this.get_focus())}OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection),this._dragCopying=!1}else{var u;(u=this.addOverlay(this.get_focus())).set_x(this.get_focus().get_x()),u.set_y(this.get_focus().get_y()),this.set_focus(u),this.selection.setSelection(this.get_focus()),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection),this._dragCopying=!1}var d=this.get_focus().get_width()/this.get_focus().get_height(),_=Vector2d.create(this.get_focus().get_x(),this.get_focus().get_y());if(t.ctrlKey)switch(a=Language.getLocalizedText(537,"Resize"),this._selectionAction){case 0:case 6:this.get_focus().set_width(Math.max(2,this.get_focus().get_width()-2*r)),this.get_focus().set_height(Math.max(2,this.get_focus().get_height()-r/d*2));break;case 1:this.get_focus().set_height(Math.max(2,this.get_focus().get_height()-2*n));break;case 2:case 4:this.get_focus().set_width(Math.max(2,this.get_focus().get_width()+2*r)),this.get_focus().set_height(Math.max(2,this.get_focus().get_height()+r/d*2));break;case 3:this.get_focus().set_width(Math.max(2,this.get_focus().get_width()+2*r));break;case 5:this.get_focus().set_height(Math.max(2,this.get_focus().get_height()+2*n));break;case 7:this.get_focus().set_width(Math.max(2,this.get_focus().get_width()-2*r));break;case 8:a=Language.getLocalizedText(538,"Rotate"),this.get_focus().set_rotationAngle(this.get_focus().get_rotationAngle()+r/10);break;case 9:a=Language.getLocalizedText(539,"Drag Copy"),_.x+=r,_.y+=n}else switch(8!==this._selectionAction&&9!==this._selectionAction&&(r>this.get_focus().get_width()-2&&(r=0),n>this.get_focus().get_height()-2&&(n=0)),a=Language.getLocalizedText(537,"Resize"),this._selectionAction){case 0:this.get_focus().set_width(this.get_focus().get_width()-r),this.get_focus().set_height(this.get_focus().get_height()-r/d),_.x+=r/2,_.y+=r/d/2;break;case 1:this.get_focus().set_height(this.get_focus().get_height()-n),_.y+=n/2;break;case 2:this.get_focus().set_width(this.get_focus().get_width()+r),this.get_focus().set_height(this.get_focus().get_height()+r/d),_.x+=r/2,_.y-=r/d/2;break;case 3:this.get_focus().set_width(this.get_focus().get_width()+r),_.x+=r/2;break;case 4:this.get_focus().set_width(this.get_focus().get_width()+r),this.get_focus().set_height(this.get_focus().get_height()+r/d),_.x+=r/2,_.y+=r/d/2;break;case 5:this.get_focus().set_height(this.get_focus().get_height()+n),_.y+=n/2;break;case 6:this.get_focus().set_width(this.get_focus().get_width()-r),this.get_focus().set_height(this.get_focus().get_height()-r/d),_.x+=r/2,_.y-=r/d/2;break;case 7:this.get_focus().set_width(this.get_focus().get_width()-r),_.x+=r/2;break;case 8:a=Language.getLocalizedText(538,"Rotate"),this.get_focus().set_rotationAngle(this.get_focus().get_rotationAngle()+r);break;case 9:a=Language.getLocalizedText(540,"Move"),_.x+=r,_.y+=n}if(9!==this._selectionAction&&8!==this._selectionAction&&(_=this.selection.pointToScreenSpace(_)),this.selection.get_multiSelect())for(var g=ss.ss.enumerate(this.selection.selectionSet);g.moveNext();)(c=g.current).set_x(c.get_x()+r),c.set_y(c.get_y()+n);else this.get_focus().set_x(_.x),this.get_focus().set_y(_.y);this._needUndoFrame&&(this._needUndoFrame=!1,s.set_actionText(a),Undo.push(s))}else if(null!=this.get_focus()){if(this.get_focus().hitTest(i))return Cursor.set_current(Cursors.get_sizeAll()),!1;var f=this.selection.hitTest(i);if(11===f)return!1;switch(f){case 0:case 4:Cursor.set_current(Cursors.get_sizeNWSE());break;case 1:case 5:Cursor.set_current(Cursors.get_sizeNS());break;case 2:case 6:Cursor.set_current(Cursors.get_sizeNESW());break;case 3:case 7:case 8:Cursor.set_current(Cursors.get_sizeWE())}}return!1},_showNoSelectionContextMenu:function(e){if(null!=this._contextMenu&&this._contextMenu._dispose(),null!=this._tour.get_currentTourStop()){this._contextMenu=new ContextMenuStrip;var t=ToolStripMenuItem.create(Language.getLocalizedText(425,"Paste"));t.enabled="WorldWideTelescope.Overlay"===this.clipboardType,t.click=ss.ss.bind("_pasteMenu_Click",this),this._contextMenu.items.push(t),this._contextMenu._show(e)}},_addOpenRectangle_Click:function(e,t){this.addShape("",6)},_addStar_Click:function(e,t){this.addShape("",2)},_insertShapeCircle_Click:function(e,t){this.addShape("",0)},_insertShapeRectangle_Click:function(e,t){this.addShape("",1)},_insertShapeLine_Click:function(e,t){this.addShape("",5)},_insertDonut_Click:function(e,t){this.addShape("",3)},_addArrow_Click:function(e,t){this.addShape("",4)},showSelectionContextMenu:function(e){if(null!=this.get_focus()){var t=this.selection.get_multiSelect();null!=this._contextMenu&&this._contextMenu._dispose(),this._contextMenu=new ContextMenuStrip;var i=ToolStripMenuItem.create(Language.getLocalizedText(427,"Cut")),r=ToolStripMenuItem.create(Language.getLocalizedText(428,"Copy")),n=ToolStripMenuItem.create(Language.getLocalizedText(425,"Paste")),s=ToolStripMenuItem.create(Language.getLocalizedText(167,"Delete")),a=new ToolStripSeparator,o=new ToolStripSeparator,l=new ToolStripSeparator,h=ToolStripMenuItem.create(Language.getLocalizedText(452,"Bring to Front")),c=ToolStripMenuItem.create(Language.getLocalizedText(453,"Send to Back")),u=ToolStripMenuItem.create(Language.getLocalizedText(454,"Bring Forward")),d=ToolStripMenuItem.create(Language.getLocalizedText(455,"Send Backward")),_=ToolStripMenuItem.create(Language.getLocalizedText(20,"Properties")),g=ToolStripMenuItem.create(Language.getLocalizedText(502,"Edit")),f=ToolStripMenuItem.create(Language.getLocalizedText(587,"Hyperlink")),m=this.get_focus().get_linkID();switch(this.get_focus().get_linkID()){case"":case null:m=" ("+Language.getLocalizedText(609,"No Link")+")";break;case"Next":m=" ("+Language.getLocalizedText(610,"Next Slide")+")";break;case"Return":m=" ("+Language.getLocalizedText(602,"Return to Caller")+")";break;default:var p=this.get_tour().getTourStopIndexByID(this.get_focus().get_linkID());p>-1&&(m=ss.ss.emptyString(this._tour.get_tourStops()[p].get_description())?ss.ss.format(" ("+Language.getLocalizedText(1340,"Slide")+" {0})",p):" ("+this._tour.get_tourStops()[p].get_description()+")")}var C=ToolStripMenuItem.create(Language.getLocalizedText(588,"Animate")),S=ToolStripMenuItem.create(Language.getLocalizedText(589,"Link to Slide")+m),w=ToolStripMenuItem.create(Language.getLocalizedText(458,"Color/Opacity")),T=ToolStripMenuItem.create(Language.getLocalizedText(630,"Flipbook Properties")),y=ToolStripMenuItem.create(Language.getLocalizedText(1029,"Animation Tween Type")),b=ToolStripMenuItem.create(Language.getLocalizedText(1030,"Linear")),v=ToolStripMenuItem.create(Language.getLocalizedText(1031,"Ease In/Out")),M=ToolStripMenuItem.create(Language.getLocalizedText(1032,"Ease In")),x=ToolStripMenuItem.create(Language.getLocalizedText(1033,"Ease Out")),L=ToolStripMenuItem.create(Language.getLocalizedText(1034,"Exponential")),A=ToolStripMenuItem.create(Language.getLocalizedText(1035,"Slide Default")),V=ToolStripMenuItem.create(Language.getLocalizedText(790,"Align")),P=ToolStripMenuItem.create(Language.getLocalizedText(1333,"Top")),E=ToolStripMenuItem.create(Language.getLocalizedText(1334,"Bottom")),I=ToolStripMenuItem.create(Language.getLocalizedText(1335,"Left")),R=ToolStripMenuItem.create(Language.getLocalizedText(1336,"Right")),D=ToolStripMenuItem.create(Language.getLocalizedText(1337,"Horizontal")),k=ToolStripMenuItem.create(Language.getLocalizedText(1338,"Vertical")),F=ToolStripMenuItem.create(Language.getLocalizedText(1339,"Centered"));switch(V.dropDownItems.push(P),V.dropDownItems.push(E),V.dropDownItems.push(I),V.dropDownItems.push(R),V.dropDownItems.push(D),V.dropDownItems.push(k),V.dropDownItems.push(F),b.tag=0,v.tag=3,M.tag=1,x.tag=2,L.tag=4,A.tag=5,b.click=ss.ss.bind("_interpolation_Click",this),v.click=ss.ss.bind("_interpolation_Click",this),M.click=ss.ss.bind("_interpolation_Click",this),x.click=ss.ss.bind("_interpolation_Click",this),L.click=ss.ss.bind("_interpolation_Click",this),A.click=ss.ss.bind("_interpolation_Click",this),this.get_focus().get_interpolationType()){case 0:b.checked=!0;break;case 1:M.checked=!0;break;case 2:x.checked=!0;break;case 3:v.checked=!0;break;case 4:L.checked=!0;break;case 5:A.checked=!0}y.dropDownItems.push(A),y.dropDownItems.push(b),y.dropDownItems.push(v),y.dropDownItems.push(M),y.dropDownItems.push(x),y.dropDownItems.push(L),i.click=ss.ss.bind("_cutMenu_Click",this),r.click=ss.ss.bind("_copyMenu_Click",this),s.click=ss.ss.bind("_deleteMenu_Click",this),h.click=ss.ss.bind("_bringToFront_Click",this),c.click=ss.ss.bind("_sendToBack_Click",this),d.click=ss.ss.bind("_sendBackward_Click",this),u.click=ss.ss.bind("_bringForward_Click",this),_.click=ss.ss.bind("_properties_Click",this),g.click=ss.ss.bind("_editText_Click",this),f.click=ss.ss.bind("_url_Click",this),w.click=ss.ss.bind("_pickColor_Click",this),n.click=ss.ss.bind("_pasteMenu_Click",this),C.click=ss.ss.bind("_animateMenu_Click",this),T.click=ss.ss.bind("_flipbookProperties_Click",this),S.click=ss.ss.bind("_linkID_Click",this),P.click=ss.ss.bind("_alignTop_Click",this),E.click=ss.ss.bind("_alignBottom_Click",this),I.click=ss.ss.bind("_alignLeft_Click",this),R.click=ss.ss.bind("_alignRight_Click",this),D.click=ss.ss.bind("_alignHorizon_Click",this),k.click=ss.ss.bind("_alignVertical_Click",this),F.click=ss.ss.bind("_alignCenter_Click",this),this._contextMenu.items.push(i),this._contextMenu.items.push(r),this._contextMenu.items.push(n),this._contextMenu.items.push(s),this._contextMenu.items.push(a),this._contextMenu.items.push(h),this._contextMenu.items.push(c),this._contextMenu.items.push(u),this._contextMenu.items.push(d),this._contextMenu.items.push(V),this._contextMenu.items.push(o),n.enabled=!1,this._contextMenu.items.push(w),this._contextMenu.items.push(f),this._contextMenu.items.push(S),this._contextMenu.items.push(C),this._contextMenu.items.push(l),this._contextMenu.items.push(T),C.checked=this.get_focus().get_animate(),this._contextMenu.items.push(y),y.enabled=this.get_focus().get_animate(),T.visible=ss.ss.canCast(this.get_focus(),FlipbookOverlay),l.visible=ss.ss.canCast(this.get_focus(),FlipbookOverlay),t?(f.visible=!1,S.visible=!1,_.visible=!1,T.visible=!1,u.visible=!1,d.visible=!1):V.visible=!1,this._contextMenu.items.push(_),null!=this.get_focus()&&ss.ss.typeOf(this.get_focus())===TextOverlay&&this._contextMenu.items.push(g),this._contextMenu._show(e)}},_editText_Click:function(e,t){null!=this.get_focus()&&ss.ss.typeOf(this.get_focus())===TextOverlay&&this._editText()},_alignVertical_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1036,"Vertical Align"),this._tour));for(var i=this.get_focus().get_x(),r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();)r.current.set_x(i)}},_alignHorizon_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1037,"Horizontal Align"),this._tour));for(var i=this.get_focus().get_y(),r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();)r.current.set_y(i)}},_alignCenter_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1038,"Align Centers"),this._tour));for(var i=this.get_focus().get_y(),r=this.get_focus().get_x(),n=ss.ss.enumerate(this.selection.selectionSet);n.moveNext();){var s=n.current;s.set_y(i),s.set_x(r)}}},_alignRight_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1040,"Align Right"),this._tour));for(var i=this.get_focus().get_x()+this.get_focus().get_width()/2,r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;n.set_x(i-n.get_width()/2)}}},_alignLeft_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1041,"Align Left"),this._tour));for(var i=this.get_focus().get_x()-this.get_focus().get_width()/2,r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;n.set_x(i+n.get_width()/2)}}},_alignBottom_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1042,"Align Bottoms"),this._tour));for(var i=this.get_focus().get_y()+this.get_focus().get_height()/2,r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;n.set_y(i-n.get_height()/2)}}},_alignTop_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(1039,"Align Tops"),this._tour));for(var i=this.get_focus().get_y()-this.get_focus().get_height()/2,r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;n.set_y(i+n.get_height()/2)}}},_interpolation_Click:function(e,t){var i=e;if(null!=this.get_focus())for(var r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();)r.current.set_interpolationType(i.tag)},_linkSlideChosen:function(){this.selectDialog.get_OK()&&this.get_focus().set_linkID(this.selectDialog.get_id())},_linkID_Click:function(e,t){this.selectDialog=new SelectLink(this.get_focus().get_linkID()),this.nextSlideCallback(this.selectDialog,ss.ss.bind("_linkSlideChosen",this))},_flipbookProperties_Click:function(e,t){},_animateMenu_Click:function(e,t){if(null!=this.get_focus()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(588,"Animate"),this._tour));for(var i=!this.get_focus().get_animate(),r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();)r.current.set_animate(i)}},_url_Click:function(e,t){var i=this;if(null!=this.get_focus()){var r=new SimpleInput(Language.getLocalizedText(541,"Edit Hyperlink"),Language.getLocalizedText(542,"Url"),this.get_focus().get_url(),2048);r.show(Cursor.get_position(),(function(){Undo.push(new UndoTourStopChange(Language.getLocalizedText(541,"Edit Hyperlink"),i._tour)),i.get_focus().set_url(r.text)}))}},_pickColor_Click:function(e,t){var i=this,r=new ColorPicker;r.color=this.get_focus().get_color(),r.callBack=function(){Undo.push(new UndoTourStopChange(Language.getLocalizedText(543,"Edit Color"),i._tour));for(var e=ss.ss.enumerate(i.selection.selectionSet);e.moveNext();)e.current.set_color(r.color)},r.show(t)},_volume_Click:function(e,t){var i=new PopupVolume;i.volume=this.get_focus().get_volume(),i.showDialog(),this.get_focus().set_volume(i.volume)},_deleteMenu_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(167,"Delete"),this._tour));for(var i=ss.ss.enumerate(this.selection.selectionSet);i.moveNext();){var r=i.current;this._tour.get_currentTourStop().removeOverlay(r)}this.set_focus(null),this.clearSelection(),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_properties_Click:function(e,t){null==this._tour||this._tour.get_currentTourStop(),Undo.push(new UndoTourStopChange(Language.getLocalizedText(549,"Properties Edit"),this._tour));var i=new OverlayProperties;i.overlay=this.get_focus(),i.showDialog(),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)},_bringForward_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(454,"Bring Forward"),this._tour));for(var i=ss.ss.enumerate(this._getSortedSelection(!1));i.moveNext();){var r=i.current;this._tour.get_currentTourStop().bringForward(r)}OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_sendBackward_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(455,"Send Backward"),this._tour));for(var i=ss.ss.enumerate(this._getSortedSelection(!0));i.moveNext();){var r=i.current;this._tour.get_currentTourStop().sendBackward(r)}OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_sendToBack_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(453,"Send to Back"),this._tour));for(var i=ss.ss.enumerate(this._getSortedSelection(!0));i.moveNext();){var r=i.current;this._tour.get_currentTourStop().sendToBack(r)}OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_bringToFront_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(452,"Bring to Front"),this._tour));for(var i=ss.ss.enumerate(this._getSortedSelection(!1));i.moveNext();){var r=i.current;this._tour.get_currentTourStop().bringToFront(r)}OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_getSortedSelection:function(e){for(var t=[],i=ss.ss.enumerate(this.selection.selectionSet);i.moveNext();){var r=i.current;t.push(r)}return e?t.sort((function(e,t){return-Util.compare(e.get_zOrder(),t.get_zOrder())})):t.sort((function(e,t){return Util.compare(e.get_zOrder(),t.get_zOrder())})),t},_copyMenu_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){var i=new XmlTextWriter;i._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),i._writeStartElement("Overlays");for(var r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();)r.current.saveToXml(i,!0);i._writeEndElement(),this.clipboardData=i.body,this.clipboardType="WorldWideTelescope.Overlay"}},_cutMenu_Click:function(e,t){if(null!=this._tour&&null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(427,"Cut"),this._tour)),this._copyMenu_Click(e,t);for(var i=ss.ss.enumerate(this.selection.selectionSet);i.moveNext();){var r=i.current;this._tour.get_currentTourStop().removeOverlay(r)}this.set_focus(null),this.clearSelection(),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}},_pasteMenu_Click:function(e,t){if(Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(544,"Paste Object"),this._tour)),"WorldWideTelescope.Overlay"===this.clipboardType){var i=(new DOMParser).parseFromString(this.clipboardData,"text/xml");this.clearSelection();for(var r=Util.selectSingleNode(i,"Overlays"),n=ss.ss.enumerate(r.childNodes);n.moveNext();){var s=n.current;if("Overlay"===s.nodeName){for(var a=Overlay._fromXml(this._tour.get_currentTourStop(),s),o=!1,l=0,h=0,c=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());c.moveNext();){var u=c.current;u.id===a.id&&ss.ss.typeOf(u)===ss.ss.typeOf(a)&&(o=!0,(h<u.get_y()||l<u.get_x())&&(l=u.get_x(),h=u.get_y()))}o&&(a.set_x(l+20),a.set_y(h+20)),this._tour.get_currentTourStop().addOverlay(a),this.set_focus(a),this.selection.addSelection(this.get_focus()),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection)}}}},mouseClick:function(e,t){return!(null==TourEditor.currentEditor||!TourEditor.currentEditor.mouseClick(e,t))},click:function(e,t){return!(null==TourEditor.currentEditor||!TourEditor.currentEditor.click(e,t))},mouseDoubleClick:function(e,t){return!(null==TourEditor.currentEditor||!TourEditor.currentEditor.mouseDoubleClick(e,t))||null==this.get_focus()||ss.ss.typeOf(this.get_focus())!==TextOverlay||(this._editText(),!0)},_doneEditing:function(){Undo.push(new UndoTourStopChange(Language.getLocalizedText(545,"Text Edit"),this._tour)),this.get_focus().set_width(0),this.get_focus().set_height(0),this.get_focus().set_color(this.get_focus().textObject.foregroundColor),this.get_focus().cleanUp()},_editText:function(){var e=this.get_focus().textObject;this.editTextCallback(e,ss.ss.bind("_doneEditing",this))},keyDown:function(e,t){if(null!=TourEditor.currentEditor&&TourEditor.currentEditor.keyDown(e,t))return!0;var i=1;switch(t.ctrlKey&&(i=10),t.keyCode){case 65:t.ctrlKey&&(this.clearSelection(),this.selection.addSelectionRange(this._tour.get_currentTourStop().get_overlays()),OverlayList._updateOverlayListSelection(this.selection),this._tour.get_currentTourStop().get_overlays().length>0&&this.set_focus(this._tour.get_currentTourStop().get_overlays()[0]));break;case 90:t.ctrlKey&&(Undo.peekAction()?TourEdit._undoStep():UiTools._beep());break;case 89:t.ctrlKey&&(Undo.peekRedoAction()?TourEdit._redoStep():UiTools._beep());break;case 67:t.ctrlKey&&this._copyMenu_Click(this,new ss.ss.EventArgs);break;case 86:t.ctrlKey&&this._pasteMenu_Click(this,new ss.ss.EventArgs);break;case 88:t.ctrlKey&&this._cutMenu_Click(this,new ss.ss.EventArgs);break;case 46:return this._deleteMenu_Click(null,null),!0;case 9:return t.shiftKey?this._selectLast():this._selectNext(),!0;case 37:if(null!=this.get_focus()){for(var r=ss.ss.enumerate(this.selection.selectionSet);r.moveNext();){var n=r.current;if(t.shiftKey)if(t.altKey)n.get_width()>i&&(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),n.set_width(n.get_width()-i));else{var s=n.get_width()/n.get_height();n.get_width()>i&&n.get_height()>i*s&&(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),n.set_width(n.get_width()-i),n.set_height(n.get_height()-i*s))}else t.altKey?(Undo.push(new UndoTourStopChange(Language.getLocalizedText(538,"Rotate"),this._tour)),n.set_rotationAngle(n.get_rotationAngle()-i)):(Undo.push(new UndoTourStopChange(Language.getLocalizedText(540,"Move"),this._tour)),n.set_x(n.get_x()-i))}return!0}break;case 39:if(null!=this.get_focus()){for(var a=ss.ss.enumerate(this.selection.selectionSet);a.moveNext();)n=a.current,t.shiftKey?(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),t.altKey?n.set_width(n.get_width()+i):(s=n.get_width()/n.get_height(),n.set_width(n.get_width()+i),n.set_height(n.get_height()+i*s))):t.altKey?(Undo.push(new UndoTourStopChange(Language.getLocalizedText(538,"Rotate"),this._tour)),n.set_rotationAngle(n.get_rotationAngle()+i)):(Undo.push(new UndoTourStopChange(Language.getLocalizedText(540,"Move"),this._tour)),n.set_x(n.get_x()+i));return!0}break;case 38:if(null!=this.get_focus()){for(var o=ss.ss.enumerate(this.selection.selectionSet);o.moveNext();)n=o.current,t.shiftKey?(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),t.altKey?n.set_height(n.get_height()+i):(s=n.get_width()/n.get_height(),n.set_width(n.get_width()+i),n.set_height(n.get_height()+i*s))):t.altKey||(Undo.push(new UndoTourStopChange(Language.getLocalizedText(540,"Move"),this._tour)),n.set_y(n.get_y()-i));return!0}break;case 40:if(null!=this.get_focus()){for(var l=ss.ss.enumerate(this.selection.selectionSet);l.moveNext();)n=l.current,t.shiftKey?t.altKey?n.get_height()>i&&(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),n.set_height(n.get_height()-i)):(s=n.get_width()/n.get_height(),n.get_width()>i&&n.get_height()>i*s&&(Undo.push(new UndoTourStopChange(Language.getLocalizedText(537,"Resize"),this._tour)),n.set_width(n.get_width()-i),n.set_height(n.get_height()-i*s))):t.altKey||(Undo.push(new UndoTourStopChange(Language.getLocalizedText(540,"Move"),this._tour)),n.set_y(n.get_y()+i));return!0}break;case 34:if(t.altKey)return this._tour.get_currentTourstopIndex()<this._tour.get_tourStops().length-1&&(this._tour.set_currentTourstopIndex(this._tour.get_currentTourstopIndex()+1),TourEdit._selectCurrent(),TourEdit._ensureSelectedVisible()),!0;break;case 33:if(t.altKey)return this._tour.get_currentTourstopIndex()>0&&(this._tour.set_currentTourstopIndex(this._tour.get_currentTourstopIndex()-1),TourEdit._selectCurrent(),TourEdit._ensureSelectedVisible()),!0}return!1},_selectNext:function(){null!=this._tour&&null!=this._tour.get_currentTourStop()&&(this.set_focus(this._tour.get_currentTourStop().getNextOverlay(this.get_focus())),this.selection.setSelection(this.get_focus()),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection))},_selectLast:function(){null!=this._tour&&null!=this._tour.get_currentTourStop()&&(this.set_focus(this._tour.get_currentTourStop().getPerviousOverlay(this.get_focus())),this.selection.setSelection(this.get_focus()),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection))},keyUp:function(e,t){return!(null==TourEditor.currentEditor||!TourEditor.currentEditor.keyUp(e,t))},addPicture:function(e){if(null==this._tour||null==this._tour.get_currentTourStop())return!1;Undo.push(new UndoTourStopChange(Language.getLocalizedText(546,"Insert Picture"),this._tour));var t=BitmapOverlay.create(this._tour.get_currentTourStop(),e);return t.set_x(960),t.set_y(600),this._tour.get_currentTourStop().addOverlay(t),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection),!0},addFlipbook:function(e){return!1},addAudio:function(e,t){if(null==this._tour||null==this._tour.get_currentTourStop())return!1;var i=AudioOverlay.create(this._tour.get_currentTourStop(),e);return i.set_x(900),i.set_y(600),t?this._tour.get_currentTourStop().set_musicTrack(i):this._tour.get_currentTourStop().set_voiceTrack(i),!0},addVideo:function(e){return!0},addText:function(e,t){if(null==this._tour||null==this._tour.get_currentTourStop())return!1;var i=TextOverlay.create(t);return i.set_color(t.foregroundColor),i.set_x(960),i.set_y(600),Undo.push(new UndoTourStopChange(Language.getLocalizedText(547,"Insert Text"),this._tour)),this._tour.get_currentTourStop().addOverlay(i),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection),!0},addOverlay:function(e){if(null==this._tour||null==this._tour.get_currentTourStop())return null;if(ss.ss.typeOf(e)===ShapeOverlay){var t=e;if(null!=t){var i=ShapeOverlay._create(this._tour.get_currentTourStop(),t.get_shapeType());return i.set_width(t.get_width()),i.set_height(t.get_height()),i.set_x(this._contextPoint.x),i.set_y(this._contextPoint.y),i.set_color(t.get_color()),i.set_rotationAngle(t.get_rotationAngle()),this._tour.get_currentTourStop().addOverlay(i),i}}else if(ss.ss.typeOf(e)===TextOverlay){var r=e;if(null!=r){var n=TextOverlay.create(r.textObject);return n.set_x(this._contextPoint.x),n.set_y(this._contextPoint.y),n.set_color(r.get_color()),this._tour.get_currentTourStop().addOverlay(n),n}}else if(ss.ss.typeOf(e)===BitmapOverlay){if(null!=e)return(s=e.copy(this._tour.get_currentTourStop())).set_x(this._contextPoint.x),s.set_y(this._contextPoint.y),this._tour.get_currentTourStop().addOverlay(s),s}else if(ss.ss.typeOf(e)===FlipbookOverlay){var s;if(null!=e)return(s=e.copy(this._tour.get_currentTourStop())).set_x(this._contextPoint.x),s.set_y(this._contextPoint.y),this._tour.get_currentTourStop().addOverlay(s),s}return null},addShape:function(e,t){if(null==this._tour||null==this._tour.get_currentTourStop())return!1;Undo.push(new UndoTourStopChange(Language.getLocalizedText(548,"Insert Shape"),this._tour));var i=ShapeOverlay._create(this._tour.get_currentTourStop(),t);return i.set_width(200),i.set_height(200),4===t&&i.set_height(i.get_height()/2),5===t&&i.set_height(12),i.set_x(960),i.set_y(600),this._tour.get_currentTourStop().addOverlay(i),this.set_focus(i),this.selection.setSelection(this.get_focus()),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.selection),!0},getCurrentColor:function(){return null==this._tour||null==this._tour.get_currentTourStop()?this._defaultColor:null!=this.get_focus()?this.get_focus().get_color():this._defaultColor},setCurrentColor:function(e){this._defaultColor=e,null!=this._tour&&null!=this._tour.get_currentTourStop()&&null!=this.get_focus()&&this.get_focus().set_color(e)},dispose:function(){null!=this._contextMenu&&(this._contextMenu._dispose(),this._contextMenu=null)},hover:function(e){return null!=TourEditor.currentEditor&&TourEditor.currentEditor.hover(e),!0}};function OverlayList(){}registerType("TourEditor",[TourEditor,TourEditor$,null,IUiController]),OverlayList._updateOverlayList=function(e,t){},OverlayList._updateOverlayListSelection=function(e){};var OverlayList$={};function TourEdit(){}registerType("OverlayList",[OverlayList,OverlayList$,null]),TourEdit._ensureSelectedVisible=function(){},TourEdit._selectCurrent=function(){},TourEdit._undoStep=function(){Undo.peekAction()&&Undo.stepBack()},TourEdit._redoStep=function(){Undo.peekRedoAction()&&Undo.stepForward()};var TourEdit$={};function SoundEditor(){this.target=null}registerType("TourEdit",[TourEdit,TourEdit$,null]);var SoundEditor$={};function TourStopList(){this.tour=null,this.showAddButton=!1,this.selectedItems=null,this.selectedItem=-1,this.refreshCallback=null,this.multipleSelection=!1,this.hitType=!1}registerType("SoundEditor",[SoundEditor,SoundEditor$,null]);var TourStopList$={selectAll:function(){this.selectedItems={};for(var e=0;e<this.tour.get_tourStops().length;e++)this.selectedItems[e]=this.tour.get_tourStops()[e]},refresh:function(){null!=this.refreshCallback&&this.refreshCallback()},findItem:function(e){return-1},ensureSelectedVisible:function(){},ensureAddVisible:function(){}};function TimeLine(){}registerType("TourStopList",[TourStopList,TourStopList$,null]),TimeLine.refreshUi=function(){};var TimeLine$={};function TourPlayer(){this._overlayBlend=BlendState.create(!1,1e3),this._tour=null,this._onTarget=!1,this._currentMasterSlide=null,this._callStack=new ss.ss.Stack,this._leaveSettingsWhenStopped=!1}registerType("TimeLine",[TimeLine,TimeLine$,null]),TourPlayer._playing=!1,TourPlayer._switchedToFullScreen=!1,TourPlayer.noRestoreUIOnStop=!1,TourPlayer.get_playing=function(){return TourPlayer._playing},TourPlayer.set_playing=function(e){return TourPlayer._playing=e,e},TourPlayer.add_tourEnded=function(e){TourPlayer.__tourEnded=ss.ss.bindAdd(TourPlayer.__tourEnded,e)},TourPlayer.remove_tourEnded=function(e){TourPlayer.__tourEnded=ss.ss.bindSub(TourPlayer.__tourEnded,e)};var TourPlayer$={render:function(e){if(null!=this._tour&&null!=this._tour.get_currentTourStop()&&TourPlayer._playing){if(e.save(),this.updateSlideStates(),!this._onTarget&&(this._slideStartTime=ss.ss.now(),e.onTarget(this.get_tour().get_currentTourStop().get_target()))){this._onTarget=!0,this._overlayBlend.set_state(!this.get_tour().get_currentTourStop().get_fadeInOverlays()),this._overlayBlend.set_targetState(!0),null!=this._tour.get_currentTourStop().get_musicTrack()&&(this._tour.get_currentTourStop().get_musicTrack().seek(0),this._tour.get_currentTourStop().get_musicTrack().play()),null!=this._tour.get_currentTourStop().get_voiceTrack()&&(this._tour.get_currentTourStop().get_voiceTrack().seek(0),this._tour.get_currentTourStop().get_voiceTrack().play());for(var t="",i=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());i.moveNext();){if("caption"===(h=i.current).get_name().toLowerCase()){var r=ss.ss.safeCast(h,TextOverlay);null!=r&&(t=r.textObject.text)}h.play()}setManagerVisibleLayerList(this._tour.get_currentTourStop().layers),null!=this._tour.get_currentTourStop().get_endTarget()&&-1!==this._tour.get_currentTourStop().get_endTarget().get_zoomLevel()&&(this._tour.get_currentTourStop().get_target().get_type(),e.viewMover=new ViewMoverKenBurnsStyle(this._tour.get_currentTourStop().get_target().get_camParams(),this._tour.get_currentTourStop().get_endTarget().get_camParams(),this._tour.get_currentTourStop().get_duration()/1e3,this._tour.get_currentTourStop().get_startTime(),this._tour.get_currentTourStop().get_endTime(),this._tour.get_currentTourStop().get_interpolationType())),Settings.tourSettings=this._tour.get_currentTourStop(),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1),globalScriptInterface._fireSlideChanged(t)}if(null!=e.gl){if(e.setupMatricesOverlays(),null!=this._currentMasterSlide)for(var n=ss.ss.enumerate(this._currentMasterSlide.get_overlays());n.moveNext();)(h=n.current).set_tweenFactor(1),h.draw3D(e,!1);if(this._onTarget)for(var s=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());s.moveNext();)("caption"!==(h=s.current).get_name().toLowerCase()||globalScriptInterface.get_showCaptions())&&(h.set_tweenFactor(CameraParameters.easeCurve(this._tour.get_currentTourStop().get_tweenPosition(),5===h.get_interpolationType()?this._tour.get_currentTourStop().get_interpolationType():h.get_interpolationType())),h.draw3D(e,!1));e.restore()}else{e.device.scale(e.height/1116,e.height/1116);var a=e.width/e.height;if(e.device.translate(-(1920-1116*a)/2,0),null!=this._currentMasterSlide)for(var o=ss.ss.enumerate(this._currentMasterSlide.get_overlays());o.moveNext();)(h=o.current).set_tweenFactor(1),h.draw3D(e,!1);if(this._onTarget)for(var l=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());l.moveNext();){var h;("caption"!==(h=l.current).get_name().toLowerCase()||globalScriptInterface.get_showCaptions())&&(h.set_tweenFactor(CameraParameters.easeCurve(this._tour.get_currentTourStop().get_tweenPosition(),5===h.get_interpolationType()?this._tour.get_currentTourStop().get_interpolationType():h.get_interpolationType())),h.draw3D(e,!1))}e.restore()}}},get_tour:function(){return this._tour},set_tour:function(e){return this._tour=e,e},nextSlide:function(){if(null!=this._tour.get_currentTourStop())if(this._tour.get_currentTourStop().get_masterSlide())this._currentMasterSlide=this._tour.get_currentTourStop();else{null!=this._tour.get_currentTourStop().get_musicTrack()&&this._tour.get_currentTourStop().get_musicTrack().stop(),null!=this._tour.get_currentTourStop().get_voiceTrack()&&this._tour.get_currentTourStop().get_voiceTrack().stop();for(var e=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());e.moveNext();)e.current.stop()}if(this._tour.get_currentTourstopIndex()<this._tour.get_tourStops().length-1||this._tour.get_currentTourStop().get_isLinked()){if(null!=this._tour.get_currentTourStop().get_endTarget()&&(globalWWTControl.gotoTargetFull(!1,!0,this._tour.get_currentTourStop().get_endTarget().get_camParams(),this._tour.get_currentTourStop().get_target().get_studyImageset(),this._tour.get_currentTourStop().get_target().get_backgroundImageset()),globalWWTControl.set__mover(null)),this._onTarget=!1,this._tour.get_currentTourStop().get_isLinked())try{"Return"===this._tour.get_currentTourStop().get_nextSlide()?this._callStack.count>0?this.playFromTourstop(this._tour.get_tourStops()[this._callStack.pop()]):this._tour.set_currentTourstopIndex(this._tour.get_tourStops().length-1):this.playFromTourstop(this._tour.get_tourStops()[this._tour.getTourStopIndexByID(this._tour.get_currentTourStop().get_nextSlide())])}catch(e){this._tour.get_currentTourstopIndex()<this._tour.get_tourStops().length-1&&this._tour.set_currentTourstopIndex(this._tour.get_currentTourstopIndex()+1)}else this._tour.set_currentTourstopIndex(this._tour.get_currentTourstopIndex()+1);null!=this._currentMasterSlide&&this._tour.get_currentTourStop().get_masterSlide()&&this._stopCurrentMaster();var t=!1;switch(this._tour.get_currentTourStop().get__transition()){case 0:default:break;case 1:case 2:case 3:case 5:case 4:t=!0}globalWWTControl.gotoTarget(this._tour.get_currentTourStop().get_target(),!1,t,!1),this._slideStartTime=ss.ss.now(),Settings.tourSettings=this._tour.get_currentTourStop(),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1)}else this._stopCurrentMaster(),TourPlayer._playing=!1,Settings.get_current().autoRepeatTour?(this._tour.set_currentTourstopIndex(-1),this.play()):(globalWWTControl._freezeView(),null!=TourPlayer.__tourEnded&&TourPlayer.__tourEnded(this,new ss.ss.EventArgs),globalWWTControl._hideUI(!1),globalScriptInterface._fireTourEnded())},_stopCurrentMaster:function(){if(null!=this._currentMasterSlide){null!=this._currentMasterSlide.get_musicTrack()&&this._currentMasterSlide.get_musicTrack().stop(),null!=this._currentMasterSlide.get_voiceTrack()&&this._currentMasterSlide.get_voiceTrack().stop();for(var e=ss.ss.enumerate(this._currentMasterSlide.get_overlays());e.moveNext();)e.current.stop();this._currentMasterSlide=null}},get_leaveSettingsWhenStopped:function(){return this._leaveSettingsWhenStopped},set_leaveSettingsWhenStopped:function(e){return this._leaveSettingsWhenStopped=e,e},play:function(){if(null!=this._tour){if(TourPlayer._playing?this.stop(!0):TourPlayer._playing=!0,globalWWTControl._hideUI(!0),TourPlayer._playing=!0,this._tour.get_tourStops().length>0){this._onTarget=!1,-1===this._tour.get_currentTourstopIndex()&&this._tour.set_currentTourStop(this._tour.get_tourStops()[0]);for(var e=ss.ss.enumerate(this._tour.get_tourStops());e.moveNext();){var t=e.current;null!=t.get_musicTrack()&&t.get_musicTrack().prepMultimedia(),null!=t.get_voiceTrack()&&t.get_voiceTrack().prepMultimedia();for(var i=ss.ss.enumerate(t.get_overlays());i.moveNext();)i.current.prepMultimedia()}this._tour.get_currentTourstopIndex()>0&&this._playMasterForCurrent(),globalWWTControl.gotoTarget(this._tour.get_currentTourStop().get_target(),!1,!0,!1)}this._slideStartTime=ss.ss.now(),TourPlayer._playing=!0}},_playMasterForCurrent:function(){if(!this._tour.get_currentTourStop().get_masterSlide()){var e=this._tour.elapsedTimeSinceLastMaster(this._tour.get_currentTourstopIndex());if(null!=e){var t=e.duration;this._currentMasterSlide=e.master,null!=this._currentMasterSlide.get_musicTrack()&&(this._currentMasterSlide.get_musicTrack().seek(t),this._currentMasterSlide.get_musicTrack().play()),null!=this._currentMasterSlide.get_voiceTrack()&&(this._currentMasterSlide.get_voiceTrack().seek(t),this._currentMasterSlide.get_voiceTrack().play());for(var i=ss.ss.enumerate(this._currentMasterSlide.get_overlays());i.moveNext();){var r=i.current;r.seek(t),r.play()}}}},stop:function(e){if(TourPlayer._switchedToFullScreen,this._leaveSettingsWhenStopped||(Settings.tourSettings=null),TourPlayer._playing=!1,null!=this._tour.get_currentTourStop()){null!=this._tour.get_currentTourStop().get_musicTrack()&&this._tour.get_currentTourStop().get_musicTrack().stop(),null!=this._tour.get_currentTourStop().get_voiceTrack()&&this._tour.get_currentTourStop().get_voiceTrack().stop();for(var t=ss.ss.enumerate(this._tour.get_currentTourStop().get_overlays());t.moveNext();)t.current.stop()}if(null!=this._currentMasterSlide){null!=this._currentMasterSlide.get_musicTrack()&&this._currentMasterSlide.get_musicTrack().stop(),null!=this._currentMasterSlide.get_voiceTrack()&&this._currentMasterSlide.get_voiceTrack().stop();for(var i=ss.ss.enumerate(this._currentMasterSlide.get_overlays());i.moveNext();)i.current.stop()}globalWWTControl._hideUI(TourPlayer.noRestoreUIOnStop),globalScriptInterface._fireTourEnded()},updateSlideStates:function(){var e=!1,t=ss.ss.now()-this._slideStartTime;if(t>this._tour.get_currentTourStop().get_duration()&&TourPlayer._playing&&(this.nextSlide(),e=!0),t=ss.ss.now()-this._slideStartTime,null!=this._tour.get_currentTourStop()){this._tour.get_currentTourStop().set_tweenPosition(Math.min(1,t/this._tour.get_currentTourStop().get_duration())),this._tour.get_currentTourStop().faderOpacity=0;var i=this._tour.get_currentTourStop().get_tweenPosition()*this._tour.get_currentTourStop().get_duration()/1e3;switch(e&&globalWWTControl.set_crossFadeFrame(!1),this._tour.get_currentTourStop().get__transition()){case 0:this._tour.get_currentTourStop().faderOpacity=0,globalWWTControl.set_crossFadeFrame(!1);break;case 2:i<i-this._tour.get_currentTourStop().get__transitionHoldTime()?(globalWWTControl.set_crossFadeFrame(!0),this._tour.get_currentTourStop().faderOpacity=1):(this._tour.get_currentTourStop().faderOpacity=0,globalWWTControl.set_crossFadeFrame(!1));break;case 1:globalWWTControl.set_crossFadeFrame(!0);var r=Math.max(0,1-Math.min(1,(i-this._tour.get_currentTourStop().get__transitionHoldTime())/this._tour.get_currentTourStop().get__transitionTime()));this._tour.get_currentTourStop().faderOpacity=r;break;case 3:case 4:globalWWTControl.set_crossFadeFrame(!1),r=Math.max(0,1-Math.max(0,i-this._tour.get_currentTourStop().get__transitionHoldTime())/this._tour.get_currentTourStop().get__transitionTime()),this._tour.get_currentTourStop().faderOpacity=r;break;case 5:globalWWTControl.set_crossFadeFrame(!1)}if(!this._tour.get_currentTourStop().get_isLinked()&&this._tour.get_currentTourstopIndex()<this._tour.get_tourStops().length-1){var n=this._tour.get_tourStops()[this._tour.get_currentTourstopIndex()+1].get__transition(),s=this._tour.get_tourStops()[this._tour.get_currentTourstopIndex()+1].get__transitionOutTime();switch(n){case 5:case 3:this._tour.get_currentTourStop().faderOpacity||(globalWWTControl.set_crossFadeFrame(!1),r=Math.max(0,1-Math.min(1,(this._tour.get_currentTourStop().get_duration()/1e3-i)/s)),this._tour.get_currentTourStop().faderOpacity=r)}}}},updateTweenPosition:function(e){var t=ss.ss.now()-this._slideStartTime;return e>-1?this._tour.get_currentTourStop().set_tweenPosition(Math.min(1,e)):this._tour.get_currentTourStop().set_tweenPosition(Math.min(1,t/this._tour.get_currentTourStop().get_duration()))},close:function(){null!=this._tour&&(TourPlayer.get_playing()&&this.stop(TourPlayer._switchedToFullScreen),this._tour=null)},mouseDown:function(e,t){var i;if(i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY)),null==this._tour||null==this._tour.get_currentTourStop())return!1;for(var r=this._tour.get_currentTourStop().get_overlays().length-1;r>=0;r--)if(this._tour.get_currentTourStop().get_overlays()[r].hitTest(i)){if(!ss.ss.emptyString(this._tour.get_currentTourStop().get_overlays()[r].get_url())){var n=this._tour.get_currentTourStop().get_overlays()[r];return Util._openUrl(n.get_url()),!0}if(!ss.ss.emptyString(this._tour.get_currentTourStop().get_overlays()[r].get_linkID()))return this._callStack.push(this._tour.get_currentTourstopIndex()),this.playFromTourstop(this._tour.get_tourStops()[this._tour.getTourStopIndexByID(this._tour.get_currentTourStop().get_overlays()[r].get_linkID())]),!0}return!1},mouseUp:function(e,t){return!1},mouseMove:function(e,t){var i;try{i=this.pointToView(Vector2d.create(t.offsetX,t.offsetY))}catch(e){return!1}if(null==this._tour||null==this._tour.get_currentTourStop())return!1;for(var r=this._tour.get_currentTourStop().get_overlays().length-1;r>=0;r--)if(this._tour.get_currentTourStop().get_overlays()[r].hitTest(i)&&(!ss.ss.emptyString(this._tour.get_currentTourStop().get_overlays()[r].get_url())||!ss.ss.emptyString(this._tour.get_currentTourStop().get_overlays()[r].get_linkID())))return!0;return!1},mouseClick:function(e,t){return!1},click:function(e,t){return!1},mouseDoubleClick:function(e,t){return!1},keyDown:function(e,t){switch(t.keyCode){case 27:return this.stop(TourPlayer._switchedToFullScreen),globalWWTControl._closeTour(),!0;case 32:return this.pauseTour(),!0;case 39:return this._playNextSlide(),!0;case 37:return this._playPreviousSlide(),!0;case 35:return this._tour.get_tourStops().length>0&&this.playFromTourstop(this._tour.get_tourStops()[this._tour.get_tourStops().length-1]),!0;case 36:return this._tour.get_tourStops().length>0&&this.playFromTourstop(this._tour.get_tourStops()[0]),!0}return!1},_playNextSlide:function(){this._tour.get_currentTourstopIndex()<this._tour.get_tourStops().length-1&&this._tour.get_tourStops().length>0&&this.playFromTourstop(this._tour.get_tourStops()[this._tour.get_currentTourstopIndex()+1])},_playPreviousSlide:function(){this._tour.get_currentTourstopIndex()>0&&this.playFromTourstop(this._tour.get_tourStops()[this._tour.get_currentTourstopIndex()-1])},playFromTourstop:function(e){this.stop(!0),this._tour.set_currentTourStop(e),globalWWTControl.gotoTarget(this._tour.get_currentTourStop().get_target(),!1,!0,!1),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1),this.play()},pauseTour:function(){TourPlayer._playing?(this.stop(TourPlayer._switchedToFullScreen),globalWWTControl._freezeView(),globalScriptInterface._fireTourPaused()):(this.play(),globalScriptInterface._fireTourResume())},keyUp:function(e,t){return!1},hover:function(e){return!!TourPlayer._playing},pointToView:function(e){var t=globalWWTControl.canvas.height,i=globalWWTControl.canvas.width,r=i/t*1116,n=e.x/i*r-(r-1920)/2,s=e.y/t*1116;return Vector2d.create(n,s)}};function MasterTime(e,t){this.duration=0,this.master=e,this.duration=t}registerType("TourPlayer",[TourPlayer,TourPlayer$,null,IUiController]);var MasterTime$={};function ISSLayer(){Object3dLayer.call(this),this.id=ISSLayer.issGuid}registerType("MasterTime",[MasterTime,MasterTime$,null]),ISSLayer.issGuid=Guid.fromString("00000001-0002-0003-0405-060708090a0b"),ISSLayer._loading$2=!1,ISSLayer._issmodel$2=null,ISSLayer._doc$2=null,ISSLayer.loadBackground=function(){if(!ISSLayer._loading$2&&!freestandingMode){ISSLayer._loading$2=!0;var e=URLHelpers.singleton.coreStaticUrl("data/iss.wtt");ISSLayer._doc$2=tourDocumentFromUrlRaw(e,(function(){ISSLayer.createSpaceStation()}))}},ISSLayer.createSpaceStation=function(){ISSLayer._doc$2.set_id("28016047-97a9-4b33-a226-cd820262a151");var e=new Object3d(ISSLayer._doc$2,"0c10ae54-b6da-4282-bfda-f34562d403bc.3ds",!0,!1,!0,Colors.get_white());null!=e&&(e.issLayer=!0,ISSLayer._issmodel$2=e)};var ISSLayer$={draw:function(e,t,i){if(null==this.object3d&&null==ISSLayer._issmodel$2&&!ISSLayer._loading$2){var r=Matrix3d.multiplyMatrix(e.get_world(),e.get_view()),n=r.transform(Vector3d.get_empty()),s=Math.sqrt(r.get_m11()*r.get_m11()+r.get_m22()*r.get_m22()+r.get_m33()*r.get_m33()),a=n.length(),o=s,l=ss.ss.truncate(e.height),h=e.get_projection().get_m11(),c=e.get_projection().get_m34(),u=e.get_projection().get_m44();o*(h/(Math.abs(c)*a+u)*l)>.5&&ISSLayer.loadBackground()}return this.object3d=ISSLayer._issmodel$2,Object3dLayer.prototype.draw.call(this,e,t,i)},getPrimaryUI:function(){return null},addFilesToCabinet:function(e){},loadData:function(e,t){},cleanUp:function(){}};registerType("ISSLayer",[ISSLayer,ISSLayer$,Object3dLayer]);var CoordinatesTypes={spherical:0,rectangular:1,orbital:2};registerType("CoordinatesTypes",CoordinatesTypes),registerEnum("CoordinatesTypes",CoordinatesTypes);var AltTypes={depth:0,altitude:1,distance:2,seaLevel:3,terrain:4};registerType("AltTypes",AltTypes),registerEnum("AltTypes",AltTypes);var MarkerMixes={same_For_All:0};registerType("MarkerMixes",MarkerMixes),registerEnum("MarkerMixes",MarkerMixes);var ColorMaps={same_For_All:0,group_by_Values:2,per_Column_Literal:3};registerType("ColorMaps",ColorMaps),registerEnum("ColorMaps",ColorMaps);var PlotTypes={gaussian:0,point:1,circle:2,square:3,pushPin:4,custom:5};registerType("PlotTypes",PlotTypes),registerEnum("PlotTypes",PlotTypes);var MarkerScales={screen:0,world:1};registerType("MarkerScales",MarkerScales),registerEnum("MarkerScales",MarkerScales);var RAUnits={hours:0,degrees:1};function TimeSeriesLayer(){this.isLongIndex=!1,this.shapeVertexCount=0,this.lines=!1,this.latColumn=-1,this.fixedSize=1,this.decay=16,this.timeSeries=!1,this._dynamicData$1=!1,this._autoUpdate$1=!1,this._dataSourceUrl$1="",this._beginRange$1=new Date("1/1/2100"),this._endRange$1=new Date("01/01/1800"),this.markerDomainValues={},this.colorDomainValues={},this._coordinatesType$1=0,this.lngColumn=-1,this.geometryColumn=-1,this._xAxisColumn$1=-1,this._yAxisColumn$1=-1,this._zAxisColumn$1=-1,this._xAxisReverse$1=!1,this._yAxisReverse$1=!1,this._zAxisReverse$1=!1,this._altType$1=3,this._markerMix$1=0,this._raUnits$1=0,this._colorMap$1=3,this._markerColumn$1=-1,this._colorMapColumn$1=-1,this._plotType$1=0,this._markerIndex$1=0,this._showFarSide$1=!1,this._markerScale$1=1,this._altUnit$1=1,this._cartesianScale$1=1,this._cartesianCustomScale$1=1,this.altColumn=-1,this.startDateColumn=-1,this.endDateColumn=-1,this.sizeColumn=-1,this.nameColumn=0,this._hyperlinkFormat$1="",this._hyperlinkColumn$1=-1,this.scaleFactor=1,this.pointScaleType=1,this.positions=[],this.bufferIsFlat=!1,this.baseDate=new Date(2010,0,1,12,0,0),this.dirty=!0,this.lastVersion=0,Layer.call(this)}registerType("RAUnits",RAUnits),registerEnum("RAUnits",RAUnits),TimeSeriesLayer._circleTexture$1=null,TimeSeriesLayer.get__circleTexture$1=function(){return TimeSeriesLayer._circleTexture$1};var TimeSeriesLayer$={get_dynamicData:function(){return this._dynamicData$1},set_dynamicData:function(e){return this._dynamicData$1=e,e},get_autoUpdate:function(){return this._autoUpdate$1},set_autoUpdate:function(e){return this._autoUpdate$1=e,e},get_dataSourceUrl:function(){return this._dataSourceUrl$1},set_dataSourceUrl:function(e){return this._dataSourceUrl$1=e,e},get_timeSeries:function(){return this.timeSeries},set_timeSeries:function(e){return this.timeSeries!==e&&(this.version++,this.timeSeries=e),e},get_header:function(){return null},get_beginRange:function(){return this._beginRange$1},set_beginRange:function(e){return ss.ss.compareDates(this._beginRange$1,e)||(this.version++,this._beginRange$1=e),e},get_endRange:function(){return this._endRange$1},set_endRange:function(e){return ss.ss.compareDates(this._endRange$1,e)||(this.version++,this._endRange$1=e),e},initializeFromXml:function(e){switch(this.set_timeSeries(ss.ss.boolean(e.attributes.getNamedItem("TimeSeries").nodeValue)),this.set_beginRange(new Date(e.attributes.getNamedItem("BeginRange").nodeValue)),this.set_endRange(new Date(e.attributes.getNamedItem("EndRange").nodeValue)),this.set_decay(parseFloat(e.attributes.getNamedItem("Decay").nodeValue)),this.set_coordinatesType(Enums.parse("CoordinatesTypes",e.attributes.getNamedItem("CoordinatesType").nodeValue)),this.get_coordinatesType()<0&&this.set_coordinatesType(0),this.set_latColumn(parseInt(e.attributes.getNamedItem("LatColumn").nodeValue)),this.set_lngColumn(parseInt(e.attributes.getNamedItem("LngColumn").nodeValue)),null!=e.attributes.getNamedItem("GeometryColumn")&&this.set_geometryColumn(parseInt(e.attributes.getNamedItem("GeometryColumn").nodeValue)),e.attributes.getNamedItem("AltType").nodeValue){case"Depth":this.set_altType(0);break;case"Altitude":this.set_altType(1);break;case"Distance":this.set_altType(2);break;case"SeaLevel":this.set_altType(3);break;case"Terrain":this.set_altType(4)}switch(this.set_markerMix(0),e.attributes.getNamedItem("ColorMap").nodeValue){case"Same_For_All":this.set__colorMap(0);break;case"Group_by_Values":this.set__colorMap(2);break;case"Per_Column_Literal":this.set__colorMap(3)}switch(this.set_markerColumn(parseInt(e.attributes.getNamedItem("MarkerColumn").nodeValue)),this.set_colorMapColumn(parseInt(e.attributes.getNamedItem("ColorMapColumn").nodeValue)),e.attributes.getNamedItem("PlotType").nodeValue){case"Gaussian":this.set_plotType(0);break;case"Point":this.set_plotType(1);break;case"Circle":this.set_plotType(2);break;case"PushPin":this.set_plotType(4)}switch(this.set_markerIndex(parseInt(e.attributes.getNamedItem("MarkerIndex").nodeValue)),e.attributes.getNamedItem("MarkerScale").nodeValue){case"Screen":this.set_markerScale(0);break;case"World":this.set_markerScale(1)}switch(e.attributes.getNamedItem("AltUnit").nodeValue){case"Meters":this.set_altUnit(1);break;case"Feet":this.set_altUnit(2);break;case"Inches":this.set_altUnit(3);break;case"Miles":this.set_altUnit(4);break;case"Kilometers":this.set_altUnit(5);break;case"AstronomicalUnits":this.set_altUnit(6);break;case"LightYears":this.set_altUnit(7);break;case"Parsecs":this.set_altUnit(8);break;case"MegaParsecs":this.set_altUnit(9);break;case"Custom":this.set_altUnit(10)}switch(this.set_altColumn(parseInt(e.attributes.getNamedItem("AltColumn").nodeValue)),this.set_startDateColumn(parseInt(e.attributes.getNamedItem("StartDateColumn").nodeValue)),this.set_endDateColumn(parseInt(e.attributes.getNamedItem("EndDateColumn").nodeValue)),this.set_sizeColumn(parseInt(e.attributes.getNamedItem("SizeColumn").nodeValue)),this.set_hyperlinkFormat(e.attributes.getNamedItem("HyperlinkFormat").nodeValue),this.set_hyperlinkColumn(parseInt(e.attributes.getNamedItem("HyperlinkColumn").nodeValue)),this.set_scaleFactor(parseFloat(e.attributes.getNamedItem("ScaleFactor").nodeValue)),e.attributes.getNamedItem("PointScaleType").nodeValue){case"Linear":this.set_pointScaleType(0);break;case"Power":this.set_pointScaleType(1);break;case"Log":this.set_pointScaleType(2);break;case"Constant":this.set_pointScaleType(3);break;case"StellarMagnitude":this.set_pointScaleType(4)}if(null!=e.attributes.getNamedItem("ShowFarSide")&&this.set_showFarSide(ss.ss.boolean(e.attributes.getNamedItem("ShowFarSide").nodeValue)),null!=e.attributes.getNamedItem("RaUnits"))switch(e.attributes.getNamedItem("RaUnits").nodeValue){case"Hours":this.set_raUnits(0);break;case"Degrees":this.set_raUnits(1)}if(null!=e.attributes.getNamedItem("HoverTextColumn")&&this.set_nameColumn(parseInt(e.attributes.getNamedItem("HoverTextColumn").nodeValue)),null!=e.attributes.getNamedItem("XAxisColumn")){switch(this.set_xAxisColumn(parseInt(e.attributes.getNamedItem("XAxisColumn").nodeValue)),this.set_xAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("XAxisReverse").nodeValue)),this.set_yAxisColumn(parseInt(e.attributes.getNamedItem("YAxisColumn").nodeValue)),this.set_yAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("YAxisReverse").nodeValue)),this.set_zAxisColumn(parseInt(e.attributes.getNamedItem("ZAxisColumn").nodeValue)),this.set_zAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("ZAxisReverse").nodeValue)),e.attributes.getNamedItem("CartesianScale").nodeValue){case"Meters":this.set_cartesianScale(1);break;case"Feet":this.set_cartesianScale(2);break;case"Inches":this.set_cartesianScale(3);break;case"Miles":this.set_cartesianScale(4);break;case"Kilometers":this.set_cartesianScale(5);break;case"AstronomicalUnits":this.set_cartesianScale(6);break;case"LightYears":this.set_cartesianScale(7);break;case"Parsecs":this.set_cartesianScale(8);break;case"MegaParsecs":this.set_cartesianScale(9);break;case"Custom":this.set_cartesianScale(10)}this.set_cartesianCustomScale(parseFloat(e.attributes.getNamedItem("CartesianCustomScale").nodeValue))}null!=e.attributes.getNamedItem("DynamicData")&&(this.set_dynamicData(ss.ss.boolean(e.attributes.getNamedItem("DynamicData").nodeValue)),this.set_autoUpdate(ss.ss.boolean(e.attributes.getNamedItem("AutoUpdate").nodeValue)),this.set_dataSourceUrl(e.attributes.getNamedItem("DataSourceUrl").nodeValue))},computeDateDomainRange:function(e,t){},getDomainValues:function(e){return[]},get_decay:function(){return this.decay},set_decay:function(e){return this.decay!==e&&(this.version++,this.decay=e),e},get_coordinatesType:function(){return this._coordinatesType$1},set_coordinatesType:function(e){return this._coordinatesType$1!==e&&(this.version++,this._coordinatesType$1=e),e},get_latColumn:function(){return this.latColumn},set_latColumn:function(e){return this.latColumn!==e&&(this.version++,this.latColumn=e),e},get_lngColumn:function(){return this.lngColumn},set_lngColumn:function(e){return this.lngColumn!==e&&(this.version++,this.lngColumn=e),e},get_geometryColumn:function(){return this.geometryColumn},set_geometryColumn:function(e){return this.geometryColumn!==e&&(this.version++,this.geometryColumn=e),e},get_xAxisColumn:function(){return this._xAxisColumn$1},set_xAxisColumn:function(e){return this._xAxisColumn$1!==e&&(this.version++,this._xAxisColumn$1=e),e},get_yAxisColumn:function(){return this._yAxisColumn$1},set_yAxisColumn:function(e){return this._yAxisColumn$1!==e&&(this.version++,this._yAxisColumn$1=e),e},get_zAxisColumn:function(){return this._zAxisColumn$1},set_zAxisColumn:function(e){return this._zAxisColumn$1!==e&&(this.version++,this._zAxisColumn$1=e),e},get_xAxisReverse:function(){return this._xAxisReverse$1},set_xAxisReverse:function(e){return this._xAxisReverse$1!==e&&(this.version++,this._xAxisReverse$1=e),e},get_yAxisReverse:function(){return this._yAxisReverse$1},set_yAxisReverse:function(e){return this._yAxisReverse$1!==e&&(this.version++,this._yAxisReverse$1=e),e},get_zAxisReverse:function(){return this._zAxisReverse$1},set_zAxisReverse:function(e){return this._zAxisReverse$1!==e&&(this.version++,this._zAxisReverse$1=e),e},get_altType:function(){return this._altType$1},set_altType:function(e){return this._altType$1!==e&&(this.version++,this._altType$1=e),e},get_markerMix:function(){return this._markerMix$1},set_markerMix:function(e){return this._markerMix$1!==e&&(this.version++,this._markerMix$1=e),e},get_raUnits:function(){return this._raUnits$1},set_raUnits:function(e){return this._raUnits$1!==e&&(this.version++,this._raUnits$1=e),e},get__colorMap:function(){return this._colorMap$1},set__colorMap:function(e){return this._colorMap$1!==e&&(this.version++,this._colorMap$1=e),e},get_markerColumn:function(){return this._markerColumn$1},set_markerColumn:function(e){return this._markerColumn$1!==e&&(this.version++,this._markerColumn$1=e),e},get_colorMapColumn:function(){return this._colorMapColumn$1},set_colorMapColumn:function(e){return this._colorMapColumn$1!==e&&(this.version++,this._colorMapColumn$1=e),e},get_plotType:function(){return this._plotType$1},set_plotType:function(e){return this._plotType$1!==e&&(this.version++,this._plotType$1=e),e},get_markerIndex:function(){return this._markerIndex$1},set_markerIndex:function(e){return this._markerIndex$1!==e&&(this.version++,this._markerIndex$1=e),e},get_showFarSide:function(){return this._showFarSide$1},set_showFarSide:function(e){return this._showFarSide$1!==e&&(this.version++,this._showFarSide$1=e),e},get_markerScale:function(){return this._markerScale$1},set_markerScale:function(e){return this._markerScale$1!==e&&(this.version++,this._markerScale$1=e),e},get_altUnit:function(){return this._altUnit$1},set_altUnit:function(e){return this._altUnit$1!==e&&(this.version++,this._altUnit$1=e),e},get_cartesianScale:function(){return this._cartesianScale$1},set_cartesianScale:function(e){return this._cartesianScale$1!==e&&(this.version++,this._cartesianScale$1=e),e},get_cartesianCustomScale:function(){return this._cartesianCustomScale$1},set_cartesianCustomScale:function(e){return this._cartesianCustomScale$1!==e&&(this.version++,this._cartesianCustomScale$1=e),e},get_altColumn:function(){return this.altColumn},set_altColumn:function(e){return this.altColumn!==e&&(this.version++,this.altColumn=e),e},get_startDateColumn:function(){return this.startDateColumn},set_startDateColumn:function(e){return this.startDateColumn!==e&&(this.version++,this.startDateColumn=e),e},get_endDateColumn:function(){return this.endDateColumn},set_endDateColumn:function(e){return this.endDateColumn!==e&&(this.version++,this.endDateColumn=e),e},get_sizeColumn:function(){return this.sizeColumn},set_sizeColumn:function(e){return this.sizeColumn!==e&&(this.version++,this.sizeColumn=e),e},get_nameColumn:function(){return this.nameColumn},set_nameColumn:function(e){return this.nameColumn!==e&&(this.version++,this.nameColumn=e),e},get_hyperlinkFormat:function(){return this._hyperlinkFormat$1},set_hyperlinkFormat:function(e){return this._hyperlinkFormat$1!==e&&(this.version++,this._hyperlinkFormat$1=e),e},get_hyperlinkColumn:function(){return this._hyperlinkColumn$1},set_hyperlinkColumn:function(e){return this._hyperlinkColumn$1!==e&&(this.version++,this._hyperlinkColumn$1=e),e},get_scaleFactor:function(){return this.scaleFactor},set_scaleFactor:function(e){return this.scaleFactor!==e&&(this.version++,this.scaleFactor=e),e},get_pointScaleType:function(){return this.pointScaleType},set_pointScaleType:function(e){return this.pointScaleType!==e&&(this.version++,this.pointScaleType=e),e},prepVertexBuffer:function(e,t){return!0},draw:function(e,t,i){var r=e;this.version!==this.lastVersion&&this.cleanUp(),this.bufferIsFlat!==i&&(this.cleanUp(),this.bufferIsFlat=i),this.dirty&&this.prepVertexBuffer(r,t);var n=SpaceTimeController.get_jNow()-SpaceTimeController.utcToJulian(this.baseDate),s=this.scaleFactor;return i&&this.astronomical&&1===this._markerScale$1&&(s=this.scaleFactor/(e.viewCamera.zoom/360)),null!=this.triangleList2d&&(this.triangleList2d.decay=this.decay,this.triangleList2d.sky=this.get_astronomical(),this.triangleList2d.timeSeries=this.timeSeries,this.triangleList2d.jNow=n,this.triangleList2d.draw(e,t*this.get_opacity(),1)),null!=this.triangleList&&(this.triangleList.decay=this.decay,this.triangleList.sky=this.get_astronomical(),this.triangleList.timeSeries=this.timeSeries,this.triangleList.jNow=n,this.triangleList.draw(e,t*this.get_opacity(),1)),null!=this.pointList&&(this.pointList.depthBuffered=!1,this.pointList.decay=this.decay,this.pointList.sky=this.get_astronomical(),this.pointList.timeSeries=this.timeSeries,this.pointList.jNow=n,this.pointList.scale=1===this._markerScale$1?s:-s,this.pointList.draw(e,t*this.get_opacity(),!1)),null!=this.lineList&&(this.lineList.sky=this.get_astronomical(),this.lineList.decay=this.decay,this.lineList.timeSeries=this.timeSeries,this.lineList.jNow=n,this.lineList.drawLines(e,t*this.get_opacity())),null!=this.lineList2d&&(this.lineList2d.sky=this.get_astronomical(),this.lineList2d.decay=this.decay,this.lineList2d.timeSeries=this.timeSeries,this.lineList2d.showFarSide=this.get_showFarSide(),this.lineList2d.jNow=n,this.lineList2d.drawLines(e,t*this.get_opacity())),!0},initFromXml:function(e){Layer.prototype.initFromXml.call(this,e)},cleanUp:function(){null!=this.lineList&&this.lineList.clear(),null!=this.lineList2d&&this.lineList2d.clear(),null!=this.triangleList2d&&this.triangleList2d.clear(),null!=this.pointList&&this.pointList.clear(),null!=this.triangleList&&this.triangleList.clear()},dynamicUpdate:function(){return!1}};function KmlCoordinate(){this.lat=0,this.lng=0,this.alt=0}registerType("TimeSeriesLayer",[TimeSeriesLayer,TimeSeriesLayer$,Layer]);var KmlCoordinate$={};function KmlLineList(){this.extrude=!1,this.astronomical=!1,this.meanRadius=6371e3,this.pointList=[]}registerType("KmlCoordinate",[KmlCoordinate,KmlCoordinate$,null]);var KmlLineList$={parseWkt:function(e,t,i,r){for(var n=UiTools.split(e,"(,)"),s=ss.ss.enumerate(n);s.moveNext();){var a=s.current,o=ss.ss.trim(a).split(" ");if(o.length>1){var l=new KmlCoordinate;l.lng=parseFloat(o[0]),this.astronomical&&(l.lng-=180),l.lat=parseFloat(o[1]),o.length>2&&!i?l.alt=parseFloat(o[2]):l.alt=i,l.date=r,this.pointList.push(l)}}},getCenterPoint:function(){var e=new KmlCoordinate;e.lat=0,e.lng=0,e.alt=0;for(var t=ss.ss.enumerate(this.pointList);t.moveNext();){var i=t.current;e.lat+=i.lat,e.lng+=i.lng,e.alt+=i.alt}return e.lat/=this.pointList.length,e.lng/=this.pointList.length,e.alt/=this.pointList.length,e}};function PushPin(){}registerType("KmlLineList",[KmlLineList,KmlLineList$,null]),PushPin._pinTextureCache={},PushPin._pins=null,PushPin.triggerLoadSprite=function(){null==PushPin._pins&&(PushPin._pins=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("pins.png")))},PushPin.getPushPinTexture=function(e){var t=null;if(ss.ss.keyExists(PushPin._pinTextureCache,e))return PushPin._pinTextureCache[e];try{t=tilePrepDevice.createTexture(),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,t);var i=Math.floor(e/16),r=e%16,n=document.createElement("canvas");n.height=32,n.width=32,n.getContext("2d").drawImage(PushPin._pins.imageElement,32*r,32*i,32,32,0,0,32,32);var s=n;tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_S,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_WRAP_T,WEBGL.CLAMP_TO_EDGE),tilePrepDevice.texImage2D(WEBGL.TEXTURE_2D,0,WEBGL.RGBA,WEBGL.RGBA,WEBGL.UNSIGNED_BYTE,s),tilePrepDevice.texParameteri(WEBGL.TEXTURE_2D,WEBGL.TEXTURE_MIN_FILTER,WEBGL.LINEAR_MIPMAP_NEAREST),tilePrepDevice.generateMipmap(WEBGL.TEXTURE_2D),tilePrepDevice.bindTexture(WEBGL.TEXTURE_2D,null),PushPin._pinTextureCache[e]=t}catch(e){}return t};var PushPin$={};function SpreadSheetLayer(){this._dataDirty$1=!1,this._lastNormalizeSizeColumnIndex$1=-1,this._lastDynamicColorColumnIndex$1=-1,this._table_backcompat$1=null,this._barChartBitmask$1=0,this._barScaleFactor$1=20,this._meanRadius$1=6371e3,this._table$1=new Table,this.isLongIndex=!1,this.shapeVertexCount=0,this.lines=!1,this.latColumn=-1,this.fixedSize=1,this.decay=16,this.timeSeries=!1,this._dynamicData$1=!1,this._autoUpdate$1=!1,this._dataSourceUrl$1="",this._beginRange$1=new Date("1/1/2100"),this._endRange$1=new Date("01/01/1800"),this.markerDomainValues={},this.colorDomainValues={},this._coordinatesType$1=0,this.lngColumn=-1,this.geometryColumn=-1,this._xAxisColumn$1=-1,this._yAxisColumn$1=-1,this._zAxisColumn$1=-1,this._xAxisReverse$1=!1,this._yAxisReverse$1=!1,this._zAxisReverse$1=!1,this._altType$1=3,this._markerMix$1=0,this._raUnits$1=0,this.colorMap=3,this.colorMapperName="Greys",this._dynamicColorColumnName$1="2efc32e3-b9d9-47ff-8036-8cc344c585bd",this.dynamicColor=!1,this.normalizeColorMap=!1,this.normalizeColorMapMin=0,this.normalizeColorMapMax=1,this._markerColumn$1=-1,this.colorMapColumn=-1,this._plotType$1=0,this._markerIndex$1=0,this._showFarSide$1=!1,this._markerScale$1=1,this._altUnit$1=1,this._cartesianScale$1=1,this._cartesianCustomScale$1=1,this.altColumn=-1,this.startDateColumn=-1,this.endDateColumn=-1,this.sizeColumn=-1,this._normalizeSizeColumnName$1="dfe78b4c-f972-4796-b04f-68c5efd4ecb0",this.normalizeSize=!1,this.normalizeSizeClip=!1,this.normalizeSizeMin=0,this.normalizeSizeMax=1,this.nameColumn=0,this._hyperlinkFormat$1="",this._hyperlinkColumn$1=-1,this.scaleFactor=1,this.pointScaleType=1,this.positions=[],this.bufferIsFlat=!1,this.baseDate=new Date(2010,0,1,12,0,0),this.dirty=!0,this.lastVersion=0,Layer.call(this)}registerType("PushPin",[PushPin,PushPin$,null]),SpreadSheetLayer._circleTexture$1=null,SpreadSheetLayer._getDatafromFeed$1=function(e){return""},SpreadSheetLayer._executeQuery$1=function(e){return""},SpreadSheetLayer.parseDate=function(e){var t=ss.ss.now();try{t=new Date(e)}catch(t){try{return SpreadSheetLayer.execlToDateTime(parseFloat(e))}catch(e){}}return t},SpreadSheetLayer.execlToDateTime=function(e){e>59&&(e-=1),e>73e4&&(e=73e4);var t=new Date(1899,12,31);return new Date(t.getDate()+ss.ss.truncate(24*e*60*60*1e3))},SpreadSheetLayer.get__circleTexture$1=function(){if(null==SpreadSheetLayer._circleTexture$1){var e=URLHelpers.singleton.engineAssetUrl("circle.png");SpreadSheetLayer._circleTexture$1=Texture.fromUrl(e)}return SpreadSheetLayer._circleTexture$1};var SpreadSheetLayer$={getTypeName:function(){return"TerraViewer.SpreadSheetLayer"},get_header:function(){return this._table$1.header},canCopyToClipboard:function(){return!0},copyToClipboard:function(){},dynamicUpdate:function(){var e=SpreadSheetLayer._getDatafromFeed$1(this.get_dataSourceUrl());return null!=e&&(this.updateData(e,!1,!0,!0),this.guessHeaderAssignments(),!0)},updateData:function(e,t,i,r){return this.loadFromString(ss.ss.safeCast(e,String),!0,t,i,r),this.computeDateDomainRange(-1,-1),this._dataDirty$1=!0,this.dirty=!0,!0},loadData:function(e,t){var i=this;this._table$1=new Table;var r=e.getFileBlob(t);this.getStringFromGzipBlob(r,(function(e){i._table$1.loadFromString(e,!1,!0,!0),i._table$1.header.indexOf(i._normalizeSizeColumnName$1)>-1&&i._table$1.removeColumn(i._normalizeSizeColumnName$1),i.computeDateDomainRange(-1,-1),i.get_dynamicData()&&i.get_autoUpdate()&&i.dynamicUpdate(),i._dataDirty$1=!0,i.dirty=!0}))},addFilesToCabinet:function(e){this._fileName$1=e.tempDirectory+ss.ss.format("{0}\\{1}.txt",e.get_packageID(),this.id.toString()),this._fileName$1.substring(0,this._fileName$1.lastIndexOf("\\"));var t;t=null==this._table_backcompat$1?this._table$1.save():this._table_backcompat$1.save();var i=new Blob([t]);e.addFile(this._fileName$1,i),Layer.prototype.addFilesToCabinet.call(this,e)},_prepareBackCompatTable$1:function(){if(!(-1!==this.sizeColumn&&this.get_normalizeSize()||-1!==this.colorMapColumn&&this.get_dynamicColor()))return this._lastNormalizeSizeColumnIndex$1=-1,void(this._lastDynamicColorColumnIndex$1=-1);if(this._table_backcompat$1=this._table$1.clone(),this.sizeColumn>-1&&this.get_normalizeSize()){for(var e=[],t=ss.ss.enumerate(this._table_backcompat$1.rows);t.moveNext();){var i=t.current;e.push(this.normalizePointSize(parseFloat(i[this.sizeColumn])).toString())}this._table_backcompat$1.addColumn(this._normalizeSizeColumnName$1,e),this._lastNormalizeSizeColumnIndex$1=this._table_backcompat$1.header.length-1}else this._lastNormalizeSizeColumnIndex$1=-1;if(this.colorMapColumn>-1&&this.get_dynamicColor()){for(var r=[],n=ss.ss.enumerate(this._table_backcompat$1.rows);n.moveNext();)i=n.current,r.push(this.get_colorMapper().findClosestColor(this.normalizeColorMapValue(parseFloat(i[this.get_colorMapColumn()]))).toSimpleHex());this._table_backcompat$1.addColumn(this._dynamicColorColumnName$1,r),this._lastDynamicColorColumnIndex$1=this._table_backcompat$1.header.length-1}else this._lastDynamicColorColumnIndex$1=-1},guessHeaderAssignments:function(){for(var e=0,t=ss.ss.enumerate(this._table$1.header);t.moveNext();){var i=t.current;this._guessHeaderAssignment$1(i,e++)}this._table$1.header.length>0&&(this.nameColumn=0)},guessHeaderAssignmentsFromVoTable:function(e){var t=e.getDecColumn();null!=t&&(this.latColumn=t.index,this.astronomical=!0);var i=e.getRAColumn();null!=i&&(this.lngColumn=i.index,this.astronomical=!0,this.pointScaleType=4);var r=e.getMagColumn();null!=r&&(this.sizeColumn=r.index);for(var n=0,s=ss.ss.enumerate(e.column);s.moveNext();){var a=s.current;this._guessHeaderAssignment$1(a.name,n++)}this._table$1.header.length>0&&(this.nameColumn=0)},_guessHeaderAssignment$1:function(e,t){(e=e.toLowerCase()).indexOf("lat")>-1&&-1===this.latColumn&&(this.latColumn=t),(e.indexOf("lon")>-1||e.indexOf("lng")>-1)&&-1===this.lngColumn&&(this.lngColumn=t),e.indexOf("dec")>-1&&-1===this.latColumn&&(this.latColumn=t,this.astronomical=!0),(e.indexOf("ra")>-1||e.indexOf("ascen")>-1)&&-1===this.lngColumn&&(this.lngColumn=t,this.astronomical=!0,this.pointScaleType=4),(e.indexOf("mag")>-1||e.indexOf("size")>-1)&&-1===this.sizeColumn&&(this.sizeColumn=t),(e.indexOf("date")>-1||e.indexOf("time")>-1||e.indexOf("dt")>-1||e.indexOf("tm")>-1)&&(e.indexOf("end")>-1&&-1===this.endDateColumn?this.endDateColumn=t:-1===this.startDateColumn&&(this.startDateColumn=t)),(e.indexOf("altitude")>-1||e.indexOf("alt")>-1)&&-1===this.altColumn&&(this.altColumn=t,this.set_altType(1),this.set_altUnit(1)),e.indexOf("depth")>-1&&-1===this.altColumn&&(this.altColumn=t,this.set_altType(0),this.set_altUnit(5)),ss.ss.startsWith(e,"x")&&-1===this.get_xAxisColumn()&&this.set_xAxisColumn(t),ss.ss.startsWith(e,"y")&&-1===this.get_yAxisColumn()&&this.set_yAxisColumn(t),ss.ss.startsWith(e,"z")&&-1===this.get_zAxisColumn()&&this.set_zAxisColumn(t),e.indexOf("color")>-1&&-1===this.get_colorMapColumn()&&this.set_colorMapColumn(t),(e.indexOf("geometry")>-1||e.indexOf("geography")>-1)&&-1===this.geometryColumn&&(this.geometryColumn=t)},computeDateDomainRange:function(e,t){-1===e&&(e=this.startDateColumn),-1===t&&(t=this.endDateColumn),-1===t&&(t=e),this.set_beginRange(new Date("12/31/2100")),this.set_endRange(new Date("12/31/1890"));for(var i=ss.ss.enumerate(this._table$1.rows);i.moveNext();){var r=i.current;try{if(e>-1){var n=new Date("12/31/2100");try{(n=new Date(r[e]))<this.get_beginRange()&&this.set_beginRange(n)}catch(e){}try{var s=new Date("12/31/1890");t>-1&&(s=new Date(r[t]))>this.get_endRange()&&this.set_endRange(s)}catch(e){}}}catch(e){}}},checkState:function(){},getMaxValue:function(e){var t=0;this._table$1.lock();for(var i=ss.ss.enumerate(this._table$1.rows);i.moveNext();){var r=i.current;try{if(e>-1)try{var n=parseFloat(r[e]);n>t&&(t=n)}catch(e){}}catch(e){}}return this._table$1.unlock(),t},getDomainValues:function(e){var t=[];this._table$1.lock();for(var i=ss.ss.enumerate(this._table$1.rows);i.moveNext();){var r=i.current;try{e>-1&&(t.indexOf(r[e])>=0||t.push(r[e]))}catch(e){}}return t.sort(),this._table$1.unlock(),t},get_barChartBitmask:function(){return this._barChartBitmask$1},set_barChartBitmask:function(e){return this._barChartBitmask$1=e,e},_isPointInFrustum$1:function(e,t){for(var i=new Vector4d(e.x,e.y,e.z,1),r=0;r<6;r++)if(t[r].dot(i)<0)return!1;return!0},getTableDataInView:function(){for(var e="",t=!0,i=ss.ss.enumerate(this.get_header());i.moveNext();)t?t=!1:e+="\t",e+=i.current;e+="\r\n";for(var r=ss.ss.enumerate(this.get__table().rows);r.moveNext();){var n=r.current,s=parseFloat(n[this.get_lngColumn()]),a=parseFloat(n[this.get_latColumn()]),o=Coordinates.geoTo3dDouble(a,s);if(this._isPointInFrustum$1(o,globalRenderContext.get_frustum())){t=!0;for(var l=ss.ss.enumerate(n);l.moveNext();)t?t=!1:e+="\t",e+=l.current;e+="\r\n"}}return e},prepVertexBuffer:function(e,t){this._table$1.lock(),null!=this.lineList&&this.lineList.clear(),null!=this.lineList2d&&this.lineList2d.clear(),null!=this.triangleList&&this.triangleList.clear(),null!=this.pointList&&this.pointList.clear(),null!=this.triangleList2d&&this.triangleList2d.clear(),null==this.lineList&&(this.lineList=new LineList),null==this.pointList&&(this.pointList=new PointList(e)),this.lineList.timeSeries=this.timeSeries,null==this.lineList2d&&(this.lineList2d=new LineList,this.lineList2d.set_depthBuffered(!1)),this.lineList.timeSeries=this.timeSeries,null==this.triangleList&&(this.triangleList=new TriangleList),null==this.triangleList2d&&(this.triangleList2d=new TriangleList,this.triangleList2d.depthBuffered=!1),this.positions.length=0;var i=this.get_color(),r=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())/180*Math.PI,n=layerManagerGetAllMaps()[this.get_referenceFrame()].frame.meanRadius;n&&(this._meanRadius$1=n);for(var s=new Vector3d,a=2e-4,o=Colors.get_white(),l=0,h=0,c=ss.ss.enumerate(this._table$1.rows);c.moveNext();){var u=c.current;try{if(this.geometryColumn>-1||!this.get_coordinatesType()&&this.lngColumn>-1&&this.latColumn>-1||1===this.get_coordinatesType()&&this.get_xAxisColumn()>-1&&this.get_yAxisColumn()>-1){var d=0,_=0,g=0,f=1,m=0,p=0,C=this.getScaleFactor(this.get_altUnit(),1);if(-1===this.altColumn||3===this.get_altType()||this.bufferIsFlat)f=1,1==(this.astronomical&!this.bufferIsFlat)&&(f=6323967.17);else{this.get_altType()||(C=-C),f=0;try{f=parseFloat(u[this.altColumn])}catch(e){}this.astronomical?(p=f*(C/=149598e6)/206264.806,m=C*f,f*=C):2===this.get_altType()?(m=C*f,f=C*f/this._meanRadius$1):(m=C*f,f=1+C*f/this._meanRadius$1)}if(!this.get_coordinatesType()&&this.lngColumn>-1&&this.latColumn>-1){d=parseFloat(u[this.lngColumn]),_=parseFloat(u[this.latColumn]),this.astronomical?(this.get_raUnits()||(d*=15),this.bufferIsFlat):d+=180;var S=Coordinates.geoTo3dRad(_,d,f);this.astronomical&&!this.bufferIsFlat&&S.rotateX(r),s=S,this.positions.push(s)}else if(1===this.get_coordinatesType()){var w=this.getScaleFactor(this.get_cartesianScale(),this.get_cartesianCustomScale());this.astronomical?w/=149598e6:w/=this._meanRadius$1,this.get_zAxisColumn()>-1&&(g=parseFloat(u[this.get_zAxisColumn()])),d=parseFloat(u[this.get_xAxisColumn()]),_=parseFloat(u[this.get_yAxisColumn()]),this.get_xAxisReverse()&&(d=-d),this.get_yAxisReverse()&&(_=-_),this.get_zAxisReverse()&&(g=-g),s=Vector3d.create(d*w,g*w,_*w),this.positions.push(s)}switch(this.get_colorMap()){case 0:o=i;break;case 3:o=this.get_colorMapColumn()>-1?this.get_dynamicColor()?this.get_colorMapper().findClosestColor(this.normalizeColorMapValue(parseFloat(u[this.get_colorMapColumn()]))):this._parseColor$1(u[this.get_colorMapColumn()],i):i}if(null==o&&(o=Colors.get_transparent()),this.sizeColumn>-1)switch(this.pointScaleType){case 0:a=parseFloat(u[this.sizeColumn]),a=this.normalizePointSize(a);break;case 2:a=parseFloat(u[this.sizeColumn]),a=Math.log(a);break;case 1:try{a=parseFloat(u[this.sizeColumn]),a=this.normalizePointSize(a),a=Math.pow(2,a)}catch(e){a=0}break;case 4:var T=0;try{T=parseFloat(u[this.sizeColumn]),this.bufferIsFlat?a=40/Math.pow(1.6,T):(T-=5*(Util.logN(p,10)-1),a=12e7/Math.pow(1.6,T))}catch(e){a=0}break;case 3:a=1}else a=.2;if(1===this.get_plotType()&&(a=1),this.astronomical,this.bufferIsFlat,this.startDateColumn>-1){var y=new Date(u[this.startDateColumn]);l=SpaceTimeController.utcToJulian(y)-SpaceTimeController.utcToJulian(this.baseDate),this.endDateColumn>-1?(y=new Date(u[this.endDateColumn]),h=SpaceTimeController.utcToJulian(y)-SpaceTimeController.utcToJulian(this.baseDate)):h=l}this.pointList.addPoint(s,o,new Dates(l,h),a),this.geometryColumn>-1&&this._parseGeometry$1(u[this.geometryColumn],o,o,m,new Dates(l,h))}}catch(e){}this.lines=!1}return this._table$1.unlock(),this._dataDirty$1=!1,this.dirty=!1,!1},_parseGeometry$1:function(e,t,i,r,n){var s=(e=ss.ss.trim(e).toLowerCase()).indexOf("(");if(!(s<0)&&ss.ss.endsWith(e,")")){var a=ss.ss.trim(e.substring(0,s)),o=e.substr(s),l=a.split(" "),h=null,c=null;if(l.length>0)for(var u=ss.ss.enumerate(l);u.moveNext();){var d=u.current;ss.ss.emptyString(h)?h=d:ss.ss.emptyString(c)&&(c=d)}switch(h){case"multipolygon":case"polygon":this._parsePolygon$1(o,c,t,i,r,n);break;case"multilinestring":this._parseLineString$1(o,c,t,r,!1,n);break;case"linestring":this._parseLineString$1(o,c,t,r,!0,n);break;case"geometrycollection":o=o.substring(1,o.length-2);for(var _=UiTools.splitString(o,","),g=ss.ss.enumerate(_);g.moveNext();){var f=g.current;this._parseGeometry$1(f,t,i,r,n)}}}},_parsePolygon$1:function(e,t,i,r,n,s){if(ss.ss.startsWith(e,"(")||!ss.ss.endsWith(e,")")){e=e.substring(1,e.length-2);for(var a=UiTools.splitString(e,","),o=ss.ss.enumerate(a);o.moveNext();){var l=o.current,h=new KmlLineList;h.astronomical=this.astronomical,h.meanRadius=this._meanRadius$1,h.parseWkt(l,t,n,s),n?this._addPolygon$1(!1,h,1,r,i,!0,!0,s):this._addPolygonFlat$1(!1,h,1,r,i,!0,!0,s)}}},_parseLineString$1:function(e,t,i,r,n,s){if(ss.ss.startsWith(e,"(")||!ss.ss.endsWith(e,")")){n||(e=e.substring(1,e.length-2));for(var a=UiTools.splitString(e,","),o=ss.ss.enumerate(a);o.moveNext();){var l=o.current,h=new KmlLineList;h.astronomical=this.astronomical,h.meanRadius=this._meanRadius$1,h.parseWkt(l,t,r,s),this._addPolygon$1(!1,h,1,Colors.get_white(),i,!1,!1,s)}}},_splitShapes$1:function(e){for(;0<e.length;)e.substr(0,1);return[]},_addPolygon$1:function(e,t,i,r,n,s,a,o){for(var l=[],h=[],c=0;c<t.pointList.length;c++)l.push(Coordinates.geoTo3dRad(t.pointList[c].lat,t.pointList[c].lng,1+t.pointList[c].alt/this._meanRadius$1)),h.push(Coordinates.geoTo3dRad(t.pointList[c].lat,t.pointList[c].lng,1));for(c=0;c<t.pointList.length-1;c++)e||(s&&this.triangleList.addQuad(l[c],l[c+1],h[c],h[c+1],r,o),i>0&&(s?this.lineList.addLine(l[c],l[c+1],n,o):this.lineList2d.addLine(l[c],l[c+1],n,o),s&&(this.lineList.addLine(h[c],h[c+1],n,o),this.lineList.addLine(l[c],h[c],n,o),this.lineList.addLine(l[c+1],h[c+1],n,o))));if(a){var u=Tessellator.tesselateSimplePoly(l);for(c=0;c<u.length;c+=3)this.triangleList.addTriangle(l[u[c]],l[u[c+1]],l[u[c+2]],r,o)}},_addPolygonFlat$1:function(e,t,i,r,n,s,a,o){for(var l=[],h=0;h<t.pointList.length;h++)l.push(Coordinates.geoTo3dRad(t.pointList[h].lat,t.pointList[h].lng,1+t.pointList[h].alt/this._meanRadius$1));for(h=0;h<t.pointList.length-1;h++)e||i>0&&this.lineList2d.addLine(l[h],l[h+1],n,o);if(a){var c=Tessellator.tesselateSimplePoly(l);for(h=0;h<c.length;h+=3)this.triangleList2d.addSubdividedTriangles(l[c[h]],l[c[h+1]],l[c[h+2]],r,o,2)}},_parseColor$1:function(e,t){return Color.load(e)},getScaleFactor:function(e,t){var i=1;switch(e){case 1:i=1;break;case 2:i=.3048;break;case 3:i=.0254;break;case 4:i=1609.344;break;case 5:i=1e3;break;case 6:i=149598e6;break;case 7:i=9460528406976600;break;case 8:i=0x6da0192cd11520;break;case 9:i=30856802447988e9;break;case 10:i=t}return i},get__table:function(){return this._table$1},set__table:function(e){return this._table$1=e,e},useHeadersFromVoTable:function(e){for(var t=ss.ss.enumerate(e.column);t.moveNext();){var i=t.current;this.get_header().push(i.name)}this.guessHeaderAssignmentsFromVoTable(e),null!=e.getRAColumn()&&"deg"===e.getRAColumn().unit.toLowerCase()&&this.set_raUnits(1)},loadFromString:function(e,t,i,r,n){t||(this._table$1=new Table),this._table$1.lock(),this._table$1.loadFromString(e,t,r,n),t||(this.guessHeaderAssignments(),this.astronomical&&this.lngColumn>-1&&this.getMaxValue(this.lngColumn)>24&&this.set_raUnits(1)),i&&this.purgeByTime(),this._table$1.unlock()},purgeByTime:function(){if(!(this.startDateColumn<0)){var e=this.startDateColumn;this.endDateColumn>-1&&(e=this.endDateColumn);var t=SpaceTimeController.get_now(),i=24*ss.ss.truncate(this.decay)*60*60*1e3;t=new Date(t.getDate()-i);for(var r=this._table$1.rows.length,n=0;n<r;n++)try{var s=this._table$1.rows[n];new Date(s[e])<t&&(this._table$1.rows.splice(n,1),r--,n--)}catch(e){}}},cleanUp:function(){this.cleanUpBase(),this._table$1.lock(),Layer.prototype.cleanUp.call(this),this._table$1.unlock(),this.dirty=!0},writeLayerProperties:function(e){e._writeAttributeString("TimeSeries",this.get_timeSeries().toString()),e._writeAttributeString("BeginRange",Util.xmlDate(this.get_beginRange())),e._writeAttributeString("EndRange",Util.xmlDate(this.get_endRange())),e._writeAttributeString("Decay",this.get_decay().toString()),e._writeAttributeString("CoordinatesType",Enums.toXml("CoordinatesTypes",this.get_coordinatesType())),e._writeAttributeString("LatColumn",this.get_latColumn().toString()),e._writeAttributeString("LngColumn",this.get_lngColumn().toString()),e._writeAttributeString("GeometryColumn",this.get_geometryColumn().toString()),e._writeAttributeString("AltType",Enums.toXml("AltTypes",this.get_altType())),e._writeAttributeString("MarkerMix",Enums.toXml("MarkerMixes",this.get_markerMix())),e._writeAttributeString("ColorMap",Enums.toXml("ColorMaps",this.get_colorMap())),e._writeAttributeString("MarkerColumn",this.get_markerColumn().toString()),e._writeAttributeString("PlotType",Enums.toXml("PlotTypes",this.get_plotType())),e._writeAttributeString("MarkerIndex",this.get_markerIndex().toString()),e._writeAttributeString("MarkerScale",Enums.toXml("MarkerScales",this.get_markerScale())),e._writeAttributeString("AltUnit",Enums.toXml("AltUnits",this.get_altUnit())),e._writeAttributeString("AltColumn",this.get_altColumn().toString()),e._writeAttributeString("StartDateColumn",this.get_startDateColumn().toString()),e._writeAttributeString("EndDateColumn",this.get_endDateColumn().toString()),this._prepareBackCompatTable$1(),this._lastNormalizeSizeColumnIndex$1>-1?(e._writeAttributeString("SizeColumn",this._lastNormalizeSizeColumnIndex$1),e._writeAttributeString("NormalizeSizeColumn",this.sizeColumn.toString())):e._writeAttributeString("SizeColumn",this.get_sizeColumn().toString()),e._writeAttributeString("NormalizeSize",this.get_normalizeSize().toString()),e._writeAttributeString("NormalizeSizeClip",this.get_normalizeSizeClip().toString()),e._writeAttributeString("NormalizeSizeMin",this.get_normalizeSizeMin().toString()),e._writeAttributeString("NormalizeSizeMax",this.get_normalizeSizeMax().toString()),this._lastDynamicColorColumnIndex$1>-1?(e._writeAttributeString("ColorMapColumn",this._lastDynamicColorColumnIndex$1),e._writeAttributeString("DynamicColorColumn",this.get_colorMapColumn().toString())):e._writeAttributeString("ColorMapColumn",this.get_colorMapColumn().toString()),e._writeAttributeString("DynamicColor",this.get_dynamicColor().toString()),e._writeAttributeString("ColorMapperName",this.get_colorMapperName()),e._writeAttributeString("NormalizeColorMap",this.get_normalizeColorMap().toString()),e._writeAttributeString("NormalizeColorMapMin",this.get_normalizeColorMapMin().toString()),e._writeAttributeString("NormalizeColorMapMax",this.get_normalizeColorMapMax().toString()),e._writeAttributeString("HyperlinkFormat",this.get_hyperlinkFormat()),e._writeAttributeString("HyperlinkColumn",this.get_hyperlinkColumn().toString()),e._writeAttributeString("ScaleFactor",this.get_scaleFactor().toString()),e._writeAttributeString("PointScaleType",Enums.toXml("PointScaleTypes",this.get_pointScaleType())),e._writeAttributeString("ShowFarSide",this.get_showFarSide().toString()),e._writeAttributeString("RaUnits",Enums.toXml("RAUnits",this.get_raUnits())),e._writeAttributeString("HoverTextColumn",this.get_nameColumn().toString()),e._writeAttributeString("XAxisColumn",this.get_xAxisColumn().toString()),e._writeAttributeString("XAxisReverse",this.get_xAxisReverse().toString()),e._writeAttributeString("YAxisColumn",this.get_yAxisColumn().toString()),e._writeAttributeString("YAxisReverse",this.get_yAxisReverse().toString()),e._writeAttributeString("ZAxisColumn",this.get_zAxisColumn().toString()),e._writeAttributeString("ZAxisReverse",this.get_zAxisReverse().toString()),e._writeAttributeString("CartesianScale",Enums.toXml("AltUnits",this.get_cartesianScale())),e._writeAttributeString("CartesianCustomScale",this.get_cartesianCustomScale().toString()),e._writeAttributeString("DynamicData",this.get_dynamicData().toString()),e._writeAttributeString("AutoUpdate",this.get_autoUpdate().toString()),e._writeAttributeString("DataSourceUrl",this.get_dataSourceUrl())},get_dynamicData:function(){return this._dynamicData$1},set_dynamicData:function(e){return this._dynamicData$1=e,e},get_autoUpdate:function(){return this._autoUpdate$1},set_autoUpdate:function(e){return this._autoUpdate$1=e,e},get_dataSourceUrl:function(){return this._dataSourceUrl$1},set_dataSourceUrl:function(e){return this._dataSourceUrl$1=e,e},get_timeSeries:function(){return this.timeSeries},set_timeSeries:function(e){return this.timeSeries!==e&&(this.version++,this.timeSeries=e),e},get_beginRange:function(){return this._beginRange$1},set_beginRange:function(e){return ss.ss.compareDates(this._beginRange$1,e)||(this.version++,this._beginRange$1=e),e},get_endRange:function(){return this._endRange$1},set_endRange:function(e){return ss.ss.compareDates(this._endRange$1,e)||(this.version++,this._endRange$1=e),e},initializeFromXml:function(e){this.set_timeSeries(ss.ss.boolean(e.attributes.getNamedItem("TimeSeries").nodeValue)),this.set_beginRange(new Date(e.attributes.getNamedItem("BeginRange").nodeValue)),this.set_endRange(new Date(e.attributes.getNamedItem("EndRange").nodeValue)),this.set_decay(parseFloat(e.attributes.getNamedItem("Decay").nodeValue)),this.set_coordinatesType(Enums.parse("CoordinatesTypes",e.attributes.getNamedItem("CoordinatesType").nodeValue)),this.get_coordinatesType()<0&&this.set_coordinatesType(0),this.set_latColumn(parseInt(e.attributes.getNamedItem("LatColumn").nodeValue)),this.set_lngColumn(parseInt(e.attributes.getNamedItem("LngColumn").nodeValue)),null!=e.attributes.getNamedItem("GeometryColumn")&&this.set_geometryColumn(parseInt(e.attributes.getNamedItem("GeometryColumn").nodeValue)),this.set_altType(Enums.parse("AltTypes",e.attributes.getNamedItem("AltType").nodeValue)),this.set_markerMix(0),this.set_colorMap(Enums.parse("ColorMaps",e.attributes.getNamedItem("ColorMap").nodeValue)),this.set_markerColumn(parseInt(e.attributes.getNamedItem("MarkerColumn").nodeValue)),this.set_colorMapColumn(parseInt(e.attributes.getNamedItem("ColorMapColumn").nodeValue)),this.set_plotType(Enums.parse("PlotTypes",e.attributes.getNamedItem("PlotType").nodeValue)),this.set_markerIndex(parseInt(e.attributes.getNamedItem("MarkerIndex").nodeValue)),this.set_markerScale(Enums.parse("MarkerScales",e.attributes.getNamedItem("MarkerScale").nodeValue)),this.set_altUnit(Enums.parse("AltUnits",e.attributes.getNamedItem("AltUnit").nodeValue)),this.set_altColumn(parseInt(e.attributes.getNamedItem("AltColumn").nodeValue)),this.set_startDateColumn(parseInt(e.attributes.getNamedItem("StartDateColumn").nodeValue)),this.set_endDateColumn(parseInt(e.attributes.getNamedItem("EndDateColumn").nodeValue)),null!=e.attributes.getNamedItem("NormalizeSizeColumn")?this.set_sizeColumn(parseInt(e.attributes.getNamedItem("NormalizeSizeColumn").nodeValue)):this.set_sizeColumn(parseInt(e.attributes.getNamedItem("SizeColumn").nodeValue)),null!=e.attributes.getNamedItem("NormalizeSize")&&(this.set_normalizeSize(ss.ss.boolean(e.attributes.getNamedItem("NormalizeSize").nodeValue)),this.set_normalizeSizeClip(ss.ss.boolean(e.attributes.getNamedItem("NormalizeSizeClip").nodeValue)),this.set_normalizeSizeMin(parseFloat(e.attributes.getNamedItem("NormalizeSizeMin").nodeValue)),this.set_normalizeSizeMax(parseFloat(e.attributes.getNamedItem("NormalizeSizeMax").nodeValue))),null!=e.attributes.getNamedItem("DynamicColorColumn")?this.set_colorMapColumn(parseInt(e.attributes.getNamedItem("DynamicColorColumn").nodeValue)):this.set_colorMapColumn(parseInt(e.attributes.getNamedItem("ColorMapColumn").nodeValue)),null!=e.attributes.getNamedItem("DynamicColor")&&(this.set_dynamicColor(ss.ss.boolean(e.attributes.getNamedItem("DynamicColor").nodeValue)),this.set_colorMapperName(e.attributes.getNamedItem("ColorMapperName").nodeValue),this.set_normalizeColorMap(ss.ss.boolean(e.attributes.getNamedItem("NormalizeColorMap").nodeValue)),this.set_normalizeColorMapMin(parseFloat(e.attributes.getNamedItem("NormalizeColorMapMin").nodeValue)),this.set_normalizeColorMapMax(parseFloat(e.attributes.getNamedItem("NormalizeColorMapMax").nodeValue))),this.set_hyperlinkFormat(e.attributes.getNamedItem("HyperlinkFormat").nodeValue),this.set_hyperlinkColumn(parseInt(e.attributes.getNamedItem("HyperlinkColumn").nodeValue)),this.set_scaleFactor(parseFloat(e.attributes.getNamedItem("ScaleFactor").nodeValue)),this.set_pointScaleType(Enums.parse("PointScaleTypes",e.attributes.getNamedItem("PointScaleType").nodeValue)),null!=e.attributes.getNamedItem("ShowFarSide")&&this.set_showFarSide(ss.ss.boolean(e.attributes.getNamedItem("ShowFarSide").nodeValue)),null!=e.attributes.getNamedItem("RaUnits")&&this.set_raUnits(Enums.parse("RAUnits",e.attributes.getNamedItem("RaUnits").nodeValue)),null!=e.attributes.getNamedItem("HoverTextColumn")&&this.set_nameColumn(parseInt(e.attributes.getNamedItem("HoverTextColumn").nodeValue)),null!=e.attributes.getNamedItem("XAxisColumn")&&(this.set_xAxisColumn(parseInt(e.attributes.getNamedItem("XAxisColumn").nodeValue)),this.set_xAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("XAxisReverse").nodeValue)),this.set_yAxisColumn(parseInt(e.attributes.getNamedItem("YAxisColumn").nodeValue)),this.set_yAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("YAxisReverse").nodeValue)),this.set_zAxisColumn(parseInt(e.attributes.getNamedItem("ZAxisColumn").nodeValue)),this.set_zAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("ZAxisReverse").nodeValue)),this.set_cartesianScale(Enums.parse("AltUnits",e.attributes.getNamedItem("CartesianScale").nodeValue)),this.set_cartesianCustomScale(parseFloat(e.attributes.getNamedItem("CartesianCustomScale").nodeValue))),null!=e.attributes.getNamedItem("DynamicData")&&(this.set_dynamicData(ss.ss.boolean(e.attributes.getNamedItem("DynamicData").nodeValue)),this.set_autoUpdate(ss.ss.boolean(e.attributes.getNamedItem("AutoUpdate").nodeValue)),this.set_dataSourceUrl(e.attributes.getNamedItem("DataSourceUrl").nodeValue))},get_decay:function(){return this.decay},set_decay:function(e){return this.decay!==e&&(this.version++,this.decay=e),e},get_coordinatesType:function(){return this._coordinatesType$1},set_coordinatesType:function(e){return this._coordinatesType$1!==e&&(this.version++,this._coordinatesType$1=e),e},get_latColumn:function(){return this.latColumn},set_latColumn:function(e){return this.latColumn!==e&&(this.version++,this.latColumn=e),e},get_lngColumn:function(){return this.lngColumn},set_lngColumn:function(e){return this.lngColumn!==e&&(this.version++,this.lngColumn=e),e},get_geometryColumn:function(){return this.geometryColumn},set_geometryColumn:function(e){return this.geometryColumn!==e&&(this.version++,this.geometryColumn=e),e},get_xAxisColumn:function(){return this._xAxisColumn$1},set_xAxisColumn:function(e){return this._xAxisColumn$1!==e&&(this.version++,this._xAxisColumn$1=e),e},get_yAxisColumn:function(){return this._yAxisColumn$1},set_yAxisColumn:function(e){return this._yAxisColumn$1!==e&&(this.version++,this._yAxisColumn$1=e),e},get_zAxisColumn:function(){return this._zAxisColumn$1},set_zAxisColumn:function(e){return this._zAxisColumn$1!==e&&(this.version++,this._zAxisColumn$1=e),e},get_xAxisReverse:function(){return this._xAxisReverse$1},set_xAxisReverse:function(e){return this._xAxisReverse$1!==e&&(this.version++,this._xAxisReverse$1=e),e},get_yAxisReverse:function(){return this._yAxisReverse$1},set_yAxisReverse:function(e){return this._yAxisReverse$1!==e&&(this.version++,this._yAxisReverse$1=e),e},get_zAxisReverse:function(){return this._zAxisReverse$1},set_zAxisReverse:function(e){return this._zAxisReverse$1!==e&&(this.version++,this._zAxisReverse$1=e),e},get_altType:function(){return this._altType$1},set_altType:function(e){return this._altType$1!==e&&(this.version++,this._altType$1=e),e},get_markerMix:function(){return this._markerMix$1},set_markerMix:function(e){return this._markerMix$1!==e&&(this.version++,this._markerMix$1=e),e},get_raUnits:function(){return this._raUnits$1},set_raUnits:function(e){return this._raUnits$1!==e&&(this.version++,this._raUnits$1=e),e},get_colorMap:function(){return this.colorMap},set_colorMap:function(e){return this.colorMap!==e&&(this.version++,this.colorMap=e),e},get_colorMapperName:function(){return this.colorMapperName},set_colorMapperName:function(e){if(null==ColorMapContainer.fromNamedColormap(e))throw new Error("Invalid colormap name");return this.version++,this.colorMapperName=e,e},get_colorMapper:function(){return ColorMapContainer.fromNamedColormap(this.colorMapperName)},get_dynamicColor:function(){return this.dynamicColor},set_dynamicColor:function(e){return this.version++,this.dynamicColor=e,e},get_normalizeColorMap:function(){return this.normalizeColorMap},set_normalizeColorMap:function(e){return this.version++,this.normalizeColorMap=e,e},get_normalizeColorMapMin:function(){return this.normalizeColorMapMin},set_normalizeColorMapMin:function(e){return this.version++,this.normalizeColorMapMin=e,e},get_normalizeColorMapMax:function(){return this.normalizeColorMapMax},set_normalizeColorMapMax:function(e){return this.version++,this.normalizeColorMapMax=e,e},normalizeColorMapValue:function(e){if(!this.get_normalizeColorMap())return e;var t=(e-this.get_normalizeColorMapMin())/(this.get_normalizeColorMapMax()-this.get_normalizeColorMapMin());return t<0?t=0:t>1&&(t=1),t},get_markerColumn:function(){return this._markerColumn$1},set_markerColumn:function(e){return this._markerColumn$1!==e&&(this.version++,this._markerColumn$1=e),e},get_colorMapColumn:function(){return this.colorMapColumn},set_colorMapColumn:function(e){return this.colorMapColumn!==e&&(this.version++,this.colorMapColumn=e),e},get_plotType:function(){return this._plotType$1},set_plotType:function(e){return this._plotType$1!==e&&(this.version++,this._plotType$1=e),e},get_markerIndex:function(){return this._markerIndex$1},set_markerIndex:function(e){return this._markerIndex$1!==e&&(this.version++,this._markerIndex$1=e),e},get_showFarSide:function(){return this._showFarSide$1},set_showFarSide:function(e){return this._showFarSide$1!==e&&(this.version++,this._showFarSide$1=e),e},get_markerScale:function(){return this._markerScale$1},set_markerScale:function(e){return this._markerScale$1!==e&&(this.version++,this._markerScale$1=e),e},get_altUnit:function(){return this._altUnit$1},set_altUnit:function(e){return this._altUnit$1!==e&&(this.version++,this._altUnit$1=e),e},get_cartesianScale:function(){return this._cartesianScale$1},set_cartesianScale:function(e){return this._cartesianScale$1!==e&&(this.version++,this._cartesianScale$1=e),e},get_cartesianCustomScale:function(){return this._cartesianCustomScale$1},set_cartesianCustomScale:function(e){return this._cartesianCustomScale$1!==e&&(this.version++,this._cartesianCustomScale$1=e),e},get_altColumn:function(){return this.altColumn},set_altColumn:function(e){return this.altColumn!==e&&(this.version++,this.altColumn=e),e},get_startDateColumn:function(){return this.startDateColumn},set_startDateColumn:function(e){return this.startDateColumn!==e&&(this.version++,this.startDateColumn=e),e},get_endDateColumn:function(){return this.endDateColumn},set_endDateColumn:function(e){return this.endDateColumn!==e&&(this.version++,this.endDateColumn=e),e},get_sizeColumn:function(){return this.sizeColumn},set_sizeColumn:function(e){return this.sizeColumn!==e&&(this.version++,this.sizeColumn=e),e},get_normalizeSize:function(){return this.normalizeSize},set_normalizeSize:function(e){return this.normalizeSize!==e&&(this.version++,this.normalizeSize=e),e},get_normalizeSizeClip:function(){return this.normalizeSizeClip},set_normalizeSizeClip:function(e){return this.normalizeSizeClip!==e&&(this.version++,this.normalizeSizeClip=e),e},get_normalizeSizeMin:function(){return this.normalizeSizeMin},set_normalizeSizeMin:function(e){return this.normalizeSizeMin!==e&&(this.version++,this.normalizeSizeMin=e),e},get_normalizeSizeMax:function(){return this.normalizeSizeMax},set_normalizeSizeMax:function(e){return this.normalizeSizeMax!==e&&(this.version++,this.normalizeSizeMax=e),e},normalizePointSize:function(e){if(!this.get_normalizeSize())return e;var t=(e-this.get_normalizeSizeMin())/(this.get_normalizeSizeMax()-this.get_normalizeSizeMin());return this.get_normalizeSizeClip()&&(t<0?t=0:t>1&&(t=1)),t},get_nameColumn:function(){return this.nameColumn},set_nameColumn:function(e){return this.nameColumn!==e&&(this.version++,this.nameColumn=e),e},get_hyperlinkFormat:function(){return this._hyperlinkFormat$1},set_hyperlinkFormat:function(e){return this._hyperlinkFormat$1!==e&&(this.version++,this._hyperlinkFormat$1=e),e},get_hyperlinkColumn:function(){return this._hyperlinkColumn$1},set_hyperlinkColumn:function(e){return this._hyperlinkColumn$1!==e&&(this.version++,this._hyperlinkColumn$1=e),e},get_scaleFactor:function(){return this.scaleFactor},set_scaleFactor:function(e){return this.scaleFactor!==e&&(this.version++,this.scaleFactor=e),e},get_pointScaleType:function(){return this.pointScaleType},set_pointScaleType:function(e){return this.pointScaleType!==e&&(this.version++,this.pointScaleType=e),e},draw:function(e,t,i){var r=e;this.version!==this.lastVersion&&this.cleanUp(),this.lastVersion=this.version,this.bufferIsFlat!==i&&(this.cleanUp(),this.bufferIsFlat=i),this.dirty&&this.prepVertexBuffer(r,t);var n=SpaceTimeController.get_jNow()-SpaceTimeController.utcToJulian(this.baseDate),s=3*this.scaleFactor;if(i&&this.astronomical&&1===this._markerScale$1&&(s=this.scaleFactor/(e.viewCamera.zoom/360)),null!=this.triangleList2d&&(this.triangleList2d.decay=this.decay,this.triangleList2d.sky=this.get_astronomical(),this.triangleList2d.timeSeries=this.timeSeries,this.triangleList2d.jNow=n,this.triangleList2d.draw(e,t*this.get_opacity(),1)),null!=this.triangleList&&(this.triangleList.decay=this.decay,this.triangleList.sky=this.get_astronomical(),this.triangleList.timeSeries=this.timeSeries,this.triangleList.jNow=n,this.triangleList.draw(e,t*this.get_opacity(),1)),null!=this.pointList)switch(this.pointList.depthBuffered=!1,this.pointList.showFarSide=this.get_showFarSide(),this.pointList.decay=this.timeSeries?this.decay:0,this.pointList.sky=this.get_astronomical(),this.pointList.timeSeries=this.timeSeries,this.pointList.jNow=n,this.pointList.scale=1===this._markerScale$1?s:-s,this._plotType$1){case 0:this.pointList.draw(e,t*this.get_opacity(),!1);break;case 2:this.pointList.drawTextured(e,SpreadSheetLayer.get__circleTexture$1().texture2d,t*this.get_opacity());break;case 1:this.pointList.drawTextured(e,PushPin.getPushPinTexture(19),t*this.get_opacity());break;case 3:this.pointList.drawTextured(e,PushPin.getPushPinTexture(35),t*this.get_opacity());break;case 5:case 4:this.pointList.drawTextured(e,PushPin.getPushPinTexture(this._markerIndex$1),t*this.get_opacity())}return null!=this.lineList&&(this.lineList.sky=this.get_astronomical(),this.lineList.decay=this.decay,this.lineList.timeSeries=this.timeSeries,this.lineList.jNow=n,this.lineList.drawLines(e,t*this.get_opacity())),null!=this.lineList2d&&(this.lineList2d.sky=this.get_astronomical(),this.lineList2d.decay=this.decay,this.lineList2d.timeSeries=this.timeSeries,this.lineList2d.showFarSide=this.get_showFarSide(),this.lineList2d.jNow=n,this.lineList2d.drawLines(e,t*this.get_opacity())),!0},cleanUpBase:function(){null!=this.lineList&&this.lineList.clear(),null!=this.lineList2d&&this.lineList2d.clear(),null!=this.triangleList2d&&this.triangleList2d.clear(),null!=this.pointList&&this.pointList.clear(),null!=this.triangleList&&this.triangleList.clear()}};function CatalogSpreadSheetLayer(){this._addedTiles$2={},SpreadSheetLayer.call(this)}registerType("SpreadSheetLayer",[SpreadSheetLayer,SpreadSheetLayer$,Layer]);var CatalogSpreadSheetLayer$={addTileRows:function(e,t){if(!ss.ss.keyExists(this._addedTiles$2,e)){for(var i=ss.ss.enumerate(t);i.moveNext();){var r=i.current;this.get__table().rows.push(r)}this.dirty=!0,this._addedTiles$2[e]=!0}},removeTileRows:function(e,t){if(ss.ss.keyExists(this._addedTiles$2,e)){for(var i=ss.ss.enumerate(t);i.moveNext();){var r=i.current;ss.ss.remove(this.get__table().rows,r)}this.dirty=!0,delete this._addedTiles$2[e]}},cleanUp:function(){SpreadSheetLayer.prototype.cleanUp.call(this),ss.ss.clearKeys(this._addedTiles$2),this.get__table().rows.length=0}};function VoTableLayer(){this.isLongIndex=!1,this.shapeVertexCount=0,this.lines=!1,this.latColumn=-1,this.fixedSize=1,this.decay=0,this.timeSeries=!1,this._dynamicData$1=!1,this._autoUpdate$1=!1,this._dataSourceUrl$1="",this._beginRange$1=new Date("1/1/2100"),this._endRange$1=new Date("01/01/1800"),this.markerDomainValues={},this.colorDomainValues={},this._coordinatesType$1=0,this.lngColumn=-1,this.geometryColumn=-1,this._xAxisColumn$1=-1,this._yAxisColumn$1=-1,this._zAxisColumn$1=-1,this._xAxisReverse$1=!1,this._yAxisReverse$1=!1,this._zAxisReverse$1=!1,this._altType$1=3,this._markerMix$1=0,this._raUnits$1=0,this._colorMap$1=3,this._markerColumn$1=-1,this._colorMapColumn$1=-1,this._plotType$1=0,this._markerIndex$1=0,this._showFarSide$1=!1,this._markerScale$1=1,this._altUnit$1=1,this._cartesianScale$1=1,this._cartesianCustomScale$1=1,this.altColumn=-1,this.startDateColumn=-1,this.endDateColumn=-1,this.sizeColumn=-1,this.nameColumn=0,this._hyperlinkFormat$1="",this._hyperlinkColumn$1=-1,this.scaleFactor=1,this.pointScaleType=1,this.positions=[],this.bufferIsFlat=!1,this.baseDate=new Date(2010,0,1,12,0,0),this.dirty=!0,this._filename$1="",Layer.call(this),this._table$1=null,this._filename$1="",this.set_plotType(2)}registerType("CatalogSpreadSheetLayer",[CatalogSpreadSheetLayer,CatalogSpreadSheetLayer$,SpreadSheetLayer]),VoTableLayer._circleTexture$1=null,VoTableLayer.get__circleTexture$1=function(){if(null==VoTableLayer._circleTexture$1){var e=URLHelpers.singleton.engineAssetUrl("circle.png");VoTableLayer._circleTexture$1=Texture.fromUrl(e)}return VoTableLayer._circleTexture$1},VoTableLayer.create=function(e,t){var i=new VoTableLayer;return i._table$1=e,i._filename$1=e.loadFilename,i.set_lngColumn(e.getRAColumn().index),i.set_latColumn(e.getDecColumn().index),i.sizeColumn=e.getColumnByUcd("phot.mag").index,i.set_plotType(t),i};var VoTableLayer$={get_dynamicData:function(){return this._dynamicData$1},set_dynamicData:function(e){return this._dynamicData$1=e,e},get_autoUpdate:function(){return this._autoUpdate$1},set_autoUpdate:function(e){return this._autoUpdate$1=e,e},get_dataSourceUrl:function(){return this._dataSourceUrl$1},set_dataSourceUrl:function(e){return this._dataSourceUrl$1=e,e},get_timeSeries:function(){return this.timeSeries},set_timeSeries:function(e){return this.timeSeries!==e&&(this.version++,this.timeSeries=e),e},get_beginRange:function(){return this._beginRange$1},set_beginRange:function(e){return ss.ss.compareDates(this._beginRange$1,e)||(this.version++,this._beginRange$1=e),e},get_endRange:function(){return this._endRange$1},set_endRange:function(e){return ss.ss.compareDates(this._endRange$1,e)||(this.version++,this._endRange$1=e),e},initializeFromXml:function(e){switch(this.set_timeSeries(ss.ss.boolean(e.attributes.getNamedItem("TimeSeries").nodeValue)),this.set_beginRange(new Date(e.attributes.getNamedItem("BeginRange").nodeValue)),this.set_endRange(new Date(e.attributes.getNamedItem("EndRange").nodeValue)),this.set_decay(parseFloat(e.attributes.getNamedItem("Decay").nodeValue)),this.set_coordinatesType(Enums.parse("CoordinatesTypes",e.attributes.getNamedItem("CoordinatesType").nodeValue)),this.get_coordinatesType()<0&&this.set_coordinatesType(0),this.set_latColumn(parseInt(e.attributes.getNamedItem("LatColumn").nodeValue)),this.set_lngColumn(parseInt(e.attributes.getNamedItem("LngColumn").nodeValue)),null!=e.attributes.getNamedItem("GeometryColumn")&&this.set_geometryColumn(parseInt(e.attributes.getNamedItem("GeometryColumn").nodeValue)),e.attributes.getNamedItem("AltType").nodeValue){case"Depth":this.set_altType(0);break;case"Altitude":this.set_altType(1);break;case"Distance":this.set_altType(2);break;case"SeaLevel":this.set_altType(3);break;case"Terrain":this.set_altType(4)}switch(this.set_markerMix(0),e.attributes.getNamedItem("ColorMap").nodeValue){case"Same_For_All":this.set__colorMap(0);break;case"Group_by_Values":this.set__colorMap(2);break;case"Per_Column_Literal":this.set__colorMap(3)}switch(this.set_markerColumn(parseInt(e.attributes.getNamedItem("MarkerColumn").nodeValue)),this.set_colorMapColumn(parseInt(e.attributes.getNamedItem("ColorMapColumn").nodeValue)),e.attributes.getNamedItem("PlotType").nodeValue){case"Gaussian":this.set_plotType(0);break;case"Point":this.set_plotType(1);break;case"Circle":this.set_plotType(2);break;case"PushPin":this.set_plotType(4)}switch(this.set_markerIndex(parseInt(e.attributes.getNamedItem("MarkerIndex").nodeValue)),e.attributes.getNamedItem("MarkerScale").nodeValue){case"Screen":this.set_markerScale(0);break;case"World":this.set_markerScale(1)}switch(e.attributes.getNamedItem("AltUnit").nodeValue){case"Meters":this.set_altUnit(1);break;case"Feet":this.set_altUnit(2);break;case"Inches":this.set_altUnit(3);break;case"Miles":this.set_altUnit(4);break;case"Kilometers":this.set_altUnit(5);break;case"AstronomicalUnits":this.set_altUnit(6);break;case"LightYears":this.set_altUnit(7);break;case"Parsecs":this.set_altUnit(8);break;case"MegaParsecs":this.set_altUnit(9);break;case"Custom":this.set_altUnit(10)}switch(this.set_altColumn(parseInt(e.attributes.getNamedItem("AltColumn").nodeValue)),this.set_startDateColumn(parseInt(e.attributes.getNamedItem("StartDateColumn").nodeValue)),this.set_endDateColumn(parseInt(e.attributes.getNamedItem("EndDateColumn").nodeValue)),this.set_sizeColumn(parseInt(e.attributes.getNamedItem("SizeColumn").nodeValue)),this.set_hyperlinkFormat(e.attributes.getNamedItem("HyperlinkFormat").nodeValue),this.set_hyperlinkColumn(parseInt(e.attributes.getNamedItem("HyperlinkColumn").nodeValue)),this.set_scaleFactor(parseFloat(e.attributes.getNamedItem("ScaleFactor").nodeValue)),e.attributes.getNamedItem("PointScaleType").nodeValue){case"Linear":this.set_pointScaleType(0);break;case"Power":this.set_pointScaleType(1);break;case"Log":this.set_pointScaleType(2);break;case"Constant":this.set_pointScaleType(3);break;case"StellarMagnitude":this.set_pointScaleType(4)}if(null!=e.attributes.getNamedItem("ShowFarSide")&&this.set_showFarSide(ss.ss.boolean(e.attributes.getNamedItem("ShowFarSide").nodeValue)),null!=e.attributes.getNamedItem("RaUnits"))switch(e.attributes.getNamedItem("RaUnits").nodeValue){case"Hours":this.set_raUnits(0);break;case"Degrees":this.set_raUnits(1)}if(null!=e.attributes.getNamedItem("HoverTextColumn")&&this.set_nameColumn(parseInt(e.attributes.getNamedItem("HoverTextColumn").nodeValue)),null!=e.attributes.getNamedItem("XAxisColumn")){switch(this.set_xAxisColumn(parseInt(e.attributes.getNamedItem("XAxisColumn").nodeValue)),this.set_xAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("XAxisReverse").nodeValue)),this.set_yAxisColumn(parseInt(e.attributes.getNamedItem("YAxisColumn").nodeValue)),this.set_yAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("YAxisReverse").nodeValue)),this.set_zAxisColumn(parseInt(e.attributes.getNamedItem("ZAxisColumn").nodeValue)),this.set_zAxisReverse(ss.ss.boolean(e.attributes.getNamedItem("ZAxisReverse").nodeValue)),e.attributes.getNamedItem("CartesianScale").nodeValue){case"Meters":this.set_cartesianScale(1);break;case"Feet":this.set_cartesianScale(2);break;case"Inches":this.set_cartesianScale(3);break;case"Miles":this.set_cartesianScale(4);break;case"Kilometers":this.set_cartesianScale(5);break;case"AstronomicalUnits":this.set_cartesianScale(6);break;case"LightYears":this.set_cartesianScale(7);break;case"Parsecs":this.set_cartesianScale(8);break;case"MegaParsecs":this.set_cartesianScale(9);break;case"Custom":this.set_cartesianScale(10)}this.set_cartesianCustomScale(parseFloat(e.attributes.getNamedItem("CartesianCustomScale").nodeValue))}null!=e.attributes.getNamedItem("DynamicData")&&(this.set_dynamicData(ss.ss.boolean(e.attributes.getNamedItem("DynamicData").nodeValue)),this.set_autoUpdate(ss.ss.boolean(e.attributes.getNamedItem("AutoUpdate").nodeValue)),this.set_dataSourceUrl(e.attributes.getNamedItem("DataSourceUrl").nodeValue))},get_decay:function(){return this.decay},set_decay:function(e){return this.decay!==e&&(this.version++,this.decay=e),e},get_coordinatesType:function(){return this._coordinatesType$1},set_coordinatesType:function(e){return this._coordinatesType$1!==e&&(this.version++,this._coordinatesType$1=e),e},get_latColumn:function(){return this.latColumn},set_latColumn:function(e){return this.latColumn!==e&&(this.version++,this.latColumn=e),e},get_lngColumn:function(){return this.lngColumn},set_lngColumn:function(e){return this.lngColumn!==e&&(this.version++,this.lngColumn=e),e},get_geometryColumn:function(){return this.geometryColumn},set_geometryColumn:function(e){return this.geometryColumn!==e&&(this.version++,this.geometryColumn=e),e},get_xAxisColumn:function(){return this._xAxisColumn$1},set_xAxisColumn:function(e){return this._xAxisColumn$1!==e&&(this.version++,this._xAxisColumn$1=e),e},get_yAxisColumn:function(){return this._yAxisColumn$1},set_yAxisColumn:function(e){return this._yAxisColumn$1!==e&&(this.version++,this._yAxisColumn$1=e),e},get_zAxisColumn:function(){return this._zAxisColumn$1},set_zAxisColumn:function(e){return this._zAxisColumn$1!==e&&(this.version++,this._zAxisColumn$1=e),e},get_xAxisReverse:function(){return this._xAxisReverse$1},set_xAxisReverse:function(e){return this._xAxisReverse$1!==e&&(this.version++,this._xAxisReverse$1=e),e},get_yAxisReverse:function(){return this._yAxisReverse$1},set_yAxisReverse:function(e){return this._yAxisReverse$1!==e&&(this.version++,this._yAxisReverse$1=e),e},get_zAxisReverse:function(){return this._zAxisReverse$1},set_zAxisReverse:function(e){return this._zAxisReverse$1!==e&&(this.version++,this._zAxisReverse$1=e),e},get_altType:function(){return this._altType$1},set_altType:function(e){return this._altType$1!==e&&(this.version++,this._altType$1=e),e},get_markerMix:function(){return this._markerMix$1},set_markerMix:function(e){return this._markerMix$1!==e&&(this.version++,this._markerMix$1=e),e},get_raUnits:function(){return this._raUnits$1},set_raUnits:function(e){return this._raUnits$1!==e&&(this.version++,this._raUnits$1=e),e},get__colorMap:function(){return this._colorMap$1},set__colorMap:function(e){return this._colorMap$1!==e&&(this.version++,this._colorMap$1=e),e},get_markerColumn:function(){return this._markerColumn$1},set_markerColumn:function(e){return this._markerColumn$1!==e&&(this.version++,this._markerColumn$1=e),e},get_colorMapColumn:function(){return this._colorMapColumn$1},set_colorMapColumn:function(e){return this._colorMapColumn$1!==e&&(this.version++,this._colorMapColumn$1=e),e},get_plotType:function(){return this._plotType$1},set_plotType:function(e){return this._plotType$1!==e&&(this.version++,this._plotType$1=e),e},get_markerIndex:function(){return this._markerIndex$1},set_markerIndex:function(e){return this._markerIndex$1!==e&&(this.version++,this._markerIndex$1=e),e},get_showFarSide:function(){return this._showFarSide$1},set_showFarSide:function(e){return this._showFarSide$1!==e&&(this.version++,this._showFarSide$1=e),e},get_markerScale:function(){return this._markerScale$1},set_markerScale:function(e){return this._markerScale$1!==e&&(this.version++,this._markerScale$1=e),e},get_altUnit:function(){return this._altUnit$1},set_altUnit:function(e){return this._altUnit$1!==e&&(this.version++,this._altUnit$1=e),e},get_cartesianScale:function(){return this._cartesianScale$1},set_cartesianScale:function(e){return this._cartesianScale$1!==e&&(this.version++,this._cartesianScale$1=e),e},get_cartesianCustomScale:function(){return this._cartesianCustomScale$1},set_cartesianCustomScale:function(e){return this._cartesianCustomScale$1!==e&&(this.version++,this._cartesianCustomScale$1=e),e},get_altColumn:function(){return this.altColumn},set_altColumn:function(e){return this.altColumn!==e&&(this.version++,this.altColumn=e),e},get_startDateColumn:function(){return this.startDateColumn},set_startDateColumn:function(e){return this.startDateColumn!==e&&(this.version++,this.startDateColumn=e),e},get_endDateColumn:function(){return this.endDateColumn},set_endDateColumn:function(e){return this.endDateColumn!==e&&(this.version++,this.endDateColumn=e),e},get_sizeColumn:function(){return this.sizeColumn},set_sizeColumn:function(e){return this.sizeColumn!==e&&(this.version++,this.sizeColumn=e),e},get_nameColumn:function(){return this.nameColumn},set_nameColumn:function(e){return this.nameColumn!==e&&(this.version++,this.nameColumn=e),e},get_hyperlinkFormat:function(){return this._hyperlinkFormat$1},set_hyperlinkFormat:function(e){return this._hyperlinkFormat$1!==e&&(this.version++,this._hyperlinkFormat$1=e),e},get_hyperlinkColumn:function(){return this._hyperlinkColumn$1},set_hyperlinkColumn:function(e){return this._hyperlinkColumn$1!==e&&(this.version++,this._hyperlinkColumn$1=e),e},get_scaleFactor:function(){return this.scaleFactor},set_scaleFactor:function(e){return this.scaleFactor!==e&&(this.version++,this.scaleFactor=e),e},get_pointScaleType:function(){return this.pointScaleType},set_pointScaleType:function(e){return this.pointScaleType!==e&&(this.version++,this.pointScaleType=e),e},draw:function(e,t,i){this.bufferIsFlat!==i&&(this.cleanUp(),this.bufferIsFlat=i),this.dirty&&(this.prepVertexBuffer(e,t),this.dirty=!1);var r=SpaceTimeController.get_jNow()-SpaceTimeController.utcToJulian(this.baseDate),n=this.scaleFactor;if(i&&this.astronomical&&1===this._markerScale$1&&(n=this.scaleFactor/(e.viewCamera.zoom/360)),null!=this.triangleList2d&&(this.triangleList2d.decay=this.decay,this.triangleList2d.sky=this.get_astronomical(),this.triangleList2d.timeSeries=this.timeSeries,this.triangleList2d.jNow=r,this.triangleList2d.draw(e,t*this.get_opacity(),1)),null!=this.triangleList&&(this.triangleList.decay=this.decay,this.triangleList.sky=this.get_astronomical(),this.triangleList.timeSeries=this.timeSeries,this.triangleList.jNow=r,this.triangleList.draw(e,t*this.get_opacity(),1)),null!=this.pointList)switch(this.pointList.depthBuffered=!1,this.pointList.showFarSide=this.get_showFarSide(),this.pointList.decay=this.timeSeries?this.decay:0,this.pointList.sky=this.get_astronomical(),this.pointList.timeSeries=this.timeSeries,this.pointList.jNow=r,this.pointList.scale=1===this._markerScale$1?n:-n,this._plotType$1){case 0:this.pointList.draw(e,t*this.get_opacity(),!1);break;case 2:this.pointList.drawTextured(e,VoTableLayer.get__circleTexture$1().texture2d,t*this.get_opacity());break;case 1:this.pointList.drawTextured(e,PushPin.getPushPinTexture(19),t*this.get_opacity());break;case 3:this.pointList.drawTextured(e,PushPin.getPushPinTexture(35),t*this.get_opacity());break;case 5:case 4:this.pointList.drawTextured(e,PushPin.getPushPinTexture(this._markerIndex$1),t*this.get_opacity())}return null!=this.lineList&&(this.lineList.sky=this.get_astronomical(),this.lineList.decay=this.decay,this.lineList.timeSeries=this.timeSeries,this.lineList.jNow=r,this.lineList.drawLines(e,t*this.get_opacity())),null!=this.lineList2d&&(this.lineList2d.sky=this.get_astronomical(),this.lineList2d.decay=this.decay,this.lineList2d.timeSeries=this.timeSeries,this.lineList2d.showFarSide=this.get_showFarSide(),this.lineList2d.jNow=r,this.lineList2d.drawLines(e,t*this.get_opacity())),!0},initFromXml:function(e){Layer.prototype.initFromXml.call(this,e)},cleanUp:function(){this.dirty=!0,null!=this.lineList&&this.lineList.clear(),null!=this.lineList2d&&this.lineList2d.clear(),null!=this.triangleList2d&&this.triangleList2d.clear(),null!=this.pointList&&this.pointList.clear(),null!=this.triangleList&&this.triangleList.clear()},dynamicUpdate:function(){return!1},addFilesToCabinet:function(e){var t=this._filename$1,i=e.tempDirectory+ss.ss.format("{0}\\{1}.txt",e.get_packageID(),this.id.toString());t.substring(0,t.lastIndexOf("\\")+1),i.substring(0,i.lastIndexOf("\\")+1)},loadData:function(e,t){var i=this,r=e.getFileBlob(t),n=new FileReader;n.onloadend=function(e){var t=ss.ss.safeCast(n.result,String);i._table$1=VoTable.loadFromString(t),i.set_lngColumn(i._table$1.getRAColumn().index),i.set_latColumn(i._table$1.getDecColumn().index)},n.readAsText(r)},canCopyToClipboard:function(){return!0},copyToClipboard:function(){},findClosest:function(e,t,i,r){var n,s=Coordinates.geoTo3dDouble(e.get_lat(),e.get_lng());if(null!=i){var a=Coordinates.raDecTo3dAu(i.get_RA(),-i.get_dec(),-1);t=(n=Vector3d.subtractVectors(s,a)).length()}for(var o=-1,l=0,h=ss.ss.enumerate(this.positions);h.moveNext();){var c=h.current;(n=Vector3d.subtractVectors(s,c)).length()<t&&(t=n.length(),o=l),l++}if(-1===o)return i;var u=Coordinates.cartesianToSpherical2(this.positions[o]),d=this._table$1.rows[o].columnData[this.nameColumn].toString();this.nameColumn!==this.startDateColumn&&this.nameColumn!==this.endDateColumn||(d=SpreadSheetLayer.parseDate(d).toString()),ss.ss.emptyString(d)&&(d=ss.ss.format("RA={0}, Dec={1}",Coordinates.formatHMS(u.get_RA()),Coordinates.formatDMS(u.get_dec())));for(var _=Place.create(d,u.get_lat(),u.get_RA(),268435456,"",2,-1),g={},f=0;f<ss.ss.keyCount(this._table$1.columns);f++){var m=this._table$1.rows[o].get_item(f).toString();f!==this.startDateColumn&&f!==this.endDateColumn||(m=SpreadSheetLayer.parseDate(m).toString()),ss.ss.keyExists(g,this._table$1.column[f].name)||ss.ss.emptyString(this._table$1.column[f].name)?g["Column"+f.toString()]=m:g[this._table$1.column[f].name]=m}return _.set_tag(g),_},prepVertexBuffer:function(e,t){var i=this._table$1.getColumnByUcd("meta.id");null==i&&(i=this._table$1.column[0]);var r=this.isSiapResultSet();null==this.pointList&&(this.pointList=new PointList(e)),null==this.lineList2d&&(this.lineList2d=new LineList),this.lineList2d.clear();var n=this._table$1.getColumnByUcd("phys.area;obs.field");null==n&&ss.ss.keyExists(this._table$1.columns,"regionSTCS")&&(n=this._table$1.columns.regionSTCS),this.get_plotType()?this.set_markerScale(0):this.set_markerScale(1);var s=[],a=new TimeSeriesPointVertex;this.positions.length=0;var o=Color.fromArgb(ss.ss.truncate(t*this.get_color().a),this.get_color().r,this.get_color().g,this.get_color().b);this.pointScaleType=4;for(var l=ss.ss.enumerate(this._table$1.rows);l.moveNext();){var h=l.current;try{if(this.lngColumn>-1&&this.latColumn>-1){var c=parseFloat(h.get_item(this.get_lngColumn()).toString()),u=parseFloat(h.get_item(this.get_latColumn()).toString()),d=Coordinates.geoTo3dDouble(u,c);if(a.position=d,this.positions.push(a.position),a.set_color(o),this.sizeColumn>-1)try{if(this.get_markerScale())switch(this.pointScaleType){case 0:a.pointSize=parseFloat(h.get_item(this.sizeColumn).toString());break;case 2:a.pointSize=Math.log(parseFloat(h.get_item(this.sizeColumn).toString()));break;case 1:a.pointSize=Math.pow(2,parseFloat(h.get_item(this.sizeColumn).toString()));break;case 4:var _=parseFloat(h.get_item(this.sizeColumn).toString());a.pointSize=40/Math.pow(1.6,_)*10;break;case 3:a.pointSize=1}else a.pointSize=20}catch(e){a.pointSize=.01}else this.get_markerScale()?a.pointSize=100*Math.pow(2,1):a.pointSize=20;if(this.startDateColumn>-1){var g=ss.ss.date(h.get_item(this.startDateColumn).toString());a.tu=SpaceTimeController.utcToJulian(g),a.tv=0}s.push(a),this.pointList.addPoint(a.position,a.color,new Dates(a.tu,a.tv),a.pointSize)}r&&null!=n&&this._addSiapStcRow$1(n.name,h,h===this._table$1.selectedRow)}catch(e){}this.lines=!1}return r&&null!=n&&this._addSiapStcRow$1(n.name,this._table$1.selectedRow,!0),!0},_addSiapStcRow$1:function(e,t,i){var r=ss.ss.replaceString(t.getColumnData(e).toString(),"  "," "),n=Color.fromArgb(120,255,255,255);if(i&&(n=Colors.get_yellow()),ss.ss.startsWith(r,"Polygon J2000"))for(var s=r.split(" "),a=s.length,o=0;o<a;)if("Polygon"===s[o]){o+=2;for(var l=new Vector3d,h=new Vector3d,c=!0,u=o;u<a;u+=2){if("Polygon"===s[u]){c=!0;break}var d=15*Coordinates.parseRA(s[u],!0)+180,_=Coordinates.parseDec(s[u+1]),g=Coordinates.geoTo3dDouble(_,d);c?(h=g,c=!1):this.lineList2d.addLine(l,g,n,new Dates(0,0)),l=g,o+=2}a>4&&this.lineList2d.addLine(h,l,n,new Dates(0,0))}},isSiapResultSet:function(){return null!=this._table$1.getColumnByUcd("vox:image.title")&&null!=this._table$1.getColumnByUcd("VOX:Image.AccessReference")},get_header:function(){for(var e=new Array(ss.ss.keyCount(this._table$1.columns)),t=0,i=ss.ss.enumerate(this._table$1.column);i.moveNext();){var r=i.current;e[t++]=r.name}return e},get_table:function(){return this._table$1},set_table:function(e){return this._table$1=e,e}};registerType("VoTableLayer",[VoTableLayer,VoTableLayer$,Layer]);var ReferenceFrames={sky:0,ecliptic:1,galactic:2,sun:3,mercury:4,venus:5,earth:6,mars:7,jupiter:8,saturn:9,uranus:10,neptune:11,pluto:12,moon:13,io:14,europa:15,ganymede:16,callisto:17,custom:18,identity:19,sandbox:20};function LayerManager(){}registerType("ReferenceFrames",ReferenceFrames),registerEnum("ReferenceFrames",ReferenceFrames),LayerManager._version=0,LayerManager._tourLayers=!1,LayerManager._layerMaps={},LayerManager._layerMapsTours={},LayerManager._allMaps={},LayerManager._allMapsTours={},LayerManager._currentMap="Earth",LayerManager._layerList={},LayerManager._layerListTours={},LayerManager._moonfile="",LayerManager._selectedLayer=null,LayerManager._lastMenuClick=new Vector2d,LayerManager.get_version=function(){return LayerManager._version},LayerManager.set_version=function(e){return LayerManager._version=e,e},LayerManager.get_frameWizardDialog=function(){return LayerManager._frameWizardDialog},LayerManager.get_dataVizWizardDialog=function(){return LayerManager._dataVizWizardDialog},LayerManager.get_referenceFramePropsDialog=function(){return LayerManager._referenceFramePropsDialog},LayerManager.get_greatCircleDlg=function(){return LayerManager._greatCircleDialog},LayerManager.get_tourLayers=function(){return LayerManager._tourLayers},LayerManager.set_tourLayers=function(e){return LayerManager._tourLayers===e||e?LayerManager._tourLayers!==e&&e&&(LayerManager._tourLayers=e,LayerManager.initLayers()):(LayerManager._clearLayers(),LayerManager._tourLayers=e,LayerManager.loadTree()),e},LayerManager.loadTree=function(){null!=globalScriptInterface&&globalScriptInterface.refreshLayerManagerNow()},LayerManager.get_layerMaps=function(){return LayerManager.get_tourLayers()?LayerManager._layerMapsTours:LayerManager._layerMaps},LayerManager.set_layerMaps=function(e){return LayerManager.get_tourLayers()?LayerManager._layerMapsTours=e:LayerManager._layerMaps=e,e},LayerManager.get_allMaps=function(){return LayerManager.get_tourLayers()?LayerManager._allMapsTours:LayerManager._allMaps},set_layerManagerGetAllMaps(LayerManager.get_allMaps),LayerManager.set_allMaps=function(e){return LayerManager.get_tourLayers()?LayerManager._allMapsTours=e:LayerManager._allMaps=e,e},LayerManager.get_currentMap=function(){return LayerManager._currentMap},LayerManager.set_currentMap=function(e){return LayerManager._currentMap=e,e},LayerManager.get_layerList=function(){return LayerManager.get_tourLayers()?LayerManager._layerListTours:LayerManager._layerList},LayerManager.set_layerList=function(e){return LayerManager.get_tourLayers()?LayerManager._layerListTours=e:LayerManager._layerList=e,e},LayerManager.oneTimeInitialization=function(){null==LayerManager._webFileMoons&&LayerManager.getMoonFile(URLHelpers.singleton.engineAssetUrl("moons.txt")),PushPin.triggerLoadSprite()},LayerManager.initLayers=function(){LayerManager._clearLayers();var e=null,t=!LayerManager.get_tourLayers()&&!freestandingMode;if(t){(e=new LayerMap("ISS",18)).frame.epoch=SpaceTimeController._twoLineDateToJulian("10184.51609218"),e.frame.semiMajorAxis=6728829.41,e.frame.referenceFrameType=1,e.frame.inclination=51.6442,e.frame.longitudeOfAscendingNode=147.0262,e.frame.eccentricity=9909e-7,e.frame.meanAnomolyAtEpoch=325.5563,e.frame.meanDailyMotion=5659.821558,e.frame.argumentOfPeriapsis=286.4623,e.frame.scale=1,e.frame.semiMajorAxisUnits=1,e.frame.meanRadius=130,e.frame.oblateness=0,e.frame.showOrbitPath=!0;var i,r=new Array(0),n=URLHelpers.singleton.coreDynamicUrl("wwtweb/isstle.aspx");(i=new WebFile(n)).onStateChange=function(){if(1===i.get_state()){var t=i.getText();(r=t.split("\n")).length>1&&e.frame.fromTLE(r[0],r[1],3986004418e5)}},i.send(),e.enabled=!0}LayerManager.get_layerMaps().Sun=new LayerMap("Sun",3),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Mercury",4)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Venus",5)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Earth",6)),LayerManager.get_layerMaps().Sun.childMaps.Earth.addChild(new LayerMap("Moon",13)),t&&LayerManager.get_layerMaps().Sun.childMaps.Earth.addChild(e),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Mars",7)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Jupiter",8)),LayerManager.get_layerMaps().Sun.childMaps.Jupiter.addChild(new LayerMap("Io",14)),LayerManager.get_layerMaps().Sun.childMaps.Jupiter.addChild(new LayerMap("Europa",15)),LayerManager.get_layerMaps().Sun.childMaps.Jupiter.addChild(new LayerMap("Ganymede",16)),LayerManager.get_layerMaps().Sun.childMaps.Jupiter.addChild(new LayerMap("Callisto",17)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Saturn",9)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Uranus",10)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Neptune",11)),LayerManager.get_layerMaps().Sun.addChild(new LayerMap("Pluto",12)),LayerManager._addMoons(LayerManager._moonfile),LayerManager.get_layerMaps().Sky=new LayerMap("Sky",0),LayerManager.get_layerMaps().Sun.open=!0,LayerManager._allMaps={},LayerManager._addAllMaps(LayerManager.get_layerMaps(),null),t&&LayerManager._addIss(),LayerManager._version++,LayerManager.loadTree()},LayerManager._addIss=function(){var e=new ISSLayer;e.set_name(Language.getLocalizedText(1314,"ISS Model  (Toshiyuki Takahei)")),e.enabled=Settings.get_active().get_showISSModel(),LayerManager.get_layerList()[e.id]=e,e.set_referenceFrame("ISS"),LayerManager.get_allMaps().ISS.layers.push(e),LayerManager.get_allMaps().ISS.open=!0},LayerManager._addAllMaps=function(e,t){for(var i=ss.ss.enumerate(ss.ss.keys(e));i.moveNext();){var r=e[i.current];r.frame.parent=t,LayerManager.get_allMaps()[r.get_name()]=r,LayerManager._addAllMaps(r.childMaps,r.get_name())}},LayerManager._clearLayers=function(){for(var e=ss.ss.enumerate(ss.ss.keys(LayerManager.get_layerList()));e.moveNext();){var t=e.current;LayerManager.get_layerList()[t].cleanUp()}ss.ss.clearKeys(LayerManager.get_layerList()),ss.ss.clearKeys(LayerManager.get_layerMaps())},LayerManager.getMoonFile=function(e){LayerManager._webFileMoons=new WebFile(e),LayerManager._webFileMoons.onStateChange=LayerManager.moonFileStateChange,LayerManager._webFileMoons.send()},LayerManager.moonFileStateChange=function(){2===LayerManager._webFileMoons.get_state()?alert(LayerManager._webFileMoons.get_message()):1===LayerManager._webFileMoons.get_state()&&(LayerManager._moonfile=LayerManager._webFileMoons.getText(),LayerManager.initLayers())},LayerManager._addMoons=function(e){for(var t=e.split("\r\n"),i=!0,r=ss.ss.enumerate(t);r.moveNext();){var n=r.current;if(i)i=!1;else{var s=n.split("\t");if(s.length>16){var a=s[0],o=new LayerMap(s[2],18);o.frame._systemGenerated=!0,o.frame.epoch=parseFloat(s[1]),o.frame.semiMajorAxis=1e3*parseFloat(s[3]),o.frame.referenceFrameType=1,o.frame.inclination=parseFloat(s[7]),o.frame.longitudeOfAscendingNode=parseFloat(s[8]),o.frame.eccentricity=parseFloat(s[4]),o.frame.meanAnomolyAtEpoch=parseFloat(s[6]),o.frame.meanDailyMotion=parseFloat(s[9]),o.frame.argumentOfPeriapsis=parseFloat(s[5]),o.frame.scale=1,o.frame.semiMajorAxisUnits=1,o.frame.meanRadius=1e3*parseFloat(s[16]),o.frame.rotationalPeriod=parseFloat(s[17]),o.frame.showAsPoint=!1,o.frame.showOrbitPath=!0,o.frame.set_representativeColor(Color.fromArgb(255,175,216,230)),o.frame.oblateness=0,LayerManager.get_layerMaps().Sun.childMaps[a].addChild(o)}}}},LayerManager.addVoTableLayer=function(e,t){return LayerManager.addVoTableLayerWithPlotType(e,t,2)},LayerManager.addVoTableLayerWithPlotType=function(e,t,i){var r=VoTableLayer.create(e,i);return r.set_name(t),r.set_astronomical(!0),r.set_referenceFrame("Sky"),LayerManager.get_layerList()[r.id]=r,LayerManager.get_allMaps().Sky.layers.push(r),LayerManager.get_allMaps().Sky.open=!0,r.enabled=!0,LayerManager._version++,LayerManager.loadTree(),r},LayerManager.addImageSetLayer=function(e,t){var i=ImageSetLayer.create(e);return LayerManager.addFitsImageSetLayer(i,t)},LayerManager.addImageSetLayerCallback=function(e,t,i){var r=ImageSetLayer.create(e),n=".fits"===e.get_extension()&&null==r.getFitsImage()&&e.get_projection()!==ProjectionType.healpix;return n&&(e.get_fitsProperties().onMainImageLoaded=function(e){e.applyDisplaySettings(),null!=i&&i(r)}),LayerManager.addFitsImageSetLayer(r,t),null==i||n&&!e.get_fitsProperties().mainImageLoadedEventHasFired||i(r),r},LayerManager.addFitsImageSetLayer=function(e,t){return e.doneLoading(null),e.set_name(t),e.set_astronomical(!0),e.set_referenceFrame("Sky"),LayerManager.get_layerList()[e.id]=e,LayerManager.get_allMaps().Sky.layers.push(e),LayerManager.get_allMaps().Sky.open=!0,e.enabled=!0,LayerManager._version++,LayerManager.loadTree(),e},LayerManager.getNextFitsName=function(){return LayerManager._getNextName("Fits Image")},LayerManager.getNextImageSetName=function(){return LayerManager._getNextName("Image Set")},LayerManager._getNextName=function(e){for(var t=0,i=ss.ss.enumerate(ss.ss.keys(LayerManager.get_allMaps()));i.moveNext();)for(var r=i.current,n=ss.ss.enumerate(LayerManager.get_allMaps()[r].layers);n.moveNext();){var s=n.current;if(ss.ss.startsWith(s.get_name(),e+" ")){var a=ss.ss.replaceString(s.get_name(),e+" ","");try{var o=parseInt(a);o>t&&(t=o)}catch(e){}}}return ss.ss.format("{0} {1}",e,t+1)},LayerManager._closeAllTourLoadedLayers=function(){for(var e=[],t=ss.ss.enumerate(ss.ss.keys(LayerManager.get_layerList()));t.moveNext();){var i=t.current,r=LayerManager.get_layerList()[i];r.loadedFromTour&&e.push(r.id)}for(var n=ss.ss.enumerate(e);n.moveNext();){var s=n.current;LayerManager.deleteLayerByID(s,!0,!1)}for(var a=[],o=ss.ss.enumerate(ss.ss.keys(LayerManager.get_allMaps()));o.moveNext();){i=o.current;var l=LayerManager.get_allMaps()[i];l.loadedFromTour&&!l.layers.length&&a.push(l.get_name())}for(var h=ss.ss.enumerate(a);h.moveNext();){var c=h.current;LayerManager.purgeLayerMapDeep(LayerManager.get_allMaps()[c],!0)}LayerManager.set_version(LayerManager.get_version()+1),LayerManager.loadTree()},LayerManager.purgeLayerMapDeep=function(e,t){for(var i=ss.ss.enumerate(e.layers);i.moveNext();){var r=i.current;LayerManager.deleteLayerByID(r.id,!1,!1)}e.layers.length=0;for(var n=ss.ss.enumerate(ss.ss.keys(e.childMaps));n.moveNext();){var s=n.current,a=e.childMaps[s];LayerManager.purgeLayerMapDeep(a,!1)}ss.ss.clearKeys(e.childMaps),t&&(ss.ss.emptyString(e.frame.parent)?ss.ss.keyExists(LayerManager.get_layerMaps(),e.get_name())&&delete LayerManager.get_layerMaps()[e.get_name()]:ss.ss.keyExists(LayerManager.get_allMaps(),e.frame.parent)&&delete LayerManager.get_allMaps()[e.frame.parent].childMaps[e.get_name()]),delete LayerManager.get_allMaps()[e.get_name()],LayerManager._version++},LayerManager._cleanAllTourLoadedLayers=function(){for(var e=ss.ss.enumerate(ss.ss.keys(LayerManager.get_layerList()));e.moveNext();){var t=e.current,i=LayerManager.get_layerList()[t];i.loadedFromTour&&(i.loadedFromTour=!1)}},LayerManager.mergeToursLayers=function(){LayerManager._tourLayers=!1;for(var e=!1,t=!1,i=ss.ss.enumerate(ss.ss.keys(LayerManager._allMapsTours));i.moveNext();){var r=i.current,n=LayerManager._allMapsTours[r];if(!ss.ss.keyExists(LayerManager._allMaps,n.get_name())){var s=new LayerMap(n.get_name(),18);s.frame=n.frame,s.loadedFromTour=!0,LayerManager.get_allMaps()[s.get_name()]=s}}LayerManager.connectAllChildren();for(var a=ss.ss.enumerate(ss.ss.keys(LayerManager._layerListTours));a.moveNext();){r=a.current;var o=LayerManager._layerListTours[r];ss.ss.keyExists(LayerManager.get_layerList(),o.id)&&(t||(e=!0,t=!0),e&&LayerManager.deleteLayerByID(o.id,!0,!1)),ss.ss.keyExists(LayerManager.get_layerList(),o.id)?o.cleanUp():ss.ss.keyExists(LayerManager.get_allMaps(),o.get_referenceFrame())&&(LayerManager.get_layerList()[o.id]=o,LayerManager.get_allMaps()[o.get_referenceFrame()].layers.push(o))}ss.ss.clearKeys(LayerManager._layerListTours),ss.ss.clearKeys(LayerManager._allMapsTours),ss.ss.clearKeys(LayerManager._layerMapsTours),LayerManager.loadTree()},LayerManager.connectAllChildren=function(){for(var e=ss.ss.enumerate(ss.ss.keys(LayerManager.get_allMaps()));e.moveNext();){var t=e.current,i=LayerManager.get_allMaps()[t];ss.ss.emptyString(i.frame.parent)&&!ss.ss.keyExists(LayerManager.get_layerMaps(),i.frame.name)?LayerManager.get_layerMaps()[i.get_name()]=i:!ss.ss.emptyString(i.frame.parent)&&ss.ss.keyExists(LayerManager.get_allMaps(),i.frame.parent)&&(ss.ss.keyExists(LayerManager.get_allMaps()[i.frame.parent].childMaps,i.frame.name)||(LayerManager.get_allMaps()[i.frame.parent].childMaps[i.frame.name]=i,i.parent=LayerManager.get_allMaps()[i.frame.parent]))}},LayerManager.deleteLayerByID=function(e,t,i){if(ss.ss.keyExists(LayerManager.get_layerList(),e)){var r=LayerManager.get_layerList()[e];return r.cleanUp(),t&&ss.ss.remove(LayerManager.get_allMaps()[r.get_referenceFrame()].layers,r),delete LayerManager.get_layerList()[e],LayerManager._version++,i&&LayerManager.loadTree(),!0}return!1},LayerManager._getFrameTarget=function(e,t){var i=new FrameTarget,r=Vector3d.get_empty();if(i.target=Vector3d.get_empty(),i.matrix=Matrix3d.get_identity(),!ss.ss.keyExists(LayerManager.get_allMaps(),t))return i;var n=[],s=LayerManager.get_allMaps()[t];for(n.push(s);18===s.frame.reference;)s=s.parent,n.splice(0,0,s);for(var a=e.get_world().clone(),o=e.get_worldBaseNonRotating(),l=e.get_worldBase(),h=e.get_nominalRadius(),c=ss.ss.enumerate(n);c.moveNext();){var u=c.current;18!==u.frame.reference&&20!==u.frame.reference?Planets.setupPlanetMatrix(e,Enums.parse("SolarSystemObjects",u.frame.name),Vector3d.get_empty(),!1):(u.computeFrame(e),u.frame.useRotatingParentFrame()?e.set_world(Matrix3d.multiplyMatrix(u.frame.worldMatrix,e.get_world())):e.set_world(Matrix3d.multiplyMatrix(u.frame.worldMatrix,e.get_worldBaseNonRotating())),3===u.frame.referenceFrameType&&e.set_worldBaseNonRotating(e.get_world().clone()),e.set_nominalRadius(u.frame.meanRadius))}r=e.get_world().transform(r);var d=e.get_world().transform(Vector3d.create(0,0,1)),_=Vector3d.subtractVectors(e.get_world().transform(Vector3d.create(0,1,0)),r);return _.normalize(),i.matrix=Matrix3d.lookAtLH(new Vector3d,Vector3d.subtractVectors(d,r),_),e.set_nominalRadius(h),e.set_world(a),e.set_worldBaseNonRotating(o),e.set_worldBase(l),i.target=r,i},LayerManager._prepTourLayers=function(){if(TourPlayer.get_playing()){var e=globalWWTControl.uiController;if(null!=e){var t=e.get_tour();if(null!=t.get_currentTourStop()&&(e.updateTweenPosition(-1),!t.get_currentTourStop().get_keyFramed())){t.get_currentTourStop()._updateLayerOpacity();for(var i=ss.ss.enumerate(ss.ss.keys(t.get_currentTourStop().layers));i.moveNext();){var r=i.current,n=t.get_currentTourStop().layers[r];ss.ss.keyExists(LayerManager.get_layerList(),n.id)&&(LayerManager.get_layerList()[n.id].set_opacity(n.frameOpacity),LayerManager.get_layerList()[n.id].setParams(n.frameParams))}}}}},LayerManager._draw=function(e,t,i,r,n,s){if(ss.ss.keyExists(LayerManager.get_allMaps(),r)){var a=LayerManager.get_allMaps()[r];if(a.enabled&&(ss.ss.keyCount(a.childMaps)||a.layers.length||a.frame.showAsPoint||a.frame.showOrbitPath)){if(TourPlayer.get_playing()){var o=globalWWTControl.uiController;if(null!=o){var l=o.get_tour();if(null!=l.get_currentTourStop()){o.updateTweenPosition(-1),l.get_currentTourStop()._updateLayerOpacity();for(var h=ss.ss.enumerate(ss.ss.keys(l.get_currentTourStop().layers));h.moveNext();){var c=h.current,u=l.get_currentTourStop().layers[c];ss.ss.keyExists(LayerManager.get_layerList(),u.id)&&(LayerManager.get_layerList()[u.id].set_opacity(u.frameOpacity),LayerManager.get_layerList()[u.id].setParams(u.frameParams))}}}}var d=e.get_world(),_=e.get_worldBaseNonRotating(),g=e.get_nominalRadius();1==(18===a.frame.reference|18===a.frame.reference)&&(a.computeFrame(e),1!==a.frame.referenceFrameType&&2!==a.frame.referenceFrameType?e.set_world(Matrix3d.multiplyMatrix(a.frame.worldMatrix,e.get_world())):e.set_world(Matrix3d.multiplyMatrix(a.frame.worldMatrix,e.get_worldBaseNonRotating())),e.set_nominalRadius(a.frame.meanRadius)),a.frame.showAsPoint;for(var f=0;f<2;f++)for(var m=ss.ss.enumerate(LayerManager.get_allMaps()[r].layers);m.moveNext();){var p=m.current;if(!f&&ss.ss.canCast(p,ImageSetLayer)||1===f&&!ss.ss.canCast(p,ImageSetLayer)){var C=!1;if(f||(C=!i&&p.get_overrideDefaultLayer()),p.enabled&&!C){var S=SpaceTimeController.utcToJulian(p.get_startTime()),w=SpaceTimeController.utcToJulian(p.get_endTime()),T=SpaceTimeController.utcToJulian(p.get_startTime())-(1===p.get_fadeType()||3===p.get_fadeType()?p.get_fadeSpan()/864e6:0),y=SpaceTimeController.utcToJulian(p.get_endTime())+(2===p.get_fadeType()||3===p.get_fadeType()?p.get_fadeSpan()/864e6:0);if(SpaceTimeController.get_jNow()>T&&SpaceTimeController.get_jNow()<y){var b=1;SpaceTimeController.get_jNow()<S&&(b=(SpaceTimeController.get_jNow()-T)/(p.get_fadeSpan()/864e6)),SpaceTimeController.get_jNow()>w&&(b=(y-SpaceTimeController.get_jNow())/(p.get_fadeSpan()/864e6)),p.set_astronomical(i),ss.ss.canCast(p,SpreadSheetLayer)?ss.ss.safeCast(p,SpreadSheetLayer).draw(e,t*b,s):p.draw(e,t*b,s)}}}}if(n)for(var v=ss.ss.enumerate(ss.ss.keys(LayerManager.get_allMaps()[r].childMaps));v.moveNext();){c=v.current;var M=LayerManager.get_allMaps()[r].childMaps[c];if(ss.ss.canCast(M,LayerMap)){if(M.enabled&&M.frame.showOrbitPath&&Settings.get_active().get_solarSystemOrbits()&&Settings.get_active().get_solarSystemMinorOrbits())if(1===M.frame.referenceFrameType){null==M.frame.get_orbit()&&M.frame.set_orbit(new Orbit(M.frame.get_elements(),360,M.frame.get_representativeColor(),1,M.parent.frame.meanRadius));var x=e.get_world();e.set_world(Matrix3d.multiplyMatrix(a.frame.worldMatrix,e.get_worldBaseNonRotating())),M.frame.get_orbit().draw3D(e,.5,Vector3d.create(0,0,0)),e.set_world(x)}else M.frame.referenceFrameType;18!==M.frame.reference&&19!==M.frame.reference||LayerManager._draw(e,t,i,M.get_name(),n,s)}}e.set_nominalRadius(g),e.set_world(d),e.set_worldBaseNonRotating(_)}}},LayerManager._getVisibleLayerList=function(e){for(var t={},i=ss.ss.enumerate(ss.ss.keys(LayerManager.get_layerList()));i.moveNext();){var r=i.current,n=LayerManager.get_layerList()[r];if(n.enabled){var s=new LayerInfo;s.startOpacity=s.endOpacity=n.get_opacity(),s.id=n.id,s.startParams=n.getParams(),ss.ss.keyExists(e,s.id)?(s.endOpacity=e[s.id].endOpacity,s.endParams=e[s.id].endParams):s.endParams=n.getParams(),t[n.id]=s}}return t},LayerManager.setVisibleLayerList=function(e){for(var t=ss.ss.enumerate(ss.ss.keys(LayerManager.get_layerList()));t.moveNext();){var i=t.current,r=LayerManager.get_layerList()[i];r.enabled=ss.ss.keyExists(e,r.id);try{r.enabled&&(r.set_opacity(e[r.id].frameOpacity),r.setParams(e[r.id].frameParams))}catch(e){}}},set_setManagerVisibleLayerList(LayerManager.setVisibleLayerList),LayerManager._preDraw=function(e,t,i,r,n){if(ss.ss.keyExists(LayerManager.get_allMaps(),r)){var s=LayerManager.get_allMaps()[r];if(ss.ss.keyCount(s.childMaps)||s.layers.length){if(TourPlayer.get_playing()){var a=ss.ss.safeCast(globalWWTControl.uiController,TourPlayer);if(null!=a){var o=a.get_tour();if(null!=o.get_currentTourStop()){a.updateTweenPosition(-1),o.get_currentTourStop()._updateLayerOpacity();for(var l=ss.ss.enumerate(ss.ss.keys(o.get_currentTourStop().layers));l.moveNext();){var h=l.current,c=o.get_currentTourStop().layers[h];ss.ss.keyExists(LayerManager.get_layerList(),c.id)&&(LayerManager.get_layerList()[c.id].set_opacity(c.frameOpacity),LayerManager.get_layerList()[c.id].setParams(c.frameParams))}}}}var u=e.get_world(),d=e.get_worldBaseNonRotating(),_=e.get_nominalRadius();18===s.frame.reference&&(s.computeFrame(e),1!==s.frame.referenceFrameType?e.set_world(Matrix3d.multiplyMatrix(s.frame.worldMatrix,e.get_world())):e.set_world(Matrix3d.multiplyMatrix(s.frame.worldMatrix,e.get_worldBaseNonRotating())),e.set_nominalRadius(s.frame.meanRadius));for(var g=0;g<2;g++)for(var f=ss.ss.enumerate(LayerManager.get_allMaps()[r].layers);f.moveNext();){var m=f.current;if((!g&&ss.ss.canCast(m,ImageSetLayer)||1===g&&!ss.ss.canCast(m,ImageSetLayer))&&m.enabled){var p=SpaceTimeController.utcToJulian(m.get_startTime()),C=SpaceTimeController.utcToJulian(m.get_endTime()),S=SpaceTimeController.utcToJulian(m.get_startTime())-(1===m.get_fadeType()||3===m.get_fadeType()?m.get_fadeSpan()/864e6:0),w=SpaceTimeController.utcToJulian(m.get_endTime())+(2===m.get_fadeType()||3===m.get_fadeType()?m.get_fadeSpan()/864e6:0);if(SpaceTimeController.get_jNow()>S&&SpaceTimeController.get_jNow()<w){var T=1;SpaceTimeController.get_jNow()<p&&(T=(SpaceTimeController.get_jNow()-S)/(m.get_fadeSpan()/864e6)),SpaceTimeController.get_jNow()>C&&(T=(w-SpaceTimeController.get_jNow())/(m.get_fadeSpan()/864e6)),s.frame.reference||m.set_astronomical(!0),m.preDraw(e,t*T)}}}if(n)for(var y=ss.ss.enumerate(ss.ss.keys(LayerManager.get_allMaps()[r].childMaps));y.moveNext();){h=y.current;var b=LayerManager.get_allMaps()[r].childMaps[h];18!==b.frame.reference&&19!==b.frame.reference||LayerManager._preDraw(e,t,i,b.get_name(),n)}e.set_nominalRadius(_),e.set_world(u),e.set_worldBaseNonRotating(d)}}},LayerManager.add=function(e,t){ss.ss.keyExists(LayerManager.get_layerList(),e.id)||ss.ss.keyExists(LayerManager.get_allMaps(),e.get_referenceFrame())&&(LayerManager.get_layerList()[e.id]=e,LayerManager.get_allMaps()[e.get_referenceFrame()].layers.push(e),LayerManager._version++,t&&LayerManager.loadTree())},LayerManager.layerSelectionChanged=function(e){if(LayerManager._selectedLayer=e,null!=LayerManager._selectedLayer)if(ss.ss.canCast(LayerManager._selectedLayer,LayerMap)){var t=ss.ss.safeCast(LayerManager._selectedLayer,LayerMap);null!=t&&LayerManager.set_currentMap(t.get_name())}else{var i=ss.ss.safeCast(LayerManager._selectedLayer,ImageSetLayer);if(null!=i&&ss.ss.canCast(i.get_imageSet().get_wcsImage(),FitsImage))return}globalScriptInterface.setTimeSlider("left",""),globalScriptInterface.setTimeSlider("right",""),globalScriptInterface.setTimeSlider("title",Language.getLocalizedText(667,"Time Scrubber"))},LayerManager.setTimeSliderValue=function(e){var t=ss.ss.safeCast(LayerManager._selectedLayer,ImageSetLayer);null!=t&&ss.ss.canCast(t.get_imageSet().get_wcsImage(),FitsImage)},LayerManager.showLayerMenu=function(e,t,i){if(LayerManager._lastMenuClick=Vector2d.create(t,i),LayerManager._selectedLayer=e,ss.ss.canCast(e,LayerMap)?LayerManager.set_currentMap(e.get_name()):ss.ss.canCast(e,Layer)&&LayerManager.set_currentMap(e.get_referenceFrame()),ss.ss.canCast(e,Layer)&&!ss.ss.canCast(e,SkyOverlays)){var r=e;LayerManager._contextMenu=new ContextMenuStrip;var n=ToolStripMenuItem.create(Language.getLocalizedText(225,"Rename")),s=ToolStripMenuItem.create(Language.getLocalizedText(981,"Expand")),a=ToolStripMenuItem.create(Language.getLocalizedText(982,"Collapse")),o=ToolStripMenuItem.create(Language.getLocalizedText(428,"Copy")),l=ToolStripMenuItem.create(Language.getLocalizedText(167,"Delete")),h=ToolStripMenuItem.create(Language.getLocalizedText(960,"Save...")),c=ToolStripMenuItem.create(Language.getLocalizedText(983,"Publish to Community...")),u=ToolStripMenuItem.create(Language.getLocalizedText(458,"Color/Opacity")),d=ToolStripMenuItem.create(Language.getLocalizedText(305,"Opacity")),_=ToolStripMenuItem.create(Language.getLocalizedText(20,"Properties")),g=ToolStripMenuItem.create(Language.getLocalizedText(1291,"Scale/Histogram")),f=ToolStripMenuItem.create(Language.getLocalizedText(683,"Lifetime")),m=new ToolStripSeparator,p=ToolStripMenuItem.create(Language.getLocalizedText(684,"Move to Top")),C=ToolStripMenuItem.create(Language.getLocalizedText(685,"Move Up")),S=ToolStripMenuItem.create(Language.getLocalizedText(686,"Move Down")),w=ToolStripMenuItem.create(Language.getLocalizedText(687,"Move to Bottom")),T=ToolStripMenuItem.create(Language.getLocalizedText(957,"VO Table Viewer")),y=new ToolStripSeparator,b=ToolStripMenuItem.create(Language.getLocalizedText(1294,"Background Image Set"));if(p.click=LayerManager._top_Click,C.click=LayerManager._up_Click,S.click=LayerManager._down_Click,w.click=LayerManager._bottom_Click,h.click=LayerManager._saveMenu_Click,c.click=LayerManager._publishMenu_Click,s.click=LayerManager._expand_Click,a.click=LayerManager._collapse_Click,o.click=LayerManager._copyMenu_Click,u.click=LayerManager._colorMenu_Click,l.click=LayerManager._deleteMenu_Click,n.click=LayerManager._renameMenu_Click,_.click=LayerManager._propertiesMenu_Click,g.click=LayerManager.scaleMenu_click,b.click=LayerManager._defaultImageset_Click,d.click=LayerManager._opacityMenu_Click,f.click=LayerManager._lifeTimeMenu_Click,T.click=LayerManager._showViewer_Click,LayerManager._contextMenu.items.push(n),!r.get_opened()&&null!=r.getPrimaryUI()&&r.getPrimaryUI().get_hasTreeViewNodes()&&LayerManager._contextMenu.items.push(s),r.get_opened()&&LayerManager._contextMenu.items.push(a),r.canCopyToClipboard(),LayerManager._contextMenu.items.push(l),LayerManager._contextMenu.items.push(y),LayerManager._contextMenu.items.push(u),ss.ss.canCast(e,ImageSetLayer)){LayerManager._contextMenu.items.push(b);var v=ss.ss.safeCast(e,ImageSetLayer);b.checked=v.get_overrideDefaultLayer()}(ss.ss.canCast(e,SpreadSheetLayer)||ss.ss.canCast(e,GreatCirlceRouteLayer))&&LayerManager._contextMenu.items.push(_),ss.ss.canCast(e,VoTableLayer)&&LayerManager._contextMenu.items.push(T),ss.ss.canCast(e,ImageSetLayer)&&(v=ss.ss.safeCast(e,ImageSetLayer),LayerManager._contextMenu.items.push(g)),LayerManager.get_allMaps()[r.get_referenceFrame()].layers.length>1&&(LayerManager._contextMenu.items.push(m),LayerManager._contextMenu.items.push(p),LayerManager._contextMenu.items.push(C),LayerManager._contextMenu.items.push(S),LayerManager._contextMenu.items.push(w)),LayerManager._contextMenu._show(Vector2d.create(t,i))}else if(ss.ss.canCast(e,LayerMap)){var M=ss.ss.safeCast(e,LayerMap),x="Sandbox"===Enums.toXml("ReferenceFrames",M.frame.reference),L="Dome"===M.frame.name,A="Sky"===M.frame.name;if(L)return;LayerManager._contextMenu=new ContextMenuStrip;var V=ToolStripMenuItem.create(Language.getLocalizedText(1298,"Track this frame")),P=ToolStripMenuItem.create(Language.getLocalizedText(1299,"Fly Here")),E=ToolStripMenuItem.create("Show Orbit"),I=ToolStripMenuItem.create(Language.getLocalizedText(674,"New Reference Frame")),R=ToolStripMenuItem.create(Language.getLocalizedText(675,"New Layer Group")),D=ToolStripMenuItem.create(Language.getLocalizedText(166,"Add")),k=ToolStripMenuItem.create("Add Light"),F=(ToolStripMenuItem.create(Language.getLocalizedText(956,"Add OData/table feed as Layer")),ToolStripMenuItem.create(Language.getLocalizedText(987,"New WMS Layer")),ToolStripMenuItem.create(Language.getLocalizedText(1300,"New Lat/Lng Grid"))),B=ToolStripMenuItem.create(Language.getLocalizedText(988,"New Great Circle")),N=(ToolStripMenuItem.create(Language.getLocalizedText(989,"Import Orbital Elements")),ToolStripMenuItem.create(Language.getLocalizedText(1301,"Add Minor Planet"))),$=ToolStripMenuItem.create(Language.getLocalizedText(167,"Delete")),U=ToolStripMenuItem.create(Language.getLocalizedText(425,"Paste")),O=(ToolStripMenuItem.create(Language.getLocalizedText(1290,"Add to Timeline")),ToolStripMenuItem.create(Language.getLocalizedText(1280,"Add Keyframe")),ToolStripMenuItem.create(Language.getLocalizedText(20,"Properties"))),z=(h=ToolStripMenuItem.create(Language.getLocalizedText(990,"Save Layers")),ToolStripMenuItem.create(Language.getLocalizedText(991,"Publish Layers to Community")),m=new ToolStripSeparator,new ToolStripSeparator),G=(y=new ToolStripSeparator,ToolStripMenuItem.create("As Reference Frame")),W=ToolStripMenuItem.create("As Orbital Line");if(V.click=LayerManager._trackFrame_Click,P.click=LayerManager._goTo_Click,G.click=LayerManager._addMpc_Click,W.click=LayerManager._asOrbitalLines_Click,N.dropDownItems.push(G),N.dropDownItems.push(W),D.click=LayerManager._addMenu_Click,R.click=LayerManager._newLayerGroupMenu_Click,U.click=LayerManager._pasteLayer_Click,I.click=LayerManager._newMenu_Click,$.click=LayerManager._deleteFrameMenu_Click,O.click=LayerManager._framePropertiesMenu_Click,B.click=LayerManager._addGreatCircle_Click,F.click=LayerManager._addGirdLayer_Click,ToolStripMenuItem.create("Extract Orbit Layer"),19!==M.frame.reference){if(1==(globalWWTControl.get_solarSystemMode()|globalWWTControl.sandboxMode)){var H=!1;if(18===M.frame.reference||globalWWTControl.sandboxMode)x||A||(LayerManager._contextMenu.items.push(V),H=!0),E.checked=M.frame.showOrbitPath,E.click=LayerManager._showOrbit_Click;else try{var X=Enums.toXml("ReferenceFrames",M.frame.reference);if("Sandbox"!==X){var j=Enums.parse("SolarSystemObjects",X),Y=Math.pow(2,j);E.checked=!!(Settings.get_active().get_planetOrbitsFilter()&Y),E.click=LayerManager._showOrbitPlanet_Click,E.tag=Y.toString()}}catch(e){}H&&LayerManager._contextMenu.items.push(y),A||x||(LayerManager._contextMenu.items.push(E),LayerManager._contextMenu.items.push(z)),"Sandbox"===Enums.toXml("ReferenceFrames",M.frame.reference)&&LayerManager._contextMenu.items.push(k)}A||LayerManager._contextMenu.items.push(I)}A||(LayerManager._contextMenu.items.push(B),LayerManager._contextMenu.items.push(F)),(19!==M.frame.reference&&"Sun"===M.frame.name||19===M.frame.reference&&null!=M.parent&&"Sun"===M.parent.frame.name)&&LayerManager._contextMenu.items.push(N),18===M.frame.reference&&1===M.frame.referenceFrameType&&null!=M.parent&&M.parent.frame.name,LayerManager._contextMenu.items.push(U),19===M.frame.reference&&LayerManager._contextMenu.items.push($),18===M.frame.reference&&(LayerManager._contextMenu.items.push($),LayerManager._contextMenu.items.push(O)),LayerManager._contextMenu.items.push(m),LayerManager._contextMenu._show(Vector2d.create(t,i))}},LayerManager._publishMenu_Click=function(e,t){},LayerManager._addGirdLayer_Click=function(e,t){var i=new GridLayer;i.enabled=!0,i.set_name("Lat-Lng Grid"),LayerManager.get_layerList()[i.id]=i,i.set_referenceFrame(LayerManager._currentMap),LayerManager.get_allMaps()[LayerManager._currentMap].layers.push(i),LayerManager.get_allMaps()[LayerManager._currentMap].open=!0,LayerManager._version++,LayerManager.loadTree()},LayerManager._trackFrame_Click=function(e,t){var i=LayerManager._selectedLayer;globalRenderContext.set_solarSystemTrack(20),globalRenderContext.set_trackingFrame(i.get_name()),globalRenderContext.viewCamera.zoom=globalRenderContext.targetCamera.zoom=1e-9},LayerManager._goTo_Click=function(e,t){},LayerManager._saveMenu_Click=function(e,t){},LayerManager._expand_Click=function(e,t){},LayerManager._collapse_Click=function(e,t){},LayerManager._copyMenu_Click=function(e,t){null!=LayerManager._selectedLayer&&ss.ss.canCast(LayerManager._selectedLayer,Layer)&&LayerManager._selectedLayer.copyToClipboard()},LayerManager._newLayerGroupMenu_Click=function(e,t){},LayerManager._importTLEFile=function(e){},LayerManager._makeLayerGroupNow=function(e){var t=LayerManager._selectedLayer;LayerManager._makeLayerGroup(e,t)},LayerManager._makeLayerGroup=function(e,t){var i=new ReferenceFrame;i.name=e,i.reference=19;var r=new LayerMap(i.name,19);r.frame=i,r.frame._systemGenerated=!1,t.addChild(r),r.frame.parent=t.get_name(),LayerManager.get_allMaps()[i.name]=r,LayerManager._version++},LayerManager._lifeTimeMenu_Click=function(e,t){},LayerManager._deleteFrameMenu_Click=function(e,t){},LayerManager._framePropertiesMenu_Click=function(e,t){var i=LayerManager._selectedLayer;LayerManager.get_referenceFramePropsDialog().show(i.frame,t)},LayerManager._newMenu_Click=function(e,t){var i=new ReferenceFrame;LayerManager.get_frameWizardDialog().show(i,t)},LayerManager.referenceFrameWizardFinished=function(e){var t=LayerManager._selectedLayer,i=new LayerMap(e.name,18);ss.ss.keyExists(LayerManager.get_allMaps(),e.name)||(i.frame=e,t.addChild(i),i.frame.parent=t.get_name(),LayerManager.get_allMaps()[e.name]=i,LayerManager._version++,LayerManager.loadTree())},LayerManager.pasteFromTle=function(e,t){for(var i="",r="",n=0;n<e.length;n++)e[n]=ss.ss.trim(e[n]),69===e[n].length&&ReferenceFrame.isTLECheckSumGood(e[n])&&(i.length||"1"!==e[n].substring(0,1)||(i=e[n]),r.length||"2"!==e[n].substring(0,1)||(r=e[n]));return 69===i.length&&69===r.length&&(t.fromTLE(i,r,3986004418e5),!0)},LayerManager._opacityMenu_Click=function(e,t){},LayerManager._defaultImageset_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,ImageSetLayer);i.set_overrideDefaultLayer(!i.get_overrideDefaultLayer())},LayerManager._propertiesMenu_Click=function(e,t){if(ss.ss.canCast(LayerManager._selectedLayer,SpreadSheetLayer)){var i=LayerManager._selectedLayer;LayerManager.get_dataVizWizardDialog().show(i,t)}ss.ss.canCast(LayerManager._selectedLayer,GreatCirlceRouteLayer)&&LayerManager.get_greatCircleDlg().show(LayerManager._selectedLayer,new ss.ss.EventArgs)},LayerManager._renameMenu_Click=function(e,t){var i=LayerManager._selectedLayer,r=new SimpleInput(Language.getLocalizedText(225,"Rename"),Language.getLocalizedText(228,"New Name"),i.get_name(),32);r.show(LayerManager._lastMenuClick,(function(){ss.ss.emptyString(r.text)||(i.set_name(r.text),LayerManager._version++,LayerManager.loadTree())}))},LayerManager._colorMenu_Click=function(e,t){var i=LayerManager._selectedLayer,r=new ColorPicker;null!=i.get_color()&&(r.color=i.get_color()),r.callBack=function(){i.set_color(r.color)},r.show(t)},LayerManager._addMenu_Click=function(e,t){},LayerManager._deleteMenu_Click=function(e,t){LayerManager._deleteSelectedLayer()},LayerManager._deleteSelectedLayer=function(){if(null!=LayerManager._selectedLayer&&ss.ss.canCast(LayerManager._selectedLayer,Layer)){var e=LayerManager._selectedLayer;delete LayerManager.get_layerList()[e.id],ss.ss.remove(LayerManager.get_allMaps()[LayerManager.get_currentMap()].layers,e),e.cleanUp(),e.set_version(e.get_version()+1),LayerManager.loadTree(),LayerManager._version++}},LayerManager.scaleMenu_click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,ImageSetLayer);if(null!=i){var r=new Histogram;r.image=i.getFitsImage(),r.layer=i,r.show(Vector2d.create(200,200))}},LayerManager._showViewer_Click=function(e,t){if(ss.ss.canCast(LayerManager._selectedLayer,VoTableLayer)){var i=ss.ss.safeCast(LayerManager._selectedLayer,VoTableLayer);globalScriptInterface.displayVoTableLayer(i)}},LayerManager._bottom_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,Layer);null!=i&&(ss.ss.remove(LayerManager.get_allMaps()[i.get_referenceFrame()].layers,i),LayerManager.get_allMaps()[i.get_referenceFrame()].layers.push(i)),LayerManager._version++,LayerManager.loadTree()},LayerManager._down_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,Layer);if(null!=i){var r=LayerManager.get_allMaps()[i.get_referenceFrame()].layers.lastIndexOf(i);r<LayerManager.get_allMaps()[i.get_referenceFrame()].layers.length-1&&(ss.ss.remove(LayerManager.get_allMaps()[i.get_referenceFrame()].layers,i),LayerManager.get_allMaps()[i.get_referenceFrame()].layers.splice(r+1,0,i))}LayerManager._version++,LayerManager.loadTree()},LayerManager._up_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,Layer);if(null!=i){var r=LayerManager.get_allMaps()[i.get_referenceFrame()].layers.lastIndexOf(i);r>0&&(ss.ss.remove(LayerManager.get_allMaps()[i.get_referenceFrame()].layers,i),LayerManager.get_allMaps()[i.get_referenceFrame()].layers.splice(r-1,0,i))}LayerManager._version++,LayerManager.loadTree()},LayerManager._top_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,Layer);null!=i&&(ss.ss.remove(LayerManager.get_allMaps()[i.get_referenceFrame()].layers,i),LayerManager.get_allMaps()[i.get_referenceFrame()].layers.splice(0,0,i)),LayerManager._version++,LayerManager.loadTree()},LayerManager._pasteLayer_Click=function(e,t){LayerManager.get_dataVizWizardDialog().show(LayerManager.get_currentMap(),t)},LayerManager.createSpreadsheetLayer=function(e,t,i){var r=new SpreadSheetLayer;return r.loadFromString(i,!1,!1,!1,!0),r.set_name(t),LayerManager.addSpreadsheetLayer(r,e),r},LayerManager.addSpreadsheetLayer=function(e,t){e.enabled=!0,e.set_referenceFrame(t),LayerManager.add(e,!0)},LayerManager._showOrbitPlanet_Click=function(e,t){try{var i=parseInt(e.tag.toString());Settings.get_globalSettings().get_planetOrbitsFilter()&i?Settings.get_globalSettings().set_planetOrbitsFilter(Settings.get_globalSettings().get_planetOrbitsFilter()&~i):Settings.get_globalSettings().set_planetOrbitsFilter(Settings.get_globalSettings().get_planetOrbitsFilter()|i)}catch(e){}},LayerManager._showOrbit_Click=function(e,t){var i=ss.ss.safeCast(LayerManager._selectedLayer,LayerMap);i.frame.showOrbitPath=!i.frame.showOrbitPath},LayerManager._addGreatCircle_Click=function(e,t){LayerManager._addGreatCircleLayer()},LayerManager._addMpc_Click=function(e,t){var i=LayerManager._selectedLayer,r=new SimpleInput(Language.getLocalizedText(1302,"Minor planet name or designation"),Language.getLocalizedText(238,"Name"),"",32),n=!1;do{if(1===r.showDialog())if(ss.ss.keyExists(i.childMaps,r.text))n=!0;else try{LayerManager._getMpc(r.text,i),n=!1}catch(e){n=!0}else n=!1}while(n)},LayerManager._asOrbitalLines_Click=function(e,t){var i=LayerManager._selectedLayer,r=new SimpleInput(Language.getLocalizedText(1302,"Minor planet name or designation"),Language.getLocalizedText(238,"Name"),"",32);r.show(Cursor.get_position(),(function(){ss.ss.keyExists(i.childMaps,r.text)||LayerManager._getMpcAsTLE(r.text,i)}))},LayerManager._getMpcAsTLE=function(e,t){var i=new WebFile("https://www.minorplanetcenter.net/db_search/show_object?object_id="+e);i.onStateChange=function(){if(1===i.get_state()){var r=i.getText(),n=r.indexOf("show-orbit-button"),s=r.indexOf("/form",n),a=r.substring(n,s),o=e,l=new ReferenceFrame;l.oblateness=0,l.showOrbitPath=!0,l.showAsPoint=!0,l.epoch=SpaceTimeController.utcToJulian(ss.ss.date(LayerManager._getValueByID(a,"epoch").substring(0,10))),l.semiMajorAxis=149598e3*parseFloat(LayerManager._getValueByID(a,"a"))*1e3,l.referenceFrameType=1,l.inclination=parseFloat(LayerManager._getValueByID(a,"incl")),l.longitudeOfAscendingNode=parseFloat(LayerManager._getValueByID(a,"node")),l.eccentricity=parseFloat(LayerManager._getValueByID(a,"e")),l.meanAnomolyAtEpoch=parseFloat(LayerManager._getValueByID(a,"m")),l.meanDailyMotion=ELL.meanMotionFromSemiMajorAxis(parseFloat(LayerManager._getValueByID(a,"a"))),l.argumentOfPeriapsis=parseFloat(LayerManager._getValueByID(a,"peri")),l.scale=1,l.semiMajorAxisUnits=1,l.meanRadius=10,l.oblateness=0;var h=o+"\n"+l.toTLE();LayerManager._loadOrbitsFile(e,h,t.get_name()),LayerManager.loadTree()}},i.send()},LayerManager._getMpc=function(e,t){var i=new WebFile("https://www.minorplanetcenter.net/db_search/show_object?object_id="+e);i.onStateChange=function(){var r=i.getText(),n=r.indexOf("show-orbit-button"),s=r.indexOf("/form",n),a=r.substring(n,s),o=e,l=new LayerMap(ss.ss.trim(o),18);l.frame.oblateness=0,l.frame.showOrbitPath=!0,l.frame.showAsPoint=!0,l.frame.epoch=SpaceTimeController.utcToJulian(ss.ss.date(LayerManager._getValueByID(a,"epoch").substring(0,10))),l.frame.semiMajorAxis=149598e3*parseFloat(LayerManager._getValueByID(a,"a"))*1e3,l.frame.referenceFrameType=1,l.frame.inclination=parseFloat(LayerManager._getValueByID(a,"incl")),l.frame.longitudeOfAscendingNode=parseFloat(LayerManager._getValueByID(a,"node")),l.frame.eccentricity=parseFloat(LayerManager._getValueByID(a,"e")),l.frame.meanAnomolyAtEpoch=parseFloat(LayerManager._getValueByID(a,"m")),l.frame.meanDailyMotion=ELL.meanMotionFromSemiMajorAxis(parseFloat(LayerManager._getValueByID(a,"a"))),l.frame.argumentOfPeriapsis=parseFloat(LayerManager._getValueByID(a,"peri")),l.frame.scale=1,l.frame.semiMajorAxisUnits=1,l.frame.meanRadius=10,l.frame.oblateness=0,ss.ss.keyExists(LayerManager.get_allMaps()[t.get_name()].childMaps,ss.ss.trim(o))||LayerManager.get_allMaps()[t.get_name()].addChild(l),LayerManager.get_allMaps()[l.get_name()]=l,l.frame.parent=t.get_name(),LayerManager._makeLayerGroup("Minor Planet",l),LayerManager.loadTree()}},LayerManager._getValueByID=function(e,t){var i=e.indexOf('id="'+t+'"');i=e.indexOf("value=",i)+7;var r=e.indexOf('"',i);return e.substr(i,r-i)},LayerManager._addGreatCircleLayer=function(){var e=new GreatCirlceRouteLayer,t=globalRenderContext.viewCamera;e.set_latStart(t.lat),e.set_latEnd(t.lat-5),e.set_lngStart(t.lng),e.set_lngEnd(t.lng+5),e.set_width(4),e.enabled=!0,e.set_name(Language.getLocalizedText(1144,"Great Circle Route")),LayerManager.get_layerList()[e.id]=e,e.set_referenceFrame(LayerManager._currentMap),LayerManager.get_allMaps()[LayerManager._currentMap].layers.push(e),LayerManager.get_allMaps()[LayerManager._currentMap].open=!0,LayerManager._version++,LayerManager.loadTree(),LayerManager.get_greatCircleDlg().show(e,new ss.ss.EventArgs)},LayerManager._loadOrbitsFile=function(e,t,i){var r=new OrbitLayer;return r.loadString(t),r.enabled=!0,r.set_name(e),LayerManager.get_layerList()[r.id]=r,r.set_referenceFrame(i),LayerManager.get_allMaps()[i].layers.push(r),LayerManager.get_allMaps()[i].open=!0,LayerManager._version++,LayerManager.loadTree(),r};var LayerManager$={};function LayerMap(e,t){this.childMaps={},this.parent=null,this.layers=[],this.open=!1,this.enabled=!0,this.loadedFromTour=!1,this.frame=new ReferenceFrame,this.set_name(e),this.frame.reference=t;var i=6371e3;switch(t){case 0:case 1:case 2:case 18:case 19:default:break;case 3:i=696e6;break;case 4:i=2439700;break;case 5:i=6051800;break;case 6:i=6371e3;break;case 7:i=339e4;break;case 8:i=69911e3;break;case 9:i=58232e3;break;case 10:i=25362e3;break;case 11:i=24622e3;break;case 12:i=1161e3;break;case 13:i=1737100;break;case 14:i=1821500;break;case 15:i=1561e3;break;case 16:i=2631200;break;case 17:i=2410300}this.frame.meanRadius=i}registerType("LayerManager",[LayerManager,LayerManager$,null]);var LayerMap$={addChild:function(e){e.parent=this,this.childMaps[e.get_name()]=e},get_name:function(){return this.frame.name},set_name:function(e){return this.frame.name=e,e},computeFrame:function(e){18===this.frame.reference&&this.frame.computeFrame(e)},toString:function(){return this.get_name()}};function SkyOverlays(){}registerType("LayerMap",[LayerMap,LayerMap$,null]);var SkyOverlays$={};function GroundOverlayLayer(){}registerType("SkyOverlays",[SkyOverlays,SkyOverlays$,null]);var GroundOverlayLayer$={};function FrameTarget(){}registerType("GroundOverlayLayer",[GroundOverlayLayer,GroundOverlayLayer$,null]);var FrameTarget$={};function layerFromXml(e,t){var i=e.attributes.getNamedItem("Type").nodeValue,r=ss.ss.replaceString(i,"TerraViewer.","");if(null==r)return null;var n=null;switch(r){case"SpreadSheetLayer":n=new SpreadSheetLayer;break;case"GreatCirlceRouteLayer":n=new GreatCirlceRouteLayer;break;case"GridLayer":n=new GridLayer;break;case"ImageSetLayer":n=new ImageSetLayer;break;case"Object3dLayer":n=new Object3dLayer;break;case"OrbitLayer":n=new OrbitLayer;break;case"VoTableLayer":n=new VoTableLayer;break;default:return null}return n.initFromXml(e),n}function FrameWizard(){Dialog.call(this)}registerType("FrameTarget",[FrameTarget,FrameTarget$,null]),Layer.fromXml=layerFromXml;var FrameWizard$={OK:function(e){LayerManager.referenceFrameWizardFinished(e)}};function ReferenceFrameProps(){Dialog.call(this)}registerType("FrameWizard",[FrameWizard,FrameWizard$,Dialog]);var ReferenceFrameProps$={OK:function(e){LayerManager.loadTree()}};function GreatCircleDialog(){Dialog.call(this)}registerType("ReferenceFrameProps",[ReferenceFrameProps,ReferenceFrameProps$,Dialog]);var GreatCircleDialog$={OK:function(e){}};function DataVizWizard(){Dialog.call(this)}registerType("GreatCircleDialog",[GreatCircleDialog,GreatCircleDialog$,Dialog]);var DataVizWizard$={OK:function(){}};registerType("DataVizWizard",[DataVizWizard,DataVizWizard$,Dialog]),LayerManager._frameWizardDialog=new FrameWizard,LayerManager._dataVizWizardDialog=new DataVizWizard,LayerManager._referenceFramePropsDialog=new ReferenceFrameProps,LayerManager._greatCircleDialog=new GreatCircleDialog;var UserLevel={beginner:0,intermediate:1,advanced:2,educator:3,professional:4};function TourDocument(){this._tourDirty=0,this._workingDirectory="",this.url="",this._tagId="",this._representativeThumbnailTourstop=0,this._id="",this._title="",this._runTime=0,this._lastDirtyCheck=0,this._description="",this._attributesAndCredits="",this._authorEmailOther="",this._authorEmail="",this._authorUrl="",this._authorPhone="",this._authorContactText="",this._orgName="None",this._orgUrl="",this._author="",this._authorImageUrl="",this._authorImage=null,this._organizationUrl="",this._filename="",this._level=0,this._type=268435456,this._taxonomy="",this._keywords="",this._objects="",this._editMode=!1,this.explicitTourLinks=[],this.implicitTourLinks=[],this._tourStops=[],this._currentTourstopIndex=-1,this._textureList={},this._textureList2d={},this._fileCache={},this.dontCleanUpTempFiles=!1,this._id=Guid.newGuid().toString()}registerType("UserLevel",UserLevel),registerEnum("UserLevel",UserLevel),TourDocument.get_baseWorkingDirectory=function(){return""},TourDocument.fromUrl=function(e,t){var i=new TourDocument;return i.url=e,i._callMe=t,i._cabinet=FileCabinet.fromUrl(e,ss.ss.bind("_loadXmlDocument",i)),i},TourDocument.fromUrlRaw=function(e,t){var i=new TourDocument;return i.url=e,i._callMe=t,i._cabinet=FileCabinet.fromUrl(e,t),i},set_tourDocumentFromUrlRaw(TourDocument.fromUrlRaw);var TourDocument$={get_tourDirty:function(){return this._tourDirty>0},set_tourDirty:function(e){return e?this._tourDirty++:this._tourDirty=0,e},get_workingDirectory:function(){return ss.ss.emptyString(this._workingDirectory)&&(this._workingDirectory=TourDocument.get_baseWorkingDirectory()+this._id+"\\"),this._workingDirectory},set_workingDirectory:function(e){return this._workingDirectory=e,e},_loadXmlDocument:function(){var e=this;try{var t=this._cabinet.get_masterFile(),i=new FileReader;i.onloadend=function(t){var r=ss.ss.safeCast(i.result,String),n=new DOMParser;e.fromXml(n.parseFromString(r,"text/xml")),e._callMe()},i.readAsText(this._cabinet.getFileBlob(t))}catch(e){globalScriptInterface._fireTourError(e)}},fromXml:function(e){var t=Util.selectSingleNode(e,"Tour");this._id=t.attributes.getNamedItem("ID").nodeValue,this.set_title(t.attributes.getNamedItem("Title").nodeValue),this.set_author(t.attributes.getNamedItem("Author").nodeValue),null!=t.attributes.getNamedItem("Descirption")&&this.set_description(t.attributes.getNamedItem("Descirption").nodeValue),null!=t.attributes.getNamedItem("AuthorEmail")&&(this._authorEmail=t.attributes.getNamedItem("AuthorEmail").nodeValue),null!=t.attributes.getNamedItem("Keywords")&&this.set_keywords(t.attributes.getNamedItem("Keywords").nodeValue),null!=t.attributes.getNamedItem("OrganizationName")&&this.set_orgName(t.attributes.getNamedItem("OrganizationName").nodeValue),this._organizationUrl=t.attributes.getNamedItem("OrganizationUrl").nodeValue,this._level=Enums.parse("UserLevel",t.attributes.getNamedItem("UserLevel").nodeValue),this._type=Enums.parse("Classification",t.attributes.getNamedItem("Classification").nodeValue),this._taxonomy=t.attributes.getNamedItem("Taxonomy").nodeValue;for(var i=Util.selectSingleNode(t,"TourStops"),r=ss.ss.enumerate(i.childNodes);r.moveNext();){var n=r.current;"TourStop"===n.nodeName&&this.addTourStop(TourStop._fromXml(this,n))}var s=Util.selectSingleNode(t,"ReferenceFrames");if(null!=s){for(var a=ss.ss.enumerate(s.childNodes);a.moveNext();){var o=a.current;if("ReferenceFrame"===o.nodeName){var l=new ReferenceFrame;if(l.initializeFromXml(o),!ss.ss.keyExists(layerManagerGetAllMaps(),l.name)){var h=new LayerMap(l.name,18);h.frame=l,h.loadedFromTour=!0,layerManagerGetAllMaps()[l.name]=h}}}LayerManager.connectAllChildren(),LayerManager.loadTree()}var c=Util.selectSingleNode(t,"Layers");if(null!=c){for(var u=ss.ss.enumerate(c.childNodes);u.moveNext();){var d=u.current;if("Layer"===d.nodeName){var _=Layer.fromXml(d,!0);if(null!=_){if(ss.ss.canCast(_,ImageSetLayer)){var g=_.get_imageSet();if(g.get_projection()===ProjectionType.healpix&&".tsv"===g.get_extension()){globalWWTControl.addCatalogHips(g);continue}}var f=ss.ss.format("{0}.txt",_.id.toString());ss.ss.keyExists(LayerManager.get_layerList(),_.id)&&LayerManager.deleteLayerByID(_.id,!0,!1);try{_.loadedFromTour=!0,_.loadData(this,f),LayerManager.add(_,!1)}catch(e){}}}}LayerManager.loadTree()}this._tourDirty=0},saveToDataUrl:function(){return URL.createObjectURL(this.saveToBlob())},saveToBlob:function(){this.cleanUp();var e=this.getTourXML(),t=new FileCabinet;t.set_packageID(this.get_id()),t.addFile("Tour.wwtxml",new Blob([e])),this._authorImage;for(var i=ss.ss.enumerate(this.get_tourStops());i.moveNext();)i.current._addFilesToCabinet(t,!1);for(var r=this._createLayerMasterList(),n=ss.ss.enumerate(r);n.moveNext();){var s=n.current;ss.ss.keyExists(LayerManager.get_layerList(),s)&&LayerManager.get_layerList()[s].addFilesToCabinet(t)}return this.set_tourDirty(!1),t.packageFiles()},getTourXML:function(){var e=new XmlTextWriter;e.formatting=1,e._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),e._writeStartElement("Tour"),e._writeAttributeString("ID",this._id),e._writeAttributeString("Title",this._title),e._writeAttributeString("Descirption",this.get_description()),e._writeAttributeString("Description",this.get_description()),e._writeAttributeString("RunTime",(this.get_runTime()/1e3).toString()),e._writeAttributeString("Author",this._author),e._writeAttributeString("AuthorEmail",this._authorEmail),e._writeAttributeString("OrganizationUrl",this._organizationUrl),e._writeAttributeString("OrganizationName",this.get_orgName()),e._writeAttributeString("Keywords",this.get_keywords()),e._writeAttributeString("UserLevel",Enums.toXml("UserLevel",this._level)),e._writeAttributeString("Classification",Enums.toXml("Classification",this._type)),e._writeAttributeString("Taxonomy",this._taxonomy);var t=this._isTimelineTour();e._writeAttributeString("TimeLineTour",t.toString()),e._writeStartElement("TourStops");for(var i=ss.ss.enumerate(this.get_tourStops());i.moveNext();)i.current._saveToXml(e,!0);e._writeEndElement();var r=this._createLayerMasterList(),n=this._getReferenceFrameList();e._writeStartElement("ReferenceFrames");for(var s=ss.ss.enumerate(n);s.moveNext();)s.current.saveToXml(e);e._writeEndElement(),e._writeStartElement("Layers");for(var a=ss.ss.enumerate(r);a.moveNext();){var o=a.current;if(ss.ss.keyExists(LayerManager.get_layerList(),o)){var l=LayerManager.get_layerList()[o].get_name(),h=globalRenderContext.getCatalogHipsByName(l);if(null!=h){var c=ImageSetLayer.create(h);c.id=o,c.set_name(l),c.set_referenceFrame("Sky"),c.saveToXml(e)}else LayerManager.get_layerList()[o].saveToXml(e)}}return e._writeEndElement(),e._writeFullEndElement(),e._close(),e.body},_getReferenceFrameList:function(){for(var e=[],t=ss.ss.enumerate(ss.ss.keys(layerManagerGetAllMaps()));t.moveNext();){var i=t.current,r=layerManagerGetAllMaps()[i];18!==r.frame.reference&&19!==r.frame.reference||e.indexOf(r.frame)>=0||r.frame._systemGenerated||e.push(r.frame)}return e},_createLayerMasterList:function(){for(var e=[],t=ss.ss.enumerate(this.get_tourStops());t.moveNext();)for(var i=t.current,r=ss.ss.enumerate(ss.ss.keys(i.layers));r.moveNext();){var n=r.current;e.indexOf(n)>=0||ss.ss.keyExists(LayerManager.get_layerList(),n)&&e.push(n)}return e},_isTimelineTour:function(){return!1},get_tagId:function(){return this._tagId},set_tagId:function(e){return this._tagId=e,e},get_authorThumbnailFilename:function(){return"Author.Png"},get_tourThumbnailFilename:function(){return this._representativeThumbnailTourstop<this._tourStops.length?this._tourStops[this._representativeThumbnailTourstop].get_tourStopThumbnailFilename():null},get_id:function(){return this._id},set_id:function(e){return this._id=e,e},get_title:function(){return this._title},set_title:function(e){return this._title=e,this.set_tourDirty(!0),e},get_runTime:function(){return this._runTime&&this._lastDirtyCheck===this._tourDirty||(this._runTime=this._calculateRunTime(),this._lastDirtyCheck=this._tourDirty),this._runTime},get_description:function(){return this._description},set_description:function(e){return this._description=e,this.set_tourDirty(!0),e},get_attributesAndCredits:function(){return this._attributesAndCredits},set_attributesAndCredits:function(e){return this._attributesAndCredits=e,this.set_tourDirty(!0),e},get_authorEmailOther:function(){return this._authorEmailOther},set_authorEmailOther:function(e){return this._authorEmailOther=e,this.set_tourDirty(!0),e},get_authorEmail:function(){return this._authorEmail},set_authorEmail:function(e){return this._authorEmail=e,this.set_tourDirty(!0),e},get_authorUrl:function(){return this._authorUrl},set_authorUrl:function(e){return this._authorUrl=e,this.set_tourDirty(!0),e},get_authorPhone:function(){return this._authorPhone},set_authorPhone:function(e){return this._authorPhone=e,this.set_tourDirty(!0),e},get_authorContactText:function(){return this._authorContactText},set_authorContactText:function(e){return this._authorContactText=e,this.set_tourDirty(!0),e},get_orgName:function(){return this._orgName},set_orgName:function(e){return this._orgName=e,this.set_tourDirty(!0),e},get_orgUrl:function(){return this._orgUrl},set_orgUrl:function(e){return this._orgUrl=e,this.set_tourDirty(!0),e},get_author:function(){return this._author},set_author:function(e){return this._author=e,this.set_tourDirty(!0),e},get_authorImageUrl:function(){return this._authorImageUrl},set_authorImageUrl:function(e){return this._authorImageUrl=e,this.set_tourDirty(!0),e},get_authorImage:function(){return this._authorImage},set_authorImage:function(e){return this._authorImage=e,this.set_tourDirty(!0),e},get_organizationUrl:function(){return this._organizationUrl},set_organizationUrl:function(e){return this._organizationUrl=e,this.set_tourDirty(!0),e},get_fileName:function(){return this._filename},set_fileName:function(e){return this._filename=e,e},get_level:function(){return this._level},set_level:function(e){return this._level=e,this.set_tourDirty(!0),e},get_type:function(){return this._type},set_type:function(e){return this._type=e,this.set_tourDirty(!0),e},get_taxonomy:function(){return this._taxonomy},set_taxonomy:function(e){return this._taxonomy=e,this.set_tourDirty(!0),e},get_keywords:function(){return this._keywords},set_keywords:function(e){return this._keywords=e,this.set_tourDirty(!0),e},get_objects:function(){return this._objects},set_objects:function(e){return this._objects=e,this.set_tourDirty(!0),e},get_editMode:function(){return this._editMode},set_editMode:function(e){return this._editMode=e,e},get_tourStops:function(){return this._tourStops},set_tourStops:function(e){return this._tourStops=e,e},get_currentTourstopIndex:function(){return this._currentTourstopIndex},set_currentTourstopIndex:function(e){return this._currentTourstopIndex=e,e},addTourStop:function(e){e.set_owner(this),this.get_tourStops().push(e),this._currentTourstopIndex=this._tourStops.length-1,this.set_tourDirty(!0)},insertTourStop:function(e){e.set_owner(this),this._currentTourstopIndex>-1?this.get_tourStops().splice(this._currentTourstopIndex,0,e):(this.get_tourStops().push(e),this._currentTourstopIndex=this._tourStops.length-1),this.set_tourDirty(!0)},insertAfterTourStop:function(e){e.set_owner(this),this._currentTourstopIndex>-1||this._currentTourstopIndex<this.get_tourStops().length?this.get_tourStops().splice(this._currentTourstopIndex+1,0,e):(this.get_tourStops().push(e),this._currentTourstopIndex=this._tourStops.length-1),this.set_tourDirty(!0)},removeTourStop:function(e){ss.ss.remove(this._tourStops,e),this._currentTourstopIndex>this._tourStops.length-1&&this._currentTourstopIndex--,this.set_tourDirty(!0)},_calculateRunTime:function(){for(var e=0,t=0;t<this._tourStops.length;t++)if(e+=this._tourStops[t].get_duration(),t>0&&0===this._tourStops[t].get__transition()&&(null==this._tourStops[t].get_target().get_backgroundImageset()||this._tourStops[t-1].get_target().get_backgroundImageset().get_dataSetType()===this._tourStops[t].get_target().get_backgroundImageset().get_dataSetType()&&(this._tourStops[t-1].get_target().get_backgroundImageset().get_dataSetType()!=ImageSetType.solarSystem||this._tourStops[t-1].get_target().get_target()===this._tourStops[t].get_target().get_target()))){var i=null==this._tourStops[t-1].get_endTarget()?this._tourStops[t-1].get_target().get_camParams():this._tourStops[t-1].get_endTarget().get_camParams();e+=1e3*ViewMoverSlew.create(i,this._tourStops[t].get_target().get_camParams()).get_moveTime()}return ss.ss.truncate(e)},elapsedTimeTillTourstop:function(e){if(!e&&e>=this._tourStops.length)return 0;for(var t=0,i=0;i<e;i++)if(t+=this._tourStops[i].get_duration(),i>0&&0===this._tourStops[i].get__transition()){var r=null==this._tourStops[i-1].get_endTarget()?this._tourStops[i-1].get_target().get_camParams():this._tourStops[i-1].get_endTarget().get_camParams();this._tourStops[i-1].get_target().get_backgroundImageset().get_dataSetType()!==this._tourStops[i].get_target().get_backgroundImageset().get_dataSetType()||this._tourStops[i-1].get_target().get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem&&this._tourStops[i-1].get_target().get_target()!==this._tourStops[i].get_target().get_target()||(t+=1e3*ViewMoverSlew.create(r,this._tourStops[i].get_target().get_camParams()).get_moveTime())}return t/1e3},elapsedTimeSinceLastMaster:function(e){var t=null;if(!e&&e>=this._tourStops.length)return null;for(var i=0,r=0;r<e;r++)if(this._tourStops[r].get_masterSlide()&&(i=0,t=this._tourStops[r]),i+=this._tourStops[r].get_duration(),r>0&&0===this._tourStops[r].get__transition()){var n=null==this._tourStops[r-1].get_endTarget()?this._tourStops[r-1].get_target().get_camParams():this._tourStops[r-1].get_endTarget().get_camParams();this._tourStops[r-1].get_target().get_backgroundImageset().get_dataSetType()!==this._tourStops[r].get_target().get_backgroundImageset().get_dataSetType()||this._tourStops[r-1].get_target().get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem&&this._tourStops[r-1].get_target().get_target()!==this._tourStops[r].get_target().get_target()||(i+=1e3*ViewMoverSlew.create(n,this._tourStops[r].get_target().get_camParams()).get_moveTime())}return new MasterTime(t,i/1e3)},getMasterSlideForIndex:function(e){for(var t=-1,i=0;i<e;i++)this._tourStops[i].get_masterSlide()&&(t=i);return-1===t?null:this._tourStops[t]},getTourStopIndexByID:function(e){if(!e||"Next"===e)return this._currentTourstopIndex++;for(var t=0,i=ss.ss.enumerate(this._tourStops);i.moveNext();){if(i.current.get_id()===e)return t;t++}return-1},cleanUp:function(){},getCachedTexture:function(e,t){if(null==this._textureList&&(this._textureList={}),ss.ss.keyExists(this._textureList,e))return t(),this._textureList[e];var i=this.getFileStream(e);if(ss.ss.whitespace(i))return null;var r=document.createElement("img");return r.src=this.getFileStream(e),r.addEventListener("load",(function(){t()}),!1),this._textureList[e]=r,r},getCachedTexture2d:function(e){if(null==this._textureList2d&&(this._textureList2d={}),ss.ss.keyExists(this._textureList2d,e))return this._textureList2d[e];var t=new Texture;return t.load(this.getFileStream(e)),this._textureList2d[e]=t,t},addCachedFile:function(e,t){this._fileCache[e]=t,ss.ss.keyExists(this._textureList2d,e)&&delete this._textureList2d[e],ss.ss.keyExists(this._textureList,e)&&delete this._textureList[e]},getFileStream:function(e){var t=this.getFileBlob(e);return null==t?null:URL.createObjectURL(t)},getFileBlob:function(e){return ss.ss.keyExists(this._fileCache,e)?this._fileCache[e]:null!=this._cabinet?this._cabinet.getFileBlob(this.get_workingDirectory()+e):null},get_currentTourStop:function(){return this._currentTourstopIndex>-1?this.get_tourStops()[this._currentTourstopIndex]:null},set_currentTourStop:function(e){for(var t=0,i=ss.ss.enumerate(this.get_tourStops());i.moveNext();){if(i.current===e){this._currentTourstopIndex,this._currentTourstopIndex=t;break}t++}return e},clearTempFiles:function(){}};function TourEditTab(){this.musicTrack=new SoundEditor,this.voiceTrack=new SoundEditor,this._tour=null,this.tourStopList=new TourStopList,this.tourEditorUI=new TourEditor,this._contextMenu=new ContextMenuStrip,this.nextSlideCallback=null,this.playing=!1,this._player=null,this._defultColor=Colors.get_white()}registerType("TourDocument",[TourDocument,TourDocument$,null]);var TourEditTab$={setUiStrings:function(){},get_tour:function(){return this._tour},set_tour:function(e){return this._tour=e,this.tourEditorUI.set_tour(this._tour),this.tourStopList.tour=this._tour,Overlay.defaultAnchor=1,this._tour.get_tourStops().length>0&&(globalWWTControl.gotoTarget(this._tour.get_tourStops()[0].get_target(),!1,!0,!1),this._tour.set_currentTourstopIndex(0),this.tourStopList.selectedItem=this._tour.get_currentTourstopIndex(),this.musicTrack.target=this._tour.get_currentTourStop(),this.voiceTrack.target=this._tour.get_currentTourStop(),setManagerVisibleLayerList(this._tour.get_currentTourStop().layers)),this.setEditMode(this._tour.get_editMode()),e},tour_CurrentTourstopChanged:function(){OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.tourEditorUI.selection),null!=this.tourEditorUI&&this.tourEditorUI.clearSelection(),this.tourStopList.refresh()},setFocusedChild:function(){},selectCurrent:function(){this.tourStopList.selectedItem=this._tour.get_currentTourstopIndex(),this.tourStopList.refresh()},tourEdit_Load:function(e,t){},playNow:function(e){this.playing=!0,(this.get_tour().get_editMode()||e)&&this.get_tour().set_currentTourstopIndex(-1),this.setPlayPauseMode()},_tourPlayer_TourEnded:function(e,t){},_endTour_CloseTour:function(e,t){},_endTour_LaunchTour:function(e,t){this.playNow(!0)},setEditMode:function(e){},tourStopList_ItemClicked:function(e,t){this._tour.get_currentTourStop()!==t&&(this._tour.set_currentTourStop(t),null!=t?(this.musicTrack.target=this._tour.get_currentTourStop(),this.voiceTrack.target=this._tour.get_currentTourStop()):(this.musicTrack.target=null,this.voiceTrack.target=null),this.tourEditorUI.clearSelection()),this.playing&&this._playFromHere_Click(e,new ss.ss.EventArgs)},tourStopList_ItemDoubleClicked:function(e,t){this.showSlideStartPosition(t)},showSlideStartPosition:function(e){this._tour.set_currentTourStop(e),null!=e?(this.musicTrack.target=this._tour.get_currentTourStop(),this.voiceTrack.target=this._tour.get_currentTourStop()):(this.musicTrack.target=null,this.voiceTrack.target=null),this.tourEditorUI.clearSelection(),null!=this._tour.get_currentTourStop()&&(this._tour.get_currentTourStop().syncSettings(),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1),globalWWTControl.gotoTarget(e.get_target(),!1,!0,!1),this._tour.get_currentTourStop().set_tweenPosition(0),this._tour.get_currentTourStop()._updateLayerOpacity(),setManagerVisibleLayerList(this._tour.get_currentTourStop().layers))},tourStopList_MouseClick:function(e,t){if(this._tour.get_editMode(),this.tourStopList.multipleSelection){null!=this._contextMenu&&this._contextMenu._dispose(),this._contextMenu=new ContextMenuStrip;var i=ToolStripMenuItem.create(Language.getLocalizedText(1345,"Select All")),r=ToolStripMenuItem.create(Language.getLocalizedText(427,"Cut")),n=ToolStripMenuItem.create(Language.getLocalizedText(428,"Copy")),s=ToolStripMenuItem.create(Language.getLocalizedText(429,"Paste")),a=ToolStripMenuItem.create(Language.getLocalizedText(167,"Delete"));r.click=ss.ss.bind("_cutMenu_Click",this),n.click=ss.ss.bind("_copyMenu_Click",this),s.click=ss.ss.bind("_pasteMenu_Click",this),a.click=ss.ss.bind("_deleteMenu_Click",this),i.click=ss.ss.bind("_selectAllMenu_Click",this);var o=new ToolStripSeparator;this._contextMenu.items.push(i),this._contextMenu.items.push(o),this._contextMenu.items.push(r),this._contextMenu.items.push(n),s.enabled="WorldWideTelescope.Slide"===this.tourEditorUI.clipboardType,this._contextMenu.items.push(s),this._contextMenu.items.push(a),this._contextMenu._show(Cursor.get_position())}else if(null==this._tour.get_currentTourStop()){null!=this._contextMenu&&this._contextMenu._dispose(),this._contextMenu=new ContextMenuStrip,i=ToolStripMenuItem.create(Language.getLocalizedText(1345,"Select All")),s=ToolStripMenuItem.create(Language.getLocalizedText(425,"Paste")),o=new ToolStripSeparator;var l=new ToolStripSeparator,h=ToolStripMenuItem.create(Language.getLocalizedText(426,"Add New Slide"));s.click=ss.ss.bind("_pasteMenu_Click",this),i.click=ss.ss.bind("_selectAllMenu_Click",this),h.click=ss.ss.bind("_addNewSlide_Click",this),s.enabled="WorldWideTelescope.Slide"===this.tourEditorUI.clipboardType,this._contextMenu.items.push(i),this._contextMenu.items.push(o),this._contextMenu.items.push(s),this._contextMenu.items.push(l),this._contextMenu.items.push(h),this._contextMenu._show(Cursor.get_position())}else{null!=this._contextMenu&&this._contextMenu._dispose(),this._contextMenu=new ContextMenuStrip,i=ToolStripMenuItem.create(Language.getLocalizedText(1345,"Select All")),r=ToolStripMenuItem.create(Language.getLocalizedText(427,"Cut")),n=ToolStripMenuItem.create(Language.getLocalizedText(428,"Copy")),s=ToolStripMenuItem.create(Language.getLocalizedText(429,"Paste")),a=ToolStripMenuItem.create(Language.getLocalizedText(167,"Delete")),o=new ToolStripSeparator;var c=new ToolStripSeparator,u=new ToolStripSeparator,d=new ToolStripSeparator,_=new ToolStripSeparator,g=new ToolStripSeparator,f=(h=ToolStripMenuItem.create(Language.getLocalizedText(431,"Insert New Slide")),ToolStripMenuItem.create(Language.getLocalizedText(627,"Duplicate Slide at End Position"))),m=ToolStripMenuItem.create(Language.getLocalizedText(628,"Merge Tour after slide...")),p=ToolStripMenuItem.create(Language.getLocalizedText(432,"Preview Tour From Here")),C=(l=new ToolStripSeparator,ToolStripMenuItem.create(Language.getLocalizedText(433,"Capture New Thumbnail"))),S=ToolStripMenuItem.create(Language.getLocalizedText(434,"Set Start Camera Position")),w=ToolStripMenuItem.create(Language.getLocalizedText(435,"Set End Camera Position")),T=ToolStripMenuItem.create(Language.getLocalizedText(436,"Show Start Camera Position")),y=ToolStripMenuItem.create(Language.getLocalizedText(437,"Show End Camera Position")),b=ToolStripMenuItem.create(Language.getLocalizedText(438,"Master Slide")),v=(ToolStripMenuItem.create(Language.getLocalizedText(1346,"Create Timeline")),ToolStripMenuItem.create(Language.getLocalizedText(1347,"Show Timeline")),this._tour.get_currentTourStop().get_nextSlide());switch(v){case"":case null:case"Next":v=" ("+Language.getLocalizedText(610,"Next Slide")+")";break;case"Return":v=" ("+Language.getLocalizedText(602,"Return to Caller")+")";break;default:var M=this.get_tour().getTourStopIndexByID(v);M>-1&&(v=ss.ss.emptyString(this._tour.get_tourStops()[M].get_description())?ss.ss.format(" (Slide {0})",M):" ("+this._tour.get_tourStops()[M].get_description()+")")}var x=ToolStripMenuItem.create(Language.getLocalizedText(590,"Set Next Slide")+v),L=ToolStripMenuItem.create(Language.getLocalizedText(439,"Track Date/Time/Location")),A=ToolStripMenuItem.create(Language.getLocalizedText(629,"Fade In Slide Elements")),V=ToolStripMenuItem.create(Language.getLocalizedText(20,"Properties")),P=ToolStripMenuItem.create(Language.getLocalizedText(1029,"Animation Tween Type")),E=ToolStripMenuItem.create(Language.getLocalizedText(1030,"Linear")),I=ToolStripMenuItem.create(Language.getLocalizedText(1031,"Ease In/Out")),R=ToolStripMenuItem.create(Language.getLocalizedText(1032,"Ease In")),D=ToolStripMenuItem.create(Language.getLocalizedText(1033,"Ease Out")),k=ToolStripMenuItem.create(Language.getLocalizedText(1034,"Exponential"));switch(E.tag=0,I.tag=3,R.tag=1,D.tag=2,k.tag=4,E.click=ss.ss.bind("_interpolation_Click",this),I.click=ss.ss.bind("_interpolation_Click",this),R.click=ss.ss.bind("_interpolation_Click",this),D.click=ss.ss.bind("_interpolation_Click",this),k.click=ss.ss.bind("_interpolation_Click",this),this._tour.get_currentTourStop().get_interpolationType()){case 0:E.checked=!0;break;case 1:R.checked=!0;break;case 2:D.checked=!0;break;case 3:I.checked=!0;break;case 4:k.checked=!0}P.dropDownItems.push(E),P.dropDownItems.push(I),P.dropDownItems.push(R),P.dropDownItems.push(D),P.dropDownItems.push(k),i.click=ss.ss.bind("_selectAllMenu_Click",this),f.click=ss.ss.bind("_insertDuplicate_Click",this),r.click=ss.ss.bind("_cutMenu_Click",this),n.click=ss.ss.bind("_copyMenu_Click",this),s.click=ss.ss.bind("_pasteMenu_Click",this),a.click=ss.ss.bind("_deleteMenu_Click",this),h.click=ss.ss.bind("_insertNewSlide_Click",this),V.click=ss.ss.bind("_properties_Click",this),C.click=ss.ss.bind("_captureThumbnail_Click",this),S.click=ss.ss.bind("_setSkyPosition_Click",this),w.click=ss.ss.bind("_setEndSkyPosition_Click",this),y.click=ss.ss.bind("_showEndSkyPosition_Click",this),T.click=ss.ss.bind("_showSkyPosition_Click",this),p.click=ss.ss.bind("_playFromHere_Click",this),b.click=ss.ss.bind("_masterSlide_Click",this),x.click=ss.ss.bind("_setNextSlide_Click",this),L.click=ss.ss.bind("_trackSpaceTime_Click",this),m.click=ss.ss.bind("_insertSlideshow_Click",this),A.click=ss.ss.bind("_fadeInOverlays_Click",this),this._tour.get_currentTourStop().get_masterSlide()&&(b.checked=!0),this._tour.get_currentTourStop().get_hasTime()&&(L.checked=!0),A.checked=this._tour.get_currentTourStop().get_fadeInOverlays(),this._contextMenu.items.push(i),this._contextMenu.items.push(g),this._contextMenu.items.push(r),this._contextMenu.items.push(n),s.enabled="WorldWideTelescope.Slide"===this.tourEditorUI.clipboardType,this._contextMenu.items.push(s),this._contextMenu.items.push(a),this._contextMenu.items.push(o),this._contextMenu.items.push(h),this._contextMenu.items.push(f),this._contextMenu.items.push(m),this._contextMenu.items.push(l),this._contextMenu.items.push(p),this._contextMenu.items.push(c),this._contextMenu.items.push(S),this._contextMenu.items.push(w),this._contextMenu.items.push(u),this._contextMenu.items.push(T),this._contextMenu.items.push(y),this._contextMenu.items.push(d),this._contextMenu.items.push(C),this._contextMenu.items.push(_),this._contextMenu.items.push(b),this._contextMenu.items.push(x),this._contextMenu.items.push(A),this._contextMenu.items.push(L),this._contextMenu.items.push(P),this._contextMenu._show(Vector2d.create(t.clientX,t.clientY))}},_selectAllMenu_Click:function(e,t){this.tourStopList.selectAll()},_interpolation_Click:function(e,t){var i=e;this._tour.get_currentTourStop().set_interpolationType(i.tag)},_nextSlideChosen:function(){this._selectDialog.get_OK()&&this._tour.get_currentTourStop().set_nextSlide(this._selectDialog.get_id())},_setNextSlide_Click:function(e,t){this._selectDialog=new SelectLink(null),this.nextSlideCallback(this._selectDialog,ss.ss.bind("_nextSlideChosen",this))},_insertDuplicate_Click:function(e,t){Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(530,"Duplicate Slide at End Position"),this._tour));var i=this._tour.get_currentTourStop().copy();if(null!=i){null!=i.get_endTarget()&&(i.get_endTarget().set_backgroundImageset(i.get_target().get_backgroundImageset()),i.get_endTarget().set_studyImageset(i.get_target().get_studyImageset()),i.set_target(i.get_endTarget()),i.set_startTime(i.get_endTime()),i.set_endTarget(null));for(var r=ss.ss.enumerate(i.get_overlays());r.moveNext();){var n=r.current;n.set_tweenFactor(1),n.set_animate(!n.get_animate()),n.set_animate(!n.get_animate())}i.set_tweenPosition(0),i.set_fadeInOverlays(!1),this._tour.insertAfterTourStop(i),this.tourStopList.refresh()}},_fadeInOverlays_Click:function(e,t){this._tour.get_currentTourStop().set_fadeInOverlays(!this._tour.get_currentTourStop().get_fadeInOverlays())},_insertSlideshow_Click:function(e,t){},_trackSpaceTime_Click:function(e,t){Undo.push(new UndoTourStopChange(Language.getLocalizedText(532,"Track Time Edit"),this._tour)),this._tour.get_currentTourStop().set_hasTime(!this._tour.get_currentTourStop().get_hasTime())},_masterSlide_Click:function(e,t){Undo.push(new UndoTourStopChange(Language.getLocalizedText(533,"Master Slide State Edit"),this._tour)),this._tour.get_currentTourStop().set_masterSlide(!this._tour.get_currentTourStop().get_masterSlide()),this.tourStopList.refresh()},_playFromHere_Click:function(e,t){this.playFromCurrentTourstop()},playFromCurrentTourstop:function(){this.playing=!0,globalWWTControl.gotoTarget(this._tour.get_currentTourStop().get_target(),!1,!0,!1),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1),this.setPlayPauseMode()},playFromTourstop:function(e){this._tour.set_currentTourStop(e),this.playFromCurrentTourstop()},_showSkyPosition_Click:function(e,t){null!=this._tour.get_currentTourStop()&&(globalWWTControl.gotoTarget(this._tour.get_currentTourStop().get_target(),!1,!0,!1),this._tour.get_currentTourStop().syncSettings(),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_startTime()),SpaceTimeController.set_syncToClock(!1),this._tour.get_currentTourStop().set_tweenPosition(0),setManagerVisibleLayerList(this._tour.get_currentTourStop().layers),this.tourStopList.refresh())},_showEndSkyPosition_Click:function(e,t){this._tour.get_currentTourStop().set_tweenPosition(1),this._tour.get_currentTourStop()._updateLayerOpacity(),null!=this._tour.get_currentTourStop()&&null!=this._tour.get_currentTourStop().get_endTarget()&&(globalWWTControl.gotoTargetFull(!1,!0,this._tour.get_currentTourStop().get_endTarget().get_camParams(),this._tour.get_currentTourStop().get_target().get_studyImageset(),this._tour.get_currentTourStop().get_target().get_backgroundImageset()),globalRenderContext.set_solarSystemTrack(this._tour.get_currentTourStop().get_endTarget().get_target()),SpaceTimeController.set_now(this._tour.get_currentTourStop().get_endTime()),this._tour.get_currentTourStop().syncSettings(),setManagerVisibleLayerList(this._tour.get_currentTourStop().layers),SpaceTimeController.set_syncToClock(!1),this.tourStopList.refresh(),this.tourEditorUI.clearSelection())},_setEndSkyPosition_Click:function(e,t){if(null!=this._tour.get_currentTourStop()){Undo.push(new UndoTourStopChange(Language.getLocalizedText(435,"Set End Camera Position"),this._tour));var i=Place.createCameraParams("End Place",globalRenderContext.viewCamera.copy(),268435456,globalWWTControl.constellation,globalRenderContext.get_backgroundImageset().get_dataSetType(),globalRenderContext.get_solarSystemTrack());this._tour.get_currentTourStop().set_endTarget(i),this._tour.get_currentTourStop().get_endTarget().set_constellation(globalWWTControl.constellation),this._tour.get_currentTourStop().set_endTime(SpaceTimeController.get_now()),this._tour.get_currentTourStop().set_tweenPosition(1);for(var r=ss.ss.enumerate(ss.ss.keys(this._tour.get_currentTourStop().layers));r.moveNext();){var n=r.current,s=this._tour.get_currentTourStop().layers[n];ss.ss.keyExists(LayerManager.get_layerList(),s.id)&&(s.endOpacity=LayerManager.get_layerList()[s.id].get_opacity(),s.endParams=LayerManager.get_layerList()[s.id].getParams())}this._tour.get_currentTourStop()._updateLayerOpacity(),this.tourStopList.refresh(),TimeLine.refreshUi(),this.tourEditorUI.clearSelection()}},_setSkyPosition_Click:function(e,t){null!=this._tour.get_currentTourStop()&&(Undo.push(new UndoTourStopChange(Language.getLocalizedText(434,"Set Start Camera Position"),this._tour)),this._tour.get_currentTourStop().get_target().set_target(globalRenderContext.get_solarSystemTrack()),this._tour.get_currentTourStop().get_target().set_type(globalRenderContext.get_backgroundImageset().get_dataSetType()),this._tour.get_currentTourStop().get_target().set_camParams(globalRenderContext.viewCamera.copy()),this._tour.get_currentTourStop().get_target().set_constellation(globalWWTControl.constellation),this._tour.get_currentTourStop().get_target().set_studyImageset(globalRenderContext.get_foregroundImageset()),this._tour.get_currentTourStop().get_target().set_type(globalRenderContext.get_backgroundImageset().get_dataSetType()),this._tour.get_currentTourStop().get_target().set_backgroundImageset(globalRenderContext.get_backgroundImageset().get_stockImageSet()),this._tour.get_currentTourStop().captureSettings(),this._tour.get_currentTourStop().layers=LayerManager._getVisibleLayerList(this._tour.get_currentTourStop().layers),this._tour.get_currentTourStop().set_tweenPosition(0),this.tourStopList.refresh(),TimeLine.refreshUi(),this.tourEditorUI.clearSelection())},_captureThumbnail_Click:function(e,t){null!=this._tour.get_currentTourStop()&&this._captureThumbnail(this._tour.get_currentTourStop())},_captureThumbnail:function(e){var t=this;globalWWTControl.captureThumbnail((function(i){var r=ss.ss.format("{0}.thumb.png",e.get_id());t._tour.addCachedFile(r,i),e.set_thumbnail(t._tour.getCachedTexture(r,(function(){t.tourStopList.refresh()})))}))},_properties_Click:function(e,t){throw new Error("The method or operation is not implemented.")},tourStopList_AddNewSlide:function(e,t){this.addSlide(!1),this.tourStopList.ensureAddVisible()},_addNewSlide_Click:function(e,t){this.addSlide(!1),this.tourStopList.ensureAddVisible()},_insertNewSlide_Click:function(e,t){this.addSlide(!0)},addSlide:function(e){Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(426,"Add New Slide"),this._tour)),Cursor.set_current(Cursors.get_waitCursor());var t=Place.createCameraParams("Current Screen",globalRenderContext.viewCamera.copy(),268435456,globalWWTControl.constellation,globalRenderContext.get_backgroundImageset().get_dataSetType(),globalRenderContext.get_solarSystemTrack());t.set_studyImageset(globalRenderContext.get_foregroundImageset()),t.set_backgroundImageset(globalRenderContext.get_backgroundImageset().get_stockImageSet());var i=TourStop.create(t);e?this._tour.insertTourStop(i):this._tour.addTourStop(i),null!=this._tour.get_currentTourStop()?(this.musicTrack.target=this._tour.get_currentTourStop(),this.voiceTrack.target=this._tour.get_currentTourStop()):(this.musicTrack.target=null,this.voiceTrack.target=null),this._tour.get_currentTourStop().layers=LayerManager._getVisibleLayerList(this._tour.get_currentTourStop().layers),this._captureThumbnail(i),this.tourStopList.selectedItem=this.tourStopList.findItem(i),this.tourStopList.refresh(),this.tourEditorUI.clearSelection(),Cursor.set_current(Cursors.get_defaultV()),TimeLine.refreshUi()},_deleteMenu_Click:function(e,t){Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(534,"Delete Slide"),this._tour));for(var i=ss.ss.enumerate(ss.ss.keys(this.tourStopList.selectedItems));i.moveNext();){var r=i.current,n=this.tourStopList.selectedItems[r];this._tour.removeTourStop(n)}ss.ss.clearKeys(this.tourStopList.selectedItems),this.tourStopList.selectedItem=-1,this._tour.set_currentTourStop(null),this.musicTrack.target=null,this.voiceTrack.target=null,this.tourStopList.refresh(),this.tourEditorUI.clearSelection()},_pasteMenu_Click:function(e,t){if("WorldWideTelescope.Slide"===this.tourEditorUI.clipboardType){Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(535,"Paste Slide"),this._tour));for(var i=(new DOMParser).parseFromString(this.tourEditorUI.clipboardData,"text/xml"),r=Util.selectSingleNode(i,"TourStops"),n=new ss.ss.Stack,s=ss.ss.enumerate(r.childNodes);s.moveNext();){var a=s.current;"TourStop"===a.nodeName&&((l=TourStop._fromXml(this._tour,a)).set_id(Guid.newGuid().toString()),n.push(l))}ss.ss.clearKeys(this.tourStopList.selectedItems);for(var o=this.tourStopList.selectedItem+n.count-1;n.count>0;){var l=n.pop();this._tour.insertTourStop(l),this.tourStopList.selectedItems[o--]=l}this.tourStopList.refresh(),this.tourEditorUI.clearSelection()}},_copyMenu_Click:function(e,t){var i=new XmlTextWriter;i._writeProcessingInstruction("xml","version='1.0' encoding='UTF-8'"),i._writeStartElement("TourStops");for(var r=ss.ss.enumerate(ss.ss.keys(this.tourStopList.selectedItems));r.moveNext();){var n=r.current;this.tourStopList.selectedItems[n]._saveToXml(i,!0)}i._writeEndElement(),this.tourEditorUI.clipboardType="WorldWideTelescope.Slide",this.tourEditorUI.clipboardData=i.body},_cutMenu_Click:function(e,t){Undo.push(new UndoTourSlidelistChange(Language.getLocalizedText(536,"Cut Slide"),this._tour)),this._copyMenu_Click(e,t);for(var i=ss.ss.enumerate(ss.ss.keys(this.tourStopList.selectedItems));i.moveNext();){var r=i.current,n=this.tourStopList.selectedItems[r];this._tour.removeTourStop(n)}ss.ss.clearKeys(this.tourStopList.selectedItems),this.tourStopList.refresh(),this.tourEditorUI.clearSelection()},pauseTour:function(){this.playing&&(this.playing=!1),this.setPlayPauseMode()},preview_Click:function(e,t){this.playing=!this.playing,this.playing&&this._tour.get_editMode()&&this.get_tour().set_currentTourstopIndex(-1),this.setPlayPauseMode()},setPlayPauseMode:function(){this._tour.get_editMode()?this.playing?(null==this._player&&(this._player=new TourPlayer),this._player.set_tour(this._tour),globalWWTControl.uiController=this._player,this._player.play(),this.tourStopList.showAddButton=!1):(globalWWTControl.uiController=this.tourEditorUI,null!=this._player&&this._player.stop(!1),this._player=null,globalWWTControl.set__mover(null),this.tourStopList.showAddButton=this._tour.get_editMode()):this.playing?(null==this._player&&(this._player=new TourPlayer),this._player.set_tour(this._tour),globalWWTControl.uiController=this._player,this._player.play(),this.tourStopList.showAddButton=!1):(globalWWTControl.uiController=null,globalRenderContext.freezeView(),null!=this._player&&this._player.stop(!1),this._player=null,globalWWTControl.uiController=null,globalWWTControl.set__mover(null),this.tourStopList.showAddButton=this._tour.get_editMode()),this.tourStopList.refresh()},playerTimer_Tick:function(e,t){this.playing&&null!=this._player&&(TourPlayer.get_playing()?this.tourStopList.selectedItem!==this._tour.get_currentTourstopIndex()&&(this.tourStopList.selectedItem=this._tour.get_currentTourstopIndex()):(this.playing=!1,this.setPlayPauseMode()))},insertShapeCircle_Click:function(e,t){this.tourEditorUI.addShape("",0)},insertShapeRectangle_Click:function(e,t){this.tourEditorUI.addShape("",1)},insertShapeLine_Click:function(e,t){this.tourEditorUI.addShape("",5)},insertDonut_Click:function(e,t){this.tourEditorUI.addShape("",3)},_addArrow_Click:function(e,t){this.tourEditorUI.addShape("",4)},insertVideo_Click:function(e,t){},insertAudio_Click:function(e,t){},insertHyperlink_Click:function(e,t){},colorPicker_Click:function(e,t){},tourEditTab_Leave:function(e,t){},editTourProperties_Click:function(e,t){},saveTour_Click:function(e,t){this.save(!1)},save:function(e){return!0},addVideo_Click:function(e,t){},addPicture_Click:function(e,t){},addShape_Click:function(e,t){},_addOpenRectangle_Click:function(e,t){this.tourEditorUI.addShape("",6)},_addStar_Click:function(e,t){this.tourEditorUI.addShape("",2)},addText_Click:function(e,t){},preview_EnabledChanged:function(e,t){this.playing},preview_MouseEnter:function(e,t){},preview_MouseLeave:function(e,t){},preview_MouseUp:function(e,t){},preview_MouseDown:function(e,t){},tourStopList_ItemHover:function(e,t){},refresh:function(){},undoStep:function(){Undo.peekAction()&&(Undo.stepBack(),this.tourStopList.refresh(),this.tourStopList.selectedItem=this._tour.get_currentTourstopIndex(),this.showSlideStartPosition(this._tour.get_currentTourStop()),this.refresh(),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.tourEditorUI.selection))},redoStep:function(){Undo.peekRedoAction()&&(Undo.stepForward(),this.tourStopList.refresh(),this.tourStopList.selectedItem=this._tour.get_currentTourstopIndex(),this.showSlideStartPosition(this._tour.get_currentTourStop()),this.refresh(),OverlayList._updateOverlayList(this._tour.get_currentTourStop(),this.tourEditorUI.selection))},tourStopList_ShowEndPosition:function(e,t){this._showEndSkyPosition_Click(this,new ss.ss.EventArgs)},tourStopList_ShowStartPosition:function(e,t){this.showSlideStartPosition(this.get_tour().get_currentTourStop()),this.tourEditorUI.clearSelection()},tourStopList_KeyDown:function(e,t){if(t.ctrlKey)switch(t.keyCode){case 67:this._copyMenu_Click(null,new ss.ss.EventArgs);break;case 86:this._pasteMenu_Click(null,new ss.ss.EventArgs);break;case 88:this._cutMenu_Click(null,new ss.ss.EventArgs);break;case 90:Undo.peekAction()?TourEdit._undoStep():UiTools._beep();break;case 89:Undo.peekRedoAction()?TourEdit._redoStep():UiTools._beep()}46===t.keyCode&&this._deleteMenu_Click(null,new ss.ss.EventArgs)},_ensureSelectedVisible:function(){this.tourStopList.ensureSelectedVisible()}};registerType("TourEditTab",[TourEditTab,TourEditTab$,null]);var FolderGroup={explorer:0,tour:1,search:2,constellation:3,view:4,goTo:5,community:6,context:7,voTable:8,imageStack:9};registerType("FolderGroup",FolderGroup),registerEnum("FolderGroup",FolderGroup);var FolderRefreshType={interval:0,conditionalGet:1,viewChange:2};registerType("FolderRefreshType",FolderRefreshType),registerEnum("FolderRefreshType",FolderRefreshType);var FolderType={earth:0,planet:1,sky:2,panorama:3};function Folder(){this.parent=null,this.isProxy=!1,this._versionDependent=!1,this._readOnly=!0,this._dirty=!1,this._thumbnail=null,this._proxyFolder=null,this._lastUpdate=new Date,this._childList=[],this._itemsField=[],this._imagesets=[],this._tours=[],this._folders=[],this._places=[],this._groupField=0,this._refreshTypeField=0,this._refreshTypeFieldSpecified=!1,this._browseableField=!0,this._browseableFieldSpecified=!1,this._searchableField=!1,this._typeField=0,this._communityIdField=0,this._componentIdField=0,this._permissionField=0}registerType("FolderType",FolderType),registerEnum("FolderType",FolderType);var Folder$={toString:function(){return this._nameField},get_versionDependent:function(){return this._versionDependent},set_versionDependent:function(e){this._versionDependent=e;for(var t=ss.ss.enumerate(this._folders);t.moveNext();)t.current.set_versionDependent(this._versionDependent);return e},get_readOnly:function(){return this._readOnly},set_readOnly:function(e){return this._readOnly=e,e},get_dirty:function(){return this._dirty},set_dirty:function(e){return this._dirty=e,e},loadFromUrlWithErrorCallback:function(e,t,i){this._onError=i,this.loadFromUrl(e,t)},loadFromUrl:function(e,t){this._onComplete=t,this._webFile=new WebFile(URLHelpers.singleton.rewrite(e,1)),this._webFile.onStateChange=ss.ss.bind("_loadData",this),this._webFile.send()},_loadData:function(){if(2===this._webFile.get_state())console.error(this._webFile.get_message()),null!=this._onError&&this._onError();else if(1===this._webFile.get_state()){var e=Util.selectSingleNode(this._webFile.getXml(),"Folder");if(null==e){var t=this._webFile.getXml();null!=t&&(e=Util.selectSingleNode(t,"Folder"))}null!=e&&(this._clearChildren(),this._parseXML(e)),null!=this._onComplete&&this._onComplete()}},_clearChildren:function(){this._folders.length=0,this._tours.length=0,this._places.length=0,this.get_imagesets().length=0},_parseXML:function(e){null!=e.attributes.getNamedItem("Name")?this._nameField=e.attributes.getNamedItem("Name").nodeValue:this._nameField="",null!=e.attributes.getNamedItem("Url")&&(this._urlField=e.attributes.getNamedItem("Url").nodeValue),null!=e.attributes.getNamedItem("Thumbnail")&&(this._thumbnailUrlField=e.attributes.getNamedItem("Thumbnail").nodeValue);for(var t=ss.ss.enumerate(e.childNodes);t.moveNext();){var i=t.current;switch(i.nodeName){case"Folder":var r=new Folder;r.parent=this,r._parseXML(i),this._folders.push(r);break;case"Place":this._places.push(Place._fromXml(i));break;case"ImageSet":this.get_imagesets().push(Imageset.fromXMLNode(i));break;case"Tour":this.get_tours().push(Tour._fromXml(i))}}},addChildFolder:function(e){this._folders.push(e),this._dirty=!0},removeChildFolder:function(e){ss.ss.remove(this._folders,e),this._dirty=!0},addChildPlace:function(e){this._places.push(e),this._dirty=!0},removeChildPlace:function(e){ss.ss.remove(this._places,e),this._dirty=!0},get_thumbnail:function(){return this._thumbnail},set_thumbnail:function(e){return this._thumbnail=e,e},get_bounds:function(){return this._bounds},set_bounds:function(e){return this._bounds=e,e},get_isImage:function(){return!1},get_isTour:function(){return!1},get_isFolder:function(){return!0},get_isCloudCommunityItem:function(){return!!this._communityIdField||this._permissionField>0},refresh:function(){null==this._proxyFolder&&(this._proxyFolder=new Folder,this._proxyFolder.isProxy=!0,this._proxyFolder.parent=this.parent),this._proxyFolder.loadFromUrlWithErrorCallback(this._urlField,this._childReadyCallback,this._childReadyCallback),this._childReadyCallback=null},childLoadCallback:function(e){this._childReadyCallback=e,this.get_children(),null==this._proxyFolder&&e()},get_children:function(){if(ss.ss.emptyString(this._urlField)){if(this._childList.length=0,null!=this.parent){var e=new FolderUp;e.parent=this.parent,this._childList.push(e)}if(null!=this.get_folders())for(var t=ss.ss.enumerate(this.get_folders());t.moveNext();){var i=t.current;this._childList.push(i)}if(null!=this.get_imagesets())for(var r=ss.ss.enumerate(this.get_imagesets());r.moveNext();){var n=r.current;this._childList.push(n)}if(null!=this.get_places())for(var s=ss.ss.enumerate(this.get_places());s.moveNext();){var a=s.current;this._childList.push(a)}if(null!=this.get_tours())for(var o=ss.ss.enumerate(this.get_tours());o.moveNext();){var l=o.current;this._childList.push(l)}return this._childList}var h=(this._lastUpdate-ss.ss.now())/1e3;return(1===this.get_refreshType()||null==this._proxyFolder||!this.get_refreshType()&&parseInt(this._refreshIntervalField)<h)&&this.refresh(),null!=this._proxyFolder?this._proxyFolder.get_children():null},get_msrCommunityId:function(){return this._communityIdField},set_msrCommunityId:function(e){return this._communityIdField=e,e},get_msrComponentId:function(){return this._componentIdField},set_msrComponentId:function(e){return this._componentIdField=e,e},get_permission:function(){return this._permissionField},set_permission:function(e){return this._permissionField=e,e},get_folders:function(){return this._folders},set_folders:function(e){return this._folders=e,e},get_places:function(){return this._places},set_places:function(e){return this._places=e,e},get_imagesets:function(){return this._imagesets},set_imagesets:function(e){return this._imagesets=e,e},get_tours:function(){return this._tours},set_tours:function(e){return this._tours=e,e},get_name:function(){return null==this._nameField?"":this._nameField},set_name:function(e){return this._nameField=e,e},get_group:function(){return this._groupField},set_group:function(e){return this._groupField=e,e},get_url:function(){return this._urlField},set_url:function(e){return this._urlField=e,e},get_thumbnailUrl:function(){return ss.ss.emptyString(this._thumbnailUrlField)?URLHelpers.singleton.engineAssetUrl("thumb_folder.jpg"):this._thumbnailUrlField},set_thumbnailUrl:function(e){return this._thumbnailUrlField=e,e},get_refreshType:function(){return this._refreshTypeField},set_refreshType:function(e){return this._refreshTypeField=e,this.set_refreshTypeSpecified(!0),e},get_refreshTypeSpecified:function(){return this._refreshTypeFieldSpecified},set_refreshTypeSpecified:function(e){return this._refreshTypeFieldSpecified=e,e},get_refreshInterval:function(){return this._refreshIntervalField},set_refreshInterval:function(e){return this._refreshIntervalField=e,e},get_browseable:function(){return this._browseableField},set_browseable:function(e){return this._browseableField=e,this._browseableFieldSpecified=!0,e},get_browseableSpecified:function(){return this._browseableFieldSpecified},set_browseableSpecified:function(e){return this._browseableFieldSpecified=e,e},get_searchable:function(){return this._searchableField},set_searchable:function(e){return this._searchableField=e,e},get_type:function(){return this._typeField},set_type:function(e){return this._typeField=e,e},get_subType:function(){return this._subTypeField},set_subType:function(e){return this._subTypeField=e,e}};registerType("Folder",[Folder,Folder$,null,IThumbnail]),set_makeNewFolder((function(){return new Folder}));var ThumbnailSize={small:0,big:1};function FolderBrowser(){this._items=[],this.top=10,this.left=10,this._indexTouchDown=-1,this._mouseDown=!1,this._lastX=0,this._lastY=0,this._ignoreClick=!1,this._thumbnailSize=0,this._horzSpacing=110,this._vertSpacing=75,this._thumbHeight=65,this._thumbWidth=110,this._horzMultiple=110,this._rowCount=1,this._colCount=6,this._dragging=!1,this._startIndex=0,this._startOffset=0,this._selectedItem=-1,this._hoverItem=-1,this.showAddButton=!1,this.width=0,this.height=0,this._addButtonHover=!1,this.imageClicked=!1}registerType("ThumbnailSize",ThumbnailSize),registerEnum("ThumbnailSize",ThumbnailSize),FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!1,FolderBrowser._imageLoadCount=0,FolderBrowser.create=function(){var e=new FolderBrowser;return e.height=85,e.width=1920,e.canvas=document.createElement("canvas"),e.canvas.width=e.width,e.canvas.height=e.height,e.setup(),e.loadImages(),e};var FolderBrowser$={setup:function(){this.canvas.addEventListener("click",ss.ss.bind("onClick",this),!1),this.canvas.addEventListener("dblclick",ss.ss.bind("onDoubleClick",this),!1),this.canvas.addEventListener("mousemove",ss.ss.bind("onMouseMove",this),!1),this.canvas.addEventListener("mouseup",ss.ss.bind("onMouseUp",this),!1),this.canvas.addEventListener("mousedown",ss.ss.bind("onMouseDown",this),!1),this.canvas.addEventListener("touchstart",ss.ss.bind("onTouchStart",this),!1),this.canvas.addEventListener("touchmove",ss.ss.bind("onTouchMove",this),!1),this.canvas.addEventListener("touchend",ss.ss.bind("onTouchEnd",this),!1),this.canvas.addEventListener("mouseout",ss.ss.bind("onMouseUp",this),!1)},onTouchStart:function(e){var t=e;t.preventDefault(),this._mouseDown=!0,this._lastX=t.targetTouches[0].pageX,this._lastY=t.targetTouches[0].pageY,this._indexTouchDown=this._getItemIndexFromCursor(Vector2d.create(t.targetTouches[0].pageX,t.targetTouches[0].pageY))},onTouchMove:function(e){var t=e;if(t.preventDefault(),this._mouseDown){if(t.targetTouches[0].pageX,this._lastX,t.targetTouches[0].pageY,this._lastY,this._mouseDown&&(this._dragging=!0),this._dragging){var i=Math.round((t.targetTouches[0].pageX-this._lastX+this._startOffset)/this._horzSpacing),r=Math.round(t.targetTouches[0].pageX-this._lastX+this._startOffset-i*this._horzSpacing);this._startOffset=r,this._startIndex-=i,this._startIndex<0&&(this._startOffset-=this._horzSpacing*this._startIndex,this._startIndex=0),this._lastX=t.targetTouches[0].pageX,this._lastY=t.targetTouches[0].pageY}else{var n=this._getItemIndexFromCursor(Vector2d.create(t.targetTouches[0].pageX,t.targetTouches[0].pageY));this._hoverItem!==n&&(this._hoverItem=n)}this.refresh()}},onTouchEnd:function(e){e.preventDefault(),this._dragging?(this._dragging=!1,this._ignoreClick=!0):this._indexTouchDown>-1&&this._mouseDown&&this._handleClick(this._indexTouchDown),this._startOffset=0,this._mouseDown=!1,this.refresh()},onClick:function(e){if(this._ignoreClick)this._ignoreClick=!1;else{var t=this._getItemIndexFromCursor(Vector2d.create(e.offsetX,e.offsetY));this._handleClick(t)}},_handleClick:function(e){var t=this;if(e>-1){if(ss.ss.canCast(this._items[e],Place)){var i=this._items[e];return void globalWWTControl.gotoTarget(i,!1,!1,!0)}if(ss.ss.canCast(this._items[e],Imageset)){var r=this._items[e];return void globalRenderContext.set_backgroundImageset(r)}if(ss.ss.canCast(this._items[e],Tour)){var n=this._items[e];return void globalWWTControl.playTour(n.get_tourUrl())}if(ss.ss.canCast(this._items[e],Folder)){var s=this._items[e];return this._startIndex=0,void s.childLoadCallback((function(){t._items=s.get_children(),t.refresh()}))}if(ss.ss.canCast(this._items[e],FolderUp)){var a=this._items[e];return void(null!=a.parent&&(this._startIndex=0,a.parent.childLoadCallback((function(){t._items=a.parent.get_children(),t.refresh()}))))}}},onDoubleClick:function(e){RenderTriangle.renderingOn=!RenderTriangle.renderingOn},onGestureChange:function(e){var t=e;this._mouseDown=!1,t.scale},onMouseDown:function(e){this._mouseDown=!0,this._lastX=Mouse.offsetX(this.canvas,e),this._lastY=Mouse.offsetY(this.canvas,e)},onMouseMove:function(e){if(this._mouseDown&&(this._dragging=!0),this._dragging){var t=Math.round((Mouse.offsetX(this.canvas,e)-this._lastX+this._startOffset)/this._horzSpacing),i=Math.round(Mouse.offsetX(this.canvas,e)-this._lastX+this._startOffset-t*this._horzSpacing);this._startOffset=i,this._startIndex-=t,this._startIndex<0&&(this._startOffset-=this._horzSpacing*this._startIndex,this._startIndex=0),this._lastX=Mouse.offsetX(this.canvas,e),this._lastY=Mouse.offsetY(this.canvas,e)}else{var r=this._getItemIndexFromCursor(Vector2d.create(Mouse.offsetX(this.canvas,e),Mouse.offsetY(this.canvas,e)));this._hoverItem!==r&&(this._hoverItem=r)}this.refresh()},onMouseUp:function(e){this._dragging&&(this._startOffset=0,this._dragging=!1,this._ignoreClick=!0),this._mouseDown=!1,this.refresh()},loadImages:function(){var e=this;FolderBrowser._imagesLoaded||FolderBrowser._downloading||(FolderBrowser._imageLoadCount=0,FolderBrowser._imagesLoaded=!1,FolderBrowser._downloading=!0,FolderBrowser._bmpBackground=document.createElement("img"),FolderBrowser._bmpBackground.src="images/thumbBackground.png",FolderBrowser._bmpBackground.addEventListener("load",(function(t){FolderBrowser._imageLoadCount++,5===FolderBrowser._imageLoadCount&&(FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!0,e.refresh())}),!1),FolderBrowser._bmpBackgroundHover=document.createElement("img"),FolderBrowser._bmpBackgroundHover.src="images/thumbBackgroundHover.png",FolderBrowser._bmpBackgroundHover.addEventListener("load",(function(t){FolderBrowser._imageLoadCount++,5===FolderBrowser._imageLoadCount&&(FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!0,e.refresh())}),!1),FolderBrowser._bmpBackgroundWide=document.createElement("img"),FolderBrowser._bmpBackgroundWide.src="images/thumbBackgroundWide.png",FolderBrowser._bmpBackgroundWide.addEventListener("load",(function(t){FolderBrowser._imageLoadCount++,5===FolderBrowser._imageLoadCount&&(FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!0,e.refresh())}),!1),FolderBrowser._bmpBackgroundWideHover=document.createElement("img"),FolderBrowser._bmpBackgroundWideHover.src="images/thumbBackgroundWideHover.png",FolderBrowser._bmpBackgroundWideHover.addEventListener("load",(function(t){FolderBrowser._imageLoadCount++,5===FolderBrowser._imageLoadCount&&(FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!0,e.refresh())}),!1),FolderBrowser._bmpDropInsertMarker=document.createElement("img"),FolderBrowser._bmpDropInsertMarker.src="images/dragInsertMarker.png",FolderBrowser._bmpDropInsertMarker.addEventListener("load",(function(t){FolderBrowser._imageLoadCount++,5===FolderBrowser._imageLoadCount&&(FolderBrowser._downloading=!1,FolderBrowser._imagesLoaded=!0,e.refresh())}),!1))},get_thumbnailSize:function(){return this._thumbnailSize},set_thumbnailSize:function(e){switch(this._thumbnailSize=e,e){case 1:this._horzSpacing=180,this._vertSpacing=75,this._thumbHeight=65,this._thumbWidth=180;break;case 0:this._horzSpacing=110,this._vertSpacing=75,this._thumbHeight=65,this._thumbWidth=110}return this._updatePaginator(),this.refresh(),e},refresh:function(){this.width!==window.innerWidth&&(this.width=window.innerWidth),this.paint()},get_rowCount:function(){return this._rowCount},set_rowCount:function(e){return this._rowCount!==e&&(this._rowCount=e,this._updatePaginator()),e},_updatePaginator:function(){},get_colCount:function(){return this._colCount},set_colCount:function(e){return this._colCount!==e&&(this._colCount=e,this._updatePaginator()),e},get_itemsPerPage:function(){return this._rowCount*this._colCount},get_currentPage:function(){return this._startIndex/this.get_itemsPerPage()},get_pageCount:function(){return Math.max(1,(this._items.length+this.get_itemsPerPage()-1+(this.showAddButton?1:0))/this.get_itemsPerPage())},paint:function(){var e=this,t=this.canvas.getContext("2d");if(t.fillStyle="rgb(20, 22, 31)",t.fillRect(0,0,this.width,this.height),FolderBrowser._imagesLoaded){var i,r=this.height-20,n=this.width-20;this.set_rowCount(Math.round(Math.max(r/this._thumbHeight,1))),this.set_colCount(Math.round(Math.max(n/this._horzSpacing,1))),this._horzMultiple=(n+13)/this.get_colCount(),this._startIndex=Math.round(this._startIndex/this.get_itemsPerPage()*this.get_itemsPerPage());for(var s=this._startIndex,a=0;a<this._rowCount;a++){for(var o=0;o<this._colCount;o++){if(s>=this._items.length){this._items.length&&!this.showAddButton||(i=Rectangle.create(this.left+o*this._horzMultiple+3+this._startOffset,this.top+a*this._vertSpacing,this._thumbWidth-10,60),t.drawImage(1===this._thumbnailSize?FolderBrowser._bmpBackgroundWide:FolderBrowser._bmpBackground,ss.ss.truncate(o*this._horzMultiple)+this._startOffset,a*this._vertSpacing));break}i=Rectangle.create(this.left+o*this._horzMultiple+3+this._startOffset,this.top+a*this._vertSpacing,this._thumbWidth-14,60);var l="white";s===this._hoverItem||s===this._selectedItem&&-1===this._hoverItem?(t.drawImage(1===this._thumbnailSize?FolderBrowser._bmpBackgroundWideHover:FolderBrowser._bmpBackgroundHover,this.left+ss.ss.truncate(o*this._horzMultiple)+this._startOffset,this.top+a*this._vertSpacing),l="yellow"):t.drawImage(1===this._thumbnailSize?FolderBrowser._bmpBackgroundWide:FolderBrowser._bmpBackground,this.left+ss.ss.truncate(o*this._horzMultiple)+this._startOffset,this.top+a*this._vertSpacing),this._items[s].set_bounds(Rectangle.create(this.left+o*this._horzMultiple+this._startOffset,this.top+a*this._vertSpacing,ss.ss.truncate(this._horzMultiple),this._vertSpacing));try{var h=this._items[s].get_thumbnail();null!=h?(t.drawImage(h,this.left+o*this._horzMultiple+2+this._startOffset,this.top+a*this._vertSpacing+3),t.strokeStyle="rgb(0,0,0)",t.rect(this.left+ss.ss.truncate(o*this._horzMultiple)+2+this._startOffset,this.top+a*this._vertSpacing+3,this._items[s].get_thumbnail().width,this._items[s].get_thumbnail().height)):(this._items[s].set_thumbnail(document.createElement("img")),this._items[s].get_thumbnail().src=this._items[s].get_thumbnailUrl(),this._items[s].get_thumbnail().addEventListener("load",(function(t){e.refresh()}),!1))}catch(e){}t.fillStyle=l,t.strokeStyle=l,t.lineWidth=1,t.font="normal 8pt Arial",t.fillText(this._items[s].get_name(),i.x,i.y+i.height,i.width),s++}if(s>=this._items.length)break}}},_getItemIndexFromCursor:function(e){var t=Vector2d.create(e.x+this.left,e.y+this.top);this.imageClicked=!1;var i,r=ss.ss.truncate(t.x/this._horzMultiple),n=ss.ss.truncate(t.x%this._horzMultiple);if(r>=this._colCount)return-1;if(r<0)return-1;var s=ss.ss.truncate(t.y/this._vertSpacing),a=ss.ss.truncate(t.y%this._vertSpacing);return s>=this._rowCount||s<0?-1:((i=this._startIndex+s*this._colCount+r)===this._items.length?this._addButtonHover=!0:this._addButtonHover=!1,i>this._items.length-1?-1:(this._items[i].get_isImage()&&a<16&&n>78&&(this.imageClicked=!0),i))},_addItems:function(e){this._items=e}};function HipsProperties(e){this._properties={},this._catalogColumnInfo=null,this._catalogSpreadSheetLayer=new CatalogSpreadSheetLayer,this._downloadComplete=!1,this.dataset=e,this._datasetName=e.get_name(),this._url=e.get_url(),this._url.toLowerCase().indexOf("norder")>-1&&(this._url=this._url.substring(0,this._url.toLowerCase().indexOf("norder"))),this._url+="properties",this._download()}registerType("FolderBrowser",[FolderBrowser,FolderBrowser$,null]);var HipsProperties$={get_properties:function(){return this._properties},get_catalogSpreadSheetLayer:function(){return this._catalogSpreadSheetLayer},set_catalogSpreadSheetLayer:function(e){return this._catalogSpreadSheetLayer=e,e},get_catalogColumnInfo:function(){return this._catalogColumnInfo},set_catalogColumnInfo:function(e){return this._catalogColumnInfo=e,e},get_downloadComplete:function(){return this._downloadComplete},_download:function(){this._webFile=new WebFile(this._url),this._webFile.onStateChange=ss.ss.bind("_onPropertiesDownloadComplete",this),this._webFile.send()},_onPropertiesDownloadComplete:function(){if(1===this._webFile.get_state())if(this._parseProperties(this._webFile.getText()),ss.ss.keyExists(this.get_properties(),"dataproduct_type")&&"catalog"===this.get_properties().dataproduct_type.toLowerCase())this._catalogColumnInfo=VoTable.loadFromUrl(ss.ss.replaceString(this._url,"/properties","/metadata.xml"),ss.ss.bind("_onCatalogMetadataDownloadComplete",this));else{if(ss.ss.keyExists(this.get_properties(),"hips_data_range")){var e=this.get_properties().hips_data_range;this.dataset.get_fitsProperties().minVal=parseFloat(e.split(" ")[0]),this.dataset.get_fitsProperties().maxVal=parseFloat(e.split(" ")[1]),this.dataset.get_fitsProperties().lowerCut=this.dataset.get_fitsProperties().minVal,this.dataset.get_fitsProperties().upperCut=this.dataset.get_fitsProperties().maxVal}if(ss.ss.keyExists(this.get_properties(),"hips_pixel_cut")){var t=this.get_properties().hips_pixel_cut;this.dataset.get_fitsProperties().lowerCut=parseFloat(t.split(" ")[0]),this.dataset.get_fitsProperties().upperCut=parseFloat(t.split(" ")[1]),ss.ss.keyExists(this.get_properties(),"hips_data_range")||(this.dataset.get_fitsProperties().minVal=this.dataset.get_fitsProperties().lowerCut,this.dataset.get_fitsProperties().maxVal=this.dataset.get_fitsProperties().upperCut)}this._downloadComplete=!0,null!=this._onDownloadComplete&&this._onDownloadComplete()}},_onCatalogMetadataDownloadComplete:function(){this._catalogSpreadSheetLayer.useHeadersFromVoTable(this._catalogColumnInfo),this._catalogSpreadSheetLayer.set_name(this._datasetName),this._catalogSpreadSheetLayer.id=Guid.createFrom(this._datasetName),LayerManager.addSpreadsheetLayer(this.get_catalogSpreadSheetLayer(),"Sky"),this._downloadComplete=!0,null!=this._onDownloadComplete&&this._onDownloadComplete()},setDownloadCompleteListener:function(e){this._onDownloadComplete=e},_parseProperties:function(e){for(var t=e.split("\n"),i=ss.ss.enumerate(t);i.moveNext();){var r=i.current;if(!ss.ss.whitespace(r)&&!ss.ss.startsWith(r,"#")){var n=r.split("=");if(2===n.length){var s=ss.ss.trim(n[0]),a=ss.ss.trim(n[1]);ss.ss.whitespace(s)||ss.ss.whitespace(a)||(this.get_properties()[s]=a)}}}}};function InViewReturnMessage(){this.aborted=!1}registerType("HipsProperties",[HipsProperties,HipsProperties$,null]),set_makeNewHipsProperties((function(e){return new HipsProperties(e)}));var InViewReturnMessage$={};function RenderContext(){this.height=0,this.width=0,this.lighting=!1,this._viewPoint=new Vector3d,this.space=!1,this._fovAngle=0,this._fovScale=0,this._nominalRadius=6378137,this._mainTexture=null,this.viewMover=null,this.viewCamera=new CameraParameters,this.targetCamera=new CameraParameters,this.alt=0,this.az=0,this.targetAlt=0,this.targetAz=0,this._backgroundImageset=null,this._foregroundImageset=null,this._activeCatalogHipsImagesets=[],this._targetHeight=1,this.targetAltitude=0,this._galactic=!0,this._galacticMatrix=Matrix3d.create(-.4838350155,-.0548755604,-.8734370902,0,.7469822445,.4941094279,-.44482963,0,.4559837762,-.867666149,-.1980763734,0,0,0,0,1),this._firstTimeInit=!1,this._useSolarSystemTilt=!0,this.customTrackingParams=new CameraParameters,this._cameraOffset=new Vector3d,this._fovLocal=Math.PI/4,this.perspectiveFov=Math.PI/4,this.nearPlane=0,this._frustumDirty=!0,this._frustum=new Array(6),this._ambientLightColor=Colors.get_black(),this._hemiLightColor=Colors.get_black(),this._hemiLightUp=new Vector3d,this._sunlightColor=Colors.get_white(),this._sunPosition=new Vector3d,this._reflectedLightColor=Colors.get_black(),this._reflectedLightPosition=new Vector3d,this._occludingPlanetRadius=0,this._occludingPlanetPosition=new Vector3d,this._lightingStateDirty=!0,this._twoSidedLighting=!1,this.cameraPosition=new Vector3d,this._skyColor="Blue";for(var e=0;e<6;e++)this._frustum[e]=new PlaneD(0,0,0,0)}registerType("InViewReturnMessage",[InViewReturnMessage,InViewReturnMessage$,null]),RenderContext.back=0,RenderContext.create=function(e){var t=new RenderContext;return t.device=e,t.viewCamera.zoom=700,t.viewCamera.target=65536,t},RenderContext.getTilesYForLevel=function(e,t){var i=1;switch(e.get_projection()){case ProjectionType.mercator:i=Math.pow(2,t);break;case ProjectionType.equirectangular:i=Math.pow(2,t)*(180/e.get_baseTileDegrees());break;case ProjectionType.tangent:i=Math.pow(2,t);break;case ProjectionType.spherical:i=1;break;case ProjectionType.healpix:i=4*Math.pow(2,t);break;default:i=Math.pow(2,t)}return i===Number.POSITIVE_INFINITY&&(i=1),i},RenderContext.getTilesXForLevel=function(e,t){var i=1;switch(e.get_projection()){case ProjectionType.plotted:case ProjectionType.toast:i=Math.pow(2,t);break;case ProjectionType.mercator:i=Math.pow(2,t)*ss.ss.truncate(e.get_baseTileDegrees()/360);break;case ProjectionType.equirectangular:i=Math.pow(2,t)*ss.ss.truncate(360/e.get_baseTileDegrees());break;case ProjectionType.tangent:i=1===e.get_widthFactor()?2*Math.pow(2,t):Math.pow(2,t);break;case ProjectionType.skyImage:case ProjectionType.spherical:i=1;break;case ProjectionType.healpix:i=3*Math.pow(2,t);break;default:i=2*Math.pow(2,t)}return i};var RenderContext$={save:function(){null!=this.gl||this.device.save()},restore:function(){null!=this.gl||this.device.restore()},clear:function(){null!=this.gl?(this.gl.viewport(0,0,ss.ss.truncate(this.width),ss.ss.truncate(this.height)),this.gl.clear(WEBGL.COLOR_BUFFER_BIT|WEBGL.DEPTH_BUFFER_BIT)):(this.device.save(),this.device.fillStyle="black",this.device.fillRect(0,0,this.width,this.height),this.device.restore())},get_viewPoint:function(){return this._viewPoint},get_RA:function(){return((180-(this.viewCamera.lng-180))/15%24+48)%24},rAtoViewLng:function(e){return 180-e/24*360-180},get_dec:function(){return this.viewCamera.lat},get_fovAngle:function(){return this._fovAngle},get_fovScale:function(){return this._fovScale},set_fovScale:function(e){return this._fovScale=e,e},get_view:function(){return this._view},set_view:function(e){return this._view=e,this._frustumDirty=!0,e},get_viewBase:function(){return this._viewBase},set_viewBase:function(e){return this._viewBase=e,e},get_projection:function(){return this._projection},set_projection:function(e){return this._projection=e,this._frustumDirty=!0,e},get_world:function(){return this._world},set_world:function(e){return this._world=e,this._frustumDirty=!0,e},_getScreenTexture:function(){return null},get_worldBase:function(){return this._worldBase},set_worldBase:function(e){return this._worldBase=e,e},get_worldBaseNonRotating:function(){return this._worldBaseNonRotating},set_worldBaseNonRotating:function(e){return this._worldBaseNonRotating=e,e},get_nominalRadius:function(){return this._nominalRadius},set_nominalRadius:function(e){return this._nominalRadius=e,e},get_mainTexture:function(){return this._mainTexture},set_mainTexture:function(e){return null!=e&&(this._mainTexture=e,this.gl.bindTexture(WEBGL.TEXTURE_2D,this._mainTexture.texture2d)),e},onTarget:function(e){return Math.abs(this.viewCamera.lat-this.targetCamera.lat)<1e-12&&Math.abs(this.viewCamera.lng-this.targetCamera.lng)<1e-12&&Math.abs(this.viewCamera.zoom-this.targetCamera.zoom)<1e-12&&null==this.viewMover},setTexture:function(e){},get_backgroundImageset:function(){return this._backgroundImageset},set_backgroundImageset:function(e){var t=null!=this._backgroundImageset&&null!=e&&this._backgroundImageset.get_dataSetType()!==e.get_dataSetType();return this._backgroundImageset=e,t&&(globalWWTControl._freezeView(),globalWWTControl.clampZooms(this)),e},get_foregroundImageset:function(){return this._foregroundImageset},set_foregroundImageset:function(e){return this._foregroundImageset=e,e},get_catalogHipsImagesets:function(){return this._activeCatalogHipsImagesets},getCatalogHipsDataInView:function(e,t,i){var r=this,n=new CatalogSpreadSheetLayer,s=function(){n.useHeadersFromVoTable(e.get_hipsProperties().get_catalogColumnInfo()),r._tryGetAllDataInView(e,t,n,i,0)};null==e.get_hipsProperties()?(e.set_hipsProperties(makeNewHipsProperties(e)),e.get_hipsProperties().setDownloadCompleteListener(s)):null!=e.get_hipsProperties()&&e.get_hipsProperties().get_downloadComplete()?s():e.get_hipsProperties().setDownloadCompleteListener(s)},_tryGetAllDataInView:function(e,t,i,r,n){for(var s=this,a=RenderContext.getTilesXForLevel(e,e.get_baseLevel()),o=RenderContext.getTilesYForLevel(e,e.get_baseLevel()),l=!1,h=0;h<a;h++)for(var c=0;c<o;c++){var u=tileCacheGetTile(e.get_baseLevel(),h,c,e,null);if(null!=u){var d=u.getDataInView(this,t,i);l=l||!d}else l=!0}if(l)((g=i.get__table().rows.length)>1e4||n>3e4)&&t?(console.log("Too Many results - Aborting"),console.log(g),(_=new InViewReturnMessage).aborted=!0,_.table=i.getTableDataInView(),r(_),i.cleanUp()):(setTimeout((function(){s._tryGetAllDataInView(e,t,i,r,n)}),10),n%200||(console.log("Waiting for more tiles to load"),console.log(g)),n++);else{var _,g=i.get__table().rows.length;console.log("Done!"),console.log(g),(_=new InViewReturnMessage).aborted=!1,_.table=i.getTableDataInView(),r(_),i.cleanUp()}},addCatalogHips:function(e,t){this._activeCatalogHipsImagesets.indexOf(e)>=0||this._activeCatalogHipsImagesets.push(e),null==e.get_hipsProperties()?(e.set_hipsProperties(makeNewHipsProperties(e)),e.get_hipsProperties().setDownloadCompleteListener(t)):null!=e.get_hipsProperties()&&e.get_hipsProperties().get_downloadComplete()&&(LayerManager.addSpreadsheetLayer(e.get_hipsProperties().get_catalogSpreadSheetLayer(),"Sky"),null!=t&&t())},removeCatalogHips:function(e){ss.ss.remove(this._activeCatalogHipsImagesets,e),null!=e.get_hipsProperties()&&LayerManager.deleteLayerByID(e.get_hipsProperties().get_catalogSpreadSheetLayer().id,!0,!0)},getCatalogHipsByName:function(e){for(var t=ss.ss.enumerate(this._activeCatalogHipsImagesets);t.moveNext();){var i=t.current;if(i.get_name()===e)return i}return null},getAltitudeForLatLongForPlanet:function(e,t,i){var r=globalWWTControl.getImagesetByName(Planets.getNameFrom3dId(e));if(null==r)return 0;for(var n=RenderContext.getTilesXForLevel(r,r.get_baseLevel()),s=RenderContext.getTilesYForLevel(r,r.get_baseLevel()),a=0;a<n;a++)for(var o=0;o<s;o++){var l=tileCacheGetTile(r.get_baseLevel(),a,o,r,null);if(null!=l&&l.isPointInTile(t,i))return l.getSurfacePointAltitude(t,i,!0)}return 0},getEarthAltitude:function(e,t,i){if(globalWWTControl.get_solarSystemMode()){var r=Coordinates.geoTo3dDouble(e,t+90),n=Planets.earthMatrixInv;(r=Vector3d._transformCoordinate(r,n)).normalize();var s=Coordinates.cartesianToLatLng(r);return this.getAltitudeForLatLongForPlanet(this.viewCamera.target,s.y,s.x)}return this.get_backgroundImageset().get_dataSetType()!=ImageSetType.earth?i?this.getMetersAltitudeForLatLong(e,t):this.getScaledAltitudeForLatLong(e,t):0},drawImageSet:function(e,t){for(var i=RenderContext.getTilesXForLevel(e,e.get_baseLevel()),r=RenderContext.getTilesYForLevel(e,e.get_baseLevel()),n=0;n<i;n++)for(var s=0;s<r;s++){var a=tileCacheGetTile(e.get_baseLevel(),n,s,e,null);null!=a&&a.draw3D(this,t)}},_getTileAtLatLong:function(e,t){var i=this.get_backgroundImageset();if(null==i)return null;for(var r=RenderContext.getTilesXForLevel(i,i.get_baseLevel()),n=RenderContext.getTilesYForLevel(i,i.get_baseLevel()),s=0;s<r;s++)for(var a=0;a<n;a++){var o=tileCacheGetTile(i.get_baseLevel(),s,a,i,null);if(null!=o&&o.isPointInTile(e,t))return o}return null},getScaledAltitudeForLatLong:function(e,t){var i=this._getTileAtLatLong(e,t);return null!=i?i.getSurfacePointAltitude(e,t,!1):0},getMetersAltitudeForLatLong:function(e,t){var i=this._getTileAtLatLong(e,t);return null!=i?i.getSurfacePointAltitude(e,t,!0):0},_setupMatricesLand3d:function(){this.lighting=!1,this.space=!1,RenderTriangle.cullInside=!1;var e=Matrix3d._rotationY((this.viewCamera.lng-90)/180*Math.PI);e._multiply(Matrix3d._rotationX(-this.viewCamera.lat/180*Math.PI)),this.set_world(e),this.set_worldBase(e.clone()),this._viewPoint=Coordinates.geoTo3d(this.viewCamera.lat,this.viewCamera.lng);var t;if(t=this._backgroundImageset.get_isMandelbrot()?this.viewCamera.zoom/180*4+1e-41:this.viewCamera.zoom/180*4+1e-6,this._fovAngle=this.viewCamera.zoom/343.774/Math.PI*180,this._fovScale=this._fovAngle/this.height*3600,null!=this.gl){this.targetAltitude=this.getScaledAltitudeForLatLong(this.viewCamera.lat,this.viewCamera.lng);var i=1+this.targetAltitude;this.targetAltitude*=this.get_nominalRadius(),this._targetHeight<i?this._targetHeight=(2*this._targetHeight+i)/3:this._targetHeight=(9*this._targetHeight+i)/10}else this.targetAltitude=0,this._targetHeight=1;var r=this.viewCamera.rotation;this.cameraPosition=Vector3d.create(Math.sin(r)*Math.sin(this.viewCamera.angle)*t,Math.cos(r)*Math.sin(this.viewCamera.angle)*t,-this._targetHeight-Math.cos(this.viewCamera.angle)*t);var n=Vector3d.create(0,0,-this._targetHeight),s=(this.cameraPosition.length(),Vector3d.create(Math.sin(r)*Math.cos(this.viewCamera.angle),Math.cos(r)*Math.cos(this.viewCamera.angle),Math.sin(this.viewCamera.angle)));this.set_view(Matrix3d.lookAtLH(this.cameraPosition,n,s)),this.set_viewBase(this.get_view());var a,o=Math.sqrt((t+1)*(t+1)-1);o=Math.max(.5,o),a=.05*t,this.set_projection(Matrix3d.perspectiveFovLH(Math.PI/4,this.width/this.height,a,o)),this._setMatrixes(),this.makeFrustum()},setupMatricesSpace3d:function(e,t){this.lighting=!1,this._firstTimeInit||(this._galacticMatrix=Matrix3d.get_identity(),this._galacticMatrix._multiply(Matrix3d._rotationY(-.019972251100208244*Math.PI)),this._galacticMatrix._multiply(Matrix3d._rotationX(.1607565219927189*Math.PI)),this._galacticMatrix._multiply(Matrix3d._rotationZ(-.3254330396661*Math.PI)),this._firstTimeInit=!0),this.space=!0,RenderTriangle.cullInside=!0;var i=Matrix3d.get_identity();if(Settings.get_active().get_galacticMode()){i._multiply(this._galacticMatrix),i._multiply(Matrix3d._rotationY(this.az/180*Math.PI)),i._multiply(Matrix3d._rotationX(-this.alt/180*Math.PI));var r=Coordinates.galactictoJ2000(this.az,this.alt);this._viewPoint=Coordinates.raDecTo3dAu(r[0]/15,r[1],1),this.targetCamera.lng=this.rAtoViewLng(r[0]/15),this.targetCamera.lat=r[1],this.viewCamera.lat=this.targetCamera.lat,this.viewCamera.lng=this.targetCamera.lng}else i._multiply(Matrix3d._rotationY(-(this.viewCamera.lng-90)/180*Math.PI)),i._multiply(Matrix3d._rotationX(-this.viewCamera.lat/180*Math.PI)),this._viewPoint=Coordinates.raDecTo3dAu(this.get_RA(),this.get_dec(),1);var n=this.viewCamera.rotation;if(this._fovAngle=this.viewCamera.zoom/343.774/Math.PI*180,this._fovScale=this._fovAngle/t*3600,Settings.get_active().get_localHorizonMode()&&this._backgroundImageset.get_dataSetType()==ImageSetType.sky){var s=new Coordinates(0,0);s.set_az(0),s.set_alt(0);var a=Coordinates.horizonToEquitorial(s,SpaceTimeController.get_location(),SpaceTimeController.get_now()),o=-(a.get_RA()-6)/24*(2*Math.PI),l=-a.get_dec()/360*(2*Math.PI);Coordinates.formatDMS(a.get_RA()),(i=Matrix3d._rotationY(-o-Math.PI))._multiply(Matrix3d._rotationX(l)),SpaceTimeController.get_location().get_lat()<0?(i._multiply(Matrix3d._rotationY(this.az/180*Math.PI)),i._multiply(Matrix3d._rotationX(this.alt/180*Math.PI)),n+=Math.PI):(i._multiply(Matrix3d._rotationY(-this.az/180*Math.PI)),i._multiply(Matrix3d._rotationX(-this.alt/180*Math.PI)));var h=Coordinates.horizonToEquitorial(Coordinates.fromLatLng(this.alt,this.az),SpaceTimeController.get_location(),SpaceTimeController.get_now());this.viewCamera.lat=this.targetCamera.lat=h.get_dec(),this.viewCamera.lng=this.targetCamera.lng=this.rAtoViewLng(h.get_RA())}this.set_world(i),this.set_worldBase(i.clone());var c=this.viewCamera.zoom;Math.PI,this.cameraPosition=Vector3d.create(0,0,0),this.set_view(Matrix3d.lookAtLH(this.cameraPosition,Vector3d.create(0,0,-1),Vector3d.create(Math.sin(n),Math.cos(n),0))),this.set_viewBase(this.get_view().clone()),this.nearPlane=.1,this.set_projection(Matrix3d.perspectiveFovLH(c/343.774,e/t,.1,-2)),this._setMatrixes(),this.makeFrustum()},get_solarSystemTrack:function(){return this.viewCamera.target},set_solarSystemTrack:function(e){return this.viewCamera.target=e,e},get_solarSystemCameraDistance:function(){return this.viewCamera.zoom/9*4+1e-6},get_sandboxMode:function(){return null!=this._backgroundImageset&&this._backgroundImageset.get_dataSetType()===ImageSetType.sandbox},get_trackingFrame:function(){return this.viewCamera.targetReferenceFrame},set_trackingFrame:function(e){return this.viewCamera.targetReferenceFrame=e,e},get_fovLocal:function(){return this._fovLocal},set_fovLocal:function(e){return this._fovLocal=e,e},setupMatricesOverlays:function(){this.set_world(Matrix3d.get_identity()),Matrix3d.get_identity();var e,t=Vector3d.create(0,0,0),i=Vector3d.create(0,0,1),r=Vector3d.create(0,1,0);(e=Matrix3d.lookAtLH(t,i,r))._multiply(Matrix3d._scaling(1,-1,1)),this.set_view(e),this.nearPlane=.1,this.set_projection(Matrix3d.perspectiveFovLH(this._fovLocal,this.width/this.height,this.nearPlane,1e4))},setupMatricesSolarSystem:function(e){this.lighting=Settings.get_active().get_solarSystemLighting(),this.space=!1,20!==this.get_solarSystemTrack()&&65536!==this.get_solarSystemTrack()&&(this.viewCamera.viewTarget=Planets.getPlanetTargetPoint(this.get_solarSystemTrack(),this.viewCamera.lat,this.viewCamera.lng,0)),RenderTriangle.cullInside=!1;var t=this.get_solarSystemCameraDistance(),i=Matrix3d.get_identity();if(t-=1e-6,20!==this.get_solarSystemTrack()||ss.ss.emptyString(this.get_trackingFrame()))ss.ss.emptyString(this.get_trackingFrame())||this.set_trackingFrame("");else{var r=LayerManager._getFrameTarget(this,this.get_trackingFrame());this.viewCamera.viewTarget=r.target,i=r.matrix}this.viewCamera.viewTarget,this.viewCamera.zoom;var n=new Vector3d,s=Matrix3d.get_identity();s._multiply(Matrix3d._rotationX(-this.viewCamera.lat/180*Math.PI)),s._multiply(Matrix3d._rotationY(-this.viewCamera.lng/180*Math.PI));var a,o=Matrix3d.get_identity();if(this._useSolarSystemTilt&&!this.get_sandboxMode()){var l=this.viewCamera.angle;if(t>8e-4)l=0;else if(t>1e-5){var h=Math.min(1.903089987,Util.log10(t)+5)/1.903089987;l*=Math.max(0,1-h)}this.cameraPosition=Vector3d.create(Math.sin(-this.viewCamera.rotation)*Math.sin(l)*t,Math.cos(-this.viewCamera.rotation)*Math.sin(l)*t,Math.cos(l)*t),a=Vector3d.create(Math.sin(-this.viewCamera.rotation),Math.cos(-this.viewCamera.rotation),1e-5)}else this.cameraPosition=Vector3d.create(0,0,t),a=Vector3d.create(Math.sin(-this.viewCamera.rotation),Math.cos(-this.viewCamera.rotation),1e-4);this.cameraPosition=s.transform(this.cameraPosition),this._cameraOffset=this.cameraPosition.copy();var c=i.clone();c.invert(),this._cameraOffset=Vector3d._transformCoordinate(this._cameraOffset,c),a=s.transform(a),this.set_world(Matrix3d.get_identity()),this.set_worldBase(Matrix3d.get_identity()),this.set_worldBaseNonRotating(Matrix3d.get_identity()),this.set_view(Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(i,Matrix3d.lookAtLH(this.cameraPosition,n,a)),o)),this.set_viewBase(this.get_view().clone());var u=Vector3d.subtractVectors(n,this.cameraPosition);u.normalize(),(u=Vector3d._transformCoordinate(u,i)).normalize(),this._viewPoint=u,t<2*Planets.getAdjustedPlanetRadius(this.get_solarSystemTrack())&&!e?(this.nearPlane=.03*t,this.nearPlane=Math.max(this.nearPlane,1e-11),RenderContext.back=1900):e?(RenderContext.back=900056,RenderContext.back=t>900056?3*t:900056,this.nearPlane=3e-5):(RenderContext.back=t>1900?t+200:1900,Settings.get_active().get_solarSystemScale()<13?this.nearPlane=Math.min(.03*t,.01):this.nearPlane=.001),this.set_projection(Matrix3d.perspectiveFovLH(this._fovLocal,this.width/this.height,this.nearPlane,RenderContext.back)),this.perspectiveFov=this._fovLocal,this._fovAngle=this.viewCamera.zoom/343.774/Math.PI*180,this._fovScale=this._fovAngle/this.height*3600,this._setMatrixes(),this.makeFrustum()},_setMatrixes:function(){},get_frustum:function(){return this._frustum},get_ambientLightColor:function(){return this._ambientLightColor},set_ambientLightColor:function(e){return this._ambientLightColor=e,this._lightingStateDirty=!0,e},get_hemisphereLightColor:function(){return this._hemiLightColor},set_hemisphereLightColor:function(e){return this._hemiLightColor=e,this._lightingStateDirty=!0,e},get_hemisphereLightUp:function(){return this._hemiLightUp},set_hemisphereLightUp:function(e){return this._hemiLightUp=e,this._lightingStateDirty=!0,e},get_sunlightColor:function(){return this._sunlightColor},set_sunlightColor:function(e){return this._sunlightColor=e,this._lightingStateDirty=!0,e},get_sunPosition:function(){return this._sunPosition},set_sunPosition:function(e){return this._sunPosition=e,this._lightingStateDirty=!0,e},get_reflectedLightColor:function(){return this._reflectedLightColor},set_reflectedLightColor:function(e){return this._reflectedLightColor!==e&&(this._reflectedLightColor=e,this._lightingStateDirty=!0),e},get_reflectedLightPosition:function(){return this._reflectedLightPosition},set_reflectedLightPosition:function(e){return this._reflectedLightPosition=e,this._lightingStateDirty=!0,e},get_occludingPlanetRadius:function(){return this._occludingPlanetRadius},set_occludingPlanetRadius:function(e){return this._occludingPlanetRadius=e,e},get_occludingPlanetPosition:function(){return this._occludingPlanetPosition},set_occludingPlanetPosition:function(e){return this._occludingPlanetPosition=e,e},get_twoSidedLighting:function(){return this._twoSidedLighting},set_twoSidedLighting:function(e){return e!==this._twoSidedLighting&&(this._twoSidedLighting=e,this._lightingStateDirty=!0),e},makeFrustum:function(){this.WV=Matrix3d.multiplyMatrix(this.get_world(),this.get_view());var e=Matrix3d.multiplyMatrix(this.WV,this.get_projection());this.WVP=e.clone(),this.get_world().clone().invert(),this._frustum[0].a=e.get_m14()+e.get_m11(),this._frustum[0].b=e.get_m24()+e.get_m21(),this._frustum[0].c=e.get_m34()+e.get_m31(),this._frustum[0].d=e.get_m44()+e.get_m41(),this._frustum[1].a=e.get_m14()-e.get_m11(),this._frustum[1].b=e.get_m24()-e.get_m21(),this._frustum[1].c=e.get_m34()-e.get_m31(),this._frustum[1].d=e.get_m44()-e.get_m41(),this._frustum[2].a=e.get_m14()-e.get_m12(),this._frustum[2].b=e.get_m24()-e.get_m22(),this._frustum[2].c=e.get_m34()-e.get_m32(),this._frustum[2].d=e.get_m44()-e.get_m42(),this._frustum[3].a=e.get_m14()+e.get_m12(),this._frustum[3].b=e.get_m24()+e.get_m22(),this._frustum[3].c=e.get_m34()+e.get_m32(),this._frustum[3].d=e.get_m44()+e.get_m42(),this._frustum[4].a=e.get_m13(),this._frustum[4].b=e.get_m23(),this._frustum[4].c=e.get_m33(),this._frustum[4].d=e.get_m43(),this._frustum[5].a=e.get_m14()-e.get_m13(),this._frustum[5].b=e.get_m24()-e.get_m23(),this._frustum[5].c=e.get_m34()-e.get_m33(),this._frustum[5].d=e.get_m44()-e.get_m43();for(var t=0;t<6;t++)this._frustum[t].normalize();this._frustumDirty=!1,this.WVP.scale(Vector3d.create(this.width/2,-this.height/2,1)),this.WVP.translate(Vector3d.create(this.width/2,this.height/2,0)),this._setMatrixes()},_initGL:function(){null!=this.gl&&(this.gl.getExtension("OES_element_index_uint"),set_tileUvMultiple(1),set_tileDemEnabled(!0),TileShader.init(this))},freezeView:function(){this.targetAlt=this.alt,this.targetAz=this.az,this.targetCamera=this.viewCamera.copy()},_setVertexBuffer:function(e){},_setIndexBuffer:function(e){},setMaterial:function(e,t,i,r,n){this.set_mainTexture(t)},preDraw:function(){}};function SlideChangedEventArgs(e){ss.ss.EventArgs.call(this),this.set_caption(e)}registerType("RenderContext",[RenderContext,RenderContext$,null]);var SlideChangedEventArgs$={get_caption:function(){return this._caption$2},set_caption:function(e){return this._caption$2=e,e}};function ArrivedEventArgs(e,t,i){this._ra$2=0,this._dec$2=0,this._zoom$2=0,ss.ss.EventArgs.call(this),this.set_RA(15*e),this.set_dec(t),this.set_zoom(i/6)}registerType("SlideChangedEventArgs",[SlideChangedEventArgs,SlideChangedEventArgs$,ss.ss.EventArgs]);var ArrivedEventArgs$={get_RA:function(){return this._ra$2},set_RA:function(e){return this._ra$2=e,e},get_dec:function(){return this._dec$2},set_dec:function(e){return this._dec$2=e,e},get_zoom:function(){return this._zoom$2},set_zoom:function(e){return this._zoom$2=e,e}};function AnnotationClickEventArgs(e,t,i){this._ra$2=0,this._dec$2=0,ss.ss.EventArgs.call(this),this.set_RA(15*e),this.set_dec(t),this.set_id(i)}registerType("ArrivedEventArgs",[ArrivedEventArgs,ArrivedEventArgs$,ss.ss.EventArgs]);var AnnotationClickEventArgs$={get_RA:function(){return this._ra$2},set_RA:function(e){return this._ra$2=e,e},get_dec:function(){return this._dec$2},set_dec:function(e){return this._dec$2=e,e},get_id:function(){return this._id$2},set_id:function(e){return this._id$2=e,e}};function CollectionLoadedEventArgs(e){ss.ss.EventArgs.call(this),this._url$2=e}registerType("AnnotationClickEventArgs",[AnnotationClickEventArgs,AnnotationClickEventArgs$,ss.ss.EventArgs]);var CollectionLoadedEventArgs$={get_url:function(){return this._url$2},set_url:function(e){return this._url$2=e,e}};function ScriptInterface(){this._missedReady=!1,this.hideTourFeedback=!1,this._smoothAnimation=!1,this._showCaptions=!0}registerType("CollectionLoadedEventArgs",[CollectionLoadedEventArgs,CollectionLoadedEventArgs$,ss.ss.EventArgs]),ScriptInterface._containsFitsLikeExtentsion=function(e){var t=e.toLowerCase();return ss.ss.endsWith(t,"fits")||ss.ss.endsWith(t,"ftz")||ss.ss.endsWith(t,"fit")||ss.ss.endsWith(t,"fts")},ScriptInterface._addImageSet=function(e,t,i,r){ss.ss.whitespace(e)&&(e=LayerManager.getNextImageSetName());var n=LayerManager.addImageSetLayerCallback(r,e,i);if(t){var s=r._guessZoomSetting(globalRenderContext.viewCamera.zoom);globalWWTControl.gotoRADecZoom(r.get_viewCenterX()/15,r.get_viewCenterY(),s,!1,null)}return n},ScriptInterface._addFitsLayer=function(e,t,i,r){ss.ss.whitespace(t)&&(t=LayerManager.getNextFitsName());var n=new ImageSetLayer,s=new Imageset,a=function(e){if(!e.errored){if(ss.ss.truncate(e.get_sizeX()),ss.ss.truncate(e.get_sizeY()),s.setInitialParameters(e.get_description(),e.get_filename(),2,3,5,Util.getHashCode(e.get_filename()),0,0,e.get_scaleY(),".fits",e.get_scaleX()>0,"",e.get_centerX(),e.get_centerY(),e.get_rotation(),!1,"",!1,!1,1,e.get_referenceX(),e.get_referenceY(),e.get_copyright(),e.get_creditsUrl(),"","",0,""),s.set_wcsImage(e),n.set_imageSet(s),LayerManager.addFitsImageSetLayer(n,t),i){var a=s._guessZoomSetting(globalRenderContext.viewCamera.zoom);globalWWTControl.gotoRADecZoom(e.get_viewCenterX()/15,e.get_viewCenterY(),a,!1,null)}null!=r&&r(n)}};return ss.ss.whitespace(t)&&(t=LayerManager.getNextFitsName()),useGlVersion2?new FitsImage(s,e,null,a):new FitsImageJs(s,e,null,a),n};var ScriptInterface$={add_ready:function(e){this.__ready=ss.ss.bindAdd(this.__ready,e)},remove_ready:function(e){this.__ready=ss.ss.bindSub(this.__ready,e)},_fireReady:function(){null!=this.__ready?this.__ready(this,new ss.ss.EventArgs):this._missedReady=!0},add_collectionLoaded:function(e){this.__collectionLoaded=ss.ss.bindAdd(this.__collectionLoaded,e)},remove_collectionLoaded:function(e){this.__collectionLoaded=ss.ss.bindSub(this.__collectionLoaded,e)},_fireCollectionLoaded:function(e){null!=this.__collectionLoaded&&this.__collectionLoaded(this,new CollectionLoadedEventArgs(e))},add_colorPickerDisplay:function(e){this.__colorPickerDisplay=ss.ss.bindAdd(this.__colorPickerDisplay,e)},remove_colorPickerDisplay:function(e){this.__colorPickerDisplay=ss.ss.bindSub(this.__colorPickerDisplay,e)},add_voTableDisplay:function(e){this.__voTableDisplay=ss.ss.bindAdd(this.__voTableDisplay,e)},remove_voTableDisplay:function(e){this.__voTableDisplay=ss.ss.bindSub(this.__voTableDisplay,e)},add_refreshLayerManager:function(e){this.__refreshLayerManager=ss.ss.bindAdd(this.__refreshLayerManager,e)},remove_refreshLayerManager:function(e){this.__refreshLayerManager=ss.ss.bindSub(this.__refreshLayerManager,e)},add_arrived:function(e){this.__arrived=ss.ss.bindAdd(this.__arrived,e)},remove_arrived:function(e){this.__arrived=ss.ss.bindSub(this.__arrived,e)},add_clicked:function(e){this.__clicked=ss.ss.bindAdd(this.__clicked,e)},remove_clicked:function(e){this.__clicked=ss.ss.bindSub(this.__clicked,e)},add_annotationClicked:function(e){this.__annotationClicked=ss.ss.bindAdd(this.__annotationClicked,e)},remove_annotationClicked:function(e){this.__annotationClicked=ss.ss.bindSub(this.__annotationClicked,e)},add_imageryLoaded:function(e){this.__imageryLoaded=ss.ss.bindAdd(this.__imageryLoaded,e)},remove_imageryLoaded:function(e){this.__imageryLoaded=ss.ss.bindSub(this.__imageryLoaded,e)},add_tourReady:function(e){this.__tourReady=ss.ss.bindAdd(this.__tourReady,e)},remove_tourReady:function(e){this.__tourReady=ss.ss.bindSub(this.__tourReady,e)},add_tourError:function(e){this.__tourError=ss.ss.bindAdd(this.__tourError,e)},remove_tourError:function(e){this.__tourError=ss.ss.bindSub(this.__tourError,e)},add_tourPaused:function(e){this.__tourPaused=ss.ss.bindAdd(this.__tourPaused,e)},remove_tourPaused:function(e){this.__tourPaused=ss.ss.bindSub(this.__tourPaused,e)},add_tourResumed:function(e){this.__tourResumed=ss.ss.bindAdd(this.__tourResumed,e)},remove_tourResumed:function(e){this.__tourResumed=ss.ss.bindSub(this.__tourResumed,e)},add_tourEnded:function(e){this.__tourEnded=ss.ss.bindAdd(this.__tourEnded,e)},remove_tourEnded:function(e){this.__tourEnded=ss.ss.bindSub(this.__tourEnded,e)},add_slideChanged:function(e){this.__slideChanged=ss.ss.bindAdd(this.__slideChanged,e)},remove_slideChanged:function(e){this.__slideChanged=ss.ss.bindSub(this.__slideChanged,e)},add_timeScrubberHook:function(e){this.__timeScrubberHook=ss.ss.bindAdd(this.__timeScrubberHook,e)},remove_timeScrubberHook:function(e){this.__timeScrubberHook=ss.ss.bindSub(this.__timeScrubberHook,e)},setTimeScrubberPosition:function(e){LayerManager.setTimeSliderValue(e)},setTimeSlider:function(e,t){this.__timeScrubberHook(e,t)},showColorPicker:function(e,t){null!=this.__colorPickerDisplay&&this.__colorPickerDisplay(e,t)},displayVoTableLayer:function(e){null!=this.__voTableDisplay&&this.__voTableDisplay(e,new ss.ss.EventArgs)},refreshLayerManagerNow:function(){null!=this.__refreshLayerManager&&this.__refreshLayerManager(null,new ss.ss.EventArgs)},_fireTourReady:function(){null!=this.__tourReady&&this.__tourReady(this,new ss.ss.EventArgs)},_fireTourError:function(e){null!=this.__tourError&&this.__tourError(e,new ss.ss.EventArgs)},_fireTourPaused:function(){null!=this.__tourPaused&&this.__tourPaused(this,new ss.ss.EventArgs)},_fireTourResume:function(){null!=this.__tourResumed&&this.__tourResumed(this,new ss.ss.EventArgs)},_fireTourEnded:function(){null!=this.__tourEnded&&this.__tourEnded(this,new ss.ss.EventArgs)},_fireImageryLoaded:function(){null!=this.__imageryLoaded&&this.__imageryLoaded(this,new ss.ss.EventArgs)},_fireClick:function(e,t){null!=this.__clicked&&this.__clicked(this,new ArrivedEventArgs(e,t,globalRenderContext.viewCamera.zoom))},_fireArrived:function(e,t,i){null!=this.__arrived&&this.__arrived(this,new ArrivedEventArgs(e,t,i))},_fireAnnotationclicked:function(e,t,i){try{null!=this.__annotationClicked&&this.__annotationClicked(this,new AnnotationClickEventArgs(e,t,i))}catch(e){}},_fireSlideChanged:function(e){try{null!=this.__slideChanged&&this.__slideChanged(this,new SlideChangedEventArgs(e))}catch(e){}},endInit:function(){this._missedReady&&this._fireReady()},gotoRaDecZoom:function(e,t,i,r,n,s){null!=globalWWTControl&&globalWWTControl.gotoRADecZoom(e/15,t,6*i,r,n,s)},setBackgroundImageByName:function(e){null!=globalWWTControl&&globalWWTControl.setBackgroundImageByName(e)},addVoTableLayer:function(e){return LayerManager.addVoTableLayer(e,"Vo Table")},getLayers:function(){return LayerManager.get_layerList()},setForegroundImageByName:function(e){null!=globalWWTControl&&(globalWWTControl.setForegroundImageByName(e),globalRenderContext.viewCamera.opacity=100)},setForegroundOpacity:function(e){null!=globalWWTControl&&(globalRenderContext.viewCamera.opacity=e)},addCatalogHipsByName:function(e){null!=globalWWTControl&&globalWWTControl.addCatalogHipsByName(e)},addCatalogHipsByNameWithCallback:function(e,t){null!=globalWWTControl&&globalWWTControl.addCatalogHipsByNameWithCallback(e,t)},removeCatalogHipsByName:function(e){null!=globalWWTControl&&globalWWTControl.removeCatalogHipsByName(e)},getCatalogHipsDataInView:function(e,t,i){null!=globalWWTControl&&globalWWTControl.getCatalogHipsDataInView(e,t,i)},setCutsForFits:function(e,t,i){null!=globalWWTControl&&globalWWTControl.setCutsForFits(e,t,i)},setColorMapForFits:function(e,t){null!=globalWWTControl&&globalWWTControl.setColorMapForFits(e,t)},setScaleTypeForFits:function(e,t){null!=globalWWTControl&&globalWWTControl.setScaleTypeForFits(e,t)},hideUI:function(e){},loadTour:function(e){null!=globalWWTControl&&globalWWTControl.playTour(e)},loadFits:function(e){return this.loadFitsLayer(e,"",!0,null)},loadFitsLayer:function(e,t,i,r){return this.addImageSetLayer(e,"fits",t,i,r)},addImageSetLayer:function(e,t,i,r,n){if(null!=t&&"fits"===t.toLowerCase())return ScriptInterface._addFitsLayer(e,i,r,n);if(null!=t&&"preloaded"===t.toLowerCase()){if(null!=(s=globalWWTControl.getImageSetByUrl(e)))return ScriptInterface._addImageSet(i,r,n,s)}else{var s;if(null!=(s=globalWWTControl.getImageSetByUrl(e)))return ScriptInterface._addImageSet(i,r,n,s);if(ScriptInterface._containsFitsLikeExtentsion(e))return ScriptInterface._addFitsLayer(e,i,r,n)}return null},setImageSetLayerOrder:function(e,t){var i=LayerManager.get_layerList()[e];ss.ss.canCast(i,ImageSetLayer)&&t>=0&&(ss.ss.remove(layerManagerGetAllMaps()[i.get_referenceFrame()].layers,i),layerManagerGetAllMaps()[i.get_referenceFrame()].layers.splice(t,0,i))},isUsingWebGl2:function(){return useGlVersion2},get_hideTourFeedback:function(){return this.hideTourFeedback},set_hideTourFeedback:function(e){return this.hideTourFeedback=e,e},playTour:function(){null!=globalWWTControl&&globalWWTControl.playCurrentTour()},stopTour:function(){null!=globalWWTControl&&globalWWTControl.stopCurrentTour()},loadImageCollection:function(e,t){var i=this;this._imageUrl=e,loadWtmlFile(e,(function(){i._fireCollectionLoaded(e)}),t)},_imageFileLoaded:function(){this._fireCollectionLoaded(this._imageUrl)},zoom:function(e){null!=globalWWTControl&&globalWWTControl.zoom(e)},getRA:function(){return null!=globalWWTControl?globalRenderContext.get_RA():0},getDec:function(){return null!=globalWWTControl?globalRenderContext.get_dec():0},createFolder:function(){return new Folder},createPolygon:function(e){var t=new Poly;return t.set_fill(e),t},createPolyLine:function(e){return new PolyLine},createCircle:function(e){var t=new Circle;return t.set_fill(e),t},addAnnotation:function(e){null!=e&&ss.ss.canCast(e,Annotation)&&null!=globalWWTControl&&globalWWTControl._addAnnotation(e)},removeAnnotation:function(e){null!=e&&null!=globalWWTControl&&globalWWTControl._removeAnnotation(e)},clearAnnotations:function(){null!=globalWWTControl&&globalWWTControl._clearAnnotations()},get_smoothAnimation:function(){return this._smoothAnimation},set_smoothAnimation:function(e){return this._smoothAnimation=e,e},get_showCaptions:function(){return this._showCaptions},set_showCaptions:function(e){return this._showCaptions=e,e},loadVOTable:function(e,t){},get_fov:function(){return null!=globalWWTControl?globalRenderContext.viewCamera.zoom/6:60},get_roll:function(){return null!=globalRenderContext?globalRenderContext.viewCamera.rotation:0}};function MinorPlanets(){}registerType("ScriptInterface",[ScriptInterface,ScriptInterface$,null]),MinorPlanets.mpcList=[],MinorPlanets._initBegun=!1,MinorPlanets._mpcBlendStates=new Array(7),MinorPlanets.starTexture=null,MinorPlanets._mpcVertexBuffer=null,MinorPlanets._mpcCount=0,MinorPlanets.getMpcFile=function(e){MinorPlanets._webMpcFile=new WebFile(e),MinorPlanets._webMpcFile.responseType="blob",MinorPlanets._webMpcFile.onStateChange=MinorPlanets.starFileStateChange,MinorPlanets._webMpcFile.send()},MinorPlanets.starFileStateChange=function(){if(2===MinorPlanets._webMpcFile.get_state())alert(MinorPlanets._webMpcFile.get_message());else if(1===MinorPlanets._webMpcFile.get_state()){var e=MinorPlanets._webMpcFile.getBlob(),t=new FileReader;t.onloadend=function(e){MinorPlanets._readFromBin(new BinaryReader(new Uint8Array(t.result))),MinorPlanets.initMPCVertexBuffer()},t.readAsArrayBuffer(e)}},MinorPlanets._readFromBin=function(e){MinorPlanets.mpcList=[];var t,i=e.get_length();try{for(;e.get_position()<i;)t=EOE._create(e),MinorPlanets.mpcList.push(t)}catch(e){}e.close()},MinorPlanets.drawMPC3D=function(e,t,i){var r=e.viewCamera.zoom,n=90*(Math.log(Math.max(1,r))/Math.log(4)-15.5);if(!(Math.min(255,Math.max(0,ss.ss.truncate(n)))>254))if(null!=MinorPlanets._mpcVertexBuffer){var s=Matrix3d.translation(Vector3d.negate(i)),a=Matrix3d.multiplyMatrix(e.get_world(),s),o=Matrix3d.multiplyMatrix(a,e.get_view());if(Vector3d._transformCoordinate(e.cameraPosition,Matrix3d.invertMatrix(e.get_world())),null!=MinorPlanets._mpcVertexBuffer)for(l=0;l<7;l++)MinorPlanets._mpcBlendStates[l].set_targetState(!0),MinorPlanets._mpcBlendStates[l].get_state()&&(KeplerPointSpriteShader.use(e,o,MinorPlanets._mpcVertexBuffer[l].vertexBuffer,MinorPlanets.starTexture.texture2d,Colors.get_white(),t*MinorPlanets._mpcBlendStates[l].get_opacity(),!1,SpaceTimeController.get_jNow()-KeplerVertex.baseDate,0,e.cameraPosition,200,.1),e.gl.drawArrays(WEBGL.POINTS,0,MinorPlanets._mpcVertexBuffer[l].count))}else{null==MinorPlanets.starTexture&&(MinorPlanets.starTexture=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("StarProfileAlpha.png")));for(var l=0;l<7;l++)MinorPlanets._mpcBlendStates[l]=BlendState.create(!1,1e3);MinorPlanets._initBegun||(MinorPlanets._startInit(),MinorPlanets._initBegun=!0)}},MinorPlanets._startInit=function(){freestandingMode||MinorPlanets.getMpcFile(URLHelpers.singleton.coreStaticUrl("wwtweb/catalog.aspx?Q=mpcbin"))},MinorPlanets.initMPCVertexBuffer=function(){try{if(null==MinorPlanets._mpcVertexBuffer){var e=new Array(7);MinorPlanets._mpcCount=MinorPlanets.mpcList.length;for(var t=new Array(7),i=0;i<7;i++)t[i]=[];for(var r=ss.ss.enumerate(MinorPlanets.mpcList);r.moveNext();){var n,s=r.current;n=s.a<2.5?0:s.a<2.83?1:s.a<2.96?2:s.a<3.3?3:s.a<5?4:s.a<10?5:6;var a=new KeplerVertex;a.fill(s),t[n].push(a)}for(i=0;i<7;i++)e[i]=KeplerVertexBuffer.create(t[i]),e[i].unlock();MinorPlanets._mpcVertexBuffer=e}}finally{}};var MinorPlanets$={};function Planets3d(){}function WWTControl(){this.freestandingMode=!1,this.uiController=null,this._annotations=[],this._hoverText="",this._hoverTextPoint=new Vector2d,this._lastMouseMove=new Date(1900,1,0,0,0,0,0),this.layers=[],this._frameCount=0,this._zoomMax=360,this._zoomMaxSolarSystem=1e16,this._zoomMin=.001373291015625,this._zoomMinSolarSystem=1e-8,this.constellation="UMA",this._fadePoints=null,this.fader=BlendState.create(!0,2e3),this._crossFadeFrame=!1,this._crossFadeTexture=null,this._sprite=new Sprite2d,this.renderType=2,this._milkyWayBackground=null,this.capturingVideo=!1,this._videoBlobReady=null,this.dumpFrameParams=null,this._videoBlobQueue={},this._videoQueueIndex=0,this._emptyFrames=[],this._beginZoom=1,this._dragging=!1,this._mouseDown=!1,this._hasTwoTouches=!1,this._lastX=0,this._lastY=0,this._pointerIds=new Array(2),this._pinchingZoomRect=new Array(2),this._moved=!1,this._zooming=!1,this._rotating=!1,this._dragThreshold=8,this._twoTouchCenter=null,this._lastTouchRect=new Array(2),this._twoTouchEvents=0,this._twoTouchEventThreshold=10,this._foregroundCanvas=null,this._fgDevice=null,this._tracking=!1,this._trackingObject=null,this.sandboxMode=!1,this._solarSystemTrack=65536,this._moving=!1,this._targetStudyImageset=null,this._targetBackgroundImageset=null,this.tour=null,this.tourEdit=null,this._crossHairs=null}registerType("MinorPlanets",[MinorPlanets,MinorPlanets$,null]),Planets3d._ringsTriangleLists=new Array(2),Planets3d._ringImage=null,Planets3d._triangleCountRings=194,Planets3d._ringsVertexBuffer=null,Planets3d.getImageSetNameNameFrom3dId=function(e){switch(e){case 0:return"Sun";case 1:return"Mercury";case 2:return"Venus";case 3:return"Visible Imagery";case 4:return"Jupiter";case 5:return"Saturn";case 6:return"Uranus";case 7:return"Neptune";case 8:return"Pluto";case 9:return"Moon";case 10:return"Io (Jupiter)";case 11:return"Europa (Jupiter)";case 12:return"Ganymede (Jupiter)";case 13:return"Callisto (Jupiter)";case 19:return"Bing Maps Aerial";default:return""}},Planets3d.initPlanetResources=function(e){},Planets3d.drawPlanets3D=function(e,t,i){Planets3d.initPlanetResources(e);var r=UiTools.solarSystemToMeters(e.get_solarSystemCameraDistance()),n=Math.min(1,Math.max(Util.log10(r)-8.6,0));if(Settings.get_active().get_solarSystemOrbits()&&n>0){for(var s=1;s<10;s++){var a=s;9===s&&(a=19);var o=Math.atan2(Planets._planet3dLocations[a].z,Planets._planet3dLocations[a].x);Planets3d._drawSingleOrbit(e,Planets.planetColors[a],a,i,o,Planets._planet3dLocations[a],n)}Planets3d._drawSingleOrbit(e,Planets.planetColors[9],9,i,0,Planets._planet3dLocations[9],n);const t=126686534,r=1/1440*.1,h=GM.calculate(Planets._jNow),c=GM.calculate(Planets._jNow-r),u=[h.satellite1.eclipticRectangularCoordinates,h.satellite2.eclipticRectangularCoordinates,h.satellite3.eclipticRectangularCoordinates,h.satellite4.eclipticRectangularCoordinates],d=[c.satellite1.eclipticRectangularCoordinates,c.satellite2.eclipticRectangularCoordinates,c.satellite3.eclipticRectangularCoordinates,c.satellite4.eclipticRectangularCoordinates],_=[SolarSystemObjects.io,SolarSystemObjects.europa,SolarSystemObjects.ganymede,SolarSystemObjects.callisto];for(var l=0;l<4;l++){const n=_[l],s=Math.pow(2,n);if(!(Settings.get_active().get_planetOrbitsFilter()&s))continue;const a=u[l],o=d[l],h=Vector3d.create(a.x,a.z,a.y),c=Vector3d.create(o.x,o.z,o.y),g=Vector3d.scale(Vector3d.subtractVectors(h,c),1/r),f=Planets._stateVectorToKeplerian(h,g,t);Planets3d._drawSingleOrbitElements(e,Planets.planetColors[n],n,i,0,Planets._planet3dLocations[n],f)}}ss.ss.clearKeys(Planets._drawOrder);for(var h=e.cameraPosition.copy(),c=0;c<14;c++)if(!Settings.get_active().get_solarSystemLighting()||!Planets._planetLocations[c].eclipsed){var u=Vector3d.subtractVectors(h,Vector3d.subtractVectors(Planets._planet3dLocations[c],i));ss.ss.keyExists(Planets._drawOrder,u.length())||(Planets._drawOrder[u.length()]=c)}var d=Vector3d.subtractVectors(h,Vector3d.subtractVectors(Planets._planet3dLocations[19],i));ss.ss.keyExists(Planets._drawOrder,d.length())||(Planets._drawOrder[d.length()]=19);for(var _=ss.ss.enumerate(ss.ss.keys(Planets._drawOrder));_.moveNext();){var g=_.current;c=Planets._drawOrder[g],Planets3d._drawPlanet3d(e,c,i)}return!0},Planets3d._drawSingleOrbit=function(e,t,i,r,n,s,a){if(!(a<.01))if(null==e.gl){var o=Planets._orbitalSampleRate,l=!1,h=(e.get_viewPoint(),e.device);h.save(),h.strokeStyle=t.toString(),h.lineWidth=2,h.globalAlpha=1;for(var c=new Vector3d,u=new Vector3d,d=new Vector3d,_=!0,g=Matrix3d.translation(Vector3d.negate(r)),f=Matrix3d.multiplyMatrix(g,e.WVP),m=Matrix3d.multiplyMatrix(g,e.WV),p=0;p<o;p++){var C=Planets._orbits[i][p],S=(Math.atan2(Planets._orbits[i][p].z,Planets._orbits[i][p].x)+2*Math.PI-n)%(2*Math.PI),w=(b=ss.ss.truncate(S/(2*Math.PI)*255))/255;b<2&&!l&&(C=s,w=1),u=m.transform(C),c=f.transform(C),u.z>0&&(_?_=!1:(h.beginPath(),h.globalAlpha=w*a,h.moveTo(d.x,d.y),h.lineTo(c.x,c.y),h.stroke())),d=c}h.restore()}else if(9!==i){o=Planets._orbitalSampleRate,l=!1,e.get_viewPoint(),c=new Vector3d,u=new Vector3d,d=new Vector3d;var T=new Color,y=(_=!0,new OrbitLineList);for(p=0;p<o;p++){C=Planets._orbits[i][p].copy(),S=(Math.atan2(C.z,C.x)+2*Math.PI-n)%(2*Math.PI),w=(b=ss.ss.truncate(S/(2*Math.PI)*255))/255;var b,v=Color.fromArgb(b,t.r,t.g,t.b);b<2&&!l&&!_&&(C=Vector3d.subtractVectors(s,r),w=1,b=255,v.a=255,T.a=255,y.addLine(d,C.copy(),T._clone(),v._clone()),T.a=0,v.a=0,C=Planets._orbits[i][p].copy(),l=!0),C=Vector3d.subtractVectors(C,r),_?_=!1:y.addLine(d,C,T,v),d=C,T=v._clone()}y.drawLines(e,1,Colors.get_white()),y.clear()}else{var M=0;switch(i){case 9:M=403503.21979;break;case 10:case 11:case 12:case 13:M=126686534;break;default:M=132712440018.8}var x=Planets.getPlanetPositionDirect(i,Planets._jNow),L=Planets.getPlanetPositionDirect(i,Planets._jNow-1/1440*.1),A=Vector3d.scale(Vector3d.subtractVectors(x,L),14400),V=Planets._stateVectorToKeplerian(x,A,M);Planets3d._drawSingleOrbitElements(e,t,i,r,n,s,V)}},Planets3d._drawSingleOrbitElements=function(e,t,i,r,n,s,a){var o;switch(i){case 9:o=Settings.get_active().get_solarSystemScale()>1?Settings.get_active().get_solarSystemScale()/2:1;break;case 10:case 11:case 12:case 13:o=Settings.get_active().get_solarSystemScale();break;default:o=1}var l=Vector3d.negate(r);9===i?l.add(Planets._planet3dLocations[19]):10!==i&&11!==i&&12!==i&&13!==i||l.add(Planets._planet3dLocations[4]);var h=Vector3d.subtractVectors(s,r),c=Matrix3d.multiplyMatrix(Matrix3d.multiplyMatrix(a.orientation,Matrix3d.translation(l)),e.get_world());EllipseRenderer.drawEllipseWithPosition(e,a.a/149598e3*o,a.e,a.ea,t,c,h)},Planets3d.isPlanetInFrustum=function(e,t){for(var i=e.get_frustum(),r=(Vector3d.create(0,0,0),new Vector4d(0,0,0,1)),n=0;n<6;n++)if(i[n].dot(r)+t<0)return!1;return!0},Planets3d._drawPlanet3d=function(e,t,i){0===t?TileShader.minLightingBrightness=1:(TileShader.minLightingBrightness=.025,TileShader.atmosphereColor=19===t?Color.fromArgb(255,65,157,217):Color.fromArgb(0,0,0,0));var r=e.get_world(),n=e.get_worldBase(),s=e.get_worldBaseNonRotating(),a=Planets.getAdjustedPlanetRadius(t);Planets.setupPlanetMatrix(e,t,i,!0);var o=1;if(5===t&&(o=3),Planets3d.isPlanetInFrustum(e,o)){e.get_world(),e.get_worldBase(),e.get_worldBaseNonRotating();var l=Planets._planet3dLocations[0].copy(),h=Planets._planet3dLocations[t].copy();l=r.transform(l),h=r.transform(h),e.set_world(r),e.set_worldBase(n),e.set_worldBaseNonRotating(s),Planets._setupMatrixForPlanetGeometry(e,t,i,!0);var c=Vector3d.subtractVectors(l,h);c.normalize(),e.set_sunPosition(c),TileShader.sunPosition=Vector3d.subtractVectors(Planets._planet3dLocations[0],h);var u=Vector3d.subtractVectors(Planets._planet3dLocations[t],i);u.subtract(e.cameraPosition);var d,_=u.length(),g=2*Math.atan(a/_*.5)/Math.PI*180;if(d=g>10.5?0:g>3.9?1:g>.72?2:g>.05?3:4,19===t&&d<2&&Settings.get_active().get_solarSystemScale(),d<4){var f=e.lighting;5===t&&null==e.gl&&(e.lighting=!1,Planets3d.drawSaturnsRings(e,!1,_),e.lighting=f),t||(e.lighting=!1),Planets3d._drawSphere(e,t),5===t&&(null==e.gl?(e.lighting=!1,Planets3d.drawSaturnsRings(e,!0,_)):(e.lighting=!1,Planets3d._drawRings(e),e.lighting=f)),e.lighting=f}else if(t)if(t<9||19===t){var m=800*Planets._planetDiameters[t];BasePlanets.drawPointPlanet(e,new Vector3d,Math.max(.05,Math.min(.1,m)),Planets.planetColors[t],!0)}else g>.002&&(m=800*Planets._planetDiameters[t],BasePlanets.drawPointPlanet(e,new Vector3d,Math.max(.05,Math.min(.1,m)),Planets.planetColors[t],!0));else BasePlanets.drawPointPlanet(e,new Vector3d,10*Planets._planetDiameters[t],Planets.planetColors[t],!0)}LayerManager._draw(e,1,!1,Planets.getNameFrom3dId(t),!0,!1),e.set_world(r),e.set_worldBase(n),e.set_worldBaseNonRotating(s)},Planets3d.drawSaturnsRings=function(e,t,i){if(null==Planets3d._ringsTriangleLists[0]){Planets3d._ringImage=document.createElement("img"),Planets3d._ringImage.crossOrigin="anonymous",Planets3d._ringImage.src=URLHelpers.singleton.engineAssetUrl("saturnringsshadow.png"),Planets3d._ringsTriangleLists[0]=[],Planets3d._ringsTriangleLists[1]=[];var r,n=2.25,s=Vector3d.create(-2.25,0,-2.25),a=Vector3d.create(n,0,-2.25),o=Vector3d.create(-2.25,0,n),l=Vector3d.create(n,0,n),h=(Vector3d.create(0,0,0),Vector3d.create(-2.25,0,0),Vector3d.create(0,0,-2.25),Vector3d.create(0,0,n),Vector3d.create(n,0,0),1024),c=1024;(r=[]).push(PositionTexture.createPosSize(s,0,0,h,c)),r.push(PositionTexture.createPosSize(a,1,0,h,c)),r.push(PositionTexture.createPosSize(o,0,1,h,c)),r.push(PositionTexture.createPosSize(l,1,1,h,c));var u=[];u.push(Triangle.create(0,2,1)),u.push(Triangle.create(2,3,1));for(var d=5;d-- >1;){for(var _=[],g=ss.ss.enumerate(u);g.moveNext();)(M=g.current).subDivideNoNormalize(_,r);u=_}for(var f=.6/(h/256),m=ss.ss.enumerate(u);m.moveNext();){var p=r[(M=m.current).a],C=r[M.b],S=r[M.c];Planets3d._ringsTriangleLists[0].push(RenderTriangle.createWithMiter(p,C,S,Planets3d._ringImage,6,f))}}if(null==e.gl){e.cameraPosition,new Vector3d;var w=Matrix3d.multiplyMatrix(Matrix3d._rotationY(Math.atan2(e.get_sunPosition().x,e.get_sunPosition().z)),e.get_worldBaseNonRotating()),T=Matrix3d.multiplyMatrix(w,e.get_view()),y=Matrix3d.multiplyMatrix(T,e.get_projection());h=e.width,c=e.height,y.scale(Vector3d.create(h/2,-c/2,1)),y.translate(Vector3d.create(h/2,c/2,0));for(var b=0;b<2;b++){for(var v=ss.ss.enumerate(Planets3d._ringsTriangleLists[0]);v.moveNext();){var M=v.current,x=T.transform(M.a.position).length()>i;t&&(x=!x),x&&(M.opacity=1,M.draw(e.device,y))}RenderTriangle.cullInside=!RenderTriangle.cullInside}}},Planets3d._drawRings=function(e){Planets3d._initRings(),TileShader.use(e,Planets3d._ringsVertexBuffer.vertexBuffer,null,Planets._ringsTexture.texture2d,1,!1,Vector3d.zero),e.gl.drawArrays(WEBGL.TRIANGLE_STRIP,0,Planets3d._triangleCountRings)},Planets3d._initRings=function(){if(null==Planets3d._ringsVertexBuffer){Planets._ringsTexture=Texture.fromUrl(URLHelpers.singleton.engineAssetUrl("saturnringsstrip.png"));var e=1.113,t=2.25;Planets3d._ringsVertexBuffer=new PositionTextureVertexBuffer(386),Planets3d._triangleCountRings=386;for(var i=Planets3d._ringsVertexBuffer.lock(),r=2*Math.PI/192,n=0,s=0;s<=192;s+=2){var a=s*r,o=(s+1)*r;i[n]=new PositionTexture,i[n].position=Vector3d.create(Math.cos(a)*e,0,Math.sin(a)*e),i[n].tu=1,i[n].tv=0,i[++n]=new PositionTexture,i[n].position=Vector3d.create(Math.cos(a)*t,0,Math.sin(a)*t),i[n].tu=0,i[n].tv=0,i[++n]=new PositionTexture,i[n].position=Vector3d.create(Math.cos(o)*e,0,Math.sin(o)*e),i[n].tu=1,i[n].tv=1,i[++n]=new PositionTexture,i[n].position=Vector3d.create(Math.cos(o)*t,0,Math.sin(o)*t),i[n].tu=0,i[n].tv=1,n++}Planets3d._ringsVertexBuffer.unlock()}},Planets3d._drawSphere=function(e,t){var i=Planets3d.getImageSetNameNameFrom3dId(t),r=globalWWTControl.getImagesetByName(i);null==r&&(r=globalWWTControl.getImagesetByName("Bing Maps Aerial")),null==r||e.drawImageSet(r,100)},registerType("Planets3d",[Planets3d,{},null]),WWTControl.imageSets=[],WWTControl.imageSetName="",WWTControl.showDataLayers=!1,WWTControl._renderNeeded=!1,WWTControl.constellationsFigures=null,WWTControl.constellationsBoundries=null,WWTControl.solarSystemObjectsNames=["Sun","Mercury","Venus","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto","Moon","Io","Europa","Ganymede","Callisto","IoShadow","EuropaShadow","GanymedeShadow","CallistoShadow","SunEclipsed","Earth","Custom","Undefined"],WWTControl.addImageSetToRepository=function(e){for(var t=ss.ss.enumerate(WWTControl.imageSets);t.moveNext();){var i=t.current;if(i.get_imageSetID()===e.get_imageSetID())return i}return WWTControl.imageSets.push(e),e},WWTControl.getImageSets=function(){return WWTControl.imageSets},WWTControl.get_renderNeeded=function(){return WWTControl._renderNeeded},WWTControl.set_renderNeeded=function(e){return WWTControl._renderNeeded=!0,e},WWTControl.initControl=function(e){return WWTControl.initControl2(e,!0)},WWTControl.initControlParam=function(e,t){return WWTControl.initControl2(e,!0)},WWTControl.initControl2=function(e,t){return WWTControl.initControl6(e,t,0,0,360,"Sky")},WWTControl.initControl6=function(e,t,i,r,n,s){if(null==globalRenderContext.device){WWTControl.scriptInterface=new ScriptInterface,WWTControl.scriptInterface.settings=Settings.get_current(),set_globalScriptInterface(WWTControl.scriptInterface);var a=WWTControl._createCanvasElement(e),o=a.getContext("webgl2");if(null!=o?set_useGlVersion2(!0):(console.warn("This browser does not support WebGL 2.0. Some features will work suboptimally. To get the full WWT experience, consider using the latest version of Chrome, Firefox or Edge. In case you would like to use Safari, we recommend that you enable WebGL 2.0"),o=a.getContext("webgl")),null==o&&(o=a.getContext("experimental-webgl")),null==o){var l=a.getContext("2d");globalRenderContext.device=l}else set_tilePrepDevice(o),globalRenderContext.gl=o,set_useGl(!0);globalWWTControl.canvas=a,globalRenderContext.width=a.width,globalRenderContext.height=a.height,globalWWTControl.setup(a,i,r,n),Constellations.initializeConstellations(),LayerManager.oneTimeInitialization(),"earth"===s?globalRenderContext.set_backgroundImageset(Imageset.create("Blue Marble",URLHelpers.singleton.coreStaticUrl("wwtweb/tiles.aspx?q={1},{2},{3},bm200407"),ImageSetType.earth,BandPass.visible,ProjectionType.toast,101,0,7,256,180,".png",!1,"",0,0,0,!1,URLHelpers.singleton.coreStaticUrl("wwtweb/thumbnail.aspx?name=bm200407"),!0,!1,0,0,0,"","","","",6371e3,"Earth")):"black"===s?globalRenderContext.set_backgroundImageset(Imageset.create("Black Sky Background","",ImageSetType.sky,BandPass.visible,ProjectionType.toast,102,0,0,256,180,".png",!1,"0123",0,0,0,!1,"",!1,!1,2,0,0,"","","","",1,"Sky")):globalRenderContext.set_backgroundImageset(Imageset.create("DSS",URLHelpers.singleton.coreStaticUrl("wwtweb/dss.aspx?q={1},{2},{3}"),ImageSetType.sky,BandPass.visible,ProjectionType.toast,100,0,12,256,180,".png",!1,"",0,0,0,!1,URLHelpers.singleton.coreStaticUrl("thumbnails/DSS.png"),!0,!1,0,0,0,"","","","",1,"Sky"))}return globalRenderContext.viewCamera.lng+=0,globalRenderContext._initGL(),t&&globalWWTControl.render(),globalScriptInterface},WWTControl._createCanvasElement=function(e){var t=document.getElementById(e),i=document.createElement("canvas");return i.height=t.clientHeight,i.width=t.clientWidth,t.appendChild(i),i},WWTControl.useUserLocation=function(){navigator.geolocation.getCurrentPosition(WWTControl._getLocation,WWTControl._getLocationError)},WWTControl._getLocation=function(e){e.coords.latitude&&Settings.get_globalSettings().set_locationLat(e.coords.latitude),e.coords.longitude&&Settings.get_globalSettings().set_locationLng(e.coords.longitude),e.coords.altitude&&Settings.get_globalSettings().set_locationAltitude(e.coords.altitude)},WWTControl._getLocationError=function(e){null!=e&&null!=e.coords&&(e.coords.latitude,e.coords.longitude)},WWTControl.setBackgroundImageName=function(e){WWTControl.imageSetName=e},WWTControl.setForegroundImageName=function(e){WWTControl.imageSetName=e},WWTControl.showLayers=function(e){WWTControl.showDataLayers=e};var WWTControl$={_addAnnotation:function(e){this._annotations.push(e),Annotation.batchDirty=!0},_removeAnnotation:function(e){ss.ss.remove(this._annotations,e),Annotation.batchDirty=!0},_clearAnnotations:function(){this._annotations.length=0,Annotation.batchDirty=!0},_annotationclicked:function(e,t,i,r){if(null!=this._annotations&&this._annotations.length>0)for(var n=ss.ss.enumerate(this._annotations);n.moveNext();){var s=n.current;if(s.hitTest(this.renderContext,e,t,i,r))return globalScriptInterface._fireAnnotationclicked(e,t,s.get_id()),!0}return!1},_annotationHover:function(e,t,i,r){if(null!=this._annotations&&this._annotations.length>0)for(var n=ss.ss.enumerate(this._annotations);n.moveNext();){var s=n.current;if(s.hitTest(this.renderContext,e,t,i,r))return this._hoverText=s.get_label(),this._hoverTextPoint=Vector2d.create(i,r),!0}return!1},get_zoomMax:function(){return null!=this.renderContext.get_backgroundImageset()&&this.renderContext.get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem?this._zoomMaxSolarSystem:this._zoomMax},set_zoomMax:function(e){return this._zoomMax=e,e},setSolarSystemMaxZoom:function(e){this._zoomMaxSolarSystem=e},get_zoomMin:function(){return null!=this.renderContext.get_backgroundImageset()&&this.renderContext.get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem?this._zoomMinSolarSystem:this._zoomMin},set_zoomMin:function(e){return this._zoomMin=e,e},setSolarSystemMinZoom:function(e){this._zoomMinSolarSystem=e},_notifyMoveComplete:function(){},get_crossFadeFrame:function(){return this._crossFadeFrame},set_crossFadeFrame:function(e){return e&&this._crossFadeFrame!==e&&(this._crossFadeTexture,this._crossFadeTexture=this.renderContext._getScreenTexture()),this._crossFadeFrame=e,e||null!=this._crossFadeTexture&&(this._crossFadeTexture=null),e},_fadeFrame:function(){if(null!=this.renderContext.gl){var e=Settings.get_active().getSetting(17);if(e.opacity>0){var t=Color._fromArgbColor(255-UiTools.gamma(255-ss.ss.truncate(255*e.opacity),1/2.2),Colors.get_black());if(e.opacity>0||(t=Color._fromArgbColor(255-UiTools.gamma(255-ss.ss.truncate(255*e.opacity),1/2.2),Colors.get_black())),this._crossFadeFrame?t=Color._fromArgbColor(UiTools.gamma(ss.ss.truncate(255*e.opacity),1/2.2),Colors.get_white()):null!=this._crossFadeTexture&&(this._crossFadeTexture=null),null==this._fadePoints){this._fadePoints=new Array(4);for(var i=0;i<4;i++)this._fadePoints[i]=new PositionColoredTextured}this._fadePoints[0].position.x=-this.renderContext.width/2,this._fadePoints[0].position.y=this.renderContext.height/2,this._fadePoints[0].position.z=1347,this._fadePoints[0].tu=0,this._fadePoints[0].tv=1,this._fadePoints[0].color=t,this._fadePoints[1].position.x=-this.renderContext.width/2,this._fadePoints[1].position.y=-this.renderContext.height/2,this._fadePoints[1].position.z=1347,this._fadePoints[1].tu=0,this._fadePoints[1].tv=0,this._fadePoints[1].color=t,this._fadePoints[2].position.x=this.renderContext.width/2,this._fadePoints[2].position.y=this.renderContext.height/2,this._fadePoints[2].position.z=1347,this._fadePoints[2].tu=1,this._fadePoints[2].tv=1,this._fadePoints[2].color=t,this._fadePoints[3].position.x=this.renderContext.width/2,this._fadePoints[3].position.y=-this.renderContext.height/2,this._fadePoints[3].position.z=1347,this._fadePoints[3].tu=1,this._fadePoints[3].tv=0,this._fadePoints[3].color=t,this._sprite.draw(this.renderContext,this._fadePoints,4,this._crossFadeTexture,!0,1)}}},captureVideo:function(e,t,i,r,n,s){this.capturingVideo=!0,this._videoBlobReady=e,ss.ss.clearKeys(this._videoBlobQueue),this._videoQueueIndex=0,this._emptyFrames.length=0,this.dumpFrameParams=new VideoOutputType(t,i,r,s,!0),SpaceTimeController.frameDumping=!0,SpaceTimeController.framesPerSecond=r,SpaceTimeController.totalFrames=n,SpaceTimeController.currentFrameNumber=0},render:function(){var e=this;this.renderOneFrame(),setTimeout((function(){e.render()}),10)},renderOneFrame:function(){null!=this.renderContext.get_backgroundImageset()?this.renderType=this.renderContext.get_backgroundImageset().get_dataSetType():this.renderType=2;var e=!1;if(this.canvas.width!==this.canvas.parentNode.clientWidth&&(this.canvas.width=this.canvas.parentNode.clientWidth,e=!0),this.canvas.height!==this.canvas.parentNode.clientHeight&&(this.canvas.height=this.canvas.parentNode.clientHeight,e=!0),e&&null!=this.explorer&&this.explorer.refresh(),!(this.canvas.width<1||this.canvas.height<1)){if(e&&(this._crossHairs=null),Tile.lastDeepestLevel=Tile.deepestLevel,RenderTriangle.width=this.renderContext.width=this.canvas.width,RenderTriangle.height=this.renderContext.height=this.canvas.height,Tile.tilesInView=0,Tile.tilesTouched=0,Tile.deepestLevel=0,SpaceTimeController.set_metaNow(ss.ss.now()),null!=this.get__mover()){if(SpaceTimeController.set_now(this.get__mover().get_currentDateTime()),Planets.updatePlanetLocations(this.get_solarSystemMode()),null!=this.get__mover()){var t=this.get__mover().get_currentPosition();if(this.renderContext.targetCamera=t.copy(),this.renderContext.viewCamera=t.copy(),this.renderContext.space&&Settings.get_active().get_galacticMode()){var i=Coordinates.j2000toGalactic(15*t.get_RA(),t.get_dec());this.renderContext.targetAlt=this.renderContext.alt=i[1],this.renderContext.targetAz=this.renderContext.az=i[0]}else if(this.renderContext.space&&Settings.get_active().get_localHorizonMode()){var r=Coordinates.equitorialToHorizon(Coordinates.fromRaDec(t.get_RA(),t.get_dec()),SpaceTimeController.get_location(),SpaceTimeController.get_now());this.renderContext.targetAlt=this.renderContext.alt=r.get_alt(),this.renderContext.targetAz=this.renderContext.az=r.get_az()}this.get__mover().get_complete()&&(globalScriptInterface._fireArrived(this.get__mover().get_currentPosition().get_RA(),this.get__mover().get_currentPosition().get_dec(),globalRenderContext.viewCamera.zoom),this.set__mover(null),this._notifyMoveComplete())}}else SpaceTimeController.updateClock(),Planets.updatePlanetLocations(this.get_solarSystemMode()),this._updateViewParameters();if(this.renderContext.clear(),4===this.renderType){this._solarSystemTrack<20&&(Planets.getAdjustedPlanetRadius(this._solarSystemTrack),this.renderContext.get_solarSystemCameraDistance(),this.renderContext.get_fovLocal()),this._trackingObject,this.renderContext.setupMatricesSolarSystem(!0);var n=this.renderContext.viewCamera.zoom,s=Math.min(1,Math.max(0,Math.log(n)-8.4)/4.2),a=Math.min(1,Math.max(0,Math.log(n)-17.9)/2.3),o=this.renderContext.get_world(),l=this.renderContext.get_world().clone();l._multiply(Matrix3d._scaling(1e5,1e5,1e5)),l._multiply(Matrix3d._rotationX(23.5/180*Math.PI)),l._multiply(Matrix3d.translation(this.renderContext.cameraPosition)),this.renderContext.set_world(l),this.renderContext.set_worldBase(l),this.renderContext.space=!0,this.renderContext.makeFrustum();var h=this.renderContext.lighting;if(this.renderContext.lighting=!1,Settings.get_active().get_solarSystemMilkyWay()&&s<1&&(null==this._milkyWayBackground&&(this._milkyWayBackground=this.getImagesetByName("Digitized Sky Survey (Color)")),null!=this._milkyWayBackground)){RenderTriangle.cullInside=!0;var c=(1-s)/2;this.renderContext.drawImageSet(this._milkyWayBackground,100*c),RenderTriangle.cullInside=!1}this._drawSkyOverlays(),this.renderContext.lighting=h,this.renderContext.space=!1,this.renderContext.set_world(o),this.renderContext.set_worldBase(o),this.renderContext.makeFrustum();var u=this.renderContext.cameraPosition,d=this.renderContext.get_world(),_=this.renderContext.get_world();_._multiply(Matrix3d.translation(this.renderContext.viewCamera.viewTarget)),this.renderContext.cameraPosition=Vector3d.subtractVectors(this.renderContext.cameraPosition,this.renderContext.viewCamera.viewTarget),this.renderContext.set_world(_),this.renderContext.makeFrustum(),Settings.get_active().get_solarSystemCosmos()&&Grids.drawCosmos3D(this.renderContext,1),Settings.get_active().get_solarSystemMilkyWay()&&a>0&&Grids.drawGalaxyImage(this.renderContext,a),Settings.get_active().get_solarSystemStars()&&Grids.drawStars3D(this.renderContext,1),_=d;var g=this.renderContext.viewCamera.viewTarget,f=Vector3d.create(-g.x,-g.y,-g.z);this.renderContext.cameraPosition=u,_._multiply(Matrix3d.translation(f)),this.renderContext.set_world(_),this.renderContext.makeFrustum(),LayerManager._draw(this.renderContext,1,!0,"Sky",!0,!1),this.renderContext.set_world(d),this.renderContext.makeFrustum(),this.renderContext.get_solarSystemCameraDistance()<15e3&&(this.renderContext.setupMatricesSolarSystem(!1),Settings.get_active().get_solarSystemMinorPlanets()&&MinorPlanets.drawMPC3D(this.renderContext,1,this.renderContext.viewCamera.viewTarget),Settings.get_active().get_solarSystemPlanets()&&Planets3d.drawPlanets3D(this.renderContext,1,this.renderContext.viewCamera.viewTarget))}else{if(this.renderType&&1!==this.renderType?this.renderContext.setupMatricesSpace3d(this.renderContext.width,this.renderContext.height):this.renderContext._setupMatricesLand3d(),this.renderContext.drawImageSet(this.renderContext.get_backgroundImageset(),100),null!=this.renderContext.get_foregroundImageset())if(this.renderContext.get_foregroundImageset().get_dataSetType()!==this.renderContext.get_backgroundImageset().get_dataSetType())this.renderContext.set_foregroundImageset(null);else if(100!==this.renderContext.viewCamera.opacity&&null==this.renderContext.gl){this._foregroundCanvas.width===this.renderContext.width&&this._foregroundCanvas.height===this.renderContext.height||(this._foregroundCanvas.width=ss.ss.truncate(this.renderContext.width),this._foregroundCanvas.height=ss.ss.truncate(this.renderContext.height));var m=this.renderContext.device;this._fgDevice.clearRect(0,0,this.renderContext.width,this.renderContext.height),this.renderContext.device=this._fgDevice,this.renderContext.drawImageSet(this.renderContext.get_foregroundImageset(),100),this.renderContext.device=m,this.renderContext.device.save(),this.renderContext.device.globalAlpha=this.renderContext.viewCamera.opacity/100,this.renderContext.device.drawImage(this._foregroundCanvas,0,0),this.renderContext.device.restore()}else this.renderContext.drawImageSet(this.renderContext.get_foregroundImageset(),this.renderContext.viewCamera.opacity);if(2===this.renderType)for(var p=ss.ss.enumerate(this.renderContext.get_catalogHipsImagesets());p.moveNext();){var C=p.current;C.get_hipsProperties().get_catalogSpreadSheetLayer().enabled&&C.get_hipsProperties().get_catalogSpreadSheetLayer().lastVersion===C.get_hipsProperties().get_catalogSpreadSheetLayer().get_version()&&this.renderContext.drawImageSet(C,100)}if(2===this.renderType&&Settings.get_active().get_showSolarSystem()&&(Planets.drawPlanets(this.renderContext,1),this.constellation=Constellations.containment.findConstellationForPoint(this.renderContext.viewCamera.get_RA(),this.renderContext.viewCamera.get_dec()),this._drawSkyOverlays()),this.get_planetLike()||this.get_space()){if(this.get_space())this.renderContext.set_worldBaseNonRotating(this.renderContext.get_world()),null!=this._targetBackgroundImageset&&this.renderContext.set_nominalRadius(this._targetBackgroundImageset.get_meanRadius());else{var S=Coordinates.mstFromUTC2(SpaceTimeController.get_now(),0)/180*Math.PI;this.renderContext.set_worldBaseNonRotating(Matrix3d.multiplyMatrix(Matrix3d._rotationY(S),this.renderContext.get_worldBase())),null!=this._targetBackgroundImageset&&this.renderContext.set_nominalRadius(this._targetBackgroundImageset.get_meanRadius())}var w=this.getCurrentReferenceFrame();LayerManager._draw(this.renderContext,1,this.get_space(),w,!0,this.get_space())}}var T=this.renderContext.get_world(),y=this.renderContext.get_view(),b=this.renderContext.get_projection();if(Settings.get_current().get_showCrosshairs()&&this._drawCrosshairs(this.renderContext),null!=this.uiController)this.uiController.render(this.renderContext);else{Annotation.prepBatch(this.renderContext);for(var v=ss.ss.enumerate(this._annotations);v.moveNext();)v.current.draw(this.renderContext);if(Annotation.drawBatch(this.renderContext),ss.ss.now()-this._lastMouseMove>400){var M=this.getCoordinatesForScreenPoint(this._hoverTextPoint.x,this._hoverTextPoint.y);this._annotationHover(M.x,M.y,this._hoverTextPoint.x,this._hoverTextPoint.y),this._lastMouseMove=new Date(2100,1,1)}ss.ss.emptyString(this._hoverText)||this._drawHoverText(this.renderContext)}var x=!TileCache.get_queueCount();this.renderContext.setupMatricesOverlays(),this._fadeFrame(),this._frameCount++,TileCache.decimateQueue(),TileCache.processQueue(this.renderContext),Tile.currentRenderGeneration++,TourPlayer.get_playing()||this.set_crossFadeFrame(!1),this.renderContext.set_world(T),this.renderContext.set_view(y),this.renderContext.set_projection(b);var L=ss.ss.now();L-this._lastUpdate>1e3&&(this._lastUpdate=L,this._frameCount=0,RenderTriangle.trianglesRendered=0,RenderTriangle.trianglesCulled=0),this.capturingVideo&&(null==this.dumpFrameParams||this.dumpFrameParams.waitDownload&&!x||(this.captureFrameForVideo(this._videoBlobReady,this.dumpFrameParams.width,this.dumpFrameParams.height,this.dumpFrameParams.format),SpaceTimeController.nextFrame()),SpaceTimeController.get_doneDumping()&&(SpaceTimeController.frameDumping=!1,SpaceTimeController.cancelFrameDump=!1,this.capturingVideo=!1))}},getCurrentReferenceFrame:function(){if(null==this.renderContext.get_backgroundImageset())return"Sun";if(!ss.ss.emptyString(this.renderContext.get_backgroundImageset().get_referenceFrame()))return this.renderContext.get_backgroundImageset().get_referenceFrame();if(!this.renderContext.get_backgroundImageset().get_dataSetType())return"Earth";if("Visible Imagery"===this.renderContext.get_backgroundImageset().get_name()&&this.renderContext.get_backgroundImageset().get_url().toLowerCase().indexOf("mars")>-1)return this.renderContext.get_backgroundImageset().set_referenceFrame("Mars"),this.renderContext.get_backgroundImageset().get_referenceFrame();if(1===this.renderContext.get_backgroundImageset().get_dataSetType())for(var e=ss.ss.enumerate(WWTControl.solarSystemObjectsNames);e.moveNext();){var t=e.current;if(this.renderContext.get_backgroundImageset().get_name().toLowerCase().indexOf(t.toLowerCase())>-1)return this.renderContext.get_backgroundImageset().set_referenceFrame(t),t}return 2===this.renderContext.get_backgroundImageset().get_dataSetType()?"Sky":""},get_planetLike:function(){return null==this.renderContext.get_backgroundImageset()||!this.renderContext.get_backgroundImageset().get_dataSetType()||1===this.renderContext.get_backgroundImageset().get_dataSetType()},get_space:function(){return null==this.renderContext.get_backgroundImageset()||2===this.renderContext.get_backgroundImageset().get_dataSetType()},_drawSkyOverlays:function(){Settings.get_active().get_showConstellationPictures()&&!this.freestandingMode&&Constellations.drawArtwork(this.renderContext),Settings.get_active().get_showConstellationFigures()&&(null==WWTControl.constellationsFigures&&(WWTControl.constellationsFigures=Constellations.create("Constellations",URLHelpers.singleton.engineAssetUrl("figures.txt"),!1,!1,!1)),WWTControl.constellationsFigures.draw(this.renderContext,!1,"UMA",!1)),Settings.get_active().get_showEclipticGrid()&&(Grids.drawEclipticGrid(this.renderContext,1,Settings.get_active().get_eclipticGridColor()),Settings.get_active().get_showEclipticGridText()&&Grids.drawEclipticGridText(this.renderContext,1,Settings.get_active().get_eclipticGridColor())),Settings.get_active().get_showGalacticGrid()&&(Grids.drawGalacticGrid(this.renderContext,1,Settings.get_active().get_galacticGridColor()),Settings.get_active().get_showGalacticGridText()&&Grids.drawGalacticGridText(this.renderContext,1,Settings.get_active().get_galacticGridColor())),Settings.get_active().get_showAltAzGrid()&&(Grids.drawAltAzGrid(this.renderContext,1,Settings.get_active().get_altAzGridColor()),Settings.get_active().get_showAltAzGridText()&&Grids.drawAltAzGridText(this.renderContext,1,Settings.get_active().get_altAzGridColor())),Settings.get_active().get_showPrecessionChart()&&Grids.drawPrecessionChart(this.renderContext,1,Settings.get_active().get_precessionChartColor()),Settings.get_active().get_showEcliptic()&&(Grids.drawEcliptic(this.renderContext,1,Settings.get_active().get_eclipticColor(),Settings.get_active().get_showEclipticCircle()),Settings.get_active().get_showEclipticOverviewText()&&Grids.drawEclipticText(this.renderContext,1,Settings.get_active().get_eclipticColor())),Settings.get_active().get_showGrid()&&(Grids.drawEquitorialGrid(this.renderContext,1,Settings.get_active().get_equatorialGridColor()),Settings.get_active().get_showEquatorialGridText()&&Grids.drawEquitorialGridText(this.renderContext,1,Settings.get_active().get_equatorialGridColor())),Settings.get_active().get_showConstellationBoundries()&&(null==WWTControl.constellationsBoundries&&(WWTControl.constellationsBoundries=Constellations.create("Constellations",URLHelpers.singleton.engineAssetUrl("constellations.txt"),!0,!1,!1)),WWTControl.constellationsBoundries.draw(this.renderContext,Settings.get_active().get_showConstellationSelection(),this.constellation,!1)),Settings.get_active().get_showConstellationLabels()&&Constellations.drawConstellationNames(this.renderContext,1,Colors.get_yellow())},_drawHoverText:function(e){if(null==e.gl){var t=e.device;t.save(),t.fillStyle="White",t.font="15px Arial",t.fillText(this._hoverText,this._hoverTextPoint.x,this._hoverTextPoint.y),t.restore()}},rAtoViewLng:function(e){return(180-e/24*360-180+540)%360-180},_updateViewParameters:function(){if(this.renderContext.space&&this._tracking&&null!=this._trackingObject)if(Settings.get_active().get_galacticMode()&&this.renderContext.space){var e=Coordinates.j2000toGalactic(15*this._trackingObject.get_RA(),this._trackingObject.get_dec());this.renderContext.targetAlt=this.renderContext.alt=e[1],this.renderContext.targetAz=this.renderContext.az=e[0]}else if(this.renderContext.space&&Settings.get_active().get_localHorizonMode()){var t=Coordinates.equitorialToHorizon(Coordinates.fromRaDec(this._trackingObject.get_RA(),this._trackingObject.get_dec()),SpaceTimeController.get_location(),SpaceTimeController.get_now());this.renderContext.targetAlt=this.renderContext.alt=t.get_alt(),this.renderContext.targetAz=this.renderContext.az=t.get_az()}else this.renderContext.viewCamera.lng=this.renderContext.targetCamera.lng=this.rAtoViewLng(this._trackingObject.get_RA()),this.renderContext.viewCamera.lat=this.renderContext.targetCamera.lat=this._trackingObject.get_dec();else this.get_solarSystemMode()||(this._tracking=!1,this._trackingObject=null);var i=1-.8;if(!this._tracking){var r=this.renderContext.viewCamera.zoom/4e3;this.renderContext.viewCamera.zoom>360&&(r=.009),this.renderContext.space&&(Settings.get_active().get_localHorizonMode()||Settings.get_active().get_galacticMode())?1==(Math.abs(this.renderContext.targetAlt-this.renderContext.alt)>=r|Math.abs(this.renderContext.targetAz-this.renderContext.az)>=r)&&(this.renderContext.alt+=(this.renderContext.targetAlt-this.renderContext.alt)/10,Math.abs(this.renderContext.targetAz-this.renderContext.az)>170?this.renderContext.targetAz>this.renderContext.az?this.renderContext.az+=(this.renderContext.targetAz-(360+this.renderContext.az))/10:this.renderContext.az+=(360+this.renderContext.targetAz-this.renderContext.az)/10:this.renderContext.az+=(this.renderContext.targetAz-this.renderContext.az)/10,this.renderContext.az=(this.renderContext.az+720)%360):1==(Math.abs(this.renderContext.targetCamera.lat-this.renderContext.viewCamera.lat)>=r|Math.abs(this.renderContext.targetCamera.lng-this.renderContext.viewCamera.lng)>=r)?(this.renderContext.viewCamera.lat+=(this.renderContext.targetCamera.lat-this.renderContext.viewCamera.lat)/10,Math.abs(this.renderContext.targetCamera.lng-this.renderContext.viewCamera.lng)>170?this.renderContext.targetCamera.lng>this.renderContext.viewCamera.lng?this.renderContext.viewCamera.lng+=(this.renderContext.targetCamera.lng-(360+this.renderContext.viewCamera.lng))/10:this.renderContext.viewCamera.lng+=(360+this.renderContext.targetCamera.lng-this.renderContext.viewCamera.lng)/10:this.renderContext.viewCamera.lng+=(this.renderContext.targetCamera.lng-this.renderContext.viewCamera.lng)/10,this.renderContext.viewCamera.lng=(this.renderContext.viewCamera.lng+720)%360):this.renderContext.viewCamera.lat===this.renderContext.targetCamera.lat&&this.renderContext.viewCamera.lng===this.renderContext.targetCamera.lng||(this.renderContext.viewCamera.lat=this.renderContext.targetCamera.lat,this.renderContext.viewCamera.lng=this.renderContext.targetCamera.lng)}this.renderContext.viewCamera.zoom=.8*this.renderContext.viewCamera.zoom+i*this.renderContext.targetCamera.zoom,this.renderContext.viewCamera.rotation=.8*this.renderContext.viewCamera.rotation+i*this.renderContext.targetCamera.rotation,this.renderContext.viewCamera.angle=.8*this.renderContext.viewCamera.angle+i*this.renderContext.targetCamera.angle},move:function(e,t){var i=Math.atan2(t,e),r=Math.sqrt(e*e+t*t);this.get_solarSystemMode()||this.get_planetLike()?(e=Math.cos(i+this.renderContext.viewCamera.rotation)*r,t=Math.sin(i+this.renderContext.viewCamera.rotation)*r):(e=Math.cos(i-this.renderContext.viewCamera.rotation)*r,t=Math.sin(i-this.renderContext.viewCamera.rotation)*r);var n=this.renderContext.get_fovScale()/3600;this.renderContext.get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem&&(n=.06);var s=n/Math.max(.2,Math.cos(this.renderContext.viewCamera.lat/180*Math.PI));this.renderContext.get_backgroundImageset().get_dataSetType()&&1!==this.renderContext.get_backgroundImageset().get_dataSetType()&&this.renderContext.get_backgroundImageset().get_dataSetType()!=ImageSetType.solarSystem||(s*=6.3,n*=6.3),this.renderContext.space&&(Settings.get_active().get_galacticMode()||Settings.get_active().get_localHorizonMode())?(e=Settings.get_active().get_localHorizonMode()?-e:e,this.renderContext.targetAz+=e*s,this.renderContext.targetAz=(this.renderContext.targetAz+720)%360,this.renderContext.targetAlt+=t*n,this.renderContext.targetAlt>90&&(this.renderContext.targetAlt=90),this.renderContext.targetAlt<-90&&(this.renderContext.targetAlt=-90)):(this.renderContext.targetCamera.lng-=e*s,this.renderContext.targetCamera.lng=(this.renderContext.targetCamera.lng+720)%360,this.renderContext.targetCamera.lat+=t*n,this.renderContext.targetCamera.lat>90&&(this.renderContext.targetCamera.lat=90),this.renderContext.targetCamera.lat<-90&&(this.renderContext.targetCamera.lat=-90)),Settings.get_globalSettings().get_smoothPan()||(this.renderContext.viewCamera=this.renderContext.targetCamera.copy()),e&&t&&(this._tracking=!1,this._trackingObject=null)},zoom:function(e){this.renderContext.targetCamera.zoom*=e,this.renderContext.targetCamera.zoom>this.get_zoomMax()&&(this.renderContext.targetCamera.zoom=this.get_zoomMax()),this.renderContext.targetCamera.zoom<this.get_zoomMin()&&(this.renderContext.targetCamera.zoom=this.get_zoomMin()),Settings.get_globalSettings().get_smoothPan()||(this.renderContext.viewCamera=this.renderContext.targetCamera.copy())},roll:function(e){this.renderContext.targetCamera.rotation+=e},onGestureStart:function(e){this._mouseDown=!1,this._beginZoom=this.renderContext.viewCamera.zoom},onGestureChange:function(e){var t=e;this._mouseDown=!1,this.renderContext.targetCamera.zoom=this.renderContext.viewCamera.zoom=Math.max(this.get_zoomMin(),Math.min(this.get_zoomMax(),this._beginZoom*(1/t.scale)))},onGestureEnd:function(e){this._mouseDown=!1},onTouchStart:function(e){var t=e;if(t.preventDefault(),t.stopPropagation(),this._lastX=t.targetTouches[0].pageX,this._lastY=t.targetTouches[0].pageY,2===t.targetTouches.length){this._hasTwoTouches=!0;var i=t.touches[0],r=t.touches[1];return this._twoTouchCenter=Vector2d.create(.5*(i.pageX+r.pageX),.5*(i.pageY+r.pageY)),this._lastTouchRect[0]=Vector2d.create(i.pageX,i.pageY),void(this._lastTouchRect[1]=Vector2d.create(r.pageX,r.pageY))}if(null!=this.uiController){var n=new WWTElementEvent(this._lastX,this._lastY);if(this.uiController.mouseDown(this,n))return this._mouseDown=!1,void(this._dragging=!1)}this._mouseDown=!0},onTouchMove:function(e){var t=e;if(this._hasTwoTouches){var i=t.touches[0],r=t.touches[1],n=new Array(2);if(n[0]=Vector2d.create(i.pageX,i.pageY),n[1]=Vector2d.create(r.pageX,r.pageY),this._twoTouchEvents+=1,!this._dragging&&null!=this._lastTouchRect[0]&&null!=this._lastTouchRect[1]&&null!=this._twoTouchCenter&&this._twoTouchEvents>this._twoTouchEventThreshold){var s=Vector2d.subtract(n[0],this._lastTouchRect[0]),a=Vector2d.subtract(n[1],this._lastTouchRect[1]),o=Vector2d.subtract(this._lastTouchRect[0],this._twoTouchCenter),l=Vector2d.subtract(this._lastTouchRect[1],this._twoTouchCenter);o.normalize(),l.normalize();var h=s.x*o.x+s.y*o.y,c=a.x*l.x+a.y*l.y,u=Vector2d.create(h*o.x,h*o.y),d=Vector2d.create(c*l.x,c*l.y),_=Vector2d.subtract(s,u),g=Vector2d.subtract(a,d),f=u.get_length()+d.get_length();if(f>_.get_length()+g.get_length()&&!this._rotating){var m=this.getDistance(this._lastTouchRect[0],this._lastTouchRect[1])/this.getDistance(n[0],n[1]);this.zoom(m),this._zooming=!0}else if(!this._zooming&&f>0){var p=Vector2d.subtract(this._lastTouchRect[0],this._twoTouchCenter),C=Vector2d.subtract(this._lastTouchRect[1],this._twoTouchCenter),S=Vector2d.subtract(n[0],this._twoTouchCenter),w=Vector2d.subtract(n[1],this._twoTouchCenter),T=this.crossProductZ(p,S),y=this.crossProductZ(C,w),b=Math.asin(T/(p.get_length()*S.get_length())),v=Math.asin(y/(C.get_length()*w.get_length()));if(b*v>=0){var M=b+v;(this.get_planetLike()||this.get_solarSystemMode())&&(M*=-1),this.roll(M),this._rotating=!0}}this._twoTouchCenter=Vector2d.create(.5*(i.pageX+r.pageX),.5*(i.pageY+r.pageY)),this._lastTouchRect[0]=n[0],this._lastTouchRect[1]=n[1]}return this._pinchingZoomRect=n,t.stopPropagation(),void t.preventDefault()}if(t.preventDefault(),t.stopPropagation(),!this._mouseDown||this._rotating||this._zooming){if(null!=this.uiController&&this.uiController.mouseMove(this,e))return e.preventDefault(),void e.stopPropagation()}else{var x=t.targetTouches[0].pageX-this._lastX,L=t.targetTouches[0].pageY-this._lastY;this._dragging=this._dragging||Math.sqrt(x*x+L*L)>this._dragThreshold,this.move(x,L),this._lastX=t.targetTouches[0].pageX,this._lastY=t.targetTouches[0].pageY}},onTouchEnd:function(e){var t=e;if(t.preventDefault(),t.stopPropagation(),this._pinchingZoomRect[0]=null,this._pinchingZoomRect[1]=null,this._hasTwoTouches)t.touches.length<2&&(this._hasTwoTouches=!1,this._lastTouchRect[0]=null,this._lastTouchRect[1]=null,this._twoTouchCenter=null,this._twoTouchEvents=0);else{if(null!=this.uiController){var i=new WWTElementEvent(this._lastX,this._lastY);if(this.uiController.mouseUp(this,i))return this._mouseDown=!1,void(this._dragging=!1)}this._mouseDown=!1,this._dragging=!1,this._zooming=!1,this._rotating=!1}},onPointerDown:function(e){var t=e,i=0,r=arguments[0],n=arguments[0].target;if(n.setPointerCapture?n.setPointerCapture(r.pointerId):n.msSetPointerCapture&&n.msSetPointerCapture(r.pointerId),this._pointerIds[0]===t.pointerId)i=0;else if(this._pointerIds[1]===t.pointerId)i=1;else if(this._pointerIds[0]){if(this._pointerIds[1])return;i=1}else i=0;this._pointerIds[i]=t.pointerId,this._pinchingZoomRect[i]=Vector2d.create(e.offsetX,e.offsetY)},onPointerMove:function(e){var t=e,i=0;if(this._pointerIds[0]===t.pointerId)i=0;else{if(this._pointerIds[1]!==t.pointerId)return;i=1}if(null!=this._pinchingZoomRect[0]&&null!=this._pinchingZoomRect[1]){var r=this.getDistance(this._pinchingZoomRect[0],this._pinchingZoomRect[1]),n=Vector2d.create(e.offsetX,e.offsetY),s=r/this.getDistance(n,this._pinchingZoomRect[0]),a=Math.abs(Math.log(s));isFinite(a)||(a=1e3);var o=r/this.getDistance(n,this._pinchingZoomRect[1]),l=Math.abs(Math.log(o));isFinite(l)||(l=1e3),l<a?(this._pinchingZoomRect[0]=n,this.zoom(o)):(this._pinchingZoomRect[1]=n,this.zoom(s))}else this._pinchingZoomRect[i]=Vector2d.create(e.offsetX,e.offsetY);e.stopPropagation(),e.preventDefault()},onPointerUp:function(e){var t=e;this._pointerIds[0]===t.pointerId&&(this._pointerIds[0]=-2,this._pinchingZoomRect[0]=null),this._pointerIds[1]===t.pointerId&&(this._pointerIds[1]=-2,this._pinchingZoomRect[1]=null)},onMouseDown:function(e){document.addEventListener("mousemove",ss.ss.bind("onMouseMove",this),!1),document.addEventListener("mouseup",ss.ss.bind("onMouseUp",this),!1),null!=this.uiController&&this.uiController.mouseDown(this,e)||(this._mouseDown=!0,this._lastX=Mouse.offsetX(this.canvas,e),this._lastY=Mouse.offsetY(this.canvas,e))},onMouseMove:function(e){if(this._lastMouseMove=ss.ss.now(),this._hoverTextPoint=Vector2d.create(Mouse.offsetX(this.canvas,e),Mouse.offsetY(this.canvas,e)),this._hoverText="",this._mouseDown)e.preventDefault(),e.stopPropagation(),this._moved=!0,e.ctrlKey?this._tilt(Mouse.offsetX(this.canvas,e)-this._lastX,Mouse.offsetY(this.canvas,e)-this._lastY):this.move(Mouse.offsetX(this.canvas,e)-this._lastX,Mouse.offsetY(this.canvas,e)-this._lastY),this._lastX=Mouse.offsetX(this.canvas,e),this._lastY=Mouse.offsetY(this.canvas,e);else if(null!=this.uiController&&this.uiController.mouseMove(this,e))return e.preventDefault(),void e.stopPropagation()},onMouseUp:function(e){if(document.removeEventListener("mousemove",ss.ss.bind("onMouseMove",this),!1),document.removeEventListener("mouseup",ss.ss.bind("onMouseUp",this),!1),null!=this.uiController&&this.uiController.mouseUp(this,e))return this._mouseDown=!1,void e.preventDefault();if(this._mouseDown&&!this._moved){var t=this.getCoordinatesForScreenPoint(Mouse.offsetX(this.canvas,e),Mouse.offsetY(this.canvas,e));this._annotationclicked(t.x,t.y,Mouse.offsetX(this.canvas,e),Mouse.offsetY(this.canvas,e))||globalScriptInterface._fireClick(t.x,t.y)}this._mouseDown=!1,this._moved=!1},onMouseWheel:function(e){var t=e;(t.deltaY?-t.deltaY:t.detail?-1*t.detail:t.wheelDelta)>0?this.zoom(.9):this.zoom(1.1),e.stopPropagation(),e.preventDefault()},onDoubleClick:function(e){WWTControl.showDataLayers=!0},onKeyDown:function(e){null!=this.uiController&&this.uiController.keyDown(this,e)},getDistance:function(e,t){var i,r;return i=e.x-t.x,r=e.y-t.y,Math.sqrt(i*i+r*r)},crossProductZ:function(e,t){return e.x*t.y-e.y*t.x},onContextMenu:function(e){e.preventDefault(),e.stopPropagation()},_tilt:function(e,t){this.renderContext.targetCamera.rotation+=.001*e,this.renderContext.targetCamera.angle+=.001*t,this.renderContext.targetCamera.angle<-1.52&&(this.renderContext.targetCamera.angle=-1.52),this.renderContext.targetCamera.angle>0&&(this.renderContext.targetCamera.angle=0)},getCoordinatesForScreenPoint:function(e,t){var i=Vector2d.create(e,t),r=this.transformPickPointToWorldSpace(i,this.renderContext.width,this.renderContext.height);return Coordinates.cartesianToSphericalSky(r)},transformPickPointToWorldSpace:function(e,t,i){var r=new Vector3d;if(null!=this.renderContext.get_projection()){var n=new Vector3d;n.x=(2*e.x/t-1)/this.renderContext.get_projection().get_m11(),n.y=-(2*e.y/i-1)/this.renderContext.get_projection().get_m22(),n.z=1;var s=Matrix3d.multiplyMatrix(this.renderContext.get_world(),this.renderContext.get_view());s.invert(),r.x=n.x*s.get_m11()+n.y*s.get_m21()+n.z*s.get_m31(),r.y=n.x*s.get_m12()+n.y*s.get_m22()+n.z*s.get_m32(),r.z=n.x*s.get_m13()+n.y*s.get_m23()+n.z*s.get_m33(),r.normalize()}return r},transformWorldPointToPickSpace:function(e,t,i){var r=Matrix3d.multiplyMatrix(this.renderContext.get_world(),this.renderContext.get_view()),n=new Vector2d,s=e.x*r.get_m13()+e.y*r.get_m23()+e.z*r.get_m33(),a=(e.x*r.get_m11()+e.y*r.get_m21()+e.z*r.get_m31())/s,o=-(e.x*r.get_m12()+e.y*r.get_m22()+e.z*r.get_m32())/s;return n.x=Math.round((1+this.renderContext.get_projection().get_m11()*a)*(t/2)),n.y=Math.round((1+this.renderContext.get_projection().get_m22()*o)*(i/2)),n},getScreenPointForCoordinates:function(e,t){var i=Vector2d.create(e,t),r=Coordinates.sphericalSkyToCartesian(i);return this.transformWorldPointToPickSpace(r,this.renderContext.width,this.renderContext.height)},setup:function(e,t,i,r){var n=this;window.addEventListener("contextmenu",ss.ss.bind("onContextMenu",this),!1),document.body.addEventListener("keydown",ss.ss.bind("onKeyDown",this),!1),e.addEventListener("dblclick",ss.ss.bind("onDoubleClick",this),!1),e.addEventListener("mousedown",ss.ss.bind("onMouseDown",this),!1),e.addEventListener("wheel",ss.ss.bind("onMouseWheel",this),!1),e.addEventListener("mousewheel",ss.ss.bind("onMouseWheel",this),!1),e.addEventListener("DOMMouseScroll",ss.ss.bind("onMouseWheel",this),!1),e.addEventListener("touchstart",ss.ss.bind("onTouchStart",this),!1),e.addEventListener("touchmove",ss.ss.bind("onTouchMove",this),!1),e.addEventListener("touchend",ss.ss.bind("onTouchEnd",this),!1),e.addEventListener("gesturechange",ss.ss.bind("onGestureChange",this),!1),e.addEventListener("gesturestart",ss.ss.bind("onGestureStart",this),!1),e.addEventListener("gestureend",ss.ss.bind("onGestureEnd",this),!1),e.addEventListener("pointerdown",ss.ss.bind("onPointerDown",this),!1),e.addEventListener("pointermove",ss.ss.bind("onPointerMove",this),!1),e.addEventListener("pointerup",ss.ss.bind("onPointerUp",this),!1),this.renderContext.viewCamera.lat=t,this.renderContext.viewCamera.lng=i,this.renderContext.viewCamera.zoom=r,this.renderContext.targetCamera=this.renderContext.viewCamera.copy(),null==this.renderContext.gl&&(this._foregroundCanvas=document.createElement("canvas"),this._foregroundCanvas.width=e.width,this._foregroundCanvas.height=e.height,this._fgDevice=this._foregroundCanvas.getContext("2d")),this.freestandingMode?setTimeout((function(){n._setupComplete()}),0):loadWtmlFile(URLHelpers.singleton.coreDynamicUrl("wwtweb/catalog.aspx?X=ImageSets6"),ss.ss.bind("_setupComplete",this),!0)},_setupComplete:function(){globalScriptInterface._fireReady()},gotoRADecZoom:function(e,t,i,r,n,s){this._tracking=!1,this._trackingObject=null,this.gotoTargetFull(!1,r,this._cameraParametersFromRADecZoom(e,t,i,n),globalRenderContext.get_foregroundImageset(),globalRenderContext.get_backgroundImageset(),s)},_cameraParametersFromRADecZoom:function(e,t,i,r){for(;e>24;)e-=24;for(;e<0;)e+=24;t=DoubleUtilities.clamp(t,-90,90),i=DoubleUtilities.clamp(i,this.get_zoomMin(),this.get_zoomMax());var n=null==r?globalRenderContext.viewCamera.rotation:r;return CameraParameters.create(t,globalRenderContext.rAtoViewLng(e),i,n,globalRenderContext.viewCamera.angle,globalRenderContext.viewCamera.opacity)},timeToRADecZoom:function(e,t,i,r){var n=this._cameraParametersFromRADecZoom(e,t,i,r);return this.timeToTargetFull(n,!1)},get_solarSystemMode:function(){return null!=this.renderContext.get_backgroundImageset()&&this.renderContext.get_backgroundImageset().get_dataSetType()==ImageSetType.solarSystem},gotoTarget:function(e,t,i,r,n){if(null!=e){if(r&&this.get_solarSystemMode()&&(536870912===e.get_classification()&&4!==e.get_type()||1===e.get_classification()||1048576===e.get_classification()&&e.get_distance()>0)){var s=65536;if(1===e.get_classification()||1048576===e.get_classification())s=20;else try{s=65536!==e.get_target()?e.get_target():Planets.getPlanetIDFromName(e.get_name())}catch(e){}if(65536!==s){if(this._trackingObject=e,s===this._solarSystemTrack&&1!==e.get_classification()&&1048576!==e.get_classification())return void this.gotoTarget3(e.get_camParams(),t,i,n);var a=4;20===s?a=17:a+=13*(101-Settings.get_active().get_solarSystemScale())/100,i&&(a=1);var o=this.renderContext.viewCamera.copy();o.targetReferenceFrame="",o.target=s;var l=10;if(20===s){l=e.get_classification()===Classification.galaxy?1404946007758:6323967.17;var h=Coordinates.raDecTo3dAu(e.get_RA(),e.get_dec(),e.get_distance()),c=Coordinates.meanObliquityOfEcliptic(SpaceTimeController.get_jNow())/180*Math.PI;h.rotateX(c),o.viewTarget=Vector3d.negate(o.viewTarget)}else{switch(o.viewTarget=Planets.getPlanet3dLocationJD(s,SpaceTimeController.getJNowForFutureTime(a)),s){case 0:l=.6;break;case 1:case 2:case 3:case 8:case 9:case 10:case 11:case 12:case 13:case 19:l=4e-4;break;case 4:case 5:l=.007;break;case 6:case 7:l=.004;break;case 20:l=10}l*=Settings.get_active().get_solarSystemScale()}var u=this.renderContext.viewCamera.copy();20!==this._solarSystemTrack||ss.ss.emptyString(this.renderContext.get_trackingFrame())||(u=this.renderContext.customTrackingParams,this.renderContext.set_trackingFrame("")),o.zoom=l;var d=o.viewTarget;if(d.subtract(u.viewTarget),1===e.get_classification()&&(d=Vector3d.negate(d)),d.length()){var _=d.toRaDec();o.lat=20===s?-_.y:_.y,o.lng=15*_.x-90}else o.lat=this.renderContext.viewCamera.lat,o.lng=this.renderContext.viewCamera.lng;s!==SolarSystemObjects.custom&&(o.viewTarget=Planets.getPlanetTargetPoint(s,o.lat,o.lng,SpaceTimeController.getJNowForFutureTime(a)));var g=new ViewMoverKenBurnsStyle(u,o,n??a,SpaceTimeController.get_now(),SpaceTimeController.getTimeForFutureTime(a),3);return g.fastDirectionMove=!0,void this.set__mover(g)}}this._tracking=!1,this._trackingObject=null;var f=e.get_camParams().copy();null!=this.renderContext.get_backgroundImageset()&&e.get_type()!==this.renderContext.get_backgroundImageset().get_dataSetType()?(this.renderContext.targetCamera=e.get_camParams().copy(),this.renderContext.viewCamera=this.renderContext.targetCamera.copy(),this.renderContext.set_backgroundImageset(this.getDefaultImageset(e.get_type(),3)),i=!0):this.get_solarSystemMode()&&e.get_target()!==this._solarSystemTrack&&(this.renderContext.targetCamera=e.get_camParams().copy(),this.renderContext.viewCamera=this.renderContext.targetCamera.copy(),this._solarSystemTrack=e.get_target(),i=!0),128===e.get_classification()?(f.zoom=this.get_zoomMax(),this.gotoTargetFull(!1,i,f,null,null,n)):(this._solarSystemTrack=e.get_target(),this.gotoTargetFull(t,i,f,e.get_studyImageset(),e.get_backgroundImageset(),n),r&&(this._tracking=!0,this._trackingObject=e))}},gotoTarget3:function(e,t,i,r){this._tracking=!1,this._trackingObject=null,this.gotoTargetFull(t,i,e,this.renderContext.get_foregroundImageset(),this.renderContext.get_backgroundImageset(),r)},_tooCloseForSlewMove:function(e){return Math.abs(this.renderContext.viewCamera.lat-e.lat)<1e-12&&Math.abs(this.renderContext.viewCamera.lng-e.lng)<1e-12&&Math.abs(this.renderContext.viewCamera.zoom-e.zoom)<1e-12&&Math.abs(this.renderContext.viewCamera.rotation-e.rotation)<1e-12},gotoTargetFull:function(e,t,i,r,n,s){if(this._tracking=!1,this._trackingObject=null,this._targetStudyImageset=r,this._targetBackgroundImageset=n,e?(i.zoom=this.renderContext.viewCamera.zoom,i.angle=this.renderContext.viewCamera.angle,i.rotation=this.renderContext.viewCamera.rotation):-1!==i.zoom&&i.zoom||(this.renderContext.space?i.zoom=1.40625:i.zoom=.09),t||this._tooCloseForSlewMove(i)){if(this.set__mover(null),this.renderContext.targetCamera=i.copy(),this.renderContext.viewCamera=this.renderContext.targetCamera.copy(),this.renderContext.space&&Settings.get_active().get_galacticMode()){var a=Coordinates.j2000toGalactic(15*this.renderContext.viewCamera.get_RA(),this.renderContext.viewCamera.get_dec());this.renderContext.targetAlt=this.renderContext.alt=a[1],this.renderContext.targetAz=this.renderContext.az=a[0]}else if(this.renderContext.space&&Settings.get_active().get_localHorizonMode()){var o=Coordinates.equitorialToHorizon(Coordinates.fromRaDec(this.renderContext.viewCamera.get_RA(),this.renderContext.viewCamera.get_dec()),SpaceTimeController.get_location(),SpaceTimeController.get_now());this.renderContext.targetAlt=this.renderContext.alt=o.get_alt(),this.renderContext.targetAz=this.renderContext.az=o.get_az()}this._mover_Midpoint()}else this.set__mover(ViewMoverSlew.create(this.renderContext.viewCamera,i,s)),this.get__mover().set_midpoint(ss.ss.bind("_mover_Midpoint",this))},_slewTimeBetweenTargets:function(e,t){return ViewMoverSlew.create(e,t).get_moveTime()},timeToTargetFull:function(e,t){return t&&(e.zoom=this.renderContext.viewCamera.zoom,e.angle=this.renderContext.viewCamera.angle,e.rotation=this.renderContext.viewCamera.rotation),this._tooCloseForSlewMove(e)?0:this._slewTimeBetweenTargets(globalRenderContext.viewCamera,e)},_freezeView:function(){this.renderContext.viewCamera=this.renderContext.targetCamera.copy(),this.set__mover(null)},get__mover:function(){return this.renderContext.viewMover},set__mover:function(e){return this.renderContext.viewMover=e,e},fadeInImageSet:function(e){null!=this.renderContext.get_backgroundImageset()&&e.get_dataSetType()!==this.renderContext.get_backgroundImageset().get_dataSetType()&&(TileCache.purgeQueue(),TileCache.clearCache()),this.renderContext.set_backgroundImageset(e)},_mover_Midpoint:function(){(null!=this._targetStudyImageset&&null==this.renderContext.get_foregroundImageset()||null!=this.renderContext.get_foregroundImageset()&&!this.renderContext.get_foregroundImageset().equals(this._targetStudyImageset))&&this.renderContext.set_foregroundImageset(this._targetStudyImageset),null==this.renderContext.get_backgroundImageset()||null==this._targetBackgroundImageset||this.renderContext.get_backgroundImageset().equals(this._targetBackgroundImageset)||(null!=this._targetBackgroundImageset&&this._targetBackgroundImageset.get_generic()?this.fadeInImageSet(this._getRealImagesetFromGeneric(this._targetBackgroundImageset)):this.fadeInImageSet(this._targetBackgroundImageset))},getDefaultImageset:function(e,t){for(var i=ss.ss.enumerate(WWTControl.imageSets);i.moveNext();)if((s=i.current).get_defaultSet()&&s.get_bandPass()===t&&s.get_dataSetType()===e)return s;for(var r=ss.ss.enumerate(WWTControl.imageSets);r.moveNext();)if((s=r.current).get_bandPass()===t&&s.get_dataSetType()===e)return s;for(var n=ss.ss.enumerate(WWTControl.imageSets);n.moveNext();){var s;if((s=n.current).get_dataSetType()===e)return s}return WWTControl.imageSets[0]},_getRealImagesetFromGeneric:function(e){for(var t=ss.ss.enumerate(WWTControl.imageSets);t.moveNext();)if((r=t.current).get_defaultSet()&&r.get_bandPass()===e.get_bandPass()&&r.get_dataSetType()===e.get_dataSetType())return r;for(var i=ss.ss.enumerate(WWTControl.imageSets);i.moveNext();){var r;if((r=i.current).get_bandPass()===e.get_bandPass()&&r.get_dataSetType()===e.get_dataSetType())return r}return WWTControl.imageSets[0]},_hideUI:function(e){},createTour:function(e){return ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.stop(!1),this.tour=new TourDocument,this.tour.set_title(e),this.setupTour(),this.tour.set_editMode(!0),this.tour},setupTour:function(){this.tourEdit=new TourEditTab,this.tourEdit.set_tour(this.tour),this.tour.set_currentTourstopIndex(0),this.tour.set_editMode(!1),this.uiController=this.tourEdit.tourEditorUI},loadTour:function(e){var t=this;ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.stop(!1),this.tour=TourDocument.fromUrl(e,(function(){t.setupTour();var e=new TourPlayer;e.set_tour(t.tour),globalWWTControl.uiController=e,globalScriptInterface._fireTourReady()}))},playTour:function(e){var t=this;ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.stop(!1),this.tour=TourDocument.fromUrl(e,(function(){t.setupTour(),t.tourEdit.playNow(!0),globalScriptInterface._fireTourReady()}))},playCurrentTour:function(){ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.play()},pauseCurrentTour:function(){ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.pauseTour()},stopCurrentTour:function(){ss.ss.canCast(this.uiController,TourPlayer)&&this.uiController.stop(!1)},_closeTour:function(){},getImagesetByName:function(e){for(var t=ss.ss.enumerate(WWTControl.imageSets);t.moveNext();){var i=t.current;if(i.get_name().toLowerCase().indexOf(e.toLowerCase())>-1)return i}return null},getImageSetByUrl:function(e){for(var t=ss.ss.enumerate(WWTControl.imageSets);t.moveNext();){var i=t.current;if(i.get_url()===e)return i}return null},setBackgroundImageByName:function(e){var t=this.getImagesetByName(e);null!=t&&this.renderContext.set_backgroundImageset(t)},setForegroundImageByName:function(e){var t=this.getImagesetByName(e);null!=t&&this.renderContext.set_foregroundImageset(t)},addCatalogHips:function(e){this.renderContext.addCatalogHips(e,null)},addCatalogHipsByName:function(e){this.addCatalogHipsByNameWithCallback(e,null)},addCatalogHipsByNameWithCallback:function(e,t){var i=this.getImagesetByName(e);null!=i&&this.renderContext.addCatalogHips(i,t)},removeCatalogHipsByName:function(e){var t=this.getImagesetByName(e);null!=t&&this.renderContext.removeCatalogHips(t)},getCatalogHipsByName:function(e){return this.renderContext.getCatalogHipsByName(e)},getCatalogHipsDataInView:function(e,t,i){var r=this.getImagesetByName(e);null!=r&&this.renderContext.getCatalogHipsDataInView(r,t,i)},setCutsForFits:function(e,t,i){var r=this.getImagesetByName(e);null!=r&&null!=r.get_fitsProperties()?(r.get_fitsProperties().lowerCut=t,r.get_fitsProperties().upperCut=i):console.log(e+" not found")},setColorMapForFits:function(e,t){var i=this.getImagesetByName(e);null!=i&&null!=i.get_fitsProperties()?i.get_fitsProperties().colorMapName=t:console.log(e+" not found")},setScaleTypeForFits:function(e,t){var i=this.getImagesetByName(e);null!=i&&null!=i.get_fitsProperties()?i.get_fitsProperties().scaleType=t:console.log(e+" not found")},_drawCrosshairs:function(e){if(null==e.gl){var t=e.device;t.save(),t.beginPath(),t.strokeStyle=Settings.get_current().get_crosshairsColor(),t.lineWidth=2;var i=e.width/2,r=e.height/2;t.moveTo(i,r+5),t.lineTo(i,r-5),t.moveTo(i+5,r),t.lineTo(i-5,r),t.stroke(),t.restore()}else{if(null==this._crossHairs){var n=.03*e.height/e.width;this._crossHairs=new SimpleLineList,this._crossHairs.set_depthBuffered(!1),this._crossHairs.pure2D=!0,this._crossHairs.addLine(Vector3d.create(-n,0,0),Vector3d.create(n,0,0)),this._crossHairs.addLine(Vector3d.create(0,-.03,0),Vector3d.create(0,.03,0))}this._crossHairs.drawLines(e,1,Color.load(Settings.get_current().get_crosshairsColor()))}},captureThumbnail:function(e){this.captureFrame(e,96,45,"image/jpeg",!0)},captureCurrentFrame:function(e,t,i,r){this.captureFrame(e,t,i,r,!1)},captureFrameForVideo:function(e,t,i,r){var n=this,s=SpaceTimeController.currentFrameNumber;this.captureCurrentFrame((function(t){var i;if(s===n._videoQueueIndex)for(e(t),n._videoQueueIndex+=1;(i=ss.ss.keyExists(n._videoBlobQueue,n._videoQueueIndex))||n._emptyFrames.indexOf(n._videoQueueIndex)>=0;)i?(e(n._videoBlobQueue[n._videoQueueIndex]),n._videoBlobQueue[n._videoQueueIndex]=null):ss.ss.remove(n._emptyFrames,n._videoQueueIndex),n._videoQueueIndex+=1;else null!=t?n._videoBlobQueue[s]=t:n._emptyFrames.push(s);n._videoQueueIndex>=SpaceTimeController.totalFrames&&(n._videoBlobReady=null,n._videoBlobQueue=null,n._videoQueueIndex=0,n._emptyFrames.length=0)}),t,i,r)},captureFrame:function(e,t,i,r,n){n&&this.renderOneFrame();var s=document.createElement("img");s.addEventListener("load",(function(n){var a=s.width/s.height,o=t,l=i;a<t/i?l=ss.ss.truncate(o/a):o=ss.ss.truncate(l*a);var h=(t-o)/2,c=(i-l)/2,u=document.createElement("canvas");if(u.height=i,u.width=t,u.getContext("2d").drawImage(s,h,c,o,l),"function"==typeof u.msToBlob){var d=u.msToBlob();e(d)}else u.toBlob(e,r)}),!1),s.src=globalWWTControl.canvas.toDataURL()},clampZooms:function(e){e.viewCamera.zoom=DoubleUtilities.clamp(e.viewCamera.zoom,this.get_zoomMin(),this.get_zoomMax()),e.targetCamera.zoom=DoubleUtilities.clamp(e.targetCamera.zoom,this.get_zoomMin(),this.get_zoomMax())}};function WWTControlBuilder(e){this._divId=null,this._startRenderLoop=!1,this._startLat=0,this._startLng=0,this._startZoom=360,this._freestandingAssetBaseurl="",this._startMode="",this._divId=e}registerType("WWTControl",[WWTControl,WWTControl$,null]);var WWTControlBuilder$={startRenderLoop:function(e){this._startRenderLoop=e},initialView:function(e,t,i){this._startLat=e,this._startLng=t,this._startZoom=i},freestandingMode:function(e){this._freestandingAssetBaseurl=e},initialMode:function(e){this._startMode=e},create:function(){var e,t=!!this._freestandingAssetBaseurl;return e=this._startMode?this._startMode:t?"black":"sky",set_freestandingMode(t),t&&URLHelpers.singleton.overrideAssetBaseurl(this._freestandingAssetBaseurl),WWTControl.initControl6(this._divId,this._startRenderLoop,this._startLat,this._startLng,this._startZoom,e)}};function WWTElementEvent(e,t){this.offsetX=0,this.offsetY=0,this.offsetX=e,this.offsetY=t}registerType("WWTControlBuilder",[WWTControlBuilder,WWTControlBuilder$,null]);var WWTElementEvent$={};function FolderDownloadAction(e,t){this.loadChildFolders=!1,this._numLoadingFolders=0,this._onComplete=e,this.loadChildFolders=t}registerType("WWTElementEvent",[WWTElementEvent,WWTElementEvent$,null]);var FolderDownloadAction$={_folderLoaded:function(){this._numLoadingFolders--,this._numLoadingFolders||this._onComplete()},startingNewFolderLoad:function(e){var t=this;this._numLoadingFolders++,e.childLoadCallback((function(){Wtml.loadImagesets(e,t),t._folderLoaded()}))}};function Wtml(){}registerType("FolderDownloadAction",[FolderDownloadAction,FolderDownloadAction$,null]),Wtml.getWtmlFile=function(e,t,i){null==i&&(i=!1);var r=new Folder;return r.set_url(e),new FolderDownloadAction(t,i).startingNewFolderLoad(r),r},set_loadWtmlFile(Wtml.getWtmlFile),Wtml.loadImagesets=function(e,t){for(var i=e.get_children(),r=ss.ss.enumerate(i);r.moveNext();){var n=r.current;if(ss.ss.canCast(n,Imageset)){var s=n;WWTControl.addImageSetToRepository(s)}if(ss.ss.canCast(n,Place)){var a=n;null!=a.get_studyImageset()&&WWTControl.addImageSetToRepository(a.get_studyImageset()),null!=a.get_backgroundImageset()&&WWTControl.addImageSetToRepository(a.get_backgroundImageset())}ss.ss.canCast(n,Folder)&&t.loadChildFolders&&t.startingNewFolderLoad(n)}if(!ss.ss.emptyString(WWTControl.imageSetName))for(var o=WWTControl.imageSetName.toLowerCase(),l=ss.ss.enumerate(WWTControl.getImageSets());l.moveNext();){var h=l.current;h.get_name().toLowerCase()===o&&globalRenderContext.set_backgroundImageset(h)}};var Wtml$={};function GFX(){}return registerType("Wtml",[Wtml,Wtml$,null]),registerType("GFX",[GFX,null,null]),WWTControl.exploreRoot=new Folder,WWTControl.singleton=new WWTControl,WWTControl.singleton.renderContext=new RenderContext,set_globalWWTControl(WWTControl.singleton),set_globalRenderContext(WWTControl.singleton.renderContext),SpaceTimeController._metaNow=ss.ss.now(),SpaceTimeController._now=ss.ss.now(),SpaceTimeController.last=SpaceTimeController.get_metaNow(),SpaceTimeController.updateClock(),KeplerVertex.baseDate=ss.ss.truncate(SpaceTimeController.utcToJulian(ss.ss.now())),__webpack_exports__})()));